var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,n=(e,t)=>{for(var s in t||(t={}))o.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&r(e,s,t[s]);return e},l=(e,a)=>t(e,s(a)),c=(e,t)=>{var s={};for(var r in e)o.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&i.call(e,r)&&(s[r]=e[r]);return s},d=(e,t,s)=>r(e,"symbol"!=typeof t?t+"":t,s),h=(e,t,s)=>new Promise((a,o)=>{var i=e=>{try{n(s.next(e))}catch(t){o(t)}},r=e=>{try{n(s.throw(e))}catch(t){o(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);n((s=s.apply(e,t)).next())});import{r as p,j as u,R as g,A as m,$ as f,F as y,a as C,b as w,B as b,S as v,d as S,e as N}from"./react-vendor-CBOOgHiz.js";import{a as D,E as P,F as j,u as R,w as A,b as T,r as I}from"./utils-vendor-C0yv2UKq.js";import{M,y as k}from"./ag-grid-core-PjvV4iYJ.js";import{h as L,j as E,W as F,k as O}from"./vendor-CRQPd8Pd.js";/* empty css                           */!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class $ extends p.Component{constructor(e){super(e),d(this,"handleSelection",e=>{this.setState({selectedLocation:e})}),d(this,"componentDidMount",()=>h(this,null,function*(){"no-activity"===this.props.type&&(console.log("Start CountDown"),this.startCountdown()),"update-access-right"===this.props.type&&(console.log("Update Access Right",this.props.message),this.setState({message4:this.props.message},()=>{console.log("Updated message4 state:",this.state.message4)})),"edit"===this.props.type&&(console.log("Edit",this.props.message),console.log("Participants Details:",this.props.message.participant),this.props.message&&this.props.message.participant?this.setState({participant:{id:this.props.message._id||"",name:this.props.message.participant.name||"",nric:this.props.message.participant.nric||"",residentialStatus:this.props.message.participant.residentialStatus||"",race:this.props.message.participant.race||"",gender:this.props.message.participant.gender||"",contactNumber:this.props.message.participant.contactNumber||"",email:this.props.message.participant.email||"",postalCode:this.props.message.participant.postalCode||"",educationLevel:this.props.message.participant.educationLevel||"",workStatus:this.props.message.participant.workStatus||""},showEditMessage:!0},()=>{console.log("Updated participant state:",this.state.participant)}):console.error("Participant data is missing in message."))})),d(this,"startCountdown",()=>{this.countdownInterval=setInterval(()=>{this.setState(e=>e.countdown<=1?(clearInterval(this.countdownInterval),this.props.goBackLoginPage(),{countdown:0}):(console.log(e.countdown),{countdown:e.countdown-1}))},1e3)}),d(this,"validatePassword",e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(e)),d(this,"changePassword",e=>h(this,null,function*(){e.preventDefault();const{newPassword:t,confirmPassword:s}=this.state,{accountId:a}=this.props;let o=!0;if(this.validatePassword(t)||(this.setState({newPasswordError:"Password must be at least 8 characters long and include uppercase, lowercase, number, and special character"}),o=!1),""===s?(this.setState({confirmPasswordError:"Confirm Password cannot be empty"}),o=!1):t!==s&&(this.setState({confirmPasswordError:"Passwords do not match"}),o=!1),o&&o){var i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/login",{purpose:"changePassword",accountId:a,newPassword:t});i.data.success,this.props.passPopupMessage(i.data.success,i.data.message)}})),d(this,"handlePasswordChange",e=>{const{value:t}=e.target;this.setState({newPassword:t}),this.validatePassword(t)?this.setState({newPasswordError:""}):this.setState({newPasswordError:"Password must be at least 8 characters long and include uppercase, lowercase, number, and special character"})}),d(this,"clickPasswordChange",()=>{this.setState({newPasswordError:""})}),d(this,"clickConfirmPasswordChange",()=>{this.setState({confirmPasswordError:""})}),d(this,"handleConfirmPasswordChange",e=>{const{value:t}=e.target;this.setState({confirmPassword:t}),t===this.state.newPassword&&this.setState({confirmPasswordError:""})}),d(this,"toggleNewPasswordVisibility",()=>{this.setState(e=>({showNewPassword:!e.showNewPassword}))}),d(this,"handleDelete",e=>h(this,null,function*(){console.log("Registration Id1:",e),D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"delete",id:e}).then(e=>{console.log("Deleted Participants:",e),this.props.closePopupMessage(),this.props.closePopup3()}).catch(e=>{console.error("Error submitting form:",e)})})),d(this,"handleSendOver",e=>h(this,null,function*(){D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"sendDetails",id:e}).then(e=>{this.props.closePopupMessage(),this.props.closePopup4()}).catch(e=>{console.error("Error submitting form:",e)})})),d(this,"updateWooCommerceForPortOver",(e,t,s,a)=>h(this,null,function*(){console.log("Update Port Over Woocommerce",e,t,s,a);try{if("Paid"===a||"SkillsFuture Done"===a||"Cancelled"===a||"Confirmed"===a){const o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/update_stock/",{type:"update",page:{courseChiName:e,courseEngName:t,courseLocation:s},status:a,location:s});console.log("WooCommerce stock update response:",o.data),!0===o.data.success?console.log("Stock updated successfully."):console.error("Error updating WooCommerce stock:",o.data)}else console.log("No update needed for the given status.")}catch(o){console.error("Error during the update process:",o)}})),d(this,"updateWooCommerceForUpdate",(e,t,s,a)=>h(this,null,function*(){console.log("Update Port Over +1",e,t,s,a);try{if("Paid"===a||"SkillsFuture Done"===a){const o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/port_over/",{type:"update",page:{courseChiName:e,courseEngName:t,courseLocation:s},status:a,location:s});console.log("WooCommerce stock update response:",o.data),!0===o.data.success?console.log("Stock updated successfully."):console.error("Error updating WooCommerce stock:",o.data)}else console.log("No update needed for the given status.")}catch(o){console.error("Error during the update process:",o)}})),d(this,"handlePortOver",(e,t,s,a,o)=>h(this,null,function*(){try{console.log("Registration Id1:",e,t,s,a);const{selectedLocation:o}=this.state,i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"portOver",id:e,selectedLocation:o});console.log("PortOver Participants:",i),!0===i.data.result&&(yield this.updateWooCommerceForUpdate(s.courseChiName,s.courseEngName,o,a),yield this.updateWooCommerceForUpdate(s.courseChiName,s.courseEngName,s.courseLocation,a),yield this.receiptGenerator(e,t,s,o,s.payment,a),this.props.closePopupMessage(),this.props.closePopup5())}catch(o){console.error("Error submitting form:",o)}})),d(this,"generatePDFReceipt",(e,t,s,a,o)=>h(this,null,function*(){console.log("Parameters:",e,t,s,a,o);try{const s=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"addReceiptNumber",id:e,participant:t,staff:this.props.userName,receiptNo:a,status:o});return console.log("generatePDFReceipt:",s),s}catch(i){throw console.error("Error generating PDF receipt:",i),i}})),d(this,"createReceiptInDatabase",(e,t,s,a,o)=>h(this,null,function*(){try{console.log("Creating receipt in database:",{receiptNo:e,participant:t,location:s,registration_id:a,url:o},this.props);const i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/receipt",{purpose:"createReceipt",receiptNo:e,location:s,registration_id:a,url:o,staff:this.props.userName});console.log("createReceiptInDatabase",i)}catch(i){throw console.error("Error creating receipt in database:",i),i}})),d(this,"generateReceiptNumber",(e,t,s)=>h(this,null,function*(){var e,a;const o="SkillsFuture"===s?"ECSS/SFC/":t;console.log("Course Location111:",o);const i=t;console.log("Centre Location111:",i);try{const t=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/receipt",{purpose:"getReceiptNo",courseLocation:o,centreLocation:i});if(console.log("Receipt Response1:",t),null==(a=null==(e=null==t?void 0:t.data)?void 0:e.result)?void 0:a.success)return console.log("Fetched receipt number:",t.data.result.receiptNumber),t.data.result.receiptNumber;throw new Error("Failed to fetch receipt number from response")}catch(r){throw console.error("Error fetching receipt number:",r),r}})),d(this,"receiptGenerator",(e,t,s,a,o,i)=>h(this,null,function*(){if(console.log("Selected Parameters auto:",{id:e,participant:t,course:s,newMethod:o,value:i}),"Cash"===o||"PayNow"===o){if("Paid"===i)try{console.log(`${i} For This Course:`,s);const r=yield this.generateReceiptNumber(s,a,o);console.log("Receipt No:",r),yield this.generatePDFReceipt(e,t,s,r,i),yield this.createReceiptInDatabase(r,t,s,e,"")}catch(r){console.error("Error during receipt generation:",r)}}else if("SkillsFuture"===o)try{console.log("Generating receipt for course:",s);const a=yield this.generateReceiptNumber(s,o);console.log("Invoice No:",a),yield this.generatePDFReceipt(e,t,s,a,i),yield this.createReceiptInDatabase(a,s.courseLocation,e,"")}catch(r){console.error("Error during receipt generation:",r)}})),d(this,"toggleConfirmPasswordVisibility",()=>{this.setState(e=>({showConfirmPassword:!e.showConfirmPassword}))}),d(this,"cancel",()=>h(this,null,function*(){this.props.closePopup()})),d(this,"cancel1",()=>h(this,null,function*(){this.props.closePopup(),this.setState({countdown:10})})),d(this,"handleProceedManually",()=>{this.props.onProceedManually&&this.props.onProceedManually(),this.props.closePopup()}),d(this,"goBackHome",()=>h(this,null,function*(){this.props.goBackLoginPage()})),d(this,"enterUsername",e=>{const{name:t,value:s}=e.target;console.log(t,s),this.setState({[t]:s})}),d(this,"handleSendPassword",e=>h(this,null,function*(){console.log("Handle Password"),e.preventDefault();const{username:t,newPassword1:s}=this.state;let a=!0;if(t||(this.setState({error:"Please enter your username."}),a=!1),s||(this.setState({newPasswordError1:"Password must be at least 8 characters long and include uppercase, lowercase, number, and special character"}),a=!1),this.validatePassword(s)||(this.setState({newPasswordError1:"Password must be at least 8 characters long and include uppercase, lowercase, number, and special character"}),a=!1),!0===a){var o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/login",{purpose:"resetPassword",username:t,password:s});console.log(o),!0===o.data.success?this.props.passPopupMessage(o.data.success,"Reset Password Successfully"):this.props.passPopupMessage(o.data.success,"Reset Password Failure")}})),d(this,"manageAccountInfo",e=>h(this,null,function*(){if("Delete"===e){console.log("Delete Account");var t=this.props.message,s=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"http://ecss-backend-node.azurewebsites.net")+"/accountDetails",{purpose:"deleteAccount",accountId:t});!0===s.data.success?this.props.closePopupMessage(s.data.success,"Delete Account Successfully"):this.props.closePopupMessage(s.data.success,"DeleteAccount Failure")}})),d(this,"handleCheckboxChange",(e,t)=>{var{message4:s}=this.state;const a=s[e][t];console.log("Main Key:",e),console.log("Sub Key:",t),console.log("Current Value:",a);const o=l(n({},s),{[e]:l(n({},s[e]),{[t]:!a})});this.setState({message4:o})}),d(this,"updateAccessRight",()=>h(this,null,function*(){var e=this.state.message4;console.log("Access Rights:",e);var t=e.id,s=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accessRights",{purpose:"updateAccessRight",accessRight:e,accessRightId:t});!0===s.data.success?this.props.closePopupMessage(s.data.success,"Update Access Rights Successfully"):this.props.closePopupMessage(s.data.success,"Update Access Rights Failure")})),d(this,"handleInputChange",(e,t)=>{const{value:s}=e.target;this.setState(e=>({participant:l(n({},e.participant),{[t]:s})}))}),d(this,"handleSubmitEdit",e=>h(this,null,function*(){e.preventDefault();const{participant:t}=this.state;let s=n({},this.state.errors);t.name?s.name="":s.name="Name is required.",t.nric?s.nric="":s.nric="NRIC is required.",t.contactNumber?s.contactNumber="":s.contactNumber="Contact Number is required.",t.email?s.email="":s.email="Email is required.",t.address?s.address="":s.address="Address is required.",this.setState({errors:s});if(Object.values(s).some(e=>""!==e))console.error("Validation Errors:",s);else{console.log("Updated Details:",t);try{const e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updateEntry",entry:t});!0===e.data.result?(console.log("Successfully updated participant."),this.props.closePopup2()):console.error("Backend validation error:",e.data.message)}catch(a){console.error("Error submitting form:",a),alert("An error occurred while submitting the form. Please try again.")}}})),this.state={newPassword:"",newPassword1:"",confirmPassword:"",newPasswordError:"",confirmPasswordError:"",formErrorMessage:"",showNewPassword:!1,showConfirmPassword:!1,username:"",message:"",error:"",password:"",countdown:10,checked:!0,message4:null,selectedLocation:"",participant:{id:"",name:"",nric:"",residentalStatus:"",race:"",gender:"",contactNumber:"",email:"",postalCode:"",educationLevel:"",workStatus:""},errors:{name:"",nric:"",contactNumber:"",email:"",postalCode:""},showEditMessage:!1},this.countdownInterval=null}componentDidUpdate(e){this.props.type!==e.type&&(console.log("Type prop changed. Current type:",this.props.type),"no-activity"===this.props.type?(console.log("Restart CountDown"),this.startCountdown()):"update-access-right"===this.props.type&&this.props.message!==e.message?(console.log("Update Access Right",this.props.message),this.setState({message4:this.props.message},()=>{console.log("Updated message4 state:",this.state.message4)})):(clearInterval(this.countdownInterval),console.log("Countdown cleared due to type change"))),"edit"===this.props.type&&this.props.message!==e.message&&(console.log("Edit",this.props.message),console.log("Participants Details:",this.props.message.participant),this.props.message&&this.props.message.participant?this.setState({participant:{id:this.props.message._id||"",name:this.props.message.participant.name||"",nric:this.props.message.participant.nric||"",residentialStatus:this.props.message.participant.residentialStatus||"",race:this.props.message.participant.race||"",gender:this.props.message.participant.gender||"",contactNumber:this.props.message.participant.contactNumber||"",email:this.props.message.participant.email||"",postalCode:this.props.message.participant.postalCode||"",educationLevel:this.props.message.participant.educationLevel||"",workStatus:this.props.message.participant.workStatus||""},showEditMessage:!0},()=>{console.log("Updated participant state:",this.state.participant)}):console.error("Participant data is missing in the message."))}componentWillUnmount(){clearInterval(this.countdownInterval),this.setState({countdown:10})}render(){const{message:e,isOpen:t,onClose:s,type:a}=this.props,{newPassword:o,newPassword1:i,confirmPassword:r,newPasswordError:n,newPasswordError1:l,confirmPasswordError:c,formErrorMessage:d,showNewPassword:h,showConfirmPassword:p,username:g,message1:m,error:f,countdown:y,message4:C,participant:w,showEditMessage:b,selectedLocation:x}=this.state;if(!t)return null;const v=`popup-content ${a}`;return u.jsx("div",{className:"popup-overlay",onClick:s,children:u.jsx("div",{className:v,onClick:e=>e.stopPropagation(),children:"loading"===a?u.jsxs("div",{className:"loading-popup",children:[u.jsx("h2",{children:e}),u.jsxs("div",{className:"bouncing-circles",children:[u.jsx("div",{className:"circle"}),u.jsx("div",{className:"circle"}),u.jsx("div",{className:"circle"}),u.jsx("div",{className:"circle"})]})]}):"success-message"===a?u.jsxs("div",{className:"success-message",children:[u.jsx("img",{src:"https://ecss.org.sg/wp-content/uploads/2024/10/iqbf2fomkl6f65us70kdcann90.png"}),u.jsx("h2",{className:"success-title",children:"Success!"}),u.jsx("p",{children:e})]}):"error-message"===a?u.jsxs("div",{className:"error-message",children:[u.jsx("img",{src:"https://ecss.org.sg/wp-content/uploads/2024/10/error-10376-2.png"}),u.jsx("h2",{className:"error-title",children:"Error!"}),u.jsx("p",{children:e})]}):"change-password"===a?u.jsx("div",{className:"change-password-message",children:u.jsxs("form",{onSubmit:this.changePassword,children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"new-password",children:"New Password"}),u.jsxs("div",{className:"password-input-container",children:[u.jsx("input",{type:h?"text":"password",id:"new-password",name:"newPassword",value:o,onChange:this.handlePasswordChange,onClick:this.clickPasswordChange}),u.jsx("i",{className:`fa ${h?"fa-eye-slash":"fa-eye"} password-toggle-icon`,onClick:this.toggleNewPasswordVisibility})]}),n&&u.jsx("p",{className:"error-message1",children:n})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),u.jsxs("div",{className:"password-input-container",children:[u.jsx("input",{type:p?"text":"password",id:"confirm-password",name:"confirmPassword",value:r,onChange:this.handleConfirmPasswordChange,onClick:this.clickConfirmPasswordChange}),u.jsx("i",{className:`fa ${p?"fa-eye-slash":"fa-eye"} password-toggle-icon`,onClick:this.toggleConfirmPasswordVisibility})]}),c&&u.jsx("p",{className:"error-message1",children:c})]}),d&&u.jsx("p",{className:"error-message1",children:d}),u.jsx("button",{type:"submit",className:"submit-btn",children:"Change Password"})]})}):"forgot-password"===a?u.jsxs("div",{className:"forgot-password-message",children:[u.jsx("h2",{style:{color:"#000000"},children:"Forgot Password"}),u.jsxs("form",{onSubmit:this.handleSendPassword,className:"forgot-password-form",children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"username",children:"Username:"}),u.jsx("input",{type:"text",id:"username",name:"username",value:g,onChange:this.enterUsername})]}),f&&u.jsx("div",{className:"error-message2",children:f}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"password1",children:"Password:"}),u.jsxs("div",{className:"password-input-container",children:[u.jsx("input",{type:h?"text":"password",id:"new-password1",name:"newPassword1",value:i,onChange:this.enterUsername}),u.jsx("i",{className:`fa ${h?"fa-eye-slash":"fa-eye"} password-toggle-icon`,onClick:this.toggleNewPasswordVisibility})]}),l&&u.jsx("p",{className:"error-message2",children:l})]}),m&&u.jsx("div",{className:"success-message",children:m}),u.jsx("br",{}),u.jsx("button",{type:"submit",className:"submit-button",children:"Submit"})]})]}):"logout"===a?u.jsxs("div",{className:"logout-message",children:[u.jsx("h2",{className:"logout-title",children:"Logout"}),u.jsx("p",{children:e}),u.jsxs("div",{className:"button-container1",children:[u.jsx("button",{onClick:this.cancel,children:"No"}),u.jsx("button",{onClick:this.goBackHome,children:"Yes"})]})]}):"no-activity"===a?u.jsxs("div",{className:"no-activity-message",children:[u.jsx("h2",{className:"no-activity-title",children:"No Activity"}),u.jsx("p",{children:"You have been inactive for a while"}),u.jsxs("h3",{children:["Returning to Login Page: ",`00:${y.toString().padStart(2,"0")}`]}),u.jsx("div",{className:"button-container1",children:u.jsx("button",{onClick:this.cancel1,children:"Cancel"})})]}):"edit-account"===a?u.jsxs("div",{className:"edit-account-message",children:[u.jsx("button",{className:"close-button12",onClick:this.cancel,children:"×"}),u.jsx("h2",{className:"edit-account-title",children:"Account"}),u.jsx("p",{children:"Click on the button below:"}),u.jsx("div",{className:"button-container2",children:u.jsx("button",{onClick:()=>this.manageAccountInfo("Delete"),children:"Delete Account"})})]}):"update-access-right"===a&&C&&Object.keys(C).length>0?u.jsxs("div",{className:"access-right-message",children:[u.jsx("h2",{className:"access-right-title",children:"Update Access Rights"}),Object.keys(C).filter(e=>"id"!==e&&"accType"!==e&&"name"!==e&&"sn"!==e).map(e=>{console.log("Main Key:",e);const t="accounts"===e?"Account":"regPay"===e?"Registration And Payment":"qRCode"===e?"QR Code":"courses"===e?"Courses":"attendance"===e?"Attendances":"reports"===e?"Reports":"membership"===e?"Membership":e;return u.jsxs("div",{className:"main-key",children:[u.jsx("h3",{children:t}),u.jsx("div",{className:"sub-keys",children:u.jsx("div",{className:"checkbox-container",children:Object.keys(C[e]).filter(e=>"Account ID"!==e).map(t=>{const s=C[e][t];return u.jsx("div",{className:"checkbox-box",children:u.jsxs("label",{className:"checkbox-label",children:["boolean"==typeof s?u.jsx("input",{type:"checkbox",checked:s,onChange:()=>this.handleCheckboxChange(e,t)}):null,u.jsxs("strong",{children:[t,"boolean"==typeof s?" ":": "]})," ","string"==typeof s?s:""]})},t)})})})]},t)}),u.jsxs("div",{className:"button-container1",children:[u.jsx("button",{onClick:this.cancel,children:"Cancel"}),u.jsx("button",{onClick:()=>this.updateAccessRight(),children:"Update"})]})]}):"edit"===a?u.jsx("div",{className:"edit-message",children:u.jsx("p",{children:e})}):"sendOver"===a?u.jsxs("div",{className:"confirmation-message",children:[u.jsx("p",{children:e}),u.jsxs("div",{className:"confirmation-buttons",children:[u.jsx("button",{onClick:()=>this.handleSendOver(this.props.id),className:"confirm-btn",children:"Confirm"}),u.jsx("button",{onClick:this.cancel,className:"cancel-btn",children:"Cancel"})]})]}):"delete"===a?u.jsxs("div",{className:"confirmation-message",children:[u.jsx("p",{children:e}),u.jsxs("div",{className:"confirmation-buttons",children:[u.jsx("button",{onClick:()=>this.handleDelete(this.props.id),className:"confirm-btn",children:"Confirm"}),u.jsx("button",{onClick:this.cancel,className:"cancel-btn",children:"Cancel"})]})]}):"portOver"===a?u.jsxs("div",{className:"confirmation-message",children:[u.jsx("p",{children:e}),u.jsxs("select",{value:x,onChange:e=>this.handleSelection(e.target.value),style:{cursor:"pointer",padding:"5px",background:"#000000",color:"#FFFFFF",fontWeight:"bold",width:"100%",borderRadius:"5px",marginBottom:"20px"},children:[u.jsx("option",{value:"",disabled:!0,children:"Select a location"}),["Tampines 253 Centre","Pasir Ris West Wellness Centre","Tampines North Community Centre","CT Hub"].map(e=>u.jsx("option",{value:e,style:{color:"#FFFFFF"},children:e},e))]}),u.jsxs("div",{className:"confirmation-buttons",children:[u.jsx("button",{onClick:()=>this.handlePortOver(this.props.id,this.props.participantInfo,this.props.courseInfo,this.props.status),className:"confirm-btn",children:"Confirm"}),u.jsx("button",{onClick:this.cancel,className:"cancel-btn",children:"Cancel"})]})]}):"myinfo-error"===a?u.jsxs("div",{className:"myinfo-error-message",children:[u.jsxs("div",{className:"myinfo-modal-header",children:[u.jsx("div",{className:"myinfo-error-icon",children:"⚠️"}),u.jsx("h2",{className:"myinfo-modal-title",children:"MyInfo Unavailable"})]}),u.jsxs("div",{className:"myinfo-modal-message",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Error:"})," ",e]}),u.jsx("p",{children:"MyInfo service is currently experiencing issues. This could be due to:"}),u.jsxs("ul",{style:{textAlign:"left",paddingLeft:"20px"},children:[u.jsx("li",{children:"Network connectivity problems"}),u.jsx("li",{children:"MyInfo service maintenance"}),u.jsx("li",{children:"Authentication or session timeout"})]}),u.jsxs("p",{children:[u.jsx("strong",{children:"✅ No worries!"})," You can still proceed to fill in the form manually with your personal information."]})]}),u.jsxs("div",{className:"myinfo-modal-buttons",children:[u.jsx("button",{className:"myinfo-modal-button primary",onClick:()=>this.handleProceedManually(),children:"Proceed Manually"}),u.jsx("button",{className:"myinfo-modal-button secondary",onClick:this.cancel,children:"Try Again Later"})]})]}):u.jsx(u.Fragment,{})})})}}const U=p.createContext();class B extends p.Component{constructor(e){super(e),d(this,"login",()=>{this.setState({isAuthenticated:!0},()=>{localStorage.setItem("isAuthenticated","true")})}),d(this,"logout",()=>{this.setState({isAuthenticated:!1},()=>{localStorage.removeItem("isAuthenticated")})});const t="true"===localStorage.getItem("isAuthenticated");this.state={isAuthenticated:t}}render(){const{children:e}=this.props,{isAuthenticated:t}=this.state;return u.jsx(U.Provider,{value:{isAuthenticated:t,login:this.login,logout:this.logout},children:e})}}const _=e=>function(t){return u.jsx(U.Consumer,{children:s=>u.jsx(e,l(n({},t),{auth:s}))})};class V extends p.Component{constructor(e){super(e),d(this,"toggleLanguage",()=>{this.setState(e=>{const t="en"===e.language?"zh":"en";return{language:t,emailError:this.validateEmail(e.email,t),passwordError:this.validatePassword(e.password,t)}})}),d(this,"handleChange",e=>{this.setState({[e.target.name]:e.target.value})}),d(this,"togglePasswordVisibility",()=>{this.setState(e=>({showPassword:!e.showPassword}))}),d(this,"validateEmail",e=>e?"":"en"===this.state.language?"Email cannot be empty.":"电子邮件不能为空。"),d(this,"validatePassword",e=>e?"":"en"===this.state.language?"Password cannot be empty.":"密码不能为空。"),d(this,"handleSubmit",e=>h(this,null,function*(){var t,s;e.preventDefault();var{email:a,password:o}=this.state;const{auth:i}=this.props;a=a.toLowerCase();const r=this.validateEmail(a),n=this.validatePassword(o);if(r||n)this.setState({emailError:r,passwordError:n});else{this.setState({emailError:"",passwordError:""});try{const e=D.create({baseURL:"localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net",timeout:5e3,headers:{"Content-Type":"application/json"}}),[r]=yield D.all([e.post("/login",{email:a,password:o})]),n=null==(s=null==(t=null==r?void 0:r.data)?void 0:t.message)?void 0:s.message;console.log("Login Response:",n),"Login successful"===n?(i.login(),this.setState({isPopupOpen:!0,popupMessage:r.data.message.message,popupType:"success-message"}),setTimeout(()=>{if(this.setState({isPopupOpen:!1}),"Yes"===r.data.message.details.first_time_log_in)this.setState({isPopupOpen:!0,popupMessage:r.data.message.message,popupType:"change-password",accountId:r.data.message.details._id,name:r.data.message.details.name});else{this.setState({isPopupOpen:!1,popupMessage:"",popupType:"",accountId:"",name:""});const e=r.data.message.details.site,t=e&&e.includes(",")?e.split(",").map(e=>e.trim()):e;this.props.history.push({pathname:"/home",state:{accountId:r.data.message.details._id,name:r.data.message.details.name,role:r.data.message.details.role,siteIC:t}})}},5e3)):(this.setState({isPopupOpen:!0,popupMessage:"Login Failure",popupType:"error-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1,name:"",password:"",role:""})},5e3))}catch(l){this.setState({isPopupOpen:!0,popupMessage:"An error occurred. Please try again later.",popupType:"error-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1,name:"",password:"",role:""})},5e3)}}})),d(this,"resetPassword",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"",popupType:"forgot-password"})})),d(this,"passPopupMessage",(e,t)=>{!0===e?(this.setState({isPopupOpen:!0,popupMessage:t,popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1}),this.props.history.push({pathname:"/home",state:{accountId:this.state.accountId,name:this.state.name}})},5e3)):(this.setState({isPopupOpen:!0,popupMessage:t,popupType:"error-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1,name:"",email:"",password:"",role:""})},5e3))}),this.state={language:"en",email:"",password:"",emailError:"",passwordError:"",showPassword:!1,isPopupOpen:!1,popupMessage:"",popupType:"",accountId:null}}componentDidMount(){localStorage.clear()}render(){const{language:e,emailError:t,passwordError:s,showPassword:a,isPopupOpen:o,popupMessage:i,popupType:r,accountId:n}=this.state,l=u.jsxs(u.Fragment,{children:["En Community Services Society",u.jsx("br",{}),"Courses Management System"]}),c=u.jsxs(u.Fragment,{children:["© 2024 En Community Service Society Courses Management System.",u.jsx("br",{}),"All rights reserved."]});return u.jsxs("div",{class:"container",children:[u.jsx("div",{class:"header",children:u.jsx("div",{class:"language-toggle",children:u.jsx("button",{onClick:this.toggleLanguage,children:"en"===e?"中文":"English"})})}),u.jsxs("div",{class:"login-main-content",children:[u.jsxs("div",{class:"left-section",children:[u.jsxs("div",{class:"title-and-image",children:[u.jsx("img",{src:"https://ecss.org.sg/wp-content/uploads/2023/07/En_logo_Final_Large_RGB.png",alt:"Logo",class:"title-image"}),u.jsx("h1",{class:"title",children:l})]}),u.jsx("h2",{children:"Login"}),u.jsxs("form",{class:"login-form",onSubmit:this.handleSubmit,children:[u.jsx("label",{htmlFor:"email",children:"en"===e?"Email:":"电子邮件："}),u.jsx("input",{type:"text",id:"email",name:"email",className:"emailInput",value:this.state.email,onChange:this.handleChange,placeholder:"en"===e?"Enter your email":"请输入电子邮件..."}),t&&u.jsx("small",{class:"error-message1",children:t}),u.jsx("label",{htmlFor:"password",children:"en"===e?"Password:":"密码："}),u.jsxs("div",{className:"password-container",children:[u.jsx("input",{type:a?"text":"password",id:"password",name:"password",value:this.state.password,onChange:this.handleChange,placeholder:"en"===e?"Enter your password":"请输入密码..."}),u.jsx("i",{className:"fa "+(a?"fa-eye":"fa-eye-slash"),onClick:this.togglePasswordVisibility})]}),s&&u.jsx("small",{class:"error-message1",children:s}),u.jsx("a",{style:{fontWeight:"bold",color:"blue",fontSize:"0.75em",textDecoration:"underline",cursor:"pointer"},onClick:this.resetPassword,children:"Reset password"}),u.jsx("button",{type:"submit",children:"en"===e?"Login":"登录"})]}),u.jsx("p",{class:"copyright",children:c})]}),u.jsx("div",{class:"right-section",children:u.jsx("div",{class:"right-section-content",children:u.jsx("img",{src:"https://ecss.org.sg/wp-content/uploads/2024/09/Untitled_design-removebg-preview.png",alt:"Description",class:"description-image"})})})]}),u.jsx($,{isOpen:o,message:i,type:r,accountId:n,passPopupMessage:this.passPopupMessage})]})}}const z=_(V);class W extends p.Component{constructor(e){super(e),d(this,"handleClickOutside",e=>{this.dropdownRef&&!this.dropdownRef.contains(e.target)&&this.setState({showDropdown:!1})}),d(this,"handleChange",e=>{const{name:t,value:s}=e.target;this.setState({[t]:s},()=>{this.validateField(t,s)})}),d(this,"handleRoleInputChange",e=>{const t=e.target.value;this.setState({role:t,showDropdown:!0});const s=this.state.roleOptions.filter(e=>e.toLowerCase().includes(t.toLowerCase()));this.setState({filteredRoles:s})}),d(this,"selectRole",e=>{this.setState({role:e,filteredRoles:[],showDropdown:!1},()=>{this.validateField("role",e)})}),d(this,"generateRandomPassword",()=>{const e="abcdefghijklmnopqrstuvwxyz",t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="0123456789",a="!@#$%^&*()_+[]{}|;:,.<>?",o=[e[Math.floor(26*Math.random())],t[Math.floor(26*Math.random())],s[Math.floor(10*Math.random())],a[Math.floor(24*Math.random())]],i=e+t+s+a;for(let n=o.length;n<8;n++)o.push(i[Math.floor(86*Math.random())]);const r=o.sort(()=>Math.random()-.5).join("");this.setState({password:r},()=>{this.validateField("password",r)})}),d(this,"togglePasswordVisibility",()=>{this.setState(e=>({passwordVisible:!e.passwordVisible}))}),d(this,"showDropdownList",()=>{this.setState({filteredRoles:this.state.roleOptions,showDropdown:!0})}),d(this,"clearForm",()=>{this.setState({name:"",email:"",password:"",role:""})}),d(this,"isValidEmail",e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)),d(this,"handleSubmit",e=>{e.preventDefault();const{name:t,email:s,password:a,role:o}=this.state;let i=!0,r="",n="",l="",c="";if(t||(r="Name is required.",i=!1),s?this.isValidEmail(s)||(n="Email is invalid",i=!1):(n="Email is required.",i=!1),a||(l="Password is required.",i=!1),o?"Admin"!==o&&"Sub Admin"!==o&&(c="Role must be Admin or Sub Admin",i=!1):(c="Role is required.",i=!1),i){this.setState({nameError:"",emailError:"",passwordError:"",roleError:""});var d={name:t,email:s,password:a,role:o};D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accountDetails",{accountDetails:d,purpose:"create"}).then(e=>{"New account with respectively access rights created successfully"===e.data.message&&(this.setState({isPopupOpen:!0,popupMessage:e.data.message,popupType:"success-message"}),setTimeout(()=>this.setState({isPopupOpen:!1,name:"",email:"",password:"",role:""}),5e3))}).catch(e=>console.error("Error submitting form:",e))}else this.setState({nameError:r,emailError:n,passwordError:l,roleError:c})}),this.state={name:"",email:"",password:"",role:"",roleOptions:["Admin","Sub Admin"],filteredRoles:[],showDropdown:!1,message:"",error:!1,passwordVisible:!1,nameError:"",emailError:"",passwordError:"",roleError:"",isPopupOpen:!1,popupMessage:"",popupType:""}}componentDidMount(){document.addEventListener("click",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}validateField(e,t){let{nameError:s,emailError:a,passwordError:o,roleError:i}=this.state;switch(console.log(e),e){case"name":s=t?"":"Name is required.";break;case"email":a=t?this.isValidEmail(t)?"":"Email is invalid.":"Email is required.";break;case"password":o=t?"":"Password is required.";break;case"role":i=t?"Admin"!==t&&"Sub Admin"!==t?"Role must be Admin or Sub Admin.":"":"Role is required."}this.setState({nameError:s,emailError:a,passwordError:o,roleError:i})}render(){var{isPopupOpen:e,popupMessage:t,popupType:s}=this.state;return u.jsx("div",{className:"new-Customercontainer",children:u.jsxs("div",{className:"form-wrapper",children:[u.jsx("h1",{children:"Create New Admin Account"}),u.jsxs("form",{onSubmit:this.handleSubmit,children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"name",children:"Name:"}),u.jsx("input",{type:"text",id:"name",name:"name",placeholder:"Enter Name",value:this.state.name,onChange:this.handleChange,autoComplete:"off"}),this.state.nameError&&u.jsx("p",{className:"error-message2",children:this.state.nameError})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"email",children:"Email:"}),u.jsx("input",{type:"text",id:"email",name:"email",placeholder:"Enter Email",value:this.state.email,onChange:this.handleChange,autoComplete:"off"}),this.state.emailError&&u.jsx("p",{className:"error-message2",children:this.state.emailError})]}),u.jsxs("div",{className:"form-group1",children:[u.jsx("label",{htmlFor:"password",children:"Password:"}),u.jsxs("div",{className:"password-group",children:[u.jsxs("div",{className:"password-input-wrapper",children:[u.jsx("input",{type:this.state.passwordVisible?"text":"password",id:"password",name:"password",value:this.state.password,placeholder:"Password",className:"passwordInput",disabled:!0}),u.jsx("i",{className:`fas ${this.state.passwordVisible?"fa-eye-slash":"fa-eye"} password-icon`,onClick:this.togglePasswordVisibility})]}),u.jsx("button",{type:"button",onClick:this.generateRandomPassword,className:"generate-password-button",children:"Generate Password"})]}),this.state.passwordError&&u.jsx("p",{className:"error-message2",children:this.state.passwordError})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"role",children:"Role:"}),u.jsxs("div",{className:"role-input-wrapper",ref:e=>this.dropdownRef=e,children:[u.jsx("input",{type:"text",id:"role",name:"role",value:this.state.role,onChange:this.handleRoleInputChange,autoComplete:"off",placeholder:"All roles",onFocus:this.showDropdownList}),this.state.showDropdown&&this.state.filteredRoles.length>0&&u.jsx("ul",{className:"role-dropdown",children:this.state.filteredRoles.map((e,t)=>u.jsx("li",{onClick:()=>this.selectRole(e),children:e},t))})]}),this.state.roleError&&u.jsx("p",{className:"error-message2",children:this.state.roleError})]}),u.jsxs("div",{className:"button-container",children:[u.jsx("button",{type:"button",onClick:this.clearForm,className:"clear-form-button",children:"Clear Form"}),u.jsx("button",{type:"submit",className:"submit-form-button",children:"Create Account"})]})]}),u.jsx($,{isOpen:e,message:t,type:s})]})})}}class H extends p.Component{constructor(e){super(e),d(this,"accessRightsColumnDefs",()=>{const{role:e}=this.props;return[{headerName:"S/N",field:"sn",width:100},{headerName:"Name",field:"name",width:200},{headerName:"Account Type",field:"accType",width:350,cellStyle:e=>({backgroundColor:this.getRoleColor(e.value),fontWeight:"bold",color:"white",textAlign:"center",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"20px",paddingLeft:"30px",paddingRight:"30px",minWidth:"175px",whiteSpace:"nowrap"})}]}),d(this,"getAccountsColumnDefs",()=>{const{role:e}=this.props;return[{headerName:"S/N",field:"sn",width:100},{headerName:"Name",field:"name",width:300},{headerName:"Email",field:"email",width:300},{headerName:"Account Type",field:"accType",width:250,cellStyle:e=>({backgroundColor:this.getRoleColor(e.value),fontWeight:"bold",color:"white",textAlign:"center",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"20px",paddingLeft:"30px",paddingRight:"30px",minWidth:"175px",whiteSpace:"nowrap"})},{headerName:"Site I/C",field:"siteIC",width:250,cellStyle:e=>({backgroundColor:this.getSiteColor(e.value),fontWeight:"bold",color:"white",textAlign:"center",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"20px",paddingLeft:"30px",paddingRight:"30px",minWidth:"100px",whiteSpace:"nowrap"})},{headerName:"Date Created",field:"dateCreated",width:150},{headerName:"Time Created",field:"timeCreated",width:150}]}),d(this,"getAccountsRowData",e=>{console.log("All accounts:",e);const t=e.map((e,t)=>({id:e._id,sn:t+1,name:e.name,email:e.email,accType:e.role,dateCreated:e.date_created,timeCreated:e.time_created,siteIC:e.site,firstTimeLogIn:e.first_time_log_in,dateLogIn:e.date_log_in,timeLogIn:e.time_log_in,dateLogOut:e.date_log_out,timeLogOut:e.time_log_out}));console.log("All Rows Data:",t),this.setState({accounts:t,accountsRowData:t})}),d(this,"getAccessRightsRowData",e=>{console.log("Access Rights:",e);const t=e.map((e,t)=>({id:e._id,sn:t+1,name:e["Account Details"].Name,accType:e["Account Details"].Role,accounts:e.Account,courses:e.Courses,regPay:e["Registration And Payment"],qRCode:e["QR Code"],attendance:e.Attendances,membership:e.Membership,reports:e.Reports}));this.setState({accessRights:t,accessRightsRowData:t})}),d(this,"accountInfo",(e,t)=>h(this,null,function*(){console.log("Account Information:",t.id),this.props.edit(t.id)})),d(this,"accessRightInfo",e=>h(this,null,function*(){console.log("Access Rights  :",e),this.props.updateAccessRights(e)})),d(this,"getRoleColor",e=>{switch(e){case"Admin":return"#008000";case"Sub Admin":return"#0000FF";case"Ops in-charge":return"#FF0000";case"NSA in-charge":return"#FFA500";case"Site in-charge":return"#8B4513";case"Finance":return"#000000";default:return"#808080"}}),d(this,"getSiteColor",e=>{switch(e){case"Tampines 253 Centre":return"#FF6347";case"CT Hub":return"#20B2AA";case"Tampines North Community Centre":return"#FFD700";case"Pasir Ris West Wellness Centre":return"#8A2BE2";default:return""}}),d(this,"handleAccessRightsValueClick",e=>h(this,null,function*(){console.log("handleValueClick");const t=e.colDef.headerName,s=e.rowIndex,a=this.state.expandedRowIndex,o=e.data;console.log("Row Index:",s);try{"S/N"===t?(console.log("Cell clicked",e),a===s?this.setState({expandedRowIndex:null}):this.setState({expandedRowIndex:s})):"Name"===t&&this.accessRightInfo(o)}catch(i){console.error("Error during submission:",i)}})),d(this,"handleAccountsValueClick",e=>h(this,null,function*(){console.log("handleValueClick");const t=e.colDef.headerName,s=e.data,a=e.rowIndex,o=this.state.expandedRowIndex;console.log("Row Index:",a);try{"S/N"===t?(console.log("Cell clicked",e),o===a?this.setState({expandedRowIndex:null}):this.setState({expandedRowIndex:a})):"Name"===t&&(yield this.accountInfo(a,s))}catch(i){console.error("Error during submission:",i)}})),this.state={accounts:[],filteredAccounts:[],accessRights:[],filteredAccessRights:[],accountsColumnDefs:this.getAccountsColumnDefs(),accessRightsColumnDefs:this.accessRightsColumnDefs(),accountsRowData:[],accessRightsRowData:[],expandedRowIndex:null},this.tableRef=g.createRef()}fetchAccounts(){return h(this,null,function*(){try{this.setState({loading:!0});var e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accountDetails",{purpose:"retrieve"});console.log(e.data.result);var t=this.getAllRoles(e.data.result);yield this.props.getTotalNumberofAccounts(e.data.result.length),this.props.passDataToParent(t),this.props.closePopup(),this.setState({accounts:e.data.result,filteredAccounts:e.data.result,loading:!1,hideAllCells:!1,dataFetched:!0,roles:t}),this.getAccountsRowData(e.data.result),this.props.closePopup()}catch(s){console.error("Error fetching data:",s),this.setState({loading:!1}),this.props.closePopup()}})}fetchAccessRights(){return h(this,null,function*(){try{this.setState({loading:!0});var e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accessRights",{purpose:"retrieve"});console.log("Fetch Access Rights:",e.data.result);var t=this.getAllRolesAccessRight(e.data.result);yield this.props.getTotalNumberofAccounts(e.data.result.length),this.props.passDataToParent(t),this.props.closePopup(),this.setState({accessRights:e.data.result,filteredAccessRights:e.data.result,loading:!1,hideAllCells:!1,dataFetched:!0,roles:t}),this.getAccessRightsRowData(e.data.result),this.props.closePopup()}catch(s){console.error("Error fetching data:",s),this.setState({loading:!1}),this.props.closePopup()}})}getAllRoles(e){return[...new Set(e.map(e=>e.role))]}getAllRolesAccessRight(e){return[...new Set(e.map(e=>e["Account Details"].Role))]}componentDidMount(){return h(this,null,function*(){var{accountType:e}=this.props;e&&!this.state.dataFetched&&"Accounts"===e?yield this.fetchAccounts():e&&!this.state.dataFetched&&"Access Rights"===e&&(yield this.fetchAccessRights())})}componentDidUpdate(e){var{accountType:t,selectedAccountType:s,language:a,searchQuery:o}=this.props;t!==e.accountType||a!==e.language?"Accounts"===t?this.fetchAccounts():"Access Rights"===t&&this.fetchAccessRights():s!==e.selectedAccountType||o!==e.searchQuery?"Accounts"===t?(console.log("Going to Filter Accounts"),this.filterAccounts()):"Access Rights"===t&&this.filterAccessRights():e.key!==this.props.key&&this.filterAccounts()}filterAccounts(){const{section:e,selectedAccountType:t,searchQuery:s}=this.props;if("accounts"===e){const{accounts:e}=this.state;if(console.log("Accounts:",e),console.log("Filters Applied:",{selectedAccountType:t,searchQuery:s}),!("All Roles"!==t&&t||s)){const t=e.map((e,t)=>({sn:t+1,name:e.name,email:e.email,accType:e.accType,dateCreated:e.dateCreated,timeCreated:e.timeCreated,siteIC:e.site,firstTimeLogIn:e.firstTimeLogIn,dateLogIn:e.dateLogIn,timeLogIn:e.timeLogIn,dateLogOut:e.dateLogOut,timeLogOut:e.timeLogOut}));return this.setState({accountsRowData:t}),void this.updateRowData(t)}const a={accType:"All Roles"!==t?t:null,searchQuery:(s?s.toLowerCase().trim():"")||null};console.log("Criteria Selected:",a);let o=e;a.accType&&(o=o.filter(e=>e.accType.toLowerCase()===a.accType.toLowerCase())),console.log("Filtered Details:",o),a.searchQuery&&(o=o.filter(e=>{console.log("Data:",e);const t=e.name?e.name.toLowerCase().trim():"",s=e.email?e.email.toLowerCase().trim():"",o=e.accType?e.accType.toLowerCase().trim():"",i=e.dateCreated?e.dateCreated.toLowerCase().trim():"",r=e.timeCreated?e.timeCreated.toLowerCase().trim():"",n=e.siteIC?e.siteIC.toLowerCase().trim():"No Site IC";return t.includes(a.searchQuery)||s.includes(a.searchQuery)||o.includes(a.searchQuery)||i.includes(a.searchQuery)||r.includes(a.searchQuery)||n.includes(a.searchQuery)}));const i=o.map((e,t)=>({sn:t+1,name:e.name,email:e.email,accType:e.accType,dateCreated:e.date_created,timeCreated:e.time_created,siteIC:e.siteIC,firstTimeLogIn:e.firstTimeLogIn,dateLogIn:e.dateLogIn,timeLogIn:e.timeLogIn,dateLogOut:e.dateLogOut,timeLogOut:e.timeLogOut}));this.setState({accountsRowData:i}),this.updateAccountsRowData(o)}}updateAccountsRowData(e){this.setState({filteredAccounts:e})}updateAccessRightsRowData(e){this.setState({filteredAccessRights:e})}filterAccessRights(){const{section:e}=this.props;if("accounts"===e){const{accessRights:e}=this.state,{selectedAccountType:t,searchQuery:s}=this.props;if(!("All Roles"!==t&&t||s)){const t=e.map((e,t)=>({sn:t+1,name:e.name,accType:e.accType}));return this.setState({accessRightsRowData:t}),void this.updateAccessRightsRowData(t)}const a={accType:"All Roles"!==t?t:null,searchQuery:(s?s.toLowerCase().trim():"")||null};console.log("Criteria Selected:",a);let o=e;a.accType&&(o=o.filter(e=>e.accType.toLowerCase()===a.accType.toLowerCase())),console.log("Filtered Details:",o),a.searchQuery&&(o=o.filter(e=>{console.log("Data:",e);const t=e.name?e.name.toLowerCase().trim():"",s=e.accType?e.accType.toLowerCase().trim():"";return t.includes(a.searchQuery)||s.includes(a.searchQuery)}));const i=o.map((e,t)=>({sn:t+1,name:e.name,accType:e.accType}));this.setState({accessRightsRowData:i}),this.updateAccessRightsRowData(o)}}render(){return M.registerModules([k]),u.jsx("div",{className:"accounts-container",children:u.jsxs("div",{className:"accounts-heading",children:[u.jsx("h1",{children:"Accounts"===this.props.accountType?"Accounts Table":"Access Rights Table"}),u.jsx("div",{style:{width:"Accounts"===this.props.accountType?"78vw":"29.2vw"},className:"grid-container1",children:u.jsx(m,{columnDefs:"Accounts"===this.props.accountType?this.state.accountsColumnDefs:this.state.accessRightsColumnDefs,rowData:"Accounts"===this.props.accountType?this.state.accountsRowData:this.state.accessRightsRowData,domLayout:"normal",paginationPageSize:"Accounts"===this.props.accountType?this.state.accountsRowData.length:this.state.accessRightsRowData.length,sortable:!0,statusBar:!1,pagination:!0,defaultColDef:{resizable:!0},onCellClicked:"Accounts"===this.props.accountType?this.handleAccountsValueClick:this.handleAccessRightsValueClick})}),null!==this.state.expandedRowIndex&&u.jsxs("div",{style:{padding:"10px",backgroundColor:"#F9E29B",marginLeft:"auto",marginRight:"auto",width:"Accounts"===this.props.accountType?"77vw":"28.2vw",height:"fit-content",borderRadius:"15px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",textAlign:"left"},children:[u.jsx("p",{children:u.jsx("strong",{children:"More Information"})}),"Accounts"===this.props.accountType?u.jsxs(u.Fragment,{children:[u.jsxs("p",{children:[u.jsx("strong",{children:"First Time Log In: "}),this.state.accountsRowData[this.state.expandedRowIndex].firstTimeLogIn]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Last Log In: "}),u.jsx("br",{}),u.jsx("strong",{children:"Date: "}),this.state.accountsRowData[this.state.expandedRowIndex].dateLogIn,u.jsx("br",{}),u.jsx("strong",{children:"Time: "}),this.state.accountsRowData[this.state.expandedRowIndex].timeLogIn]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Last Log Out: "}),u.jsx("br",{}),u.jsx("strong",{children:"Date: "}),this.state.accountsRowData[this.state.expandedRowIndex].dateLogOut,u.jsx("br",{}),u.jsx("strong",{children:"Time: "}),this.state.accountsRowData[this.state.expandedRowIndex].timeLogOut]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Account Modules | "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Account Table: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].accounts["Account Table"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Access Rights Table: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].accounts["Access Rights Table"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Courses Modules |  "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Upload Course(s): "}),this.state.accessRightsRowData[this.state.expandedRowIndex].courses["Upload Courses"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"NSA Courses: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].courses["NSA Courses"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"ILP Courses: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].courses["ILP Courses"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Update Course(s): "}),this.state.accessRightsRowData[this.state.expandedRowIndex].courses["Update Courses"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Delete Course(s): "}),this.state.accessRightsRowData[this.state.expandedRowIndex].courses["Delete Courses"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Membership Module |  "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Viewing Membership: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].membership["View Membership"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Registration And Payment Module |  "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Registration And Payment Table: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].regPay["Registration And Payment Table"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Invoice Table: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].regPay["Invoice Table"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"QR Code Modules | "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"QR Code Creation: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].qRCode["Create QR Code"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"QR Code Table: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].qRCode["QR Code Table"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Update QR Code: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].qRCode["Update QR Code"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"QR Code Deletion: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].qRCode["Delete QR Code"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Reports Module | "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Monthly Reports: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].reports&&!0===this.state.accessRightsRowData[this.state.expandedRowIndex].reports["Monthly Report"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"flex-start"},children:[u.jsx("strong",{children:"Payment Reports: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].reports&&!0===this.state.accessRightsRowData[this.state.expandedRowIndex].reports["Payment Report"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]}),u.jsx("br",{}),u.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[u.jsx("strong",{children:"Attendances Module | "}),u.jsxs("p",{style:{margin:"0",display:"flex",alignItems:"center"},children:[u.jsx("strong",{children:"Viewing Attendance: "}),this.state.accessRightsRowData[this.state.expandedRowIndex].attendance["View Attendance"]?u.jsx("i",{className:"fas fa-check",style:{color:"green",fontSize:"20px",marginLeft:"5px"}}):u.jsx("i",{className:"fas fa-times",style:{color:"red",fontSize:"20px",marginLeft:"5px"}})]})]})]})]})]})})}}class Q extends p.Component{constructor(e){super(e),d(this,"handleEntriesPerPageChange",e=>{this.setState({entriesPerPage:parseInt(e.target.value,10),currentPage:1})}),d(this,"getColumnDefs",()=>{const e=[{headerName:"Course ID",field:"courseId",width:100},{headerName:"Course Name",field:"courseName",width:350},{headerName:"Centre Location",field:"centreLocation",width:150},{headerName:"Course Mode",field:"courseMode",width:150},{headerName:"Current",field:"current",width:100},{headerName:"Projected",field:"projected",width:100},{headerName:"Maximum",field:"maximum",width:100},{headerName:"Status",field:"status",width:200,cellRenderer:e=>{const t={Ongoing:"#FF6347",Available:"#32CD32",Ended:"#A9A9A9",Full:"#4682B4"}[e.value]||"#D3D3D3";return u.jsx("span",{style:{fontWeight:"bold",color:"white",textAlign:"center",display:"inline-block",borderRadius:"20px",paddingLeft:"30px",paddingRight:"30px",width:"fit-content",lineHeight:"30px",whiteSpace:"nowrap",backgroundColor:t},children:e.value})}},{headerName:"Course Duration",field:"courseDuration",width:250},{headerName:"Course Timing",field:"courseTiming",width:180}];return"NSA"===this.props.courseType&&e.push({headerName:"SkillsFuture Credit Eligibility",field:"eligibility",width:250,cellRenderer:e=>{const t=e.value?"https://upload.wikimedia.org/wikipedia/commons/2/29/Tick-green.png":"https://upload.wikimedia.org/wikipedia/commons/5/5f/Red_X.svg";return u.jsx("img",{src:t,alt:e.value?"Eligible":"Not Eligible",width:"20",height:"20"})}}),e}),d(this,"getAllLanguages",e=>h(this,null,function*(){return[...new Set(e.map(e=>{var t=this.getSelectedDetails(e.short_description);return console.log("Course Details123:",JSON.parse(t).language),JSON.parse(t).language}))]})),d(this,"getRowData",e=>{console.log("Get Row Data",e);const t={"Tampines 253 Centre":"T-253","Pasir Ris West Wellness Centre":"PRW","Tampines North Community Centre":"TNCC","CT Hub":"CTH"},s=e.map((e,s)=>{var a,o,i,r,n,l;console.log("Course Details:",e);var c=JSON.parse(this.getSelectedDetails(e.short_description,e.stock_quantity));console.log("Displayed Details:",c);const d=e.name.split(/<br\s*\/?>/);return console.log("Split Name:",d),{courseId:e.id,courseName:3===d.length?d[1]:2===d.length?d[0]:e.name,centreLocation:3===d.length?t[d[2].replace(/[()]/g,"").trim()]||d[2].replace(/[()]/g,"").trim():2===d.length?t[d[1].replace(/[()]/g,"").trim()]||d[1].replace(/[()]/g,"").trim():"",courseMode:"Face-to-Face"===(null==(i=null==(o=null==(a=null==e?void 0:e.attributes)?void 0:a[2])?void 0:o.options)?void 0:i[0])?"F2F":null==(l=null==(n=null==(r=null==e?void 0:e.attributes)?void 0:r[2])?void 0:n.options)?void 0:l[0],current:e.stock_quantity,projected:c.vacancies,maximum:""===c.vacancies?"":Math.ceil(1.5*parseInt(c.vacancies)),noLesson:c.noOfLesson,language:c.language,status:c.status,courseDuration:c.startDate+" - "+c.endDate,courseTiming:c.startTime+" - "+c.endTime,eligibility:c.eligibility}});console.log("All Rows Data:",s),this.setState({courses:s,filteredCourse:s,rowData:s})}),d(this,"getAllLocations",e=>h(this,null,function*(){return[...new Set(e.map(e=>this.courseNameAndDetails(e.name).location))]})),d(this,"getCsrfToken",()=>h(this,null,function*(){const e="csrftoken",t=document.cookie.split(";");for(let s=0;s<t.length;s++){const a=t[s].trim();if(a.startsWith(`${e}=`))return a.substring(10)}return null})),d(this,"axiosInstance",D.create({baseURL:("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/",withCredentials:!0})),d(this,"componentDidMount",()=>h(this,null,function*(){this.axiosInstance.interceptors.request.use(e=>{const t=this.getCsrfToken();return t&&(e.headers["X-CSRFToken"]=t),e});const{courseType:e}=this.props;e&&!this.state.dataFetched&&(yield this.fetchCourses(e))})),d(this,"handleValueClick",e=>h(this,null,function*(){console.log("handleValueClick");const t=e.rowIndex,s=e.colDef.headerName,a=this.state.expandedRowIndex;try{"Course Name"===s&&(console.log("Cell clicked",e),a===t?this.setState({expandedRowIndex:null}):this.setState({expandedRowIndex:t}))}catch(o){console.error("Error during submission:",o)}})),d(this,"saveData",e=>h(this,null,function*(){console.log("Course Data:",e);try{const t=new P.Workbook,s=t.addWorksheet("Courses"),a=["Course Id","Course Name","Course Mode","Current Capacity","Projected Capacity","Maximum Capacity","No. of Lesson","Language","Status","Course Duration","Course Timing","SkillsFuture Eligibility"];s.addRow(a);const o=s.getRow(1);o.font={bold:!0},o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFD3D3D3"}},e.forEach(e=>{const t=[e.courseId,e.courseName,e.courseMode||"",e.current,Array.isArray(e.projected)?parseInt(e.projected[0]):e.projected,e.maximum,e.noLesson,e.language,e.status,e.courseDuration,e.courseTiming,e.eligibility],a=s.addRow(t).getCell(12);!0===e.eligibility?(a.value="✓",a.font={color:{argb:"FF008000"}}):!1===e.eligibility&&(a.value="✗",a.font={color:{argb:"FFFF0000"}})}),s.columns.forEach(e=>{let t=0;e.eachCell({includeEmpty:!0},e=>{const s=e.value?e.value.toString().length:10;s>t&&(t=s)}),e.width=Math.min(t+2,30)});const i=yield t.xlsx.writeBuffer(),r=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=URL.createObjectURL(r),l=document.createElement("a");l.href=n;const c=(new Date).toISOString().split("T")[0];l.download=`Course_Listing_${c}.xlsx`,l.click(),URL.revokeObjectURL(n),console.log("Excel export completed successfully")}catch(t){console.error("Error exporting to Excel:",t)}})),this.state={courses:[],filteredCourses:[],loading:!1,columnDefs:this.getColumnDefs(),rowData:[],expandedRowIndex:null},this.tableWrapperRef=g.createRef()}fetchCourses(e){return h(this,null,function*(){try{this.setState({loading:!0});var t=(yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/courses/",{courseType:e})).data.courses;console.log("From Django:",t);var s=yield this.getAllLocations(t),a=yield this.getAllLanguages(t);console.log("Locations123:",s),console.log("Languages123:",a),this.props.passDataToParent(s,a),this.setState({courses:t,filteredCourses:t,loading:!1,locations:s,languages:a}),this.props.closePopup(),yield this.props.getTotalNumberofCourses(t.length),this.getRowData(t)}catch(o){console.error("Error fetching data:",o),this.setState({loading:!1}),this.props.closePopup()}})}getSelectedDetails(e,t){var s,a,o,i,r,n;let l=e.split("<p>");""===l[0]&&l.shift(),l=l.flatMap(e=>e.split("</p>")).filter(e=>""!==e.trim());let c=l.find(e=>e.toLowerCase().includes("lesson"))||"";c=c.split("<br />")[1]||"",c=c.replace(/\n|<b>|<\/b>/g,"").match(/\d+/),c=c?parseInt(c[0],10):"",console.log("No. of Lesson:",c);let d=l.map(e=>e.replace(/\n|<b>|<\/b>/g,"")).find(e=>e.toLowerCase().includes("language"))||"";d=(null==(s=d.split("<br />").pop())?void 0:s.trim())||"";let h=l.map(e=>e.replace(/\n|<b>|<\/b>/g,"")).find(e=>e.toLowerCase().includes("vacancy"))||"";h=(null==(a=h.split("<br />").pop())?void 0:a.trim().split("/")[2])||"";let p=h.match(/\d+/)?parseInt(h.match(/\d+/)[0],10):"",u=l.map(e=>e.replace(/\<strong>|\<\/strong>|\n|<b>|<\/b>/g,"")).find(e=>e.toLowerCase().includes("start date"))||"";u=(null==(o=u.split("<br />").pop())?void 0:o.trim())||"";let[g,m,f]=u.split(" ");g=parseInt(g)||1,f=parseInt(f)||(new Date).getFullYear();let y=this.changeMonthToNumber(m||""),C=l.map(e=>e.replace(/\<strong>|\<\/strong>|\n|<b>|<\/b>/g,"")).find(e=>e.toLowerCase().includes("end date"))||"";C=(null==(i=C.split("<br />").pop())?void 0:i.trim())||"";let[w,b,x]=C.split(" ");w=parseInt(w)||1,x=parseInt(x)||(new Date).getFullYear();let v=this.changeMonthToNumber(b||"");console.log("Course End Date:",u,C);let S=l.map(e=>e.replace(/\<strong>|\<\/strong>|\n|<b>|<\/b>/g,"")).find(e=>e.toLowerCase().includes("lesson schedule"))||"";S=(null==(r=S.split("<br />").pop())?void 0:r.trim())||"";let N="",D="";S&&(S.includes("&#8211;")?[N,D]=S.split("&#8211;").map(e=>e.trim()):S.includes("–")&&([N,D]=S.split("–").map(e=>e.trim())),N.includes(",")&&(N=(null==(n=N.split(",")[1])?void 0:n.trim())||N));const P=new Date(f,y-1,g),{hours:j,minutes:R}=this.convertTo24HourWithHrs(N||"")||{hours:0,minutes:0};P.setHours(j),P.setMinutes(R),P.setSeconds(0);const A=new Date(x,v-1,w),{hours:T,minutes:I}=this.convertTo24HourWithHrs(D||"")||{hours:0,minutes:0};A.setHours(T),A.setMinutes(I),A.setSeconds(0),console.log("Start Date Course:",f,y,g,P),console.log("End Date Time:",C,A);let M="";const k=new Date;return 0===t?M="Full":t>0&&(M=k<P?"Available":k>=A?"Ended":"Ongoing"),u=this.shorternMonth(u||""),C=this.shorternMonth(C||""),JSON.stringify({noOfLesson:c||"",language:d||"",vacancies:p||"",startDate:u||"",endDate:C||"",startTime:N||"",endTime:D||"",status:M||"",eligibility:e.includes("SkillsFuture")})}courseNameAndDetails(e){var t=e.split(/<br\s*\/?>/gi);return 3===t.length?(t[2]=t[2].replace(/[()]/g,""),{engName:t[1],chiName:t[0],location:t[2]}):2===t.length?(t[1]=t[1].replace(/[()]/g,""),{engName:t[0],chiName:t[0],location:t[1]}):void 0}updateRowData(e){this.setState({filteredCourse:e})}filterCourses(){const{section:e,selectedLocation:t,searchQuery:s}=this.props;if(console.log("Section:",e),"courses"===e){const{courses:e}=this.state;console.log("Original Data:",e),console.log("Get Row Data");const a={"T-253":"Tampines 253 Centre",PRW:"Pasir Ris West Wellness Centre",TNCC:"Tampines North Community Centre",CTH:"CT Hub"};let o=e;t&&"All Locations"!==t&&(o=o.filter(e=>a[e.centreLocation]===t));const i=s?s.toLowerCase().trim():"";i&&(o=o.filter(e=>e.courseName.toLowerCase()&&e.courseName.toLowerCase().includes(i)));const r=o.map(e=>{var t,s,a,o,i,r;return console.log("Filtered Course Details:",e),console.log("Maximum Capacity",e.maximum),{courseId:e.courseId,courseName:e.courseName,centreLocation:e.centreLocation,courseMode:"Face-to-Face"===(null==(a=null==(s=null==(t=null==e?void 0:e.attributes)?void 0:t[2])?void 0:s.options)?void 0:a[0])?"F2F":null==(r=null==(i=null==(o=null==e?void 0:e.attributes)?void 0:o[2])?void 0:i.options)?void 0:r[0],noLesson:e.noLesson,current:e.current,projected:e.projected,maximum:e.maximum,status:e.status,courseDuration:e.courseDuration,courseTiming:e.courseTiming,language:e.language,eligibility:e.eligibility}});console.log(" :",r),this.setState({rowData:r})}}componentDidUpdate(e){var{courseType:t,selectedLanguage:s,selectedLocation:a,searchQuery:o,language:i}=this.props;t!==e.courseType?(this.setState({filteredCourses:[],columnDefs:this.getColumnDefs()}),this.fetchCourses(t)):s===e.selectedLanguage&&a===e.selectedLocation&&o===e.searchQuery||this.filterCourses()}changeMonthToNumber(e){return{January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12,"一月":1,"二月":2,"三月":3,"四月":4,"五月":5,"六月":6,"七月":7,"八月":8,"九月":9,"十月":10,"十一月":11,"十二月":12}[e]||0}convertTo24HourWithHrs(e){const t=e.match(/(\d{1,2})[:.]?(\d{2})?\s?(am|pm)/i);if(!t)return{hours:null,minutes:null};let[,s,a,o]=t;return s=parseInt(s,10),a=a?parseInt(a,10):0,"pm"===o.toLowerCase()&&s<12?s+=12:"am"===o.toLowerCase()&&12===s&&(s=0),console.log("24 hr Format11:",s,"Minutes11:",a),{hours:s,minutes:a}}shorternMonth(e){const t=new Date(e);return`${t.getDate()} ${t.toLocaleString("en-US",{month:"short"})} ${t.getFullYear()}`}render(){return M.registerModules([k]),u.jsxs("div",{className:"nsa-course-container",children:[u.jsxs("div",{className:"nsa-course-heading",children:[u.jsx("h1",{style:{textAlign:"center"},children:"NSA"===this.props.courseType?"NSA Courses":"ILP"===this.props.courseType?"ILP Courses":"Marriage Preparation Programme"===this.props.courseType?"Marriage Preparation Programme":"Courses"}),u.jsx("div",{className:"button-row4",children:u.jsx("button",{className:"save-btn",onClick:()=>this.saveData(this.state.rowData),children:"Export To Excel"})}),u.jsx("div",{className:"course-table-wrapper",children:u.jsx(m,{columnDefs:this.state.columnDefs,rowData:this.state.rowData,domLayout:"normal",statusBar:!1,pagination:!0,paginationPageSize:this.state.rowData.length,defaultColDef:{resizable:!0},sortable:!0,onCellClicked:this.handleValueClick})})]}),null!==this.state.expandedRowIndex&&u.jsxs("div",{style:{padding:"10px",backgroundColor:"#F9E29B",maxWidth:"1320px",width:"1320px",height:"fit-content",borderRadius:"15px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[u.jsx("p",{style:{textAlign:"left"},children:u.jsx("h2",{style:{color:"#000000"},children:"More Information"})}),u.jsxs("p",{style:{textAlign:"left"},children:[u.jsx("strong",{children:"No Of Lesson: "}),this.state.rowData[this.state.expandedRowIndex].noLesson+" Lesson(s)"]}),u.jsxs("p",{style:{textAlign:"left"},children:[u.jsx("strong",{children:"Languages: "}),this.state.rowData[this.state.expandedRowIndex].language]})]})]})}}M.registerModules([k]);class q extends p.Component{constructor(e){super(e),d(this,"toggleRow",e=>{this.setState(t=>({expandedRow:t.expandedRow===e?null:e}))}),d(this,"toggleHideMarriagePrepFields",()=>{console.log("Toggle button clicked - current state:",this.state.hideMarriagePrepFields),this.setState(e=>({hideMarriagePrepFields:!e.hideMarriagePrepFields}),()=>{console.log("State updated - new hideMarriagePrepFields value:",this.state.hideMarriagePrepFields);const e=this.getColumnDefs(this.state.rowData);console.log("New column definitions generated, count:",e.length),this.setState({columnDefs:e})})}),d(this,"handleEntriesPerPageChange",e=>{this.setState({entriesPerPage:parseInt(e.target.value,100),currentPage:1})}),d(this,"fetchCourseRegistrations",e=>h(this,null,function*(){var t;try{var{siteIC:s,role:a}=this.props;let t=s;Array.isArray(s)?t=s:"string"==typeof s&&s.includes(",")?t=s.split(",").map(e=>e.trim()):"string"==typeof s&&(t=s);const o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"retrieve",role:a,siteIC:t}),i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"retrieve",role:"admin",siteIC:""});console.log("Response Data:",o.data.result);const r=this.languageDatabase(o.data.result,e);return{data:r,data1:this.languageDatabase(i.data.result,e)}}catch(o){return console.error("=== ERROR FETCHING COURSE REGISTRATIONS ===",o),console.error("Error details:",(null==(t=o.response)?void 0:t.data)||o.message),{data:[],data1:[]}}})),d(this,"getAnomalyRowStyles",e=>{const t={};for(let s=0;s<e.length;s++){const a=e[s],o=a.participantInfo.name,i=a.courseInfo.courseEngName,r=a.courseInfo.courseLocation;for(let n=0;n<s;n++){const a=e[n];a.participantInfo.name===o&&a.courseInfo.courseEngName===i&&a.courseInfo.courseLocation!==r?(t[s]={backgroundColor:"#FFDDC1"},t[n]={backgroundColor:"#FFDDC1"}):a.participantInfo.name===o&&a.courseInfo.courseEngName===i&&a.courseInfo.courseLocation===r&&(t[s]={backgroundColor:"\t#87CEEB"},t[n]={backgroundColor:"\t#87CEEB"})}}return t}),d(this,"anomalitiesAlert",e=>{const t=[];for(let s=0;s<e.length;s++){const a=e[s],o=a.participant.name,i=a.course.courseEngName,r=a.course.courseLocation;for(let n=0;n<s;n++){const a=e[n];a.participant.name===o&&a.course.courseEngName===i&&a.course.courseLocation!==r?t.push({originalIndex:s+1,name:o,course:i,locations:`${a.course.courseLocation} (index: ${n+1}) and ${r} (index: ${s+1})`,type:"Person registered same course in different locations"}):a.participant.name===o&&a.course.courseEngName===i&&a.course.courseLocation===r&&t.push({originalIndex:s+1,name:o,course:i,locations:`${a.course.courseLocation} (index: ${n+1}) and ${r} (index: ${s+1})`,type:"Person registered same course in same location"})}}if(t.length>0){const e=new Set,s=t.filter(t=>{const s=`${t.name}-${t.course}-${t.locations}`;return!e.has(s)&&(e.add(s),!0)});let a="Anomalies detected:\n\n";s.forEach((e,t)=>{a+=`S/N: ${t+1}\n`,a+=`Name: ${e.name}, `,a+=`Course: ${e.course}\n`,a+=`Locations: ${e.locations}\n`,a+=`Anomaly Type: ${e.type}\n\n`}),alert(a)}}),d(this,"updateWooCommerceForRegistrationPayment",(e,t,s,a)=>h(this,null,function*(){try{if("Paid"===a||"SkillsFuture Done"===a||"Cancelled"===a||"Withdrawn"===a||"Confirmed"===a){const o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/update_stock/",{type:"update",page:{courseChiName:e,courseEngName:t,courseLocation:s},status:a,location:s});console.log("WooCommerce stock update response:",o.data),!0===o.data.success?console.log("Stock updated successfully."):console.error("Error updating WooCommerce stock:",o.data)}else console.log("No update needed for the given status.")}catch(o){console.error("Error during the update process:",o)}})),d(this,"getAllLocations",e=>h(this,null,function*(){return[...new Set(e.map(e=>e.course.courseLocation))]})),d(this,"getAllQuarters",e=>h(this,null,function*(){const t=e.map(e=>{var t;if(!(null==(t=null==e?void 0:e.course)?void 0:t.courseDuration))return null;const s=e.course.courseDuration.split(" - ")[0],[a,o,i]=s.split(" "),r={January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12}[o];if(!r||!i)return null;let n="";return r>=1&&r<=3&&(n=`Q1 ${i}`),r>=4&&r<=6&&(n=`Q2 ${i}`),r>=7&&r<=9&&(n=`Q3 ${i}`),r>=10&&r<=12&&(n=`Q4 ${i}`),n});return[...new Set(t.filter(Boolean))].sort((e,t)=>{const[s,a]=e.split(" "),[o,i]=t.split(" ");return a-i||s.localeCompare(o)})})),d(this,"getAllTypes",e=>h(this,null,function*(){return[...new Set(e.map(e=>e.course.courseType))]})),d(this,"getAllNames",e=>h(this,null,function*(){return[...new Set(e.map(e=>(console.log("Course Name:",e.course.courseEngName),e.course.courseEngName)))]})),d(this,"generateReceiptNumber",(e,t)=>h(this,null,function*(){var s,a;const o="SkillsFuture"===t?"ECSS/SFC/":e.courseLocation;console.log("Course Location:",o);const i=e.courseLocation;console.log("Centre Location:",i);try{const e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/receipt",{purpose:"getReceiptNo",courseLocation:o,centreLocation:i});if(null==(a=null==(s=null==e?void 0:e.data)?void 0:s.result)?void 0:a.success)return console.log("Fetched receipt number:",e.data.result.receiptNumber),e.data.result.receiptNumber;throw new Error("Failed to fetch receipt number from response")}catch(r){throw console.error("Error fetching receipt number:",r),r}})),d(this,"generatePDFReceipt",(e,t,s,a,o)=>h(this,null,function*(){try{const i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"addReceiptNumber",id:e,participant:t,course:s,staff:this.props.userName,receiptNo:a,status:o});return console.log("generatePDFReceipt:",i),i}catch(i){throw console.error("Error generating PDF receipt:",i),i}})),d(this,"receiptShown",(e,t,s,a)=>h(this,null,function*(){try{console.log("Generating receipt for course:",t);let o="Cash"===t.payment||"PayNow"===t.payment?"receipt":"invoice";const i=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:o,participant:e,course:t,staff:this.props.userName,receiptNo:s,officialInfo:a},{responseType:"blob"});console.log("PDF Response:",i);const r=`${e.name}-${t.payment}-${s}.pdf`;console.log("Generated Filename:",r);const n=new Blob([i.data],{type:"application/pdf"}),l=window.URL.createObjectURL(n);window.open(l,"_blank")||alert("Please allow popups to view the PDF receipt.");const c=document.createElement("a");c.href=l,c.download=r,c.click(),window.URL.revokeObjectURL(l)}catch(o){console.error("Error generating PDF receipt:",o)}})),d(this,"generatePDFInvoice",(e,t,s,a,o)=>h(this,null,function*(){try{return yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"addInvoiceNumber",id:e,participant:t,course:s,staff:this.props.userName,receiptNo:a,status:o})}catch(i){throw console.error("Error generating PDF receipt:",i),i}})),d(this,"automatedWhatsappMessage",(e,t,s,a)=>h(this,null,function*(){var o;try{console.log("Sending WhatsApp message with template",e,t,s,a);const o={phoneNumber:e.contactNumber,name:e.name,course:t.courseEngName,location:t.courseLocation,date:t.courseDuration.split(" - ")[0],template:s,purpose:a};yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/whatsapp",o),console.log("WhatsApp message sent successfully")}catch(i){console.error("Failed to send WhatsApp message:",(null==(o=null==i?void 0:i.response)?void 0:o.data)||i.message)}})),d(this,"createReceiptInDatabase",(e,t,s,a)=>h(this,null,function*(){try{console.log("Creating receipt in database:",{receiptNo:e,registration_id:s,url:a});const o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/receipt",{purpose:"createReceipt",receiptNo:e,location:t,registration_id:s,url:a,staff:this.props.userName});console.log("Receipt creation response:",o.data)}catch(o){throw console.error("Error creating receipt in database:",o),o}})),d(this,"receiptGenerator",(e,t,s,a,o)=>h(this,null,function*(){if(console.log("Selected Parameters:",{course:s,official:a,value:o}),"Paid"===o){if("Cash"===s.payment||"PayNow"===s.payment)try{console.log("Generating receipt for course:",s);const a=yield this.generateReceiptNumber(s,s.payment);console.log("Manual Receipt No:",a),yield this.generatePDFReceipt(e,t,s,a,o),yield this.createReceiptInDatabase(a,s.courseLocation,e,"")}catch(i){console.error("Error during receipt generation:",i)}}else if("Generating SkillsFuture Invoice"===o)try{console.log("Generating SkillsFuture invoice for course:",s);const a=yield this.generateReceiptNumber(s);console.log("Invoice No:",a),yield this.generatePDFInvoice(e,t,s,a,o),yield this.createReceiptInDatabase(a,s.courseLocation,e,"")}catch(i){console.error("Error during SkillsFuture invoice generation:",i)}})),d(this,"autoReceiptGenerator",(e,t,s,a,o,i)=>h(this,null,function*(){if(console.log("Selected Parameters:",{course:s,official:a,newMethod:o,value:i}),"Cash"===o||"PayNow"===o){if("Paid"===i)try{console.log(`${i} For This Course:`,s);const a=yield this.generateReceiptNumber(s,o);console.log("Receipt N11o:",a),yield this.generatePDFReceipt(e,t,s,a,i),yield this.createReceiptInDatabase(a,s.courseLocation,e,"")}catch(r){console.error("Error during receipt generation:",r)}}else if("SkillsFuture"===o)try{console.log("Generating receipt for course:",s);const a=yield this.generateReceiptNumber(s,o);console.log("Invoice No:",a),yield this.generatePDFReceipt(e,t,s,a,i),yield this.createReceiptInDatabase(a,s.courseLocation,e,"")}catch(r){console.error("Error during receipt generation:",r)}})),d(this,"handleEdit",(e,t)=>h(this,null,function*(){console.log("Handle Edit:",e),this.props.showEditPopup(e)})),d(this,"exportToLOP",()=>h(this,null,function*(){var e,t;try{const{selectedRows:s}=this.state;if(!s.length)return this.props.warningPopUpMessage("No rows selected. Please select rows to export.");const a=null==(t=null==(e=s[0])?void 0:e.courseInfo)?void 0:t.courseType;let o,i;if("ILP"===a){const[e,t]=s[0].courseInfo.courseDuration.split(" - ");o="/external/OSG ILP List of participants (20250401).xlsx",i=`OSG ILP List of participants (20250401) as of ${this.convertDateFormat3(e)}.xlsx`}else o="/external/OSG NSA List of participants (20250401).xlsx",i=`OSG NSA List of participants (20250401) as of ${this.getCurrentDateTime()}.xlsx`;const r=yield fetch(o);if(!r.ok)return this.props.warningPopUpMessage("Error fetching the Excel file.");const n=yield r.arrayBuffer(),l=new P.Workbook;yield l.xlsx.load(n);const c=l.getWorksheet("LOP");if(!c)return this.props.warningPopUpMessage("Sheet 'LOP' not found!");const d=c.getRow(9),h=9;console.log("Selected Rows:",s);const p=s.filter(e=>{const t=e.paymentStatus;return"NSA"===a?"Paid"===t||"SkillsFuture Done"===t:"Confirmed"===t});if(p.sort((e,t)=>{const s=e.participantInfo.name.trim().toLowerCase(),a=t.participantInfo.name.trim().toLowerCase();return s.localeCompare(a)}),p.forEach((e,t)=>{var s,o;const i=h+t,r=c.getRow(i);if(r.height=d.height,"NSA"===a){c.getCell(`A${i}`).value=t+1,c.getCell(`B${i}`).value=e.participantInfo.name,c.getCell(`C${i}`).value=e.participantInfo.nric,c.getCell(`D${i}`).value=e.participantInfo.residentialStatus.substring(0,2);const a=null==(s=null==e?void 0:e.participantInfo)?void 0:s.dateOfBirth;if(a){const[e,t,s]=a.split("/");c.getCell(`E${i}`).value=null==e?void 0:e.trim(),c.getCell(`F${i}`).value=null==t?void 0:t.trim(),c.getCell(`G${i}`).value=null==s?void 0:s.trim()}c.getCell(`H${i}`).value=e.participantInfo.gender.split(" ")[0],c.getCell(`I${i}`).value=e.participantInfo.race.split(" ")[0][0],c.getCell(`J${i}`).value=e.participantInfo.contactNumber,c.getCell(`K${i}`).value=e.participantInfo.email,c.getCell(`L${i}`).value=e.participantInfo.postalCode;let o=e.participantInfo.educationLevel.replace(/[\u4e00-\u9fa5]+/g,"").replace(/No Formal Education.*/,"No formal education").replace(/Primary.*/,"Primary").replace(/Secondary.*/,"Secondary").replace(/Post-Secondary.*|Post Secondary.*/,"Post Secondary").replace(/Diploma.*/,"Diploma").replace(/Bachelor'?s Degree.*/,"Bachelor’s Degree").replace(/Master'?s Degree.*/,"Masters/Doctorate").replace(/Masters.*/,"Masters/Doctorate").replace(/Others?.*/,"Others").trim();c.getCell(`M${i}`).value=o;const n=e.participantInfo.workStatus.split(" ");c.getCell(`N${i}`).value=3===n.length?n[0]+" "+n[1]:n[0];let l=e.courseInfo.courseEngName,h=e.courseInfo.courseChiName,p=this.ecssChineseCourseCode(h)||this.ecssEnglishCourseCode(l);c.getCell(`O${i}`).value=p.trim();let u=h||l,g=u.split("–").pop().trim();c.getCell(`P${i}`).value="English"!==g&&"Mandarin"!==g?u.trim():u.split("–")[0].trim(),c.getCell(`R${i}`).value=e.courseInfo.coursePrice;let m=e.courseInfo.coursePrice,f=`$${(5*parseFloat(m.replace("$",""))).toFixed(2)}`;c.getCell(`Q${i}`).value=f;const[y,C]=e.courseInfo.courseDuration.split(" - ");c.getCell(`S${i}`).value=this.convertDateFormat1(y),c.getCell(`T${i}`).value=this.convertDateFormat1(C),c.getCell(`U${i}`).value="Face-to-Face"===e.courseInfo.courseMode?"F2F":e.courseInfo.courseMode,c.getCell(`W${i}`).value=e.courseInfo.coursePrice,c.getCell(`X${i}`).value="SkillsFuture"===e.courseInfo.payment?"SFC":e.courseInfo.payment,c.getCell(`AD${i}`).value=e.officialInfo.receiptNo,c.getCell(`V${i}`).value="Pasir Ris West Wellness Centre"===e.courseInfo.courseLocation?"510605,":"",d.eachCell({includeEmpty:!0},(e,t)=>{r.getCell(t).style=e.style})}else if("ILP"===a){c.getCell(`A${i}`).value=i-h+1,c.getCell(`B${i}`).value=e.participantInfo.name,c.getCell(`C${i}`).value=e.participantInfo.nric,c.getCell(`D${i}`).value=e.participantInfo.residentialStatus.substring(0,2);const t=null==(o=null==e?void 0:e.participantInfo)?void 0:o.dateOfBirth;if(t){const[e,s,a]=t.split("/");c.getCell(`E${i}`).value=null==a?void 0:a.trim()}c.getCell(`F${i}`).value=e.participantInfo.gender.split(" ")[0],c.getCell(`G${i}`).value=e.participantInfo.race.split(" ")[0][0],c.getCell(`H${i}`).value=e.participantInfo.contactNumber,c.getCell(`I${i}`).value=e.participantInfo.email;let s=e.participantInfo.educationLevel.replace(/[\u4e00-\u9fa5]+/g,"").replace(/No Formal Education.*/,"No formal education").replace(/Primary.*/,"Primary").replace(/Secondary.*/,"Secondary").replace(/Post-Secondary.*|Post Secondary.*/,"Post Secondary").replace(/Diploma.*/,"Diploma").replace(/Bachelor'?s Degree.*/,"Bachelor’s Degree").replace(/Master'?s Degree.*/,"Masters/Doctorate").replace(/Masters.*/,"Masters/Doctorate").replace(/Others?.*/,"Others").trim();c.getCell(`J${i}`).value=s;let a=e.courseInfo.courseEngName;c.getCell(`K${i}`).value=a,c.getCell(`L${i}`).value="";const[n,l]=e.courseInfo.courseDuration.split(" - ");c.getCell(`M${i}`).value=this.convertDateFormat1(n),c.getCell(`N${i}`).value=this.convertDateFormat1(l),c.getCell(`O${i}`).value="Face-to-Face"===e.courseInfo.courseMode?"F2F":e.courseInfo.courseMode,d.eachCell({includeEmpty:!0},(e,t)=>{r.getCell(t).style=e.style})}}),"NSA"===a){let e=`$${p.reduce((e,t)=>{var s;let a=(null==(s=null==t?void 0:t.courseInfo)?void 0:s.coursePrice)||"$0",o=parseFloat(a.replace("$",""));return e+(isNaN(o)?0:o)},0).toFixed(2)}`;c.getCell("R5").value=e}const u=yield l.xlsx.writeBuffer(),g=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});j.saveAs(g,i)}catch(s){console.error("Error exporting LOP:",s),this.props.warningPopUpMessage("An error occurred during export.")}})),d(this,"exportAttendance",()=>h(this,null,function*(){var e,t,s,a,o,i,r,n,l,c,d,h,p,u,g,m,f,y,{selectedRows:C}=this.state;if(console.log("Export Attendance - Selected Data:",C),0===C.length)return this.props.warningPopUpMessage("No rows selected. Please select rows to export.");const w=null==(t=null==(e=C[0])?void 0:e.courseInfo)?void 0:t.courseType,b=C.filter(e=>{const t=e.paymentStatus;return"NSA"===w?"Paid"===t||"SkillsFuture Done"===t:"Confirmed"===t});if(0===b.length){const e="NSA"===w?"No rows with payment status 'Paid' or 'SkillsFuture Done' found.":"No rows with payment status 'Confirmed' found.";return this.props.warningPopUpMessage(e)}try{let e=function(e){return`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`},t=function(e){return`${String(e.getDate()).padStart(2,"0")}${String(e.getMonth()+1).padStart(2,"0")}${e.getFullYear()}`},C=function(e){return`${String(e.getDate()).padStart(2,"0")} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]} ${e.getFullYear()}`};if("NSA"===w){const d="/external/Attendance.xlsx",h=yield fetch(d);if(!h.ok)return this.props.warningPopUpMessage("Error fetching the Excel file.");const p=yield h.arrayBuffer(),u=new P.Workbook;yield u.xlsx.load(p);const g=u.getWorksheet("Sheet1");if(!g)return this.props.warningPopUpMessage("Sheet 'Sheet1' not found!");const m=b[0],f=(null==(s=m.course)?void 0:s.courseEngName)||(null==(a=m.courseInfo)?void 0:a.courseEngName)||"Unknown Course",y=(null==(o=m.course)?void 0:o.courseLocation)||(null==(i=m.courseInfo)?void 0:i.courseLocation)||"Unknown Location",C=g.getCell("A1");C.value=`Course Title: ${f}`,C.font={name:"Calibri",size:18,bold:!0};let w="";const x=(null==(r=m.course)?void 0:r.courseDuration)||(null==(n=m.courseInfo)?void 0:n.courseDuration);if(x){const e=x.split("-");e&&e.length>0&&(w=e[0].trim())}console.log("Course Commerce Date:",w);const v=g.getCell("A2");v.value=`Course Commencement Date: ${w}`,v.font={name:"Calibri",size:18,bold:!0};const S=g.getCell("A3");S.value="Tampines 253 Centre"===y?"Venue: Blk 253 Tampines St 21 #01-406 Singapore 521253":"CT Hub"===y?"Venue: En Community Services Society 2 Kallang Avenue CT Hub #06-14 Singapore 339407":"Tampines North Community Centre"===y?"Venue: Tampines North Community Club Blk 421 Tampines St 41 #01-132 Singapore 520420":"Pasir Ris West Wellness Centre"===y?"Venue: Pasir Ris West Wellness Centre Blk 605 Elias Road #01-200 Singapore 510605":`Venue: ${y}`,S.font={name:"Calibri",size:18,bold:!0};let N=[...b].sort((e,t)=>{var s,a,o,i;const r=((null==(s=e.participant)?void 0:s.name)||(null==(a=e.participantInfo)?void 0:a.name)||"").trim().toLowerCase(),n=((null==(o=t.participant)?void 0:o.name)||(null==(i=t.participantInfo)?void 0:i.name)||"").trim().toLowerCase();return r.localeCompare(n)});console.log("Sorted Participants:",N);let D=6,R=1;for(let e=0;e<N.length;e++){const t=N[e],s=g.getCell(`A${D}`),a=g.getCell(`B${D}`);s.value=R,a.value=(null==(l=t.participant)?void 0:l.name)||(null==(c=t.participantInfo)?void 0:c.name)||"Unknown",s.font={name:"Calibri",size:18,bold:!0},a.font={name:"Calibri",size:18,bold:!0},D++,R++}const[A,T]=(x||"").split(" - ");let I=A?new Date(A):new Date,M=T?new Date(T):new Date(I.getTime()+2592e6);if(isNaN(I.getTime())||isNaN(M.getTime())){console.error("Invalid course dates:",{startDate:A,endDate:T});const e=new Date;I=e,M=new Date(e.getTime()+2592e6)}let k=1,L=new Date(I);const E=g.getRow(4);let F=[];for(let t=4;t<=42;t+=2)if(L<=M){const s=`L${k}: ${e(L)}`,a=E.getCell(t);a.value=s,a.font={name:"Calibri",size:16,bold:!0},F.push(t),L.setDate(L.getDate()+7),k++}const O=yield u.xlsx.writeBuffer(),$=new Blob([O],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});j.saveAs($,`Attendance (Course) ECSS${t(I)} ${f}.xlsx`)}else if("ILP"===w){const e=b[0],t="/external/2025 ILP Course Name Site Name Date of event.xlsx",s=yield fetch(t);if(!s.ok)return this.props.warningPopUpMessage("Error fetching the Excel file.");const a=yield s.arrayBuffer(),o=new P.Workbook;yield o.xlsx.load(a);const i=o.getWorksheet("Sheet1");if(!i)return this.props.warningPopUpMessage("Sheet 'Sheet1' not found!");const r=(null==(d=e.course)?void 0:d.courseEngName)||(null==(h=e.courseInfo)?void 0:h.courseEngName)||"Unknown Course",n=(null==(p=e.course)?void 0:p.courseLocation)||(null==(u=e.courseInfo)?void 0:u.courseLocation)||"Unknown Location";i.getCell("A1").value=`Course Title: ${r}`;let l="";const c=(null==(g=e.course)?void 0:g.courseDuration)||(null==(m=e.courseInfo)?void 0:m.courseDuration);if(c){const e=c.split("-");e&&e.length>0&&(l=e[0].trim())}console.log("Course Commerce Date:",l);i.getCell("A2").value=`Course Commencement Date: ${l}`;const w=i.getCell("A3");w.value="CT Hub"===n?"Venue: En Community Services Society 2 Kallang Avenue CT Hub #06-14 Singapore 339407":"Tampines North Community Centre"===n?"Venue: Tampines North Community Club Blk 421 Tampines St 41 #01-132 Singapore 520420":"Pasir Ris West Wellness Centre"===n?"Venue: Pasir Ris West Wellness Centre Blk 605 Elias Road #01-200 Singapore 510605":`Venue: ${n}`;i.getCell("C2").value="Tel: 67886625";i.getCell("C3").value="Submitted by: "+this.props.userName;i.getCell("C4").value="Date: "+C(new Date);let x=[...b].sort((e,t)=>{var s,a,o,i;const r=((null==(s=e.participant)?void 0:s.name)||(null==(a=e.participantInfo)?void 0:a.name)||"").trim().toLowerCase(),n=((null==(o=t.participant)?void 0:o.name)||(null==(i=t.participantInfo)?void 0:i.name)||"").trim().toLowerCase();return r.localeCompare(n)});console.log("Sorted Participants:",x);let v=6,S=1;for(let d=0;d<x.length;d++){const e=x[d];i.getCell(`A${v}`).value=S++;i.getCell(`B${v}`).value=(null==(f=e.participant)?void 0:f.name)||(null==(y=e.participantInfo)?void 0:y.name)||"",v++}const N=yield o.xlsx.writeBuffer(),D=new Blob([N],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});j.saveAs(D,`2025 ILP ${r} ${n} ${l}.xlsx`)}}catch(x){console.error("Error exporting attendance:",x),this.props.warningPopUpMessage("An error occurred during export: "+x.message)}})),d(this,"getCurrentDateTime",()=>{const e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getFullYear()).slice(2);return String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0"),String(e.getSeconds()).padStart(2,"0"),`${t}${s}${a}`}),d(this,"slideButtonRenderer",e=>{if("SkillsFuture"!==e.data.paymentMethod)return null;const t=e.value;return u.jsx("div",{className:"slide-button-container",children:u.jsx("input",{type:"checkbox",className:"slide-button",checked:t,onChange:t=>{const s=t.target.checked;e.api.getRowNode(e.node.id).setDataValue("confirmed",s),console.log("Slide button toggled:",s)}})})}),d(this,"paymentMethodRenderer",(e,t,s,a)=>{const o=e.value;let i;"NSA"===a||"Marriage Preparation Programme"===a?("Pasir Ris West Wellness Centre"===s&&(i="Community Ukulele – Mandarin"!==t?["PayNow","SkillsFuture"]:["PayNow"]),"Pasir Ris West Wellness Centre"===s?"Community Ukulele – Mandarin"!==t&&(i=["PayNow","SkillsFuture"]):i="Community Ukulele – Mandarin"!==t?["Cash","PayNow","SkillsFuture"]:["Cash","PayNow"]):i=[];return u.jsx("div",{className:"payment-method-buttons-container",children:i.map(t=>u.jsx("button",{className:"payment-method-button "+(t===o?"active":""),onClick:()=>(t=>{e.api.getRowNode(e.node.id).setDataValue("paymentMethod",t),console.log("Payment method changed to:",t)})(t),children:t},t))})}),d(this,"selectAllHeaderComponent",e=>{let t=!1;if(this.gridApi){const e=this.gridApi.getSelectedRows(),s=this.gridApi.getDisplayedRowCount();t=s>0&&e.length===s}return g.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",cursor:"pointer"},onClick:()=>{if(this.gridApi){const e=this.gridApi.getSelectedRows(),t=this.gridApi.getDisplayedRowCount();e.length===t&&t>0?this.gridApi.deselectAll():this.gridApi.selectAll(),setTimeout(()=>{this.gridApi&&this.gridApi.refreshHeader()},10)}},title:t?"Deselect all":"Select all"})}),d(this,"getColumnDefs",(e=null)=>{const{role:t,siteIC:s}=this.props;console.log("Props123455:",s);const{rowData:a}=this.state,o=e||a;if(o&&o.length>0){const e=o.filter(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)});console.log("getColumnDefs - Marriage Preparation Programme entries found:",e.length),e.length>0&&(console.log("getColumnDefs - Sample Marriage Preparation Programme data:",e[0]),console.log("getColumnDefs - Marriage Preparation Programme field values:",{spouseName:e[0].spouseName,maritalStatus:e[0].maritalStatus,intendedMarriageDate:e[0].intendedMarriageDate,housingType:e[0].housingType,spouseContact:e[0].spouseContact}))}const i=[{headerName:"S/N",field:"sn",width:100,pinned:"left"},{headerName:"Name",field:"name",width:300,editable:!0,pinned:"left"},{headerName:"Contact Number",field:"contactNo",width:150,editable:!0,pinned:"left"},{headerName:"Course Name",field:"course",width:350},{headerName:"Course Mode",field:"courseMode",width:150},{headerName:"Payment Method",field:"paymentMethod",cellRenderer:e=>{const{courseInfo:t}=e.data,{course:s,courseInfo:a}=e.data;return this.paymentMethodRenderer(e,s,a.courseLocation,a.courseType)},editable:!1,width:500,hide:!1},{headerName:"Sending Payment Details",field:"sendDetails",width:300,cellRenderer:e=>{var t;const s=null==(t=e.data)?void 0:t.sendDetails;if(void 0===s)return null;const a=s?"https://upload.wikimedia.org/wikipedia/commons/2/29/Tick-green.png":"https://upload.wikimedia.org/wikipedia/commons/5/5f/Red_X.svg";return u.jsx("img",{src:a,alt:s?"Sent":"Not Sent",width:"20",height:"20"})}},{headerName:"Confirmation",field:"confirmed",cellRenderer:e=>this.slideButtonRenderer(e),editable:!1,width:180,cellStyle:e=>"SkillsFuture"!==e.data.paymentMethod?{display:"none"}:{}},{headerName:"Receipt/Invoice Number",field:"recinvNo",width:300},{headerName:"Payment Date",field:"paymentDate",width:350,editable:!0},{headerName:"Refunded Date",field:"refundedDate",width:350,editable:!0},{headerName:"Payment Status",field:"paymentStatus",cellEditor:"agSelectCellEditor",cellEditorParams:e=>{const{paymentMethod:t,courseInfo:s,paymentStatus:a}=e.data,o="NSA"===s.courseType?"SkillsFuture"===t?["Pending","Generating SkillsFuture Invoice","SkillsFuture Done","Cancelled","Withdrawn","Refunded"]:["Pending","Paid","Cancelled","Withdrawn","Refunded"]:["Pending","Confirmed","Withdrawn"];let i;i="Pending"===a?o.filter(e=>"Withdrawn"!==e&&"Refunded"!==e):"Paid"===a?o.filter(e=>"Cancelled"!==e&&"Refunded"!==e):"Withdrawn"===a?o.filter(e=>"Cancelled"!==e):o;return{values:i.filter(e=>e!==a)}},cellRenderer:e=>{const t=e.value,s={Pending:"#FFA500","Generating SkillsFuture Invoice":"#00CED1","SkillsFuture Done":"#008000",Cancelled:"#FF0000",Withdrawn:"#800000",Paid:"#008000",Confirmed:"#008000",Refunded:"#D2691E"}[t]||"#D3D3D3";return u.jsx("span",{style:{display:"inline-block",padding:"0.25em 1.2em",borderRadius:"999px",fontWeight:"bold",color:"#fff",fontSize:"0.95em",textAlign:"center",minWidth:"100px",backgroundColor:s,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",letterSpacing:"0.02em",lineHeight:"1.8"},children:t})},editable:!0,width:350},{headerName:"Remarks",field:"remarks",width:300,editable:e=>!("Withdrawn"===e.data.paymentStatus||"Cancelled"===e.data.paymentStatus||"Refunded"===e.data.paymentStatus)}];!Array.isArray(s)&&s||this.state.hideMarriagePrepFields||i.splice(4,0,{headerName:"Course Location",field:"location",width:300,cellRenderer:e=>{if(!Array.isArray(s))return e.value;for(let t=0;t<s.length;t++)if(e.value===s[t])return e.value;return""}}),i.push({headerName:"",field:"checkbox",checkboxSelection:!0,width:50,pinned:"right",headerComponent:this.selectAllHeaderComponent});const{rowData:r}=this.state,{selectedCourseType:n}=this.props,l="NSA"===n||"ILP"===n,c="Marriage Preparation Programme"===n,d=!l&&o&&o.length>0&&o.some(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)}),h=c||d&&!this.state.hideMarriagePrepFields;if(console.log("Column generation debug:",{hasMarriagePrepData:d,hideMarriagePrepFields:this.state.hideMarriagePrepFields,shouldShowMarriagePrepColumns:h,isFilteringNSAorILP:l,isFilteringMarriagePrep:c,selectedCourseType:n}),h){const e=c?"specifically filtering by Marriage Preparation Programme":"Marriage Preparation Programme data detected and toggle is showing columns";console.log(`Adding Marriage Preparation Programme columns - ${e}`);const t=i.length-1;i.splice(t,0,{headerName:"Spouse Name",field:"spouseName",width:200,cellRenderer:e=>{var t,s;const a=e.value||"",o=e.data;return"Marriage Preparation Programme"===(null==(t=o.courseInfo)?void 0:t.courseType)&&console.log("Spouse Name - Raw data:",{spouseName:o.spouseName,spouseObject:o.spouse,marriageDetails:o.marriageDetails,courseType:null==(s=o.courseInfo)?void 0:s.courseType}),a||""}},{headerName:"Marital Status",field:"maritalStatus",width:150,cellRenderer:e=>{var t,s,a;const o=e.value||"",i=e.data;return"Marriage Preparation Programme"===(null==(t=i.courseInfo)?void 0:t.courseType)&&console.log("Marital Status - Raw data:",{maritalStatus:i.maritalStatus,marriageDetailsMaritalStatus:null==(s=i.marriageDetails)?void 0:s.maritalStatus,courseType:null==(a=i.courseInfo)?void 0:a.courseType}),o||""}},{headerName:"Marriage Duration",field:"intendedMarriageDate",width:200,cellRenderer:e=>{var t,s,a;const o=e.value||"",i=e.data;return"Marriage Preparation Programme"===(null==(t=i.courseInfo)?void 0:t.courseType)&&console.log("Marriage Duration - Raw data:",{intendedMarriageDate:i.intendedMarriageDate,marriageDetailsMarriageDuration:null==(s=i.marriageDetails)?void 0:s.marriageDuration,courseType:null==(a=i.courseInfo)?void 0:a.courseType}),o||""}},{headerName:"Housing Type",field:"housingType",width:150,cellRenderer:e=>{var t,s,a;const o=e.value||"",i=e.data;return"Marriage Preparation Programme"===(null==(t=i.courseInfo)?void 0:t.courseType)&&console.log("Housing Type - Raw data:",{housingType:i.housingType,marriageDetailsHousingType:null==(s=i.marriageDetails)?void 0:s.housingType,courseType:null==(a=i.courseInfo)?void 0:a.courseType}),o||""}},{headerName:"Spouse Contact",field:"spouseContact",width:150,cellRenderer:e=>{var t,s,a,o;const i=e.value||"",r=e.data;return"Marriage Preparation Programme"===(null==(t=r.courseInfo)?void 0:t.courseType)&&console.log("Spouse Contact - Raw data:",{spouseContact:r.spouseContact,spouseMobile:null==(s=r.spouse)?void 0:s.mobile,spouseContactNumber:null==(a=r.spouse)?void 0:a.contactNumber,courseType:null==(o=r.courseInfo)?void 0:o.courseType}),i||""}},{headerName:"Gross Monthly Income",field:"grossMonthlyIncome",width:180,cellRenderer:e=>e.value||""||""},{headerName:"Type of Marriage",field:"typeOfMarriage",width:200,cellRenderer:e=>e.value||""||""},{headerName:"Has Children",field:"hasChildren",width:120,cellRenderer:e=>e.value||""||""},{headerName:"How Found Out",field:"howFoundOut",width:150,cellRenderer:e=>e.value||""||""},{headerName:"Spouse NRIC",field:"spouseNric",width:150,cellRenderer:e=>e.value||""||""},{headerName:"Spouse Email",field:"spouseEmail",width:200,cellRenderer:e=>e.value||""||""},{headerName:"Marriage Prep Consent 1",field:"marriagePrepConsent1",width:180,cellRenderer:e=>{var t,s;const a=e.value,o=e.data;return"Marriage Preparation Programme"===(null==(t=o.courseInfo)?void 0:t.courseType)&&console.log("Marriage Prep Consent 1 - Raw data:",{marriagePrepConsent1:o.marriagePrepConsent1,consentObject:o.consent,courseType:null==(s=o.courseInfo)?void 0:s.courseType}),"boolean"==typeof a?a?"I confirm that my spouse/spouse-to-be and I understand and agree to the collection, use and disclosure of our Personal Information as set out in the link above":"":a||""}},{headerName:"Marriage Prep Consent 2",field:"marriagePrepConsent2",width:180,cellRenderer:e=>{var t,s;const a=e.value,o=e.data;return"Marriage Preparation Programme"===(null==(t=o.courseInfo)?void 0:t.courseType)&&console.log("Marriage Prep Consent 2 - Raw data:",{marriagePrepConsent2:o.marriagePrepConsent2,consentObject:o.consent,courseType:null==(s=o.courseInfo)?void 0:s.courseType}),"boolean"==typeof a?a?"I confirm that I have read and understood the Terms of Consent as set out in the link above":"":a||""}})}else l?console.log(`Skipping Marriage Preparation Programme columns - filtering by ${n}`):console.log("Skipping Marriage Preparation Programme columns - no Marriage Preparation Programme data found");return i}),d(this,"debugMarriagePrepData",()=>{const{rowData:e}=this.state;if(!e)return;const t=e.filter(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)});console.log("=== Marriage Preparation Programme Debug Information ==="),console.log("Total Marriage Preparation Programme registrations:",t.length),t.forEach((e,t)=>{var s;console.log(`Marriage Preparation Programme Entry ${t+1}:`,{id:e.id,participantName:e.name,courseName:e.course,courseType:null==(s=e.courseInfo)?void 0:s.courseType,spouseName:e.spouseName,maritalStatus:e.maritalStatus,marriageDuration:e.intendedMarriageDate,housingType:e.housingType,spouseContact:e.spouseContact,grossMonthlyIncome:e.grossMonthlyIncome,typeOfMarriage:e.typeOfMarriage,hasChildren:e.hasChildren,howFoundOut:e.howFoundOut,spouseNric:e.spouseNric,spouseEmail:e.spouseEmail,marriagePrepConsent1:e.marriagePrepConsent1,marriagePrepConsent2:e.marriagePrepConsent2,rawSpouse:e.spouse,rawMarriageDetails:e.marriageDetails,rawConsent:e.consent})}),console.log("=== End Marriage Preparation Programme Debug ===")}),d(this,"handleDelete",e=>h(this,null,function*(){yield this.props.generateDeleteConfirmationPopup(e)})),d(this,"handlePortOver",(e,t,s,a)=>h(this,null,function*(){console.log("Params1:",e,t,s,a),yield this.props.generatePortOverConfirmationPopup(e,t,s,a)})),d(this,"getRowData",e=>{const t=e.map((e,t)=>{var s,a,o,i,r,n,l,c,d,h,p,u,g,m,f,y,C,w,b;return{id:e._id,sn:t+1,name:e.participant.name,contactNo:e.participant.contactNumber,course:e.course.courseEngName,courseChi:e.course.courseChiName,location:e.course.courseLocation,courseMode:"Face-to-Face"===e.course.courseMode?"F2F":null==(s=e.course)?void 0:s.courseMode,paymentMethod:e.course.payment,confirmed:e.official.confirmed,paymentStatus:e.status,recinvNo:e.official.receiptNo,participantInfo:e.participant,courseInfo:e.course,officialInfo:e.official,agreement:e.agreement,status:e.status,registrationDate:e.registrationDate,refundedDate:(null==(a=e.official)?void 0:a.refundedDate)||"",remarks:(null==(o=e.official)?void 0:o.remarks)||"",paymentDate:(null==(i=e.official)?void 0:i.date)||"",marriageDetails:e.marriageDetails||null,spouse:e.spouse||null,consent:e.consent||null,marriagePrepConsent:e.marriagePrepConsent||null,spouseName:(null==(r=e.spouse)?void 0:r.name)||e.spouseName||"",maritalStatus:(null==(n=e.marriageDetails)?void 0:n.maritalStatus)||e.maritalStatus||"",intendedMarriageDate:(null==(l=e.marriageDetails)?void 0:l.marriageDuration)||e.intendedMarriageDate||"",housingType:(null==(c=e.marriageDetails)?void 0:c.housingType)||e.housingType||"",grossMonthlyIncome:(null==(d=e.marriageDetails)?void 0:d.grossMonthlyIncome)||e.grossMonthlyIncome||"",typeOfMarriage:(null==(h=e.marriageDetails)?void 0:h.typeOfMarriage)||e.typeOfMarriage||"",hasChildren:(null==(p=e.marriageDetails)?void 0:p.hasChildren)||e.hasChildren||"",howFoundOut:(null==(u=e.marriageDetails)?void 0:u.howFoundOut)||e.howFoundOut||"",sourceOfReferral:(null==(g=e.marriageDetails)?void 0:g.sourceOfReferral)||e.sourceOfReferral||"",spouseNric:(null==(m=e.spouse)?void 0:m.nric)||e.spouseNric||"",spouseContact:(null==(f=e.spouse)?void 0:f.mobile)||(null==(y=e.spouse)?void 0:y.contactNumber)||e.spouseContact||"",spouseEmail:(null==(C=e.spouse)?void 0:C.email)||e.spouseEmail||"",marriagePrepConsent1:(null==(w=e.consent)?void 0:w.marriagePrepConsent1)||e.marriagePrepConsent1||!1,marriagePrepConsent2:(null==(b=e.consent)?void 0:b.marriagePrepConsent2)||e.marriagePrepConsent2||!1}}),s=t.filter(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)}).length;if(console.log("Marriage Preparation Programme registrations found:",s),s>0){const e=t.find(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)});console.log("Marriage Preparation Programme data sample:",e),console.log("Marriage Preparation Programme spouse data:",null==e?void 0:e.spouse),console.log("Marriage Preparation Programme marriage details:",null==e?void 0:e.marriageDetails),console.log("Marriage Preparation Programme quick fields:",{spouseName:null==e?void 0:e.spouseName,maritalStatus:null==e?void 0:e.maritalStatus,intendedMarriageDate:null==e?void 0:e.intendedMarriageDate})}this.setState({rowData:t,columnDefs:this.getColumnDefs()},()=>{this.debugMarriagePrepData()})}),d(this,"handleValueClick",e=>h(this,null,function*(){console.log("Event (column header name):",e.colDef.headerName);const t=e.data.id,s=e.colDef.headerName,a=e.data.recinvNo,o=e.data.participantInfo,i=e.data.courseInfo,r=e.data.officialInfo,n=e.rowIndex,l=this.state.expandedRowIndex;try{if("S/N"===s)if(l===n)this.setState({expandedRowIndex:null},()=>{const e=document.getElementById(`detail-view-${n}`);e&&(f.unmountComponentAtNode(e),e.remove())});else{if(null!==l){const e=document.getElementById(`detail-view-${l}`);e&&(f.unmountComponentAtNode(e),e.remove())}this.setState({expandedRowIndex:n},()=>{if(this.gridApi&&"function"==typeof this.gridApi.getRowNode)try{this.gridApi.getRowNode(e.node.id)}catch(t){console.warn("Error getting row node:",t)}})}else if("Receipt/Invoice Number"===s)""!==a&&(this.props.showUpdatePopup("In Progress... Please wait..."),yield this.receiptShown(o,i,a,r),this.props.closePopup());else if("Contact Number"===s){if(console.log("Entry (Contact Number):",e.data.paymentStatus),o&&o.contactNumber&&"SkillsFuture"===i.payment){const e=o.contactNumber.replace(/\D/g,""),t=`${o.name} - ${i.courseEngName} invoice for your SkillsFuture submission\n              Please ensure that the details are accurate before submission.\n              🔴 Please send us a screenshot of your submission once done.\n              More Information: https://ecss.org.sg/wp-content/uploads/2025/07/Step-by-step-guide-on-how-to-do-Skillsfuture-claim-submission.pdf`,s=`https://web.whatsapp.com/send?phone=${e}&text=${encodeURIComponent(t)}`;window.open(s,"_blank")}else if(o&&o.contactNumber&&("PayNow"===i.payment||"Cash"===i.payment)){const e=o.contactNumber.replace(/\D/g,"");let t=`${i.courseEngName} - ${i.courseDuration.split("–")[0]}\n              Course subsidy applies to only Singaporeans and PRs aged 50yrs and above\n              Hi ${o.name}, \n              Thank you for signing up for the above-mentioned class. \n              Details are as follows:\n              Price: ${i.coursePrice}\n              Payment to be made via Paynow to UEN no: T03SS0051L (En Community Services Society) \n              Under the "reference portion", kindly insert your name as per NRIC. \n              Once payment has gone through, take a screenshot of the payment receipt on your phone and send it over to us. \n              Thank you.`;const s=`https://web.whatsapp.com/send?phone=+65${e}&text=${encodeURIComponent(t)}`;window.open(s,"_blank"),console.log("Whatsapp Link:",s)}else if(o&&o.contactNumber&&"Pending"===e.data.paymentStatus){const e=o.contactNumber.replace(/\D/g,"");let t=`Hi ${o.name},\n                            Thank you for registering for ${i.courseEngName}.\n                            We’re sorry to inform you that the course is currently full.\n\n                            We appreciate your interest and will be in touch should a spot become available.`;const s=`https://web.whatsapp.com/send?phone=+65${e}&text=${encodeURIComponent(t)}`;console.log("Whatsapp Link:",s),window.open(s,"_blank")}console.log("Submitted Id:",t),yield this.sendDetails(t)}}catch(c){console.error("Error during submission:",c)}})),d(this,"getDetailGridOptions",()=>({columnDefs:[{headerName:"Detail Info",field:"detailInfo",width:500},{headerName:"More Info",field:"moreInfo",width:500}],domLayout:"autoHeight"})),d(this,"getRowStyle",e=>{const{expandedRowIndex:t,rowData:s}=this.state,a=e.rowIndex,o=s&&s[a];if(null!==t&&t===a)return{background:"#f1f1f1",borderBottom:"1px solid #ddd"};if(o&&o.courseInfo&&"ILP"===o.courseInfo.courseType)return{background:"#d0f5e8"};if(o&&o.courseInfo&&"Marriage Preparation Programme"===o.courseInfo.courseType)return{background:"#fff9c4"};const i=this.getAnomalyRowStyles(s);return i&&i[a]?i[a]:null}),d(this,"renderDetailView",e=>{if(!e)return null;const{participantInfo:t,courseInfo:s,officialInfo:a,status:o,id:i,marriageDetails:r,spouse:n,consent:l}=e,c="Marriage Preparation Programme"===s.courseType;return u.jsxs("div",{className:"detail-view-container",children:[u.jsx("div",{className:"detail-view-header",children:u.jsx("h3",{children:"Registration Details"})}),u.jsxs("div",{className:"detail-view-content",children:[u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Participant Information"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Name:"}),u.jsx("span",{className:"detail-value",children:t.name})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"NRIC:"}),u.jsx("span",{className:"detail-value",children:t.nric})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Contact:"}),u.jsx("span",{className:"detail-value",children:t.contactNumber})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Email:"}),u.jsx("span",{className:"detail-value",children:t.email})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Gender:"}),u.jsx("span",{className:"detail-value",children:t.gender})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"DOB:"}),u.jsx("span",{className:"detail-value",children:t.dateOfBirth})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Residential Status:"}),u.jsx("span",{className:"detail-value",children:t.residentialStatus})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Race:"}),u.jsx("span",{className:"detail-value",children:t.race})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Postal Code:"}),u.jsx("span",{className:"detail-value",children:t.postalCode})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Education Level:"}),u.jsx("span",{className:"detail-value",children:t.educationLevel})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Work Status:"}),u.jsx("span",{className:"detail-value",children:t.workStatus})]})]})]}),c&&r&&u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Marriage Details"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Marital Status:"}),u.jsx("span",{className:"detail-value",children:r.maritalStatus||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Housing Type:"}),u.jsx("span",{className:"detail-value",children:r.housingType||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Gross Monthly Income:"}),u.jsx("span",{className:"detail-value",children:r.grossMonthlyIncome||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Marriage Duration:"}),u.jsx("span",{className:"detail-value",children:r.marriageDuration||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Type of Marriage:"}),u.jsx("span",{className:"detail-value",children:r.typeOfMarriage||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Has Children:"}),u.jsx("span",{className:"detail-value",children:r.hasChildren||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"How Found Out:"}),u.jsx("span",{className:"detail-value",children:r.howFoundOut||"N/A"})]}),r.howFoundOutOthers&&u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"How Found Out (Others):"}),u.jsx("span",{className:"detail-value",children:r.howFoundOutOthers})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Source of Referral:"}),u.jsx("span",{className:"detail-value",children:r.sourceOfReferral||"N/A"})]})]})]}),c&&n&&u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Spouse Information"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Name:"}),u.jsx("span",{className:"detail-value",children:n.name||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse NRIC:"}),u.jsx("span",{className:"detail-value",children:n.nric||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Contact:"}),u.jsx("span",{className:"detail-value",children:n.mobile||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Email:"}),u.jsx("span",{className:"detail-value",children:n.email||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Sex:"}),u.jsx("span",{className:"detail-value",children:n.sex||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse DOB:"}),u.jsx("span",{className:"detail-value",children:n.dateOfBirth||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Ethnicity:"}),u.jsx("span",{className:"detail-value",children:n.ethnicity||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Residential Status:"}),u.jsx("span",{className:"detail-value",children:n.residentialStatus||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Marital Status:"}),u.jsx("span",{className:"detail-value",children:n.maritalStatus||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Education:"}),u.jsx("span",{className:"detail-value",children:n.education||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Housing Type:"}),u.jsx("span",{className:"detail-value",children:n.housingType||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Spouse Postal Code:"}),u.jsx("span",{className:"detail-value",children:n.postalCode||"N/A"})]})]})]}),c&&l&&u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Consent & Agreements"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"I confirm that my spouse/spouse-to-be and I understand and agree to the collection, use and disclosure of our Personal Information as set out in the link above:"}),u.jsx("span",{className:"detail-value",children:l.marriagePrepConsent1?"I confirm that my spouse/spouse-to-be and I understand and agree to the collection, use and disclosure of our Personal Information as set out in the link above":""})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"I confirm that I have read and understood the Terms of Consent as set out in the link above:"}),u.jsx("span",{className:"detail-value",children:l.marriagePrepConsent2?"I confirm that I have read and understood the Terms of Consent as set out in the link above":""})]})]})]}),u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Course Information"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Course Type:"}),u.jsx("span",{className:"detail-value",children:s.courseType})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"English Name:"}),u.jsx("span",{className:"detail-value",children:s.courseEngName})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Chinese Name:"}),u.jsx("span",{className:"detail-value",children:s.courseChiName})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Location:"}),u.jsx("span",{className:"detail-value",children:s.courseLocation})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Mode:"}),u.jsx("span",{className:"detail-value",children:s.courseMode})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Price:"}),u.jsx("span",{className:"detail-value",children:s.coursePrice})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Duration:"}),u.jsx("span",{className:"detail-value",children:s.courseDuration})]})]})]}),u.jsxs("div",{className:"detail-view-section",children:[u.jsx("h4",{children:"Payment Information"}),u.jsxs("div",{className:"detail-view-grid",children:[u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Payment Method:"}),u.jsx("span",{className:"detail-value",children:s.payment})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Payment Status:"}),u.jsx("span",{className:"detail-value",children:o})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Confirmation Status:"}),u.jsx("span",{className:"detail-value",children:a.confirmed?"Confirmed":"Not Confirmed"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Receipt/Invoice Number:"}),u.jsx("span",{className:"detail-value",children:a.receiptNo||"N/A"})]}),a.refundedDate&&u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Refunded Date:"}),u.jsx("span",{className:"detail-value",children:a.refundedDate})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Staff Name:"}),u.jsx("span",{className:"detail-value",children:a.name||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Received Date:"}),u.jsx("span",{className:"detail-value",children:a.date||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Received Time:"}),u.jsx("span",{className:"detail-value",children:a.time||"N/A"})]}),u.jsxs("div",{className:"detail-field",children:[u.jsx("span",{className:"detail-label",children:"Remarks:"}),u.jsx("span",{className:"detail-value",children:a.remarks||"N/A"})]})]})]})]})]})}),d(this,"onCellValueChanged",e=>h(this,null,function*(){const t=e.colDef.headerName,s=e.data.id;e.data.sn;const a=e.data.course,o=e.data.courseChi,i=e.data.location,r=e.value,n=e.data.participantInfo,l=e.data.courseInfo,c=e.data.officialInfo;e.data.confirmed;const d=e.data.paymentMethod;e.data.paymentStatus;const p=e.oldValue;try{if("Payment Method"===t){if(this.props.showUpdatePopup("Updating in progress... Please wait ..."),yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updatePaymentMethod",id:s,newUpdatePayment:r,staff:this.props.userName}),console.log("newPaymentMethod:",r),"Cash"===r||"PayNow"===r){if(!0===(yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updatePaymentStatus",id:s,newUpdateStatus:"Paid",staff:this.props.userName})).data.result){const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,"Paid"),this.autoReceiptGenerator(s,n,l,c,r,"Paid"),this.automatedWhatsappMessage(n,l,"course_reservation_successful_om","payment")]),console.log("Updated Successfully")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}}}else if("Confirmation"===t){this.props.showUpdatePopup("Updating in progress... Please wait ..."),console.log("Cell clicked",e);const a=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updateConfirmationStatus",id:s,newConfirmation:r,staff:this.props.userName});if(console.log(`${t}: ${r}`),"SkillsFuture"===d&&!0===r&&!0===a.data.result){console.log("Auto Generate SkillsFuture Invoice");if(!0===(yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updatePaymentStatus",id:s,newUpdateStatus:"Generating SkillsFuture Invoice",staff:this.props.userName})).data.result){const e=()=>h(this,null,function*(){try{yield Promise.all([this.autoReceiptGenerator(s,n,l,c,d,"Generating SkillsFuture Invoice")]),console.log("Updated Successfully")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}}console.log("Change SkillsFuture Confirmation")}else if("Payment Status"===t){this.props.showUpdatePopup("Updating in progress... Please wait ..."),console.log("Cell clicked",e);const t=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"updatePaymentStatus",id:s,newUpdateStatus:r,staff:this.props.userName});if(console.log("Response for Payment Status1:",t),!0===t.data.result)if(console.log("New Payment Status:",r),"Cash"===d||"PayNow"===d)if(console.log("Update Payment Status Success1"),"Withdrawn"===r){if(console.log("Old Payment Status:",p),"Paid"===p){const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r)]),console.log("Both tasks completed successfully.");yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{id:s,purpose:"removedRefundedDate"})}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}}else if("Refunded"===r){const e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{id:s,purpose:"addRefundedDate"});console.log("Response Add Refunded Date:",e)}else{const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r),this.receiptGenerator(s,n,l,c,r),"Paid"===r?this.automatedWhatsappMessage(n,l,"course_reservation_successful_om","payment"):Promise.resolve()]),console.log("Both tasks completed successfully.")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}else if("SkillsFuture"===d){if("SkillsFuture Done"===r){const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r)]),console.log("Both tasks completed successfully.")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}else if("Cancelled"===r)if(console.log("SkillsFuture, Old Payment Status:",p),"SkillsFuture Done"===p){const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r)]),console.log("Both tasks completed successfully.");const e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{id:s,purpose:"removedRefundedDate"});console.log("Response Add Refunded Date:",e)}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}else if("Refunded"===r){const e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{id:s,purpose:"addRefundedDate"});console.log("Response Add Refunded Date:",e)}else console.log("SkillsFuture: Do not need to update Woocommerce")}else if("ILP"===l.courseType)if("Confirmed"===r){console.log("Confirm ILP Course");const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r),this.automatedWhatsappMessage(n,l,"course_reservation_successful_ilp","payment")]),console.log("Both tasks completed successfully.")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}else if("Cancelled"===r){console.log("Confirm ILP Course");const e=()=>h(this,null,function*(){try{yield Promise.all([this.updateWooCommerceForRegistrationPayment(o,a,i,r)]),console.log("Both tasks completed successfully.")}catch(e){console.error("Error occurred during parallel task execution:",e)}});yield e()}}else if("Remarks"===t)if(console.log("Now editing remarks",r),""!==r){yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"addCancelRemarks",id:s,editedValue:r})}else alert("No remarks added");else{console.log("Updated Particulars:",e.colDef.field,r);yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"edit",id:s,field:e.colDef.field,editedValue:r})}this.refreshChild()}catch(u){console.error("Error during submission:",u),this.props.closePopup()}})),d(this,"refreshChild",()=>h(this,null,function*(){const{language:e}=this.props;console.log("RefreshChild called - fetching new data");const t=document.querySelector(".ag-body-viewport"),s=t?t.scrollTop:0;try{const{data:a,data1:o}=yield this.fetchCourseRegistrations(e);console.log("Fetched data length:",(null==a?void 0:a.length)||0),this.setState({originalData:a||[],registerationDetails:a||[]},()=>{console.log("Original data updated, generating row data"),this.getRowData(a||[]),console.log("Re-applying filters after data refresh"),this.filterRegistrationDetails(),t&&(t.scrollTop=s),this.props.closePopup()})}catch(a){console.error("Error in refreshChild:",a),this.props.closePopup()}})),d(this,"sendDetails",e=>h(this,null,function*(){yield this.props.generateSendDetailsConfirmationPopup(e)})),d(this,"openBulkUpdateModal",()=>{0!==this.state.selectedRows.length?this.setState({showBulkUpdateModal:!0}):alert("Please select at least one row to update.")}),d(this,"closeBulkUpdateModal",()=>{this.setState({showBulkUpdateModal:!1,bulkUpdateStatus:"",bulkUpdateMethod:""})}),d(this,"handleBulkUpdate",()=>h(this,null,function*(){const{selectedRows:e,bulkUpdateStatus:t,bulkUpdateMethod:s}=this.state;if(t||s){this.props.showUpdatePopup(`Updating ${e.length} records... Please wait...`);try{const a={purpose:"bulkUpdate",updates:e.map(e=>({id:e.id,paymentStatus:t||null,paymentMethod:s||null})),staff:this.props.userName},o=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",a);if(!0!==o.data.result)throw new Error(o.data.message||"Bulk update failed");this.closeBulkUpdateModal(),yield this.refreshChild(),this.props.closePopup(),alert(`Successfully updated ${e.length} records.`)}catch(a){console.error("Error during bulk update:",a),this.props.closePopup(),alert("Error occurred during bulk update. Please try again.")}}else alert("Please select a status or payment method to update.")})),d(this,"onSelectionChanged",e=>{const t=e.api.getSelectedRows();this.setState({selectedRows:t}),setTimeout(()=>{e.api&&"function"==typeof e.api.refreshHeader&&e.api.refreshHeader()},10)}),d(this,"onGridReady",e=>{this.gridApi=e.api,this.gridColumnApi=e.columnApi,console.log("Grid API initialized successfully")}),d(this,"archiveData",()=>h(this,null,function*(){const{registerationDetails:e}=this.state,{selectedCourseType:t}=this.props;if(0!==e.length)try{const s=e.some(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.course)?void 0:t.courseType)}),a="All Courses Types"===t&&s||"Marriage Preparation Programme"===t||!t&&s,o=[],i=["S/N","Participant Name","Participant NRIC","Participant Residential Status","Participant Race","Participant Gender","Participant Date of Birth","Participant Contact Number","Participant Email","Participant Postal Code","Participant Education Level","Participant Work Status","Course Type","Course English Name","Course Chinese Name","Course Location","Course Mode","Course Price","Course Duration","Payment Method","Registration Date","Agreement","Payment Status","Confirmation Status","Refunded Date","WhatsApp Message Sent","Staff Name","Received Date","Received Time","Receipt/Invoice Number","Remarks"],r=["Spouse Name","Marital Status","Marriage Duration","Housing Type","Gross Monthly Income","Type of Marriage","Has Children","How Found Out","Source of Referral","Spouse NRIC","Spouse Contact","Spouse Email","Spouse Sex","Spouse DOB","Spouse Ethnicity","Spouse Residential Status","Spouse Marital Status","Spouse Education","Spouse Housing Type","Spouse Postal Code","I confirm that I have read and understood the Terms of Consent as set out in the link above","I confirm that I have read and understood the Terms of Consent as set out in the link above"],n=a?[...i,...r]:i;o.push(n),e.forEach((e,t)=>{var s,i,r,n,l,c,d,h,p,u,g,m,f,y,C,w,b,x,v,S,N,D,P,j,R,A,T,I,M,k;const L=[...[t+1,e.participant.name,e.participant.nric,e.participant.residentialStatus,e.participant.race,e.participant.gender,e.participant.dateOfBirth,e.participant.contactNumber,e.participant.email,e.participant.postalCode,e.participant.educationLevel,e.participant.workStatus,e.course.courseType,e.course.courseEngName,e.course.courseChiName,e.course.courseLocation,e.course.courseMode,e.course.coursePrice,e.course.courseDuration,e.course.payment,e.registrationDate,e.agreement,e.status,(null==(s=e.official)?void 0:s.confirmed)||!1,(null==(i=e.official)?void 0:i.refundedDate)||"",e.sendingWhatsappMessage||!1,(null==(r=e.official)?void 0:r.name)||"",(null==(n=e.official)?void 0:n.date)||"",(null==(l=e.official)?void 0:l.time)||"",(null==(c=e.official)?void 0:c.receiptNo)||"",(null==(d=e.official)?void 0:d.remarks)||""],...a?[e.spouseName||(null==(h=e.spouse)?void 0:h.name)||"",e.maritalStatus||(null==(p=e.marriageDetails)?void 0:p.maritalStatus)||"",e.intendedMarriageDate||(null==(u=e.marriageDetails)?void 0:u.marriageDuration)||"",e.housingType||(null==(g=e.marriageDetails)?void 0:g.housingType)||"",e.grossMonthlyIncome||(null==(m=e.marriageDetails)?void 0:m.grossMonthlyIncome)||"",e.typeOfMarriage||(null==(f=e.marriageDetails)?void 0:f.typeOfMarriage)||"",e.hasChildren||(null==(y=e.marriageDetails)?void 0:y.hasChildren)||"",e.howFoundOut||(null==(C=e.marriageDetails)?void 0:C.howFoundOut)||"",e.sourceOfReferral||(null==(w=e.marriageDetails)?void 0:w.sourceOfReferral)||"",e.spouseNric||(null==(b=e.spouse)?void 0:b.nric)||"",e.spouseContact||(null==(x=e.spouse)?void 0:x.mobile)||(null==(v=e.spouse)?void 0:v.contactNumber)||"",e.spouseEmail||(null==(S=e.spouse)?void 0:S.email)||"",e.spouseSex||(null==(N=e.spouse)?void 0:N.sex)||"",e.spouseDob||(null==(D=e.spouse)?void 0:D.dob)||"",e.spouseEthnicity||(null==(P=e.spouse)?void 0:P.ethnicity)||"",e.spouseResidentialStatus||(null==(j=e.spouse)?void 0:j.residentialStatus)||"",e.spouseMaritalStatus||(null==(R=e.spouse)?void 0:R.maritalStatus)||"",e.spouseEducation||(null==(A=e.spouse)?void 0:A.education)||"",e.spouseHousingType||(null==(T=e.spouse)?void 0:T.housingType)||"",e.spousePostalCode||(null==(I=e.spouse)?void 0:I.postalCode)||"",e.marriagePrepConsent1||(null==(M=e.consent)?void 0:M.marriagePrepConsent1)?"I confirm that my spouse/spouse-to-be and I understand and agree to the collection, use and disclosure of our Personal Information as set out in the link above":"",e.marriagePrepConsent2||(null==(k=e.consent)?void 0:k.marriagePrepConsent2)?"I confirm that I have read and understood the Terms of Consent as set out in the link above":""]:[]];o.push(L)});const l=R.aoa_to_sheet(o),c=R.book_new();R.book_append_sheet(c,l,"Archived Data");const d=new Date,h=`${String(d.getDate()).padStart(2,"0")}-${String(d.getMonth()+1).padStart(2,"0")}-${d.getFullYear()}`,p=`archived_data_${h}${a?"_with_marriage_prep":""}${t&&"All Courses Types"!==t?`_${t.replace(/\s+/g,"_")}`:""}`,u=A(c,{bookType:"xlsx",type:"array"}),g=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=document.createElement("a");m.href=window.URL.createObjectURL(g),m.download=`${p}.xlsx`,m.click(),window.URL.revokeObjectURL(m.href),this.props.closePopup();const f=e.filter(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.course)?void 0:t.courseType)}).length;let y;if(a&&f>0){const s="All Courses Types"===t?"all course types":t||"current filter";y=`Successfully archived ${e.length} records from ${s} (including ${f} Marriage Preparation Programme entries with extended fields).`}else y=t&&"All Courses Types"!==t?`Successfully archived ${e.length} records for ${t}.`:`Successfully archived ${e.length} records.`;alert(y)}catch(s){console.error("Error during archive:",s),this.props.closePopup(),alert("Error occurred during archive. Please try again.")}else alert("No data available to archive.")})),this.state={hideMarriagePrepFields:!0,registerationDetails:[],isLoading:!0,focusedInputIndex:null,originalData:[],currentPage:1,entriesPerPage:100,remarks:"",paginatedDetails:[],columnDefs:[],rowData:[],expandedRowIndex:null,editedRowIndex:"",aiSearchQuery:"",aiSuggestions:[],anomalyThreshold:.8,phoneNumber:"",message:"",status:"",isAlertShown:!1,selectedRows:[],showBulkUpdateModal:!1,bulkUpdateStatus:"",bulkUpdateMethod:""},this.tableRef=g.createRef(),this.gridRef=g.createRef()}convertToChineseDate(e){const[t,s,a]=e.split(" ");return`${a}年${{January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12}[s]}月${parseInt(t)}日`}languageDatabase(e,t){if(!Array.isArray(e))return[];for(let s=0;s<e.length;s++)if("en"===t){const t=e[s].participant;t.residentialStatus=t.residentialStatus.split(" ")[0],t.race=t.race.split(" ")[0],3===t.educationLevel.split(" ").length?t.educationLevel=t.educationLevel.split(" ").slice(0,2).join(" "):t.educationLevel=t.educationLevel.split(" ")[0],3===t.workStatus.split(" ").length?t.workStatus=t.workStatus.split(" ").slice(0,2).join(" "):t.workStatus=t.workStatus.split(" ")[0],e[s].agreement=e[s].agreement.split(" ")[0]}else if("zh"===t){const t=e[s].participant;t.residentialStatus=t.residentialStatus.split(" ")[1],t.race=t.race.split(" ")[1],t.gender="M"===t.gender?"男":"F"===t.gender?"女":t.gender,3===t.educationLevel.split(" ").length?t.educationLevel=t.educationLevel.split(" ")[2]:t.educationLevel=t.educationLevel.split(" ")[1],3===t.workStatus.split(" ").length?t.workStatus=t.workStatus.split(" ")[2]:t.workStatus=t.workStatus.split(" ")[1],e[s].course.courseDuration.split("-")[0].trim(),e[s].course.courseDuration.split("-")[1].trim(),e[s].course.courseEngName=e[s].course.courseChiName}return e}componentDidMount(){return h(this,null,function*(){yield this.fetchAndSetRegistrationData(),this.socket=L("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net"),this.socket.on("registration",e=>{console.log("Socket event received",e),this.fetchAndSetRegistrationData()})})}componentWillUnmount(){this.socket&&this.socket.disconnect()}fetchAndSetRegistrationData(){return h(this,null,function*(){const e=document.querySelector(".ag-body-viewport"),t=e?e.scrollTop:0,s=this.gridApi&&"function"==typeof this.gridApi.paginationGetCurrentPage?this.gridApi.paginationGetCurrentPage():0,{language:a,siteIC:o,role:i}=this.props,{data:r,data1:n}=yield this.fetchCourseRegistrations(a);console.log("All Courses Registration: ",r);var l=yield this.getAllLocations(r),c=yield this.getAllTypes(r),d=yield this.getAllNames(r),p=yield this.getAllQuarters(r);this.props.passDataToParent(l,c,d,p),yield this.props.getTotalNumberofDetails(r.length);const u={};r.forEach((e,t)=>{u[t]=e.status||"Pending"});const g={};r.forEach((e,t)=>{g[t]=e.official.remarks}),this.setState({originalData:r,registerationDetails:r,isLoading:!1,inputValues:u,remarks:g,locations:l,names:d},()=>h(this,null,function*(){if(console.log("Initial data loaded, originalData length:",(null==r?void 0:r.length)||0),yield this.getRowData(r),console.log("Applying initial filtering"),this.filterRegistrationDetails(),e&&(e.scrollTop=t),this.gridApi&&"function"==typeof this.gridApi.paginationGoToPage)try{this.gridApi.paginationGoToPage(s)}catch(a){console.warn("Error setting pagination page:",a)}this.state.isAlertShown||(yield this.anomalitiesAlert(n),this.setState({isAlertShown:!0})),this.props.closePopup()}))})}updateRowData(e){this.setState({registerationDetails:e})}decodeHtmlEntities(e){return(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent}getNextReceiptNumber(e,t,s,a){return h(this,null,function*(){const o=this.client.db(e).collection(t);console.log("Centre:",a);const i=(new Date).getFullYear().toString().slice(-2),r=yield o.find({receiptNo:{$regex:`^${s}`}}).toArray();console.log("Existing receipts:",r);const n=r.filter(e=>{if("ECSS/SFC/"===s){return new RegExp(`^${s}\\d+/(${i})$`).test(e.receiptNo)}return!0}),l=n.filter(e=>"CT Hub"===e.location).map(e=>{if("ECSS/SFC/"===s){const t=new RegExp(`^${s}(\\d+)/\\d+$`),a=e.receiptNo.match(t);return a?parseInt(a[1],10):null}{const t=new RegExp(`^${s} - (\\d+)$`),a=e.receiptNo.match(t);return a?parseInt(a[1],10):null}}).filter(e=>null!==e),c=l.length>0?Math.max(...l):0,d=n.filter(e=>"CT Hub"!==e.location).map(e=>{if("ECSS/SFC/"===s){const t=new RegExp(`^${s}(\\d+)/\\d+$`),a=e.receiptNo.match(t);return a?parseInt(a[1],10):null}{const t=new RegExp(`^${s} - (\\d+)$`),a=e.receiptNo.match(t);return a?parseInt(a[1],10):null}}).filter(e=>null!==e),h=d.length>0?Math.max(...d):0;if("25"===i){if("CT Hub"===a){const e=c>0?c+1:109;return"ECSS/SFC/"===s?`${s}${String(e).padStart(3,"0")}/${i}`:`${s} - ${String(e).padStart(4,"0")}`}{const e=h>0?h+1:1;return"ECSS/SFC/"===s?`${s}${String(e).padStart(3,"0")}/${i}`:`${s} - ${String(e).padStart(4,"0")}`}}if("CT Hub"===a){const e=c>0?c+1:109;return"ECSS/SFC/"===s?`${s}${String(e).padStart(3,"0")}/${i}`:`${s} - ${String(e).padStart(4,"0")}`}{const e=h>0?h+1:1;return"ECSS/SFC/"===s?`${s}${String(e).padStart(3,"0")}/${i}`:`${s} - ${String(e).padStart(4,"0")}`}})}convertDateFormat1(e){const t=e.trim().match(/^(\d{1,2})\s([A-Za-z]+)\s(\d{4})$/);if(!t)return console.error("Invalid date format:",e),"Invalid date format";const[,s,a,o]=t,i={January:"01",February:"02",Feburary:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"}[a];return i?`${s.padStart(2,"0")}/${i}/${o}`:(console.error("Invalid month name:",a),"Invalid date format")}convertDateFormat(e){const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`}convertDateFormat3(e){const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}${String(t.getMonth()+1).padStart(2,"0")}${t.getFullYear()}`}ecssChineseCourseCode(e){if(!e)return"";switch(e=e.trim()){case"不和慢性病做朋友":return"ECSS-CBO-M-016C";case"和谐粉彩绘画基础班":return"ECSS-CBO-M-019C";case"和谐粉彩绘画体验班":return"ECSS-CBO-M-018C";case"疗愈水彩画基础班":return"ECSS-CBO-M-024E";case"中文书法中级班":return"ECSS-CBO-M-021C";case"中文书法初级班":return"ECSS-CBO-M-020C";case"音乐祝福社区四弦琴班":return"ECSS-CBO-M-004C";case"音乐祝福社区四弦琴班第2阶":return"ECSS-CBO-M-037C";case"音乐祝福社区歌唱班":return"ECSS-CBO-M-003C";case"自我养生保健":return"ECSS-CBO-M-001C";case"汉语拼音基础班":return"ECSS-CBO-M-011C";case"汉语拼音中级班":return"ECSS-CBO-M-025C";case"汉语拼音之–《唐诗三百首》":return"ECSS-CBO-M-036C";case"人生休止符":return"ECSS-CBO-M-023C";case"食疗与健康":return"ECSS-CBO-M-010C";case"疗愈基础素描":return"ECSS-CBO-M-030E";case"健康心灵，健康生活":return"ECSS-CBO-M-028C";case"智能手机摄影":return"ECSS-CBO-M-038C";case"掌握沟通艺术。 拥有快乐的家":return"ECSS-CBO-M-031C";case"和谐粉彩绘画基础班-第2阶":return"ECSS-CBO-M-039C";case"中级疗愈水彩班":return"ECSS-CBO-M-040C";case"自我成长":return"ECSS-CBO-M-013C";case"我的故事":return"ECSS-CBO-M-007C";case"如何退而不休活得精彩":return"ECSS-CBO-M-006C";case"活跃乐龄大使":return"ECSS-CBO-M-005C";case"预防跌倒与功能强化训练":return"ECSS-CBO-M-002C";case"C3A心理健康课程: 以微笑应万变":return"ECSS-CBO-M-017C";case"智慧理财基础知识":return"ECSS-CBO-M-029C";case"盆栽课程":return"ECSS-CBO-M-034C";case"乐龄儿孙乐":return"ECSS-CBO-M-035C";default:return""}}ecssEnglishCourseCode(e){if(!e)return"";switch(e=e.trim()){case"TCM – Don’t be a friend of Chronic Diseases":return"ECSS-CBO-M-016C";case"Nagomi Pastel Art Basic":return"ECSS-CBO-M-019C";case"Nagomi Pastel Art Appreciation":return"ECSS-CBO-M-018C";case"Therapeutic Watercolour Painting for Beginners":return"ECSS-CBO-M-024E";case"Chinese Calligraphy Intermediate":return"ECSS-CBO-M-021C";case"Chinese Calligraphy Basic":return"ECSS-CBO-M-020C";case"Community Ukulele – Mandarin":return"ECSS-CBO-M-004C";case"Community Ukulele Level 2 – Mandarin":return"ECSS-CBO-M-037C";case"Community Singing – Mandarin":return"ECSS-CBO-M-003C";case"Self-Care TCM Wellness – Mandarin":return"ECSS-CBO-M-001C";case"Hanyu Pinyin for Beginners":return"ECSS-CBO-M-011C";case"Hanyu Pinyin Intermediate":return"ECSS-CBO-M-025C";case"Hanyu Pinyin – 300 Tang Poems":return"ECSS-CBO-M-036C";case"The Rest Note of Life – Mandarin":return"ECSS-CBO-M-023C";case"TCM Diet & Therapy":return"ECSS-CBO-M-010C";case"Therapeutic Basic Line Work":return"ECSS-CBO-M-030E";case"Healthy Minds, Healthy Lives – Mandarin":return"ECSS-CBO-M-028C";case"C3A AgeMAP – Healthy Minds for Healthy Lives":return"ECSS-CBO-M-028E";case"Smartphone Photography":return"ECSS-CBO-M-038C";case"Art of Positive Communication builds happy homes":return"ECSS-CBO-M-031C";case"Nagomi Pastel Art Basic – Level 2":return"ECSS-CBO-M-039C";case"Intermediate Therapeutic Watercolour":return"ECSS-CBO-M-040C";case"My Growth":return"ECSS-CBO-M-013C";case"My Story":return"ECSS-CBO-M-007C";case"How to Retire & Live Wonderfully":return"ECSS-CBO-M-006C";case"Active Ageing Ambassadors":return"ECSS-CBO-M-005C";case"Fall Prevention & Functional Improvement Training":return"ECSS-CBO-M-002E";case"C3A Mental Wellbeing Curriculum – Riding the Waves of Change Smiling":return"ECSS-CBO-M-017E";case"C3A Mental Wellbeing Curriculum – Riding the Waves of Change Smiling (Malay)":return"ECSS-CBO-M-017M";case"Basics of Smart Money Management":return"ECSS-CBO-M-029E";case"The Art of Paper Quilling":return"ECSS-CBO-M-032E";case"Community Cajon Foundation 1":return"ECSS-CBO-M-033E";case"Bonsai Course":return"ECSS-CBO-M-034C";case"Happy Grandparenting":return"ECSS-CBO-M-035C";default:return""}}getPaginatedDetails(){const{registerationDetails:e}=this.state,{currentPage:t,entriesPerPage:s}=this.props,a=t*s,o=a-s;return e.slice(o,a)}componentDidUpdate(e,t){const{selectedLocation:s,selectedCourseType:a,searchQuery:o,selectedCourseName:i,selectedQuarter:r}=this.props;console.log("ComponentDidUpdate - Current Props:",{selectedLocation:s,selectedCourseType:a,searchQuery:o,selectedCourseName:i,selectedQuarter:r}),console.log("ComponentDidUpdate - Previous Props:",{selectedLocation:e.selectedLocation,selectedCourseType:e.selectedCourseType,searchQuery:e.searchQuery,selectedCourseName:e.selectedCourseName,selectedQuarter:e.selectedQuarter}),s===e.selectedLocation&&a===e.selectedCourseType&&i===e.selectedCourseName&&r===e.selectedQuarter&&o===e.searchQuery||(console.log("Filter props changed - triggering filterRegistrationDetails"),a!==e.selectedCourseType?(console.log(`Course type filter changed from ${e.selectedCourseType} to ${a} - updating column definitions`),this.setState({columnDefs:this.getColumnDefs(this.state.rowData)},()=>{this.filterRegistrationDetails()})):this.filterRegistrationDetails())}filterRegistrationDetails(){var e;const{section:t,selectedLocation:s,selectedCourseType:a,selectedCourseName:o,searchQuery:i,selectedQuarter:r}=this.props;if(console.log("FilterRegistrationDetails called with section:",t),console.log("Current state - originalData length:",(null==(e=this.state.originalData)?void 0:e.length)||0),"registration"===t){const{originalData:e}=this.state;if(!e||0===e.length)return console.log("No original data available for filtering"),void this.setState({registerationDetails:[],rowData:[]});console.log("Original Data sample:",e[0]),console.log("Filters Applied:",{selectedLocation:s,selectedCourseType:a,searchQuery:i,selectedCourseName:o,selectedQuarter:r});const t={location:s&&"All Locations"!==s?s:null,courseType:a&&"All Courses Types"!==a?a:null,courseName:o&&"All Courses Name"!==o?o:null,quarter:r&&"All Quarters"!==r?r:null,searchQuery:(i?i.toLowerCase().trim():"")||null};console.log("Active filters:",t);let n=[...e];if(console.log("Starting with originalData length:",n.length),t.location&&(n=n.filter(e=>{var s;const a=null==(s=e.course)?void 0:s.courseLocation,o=a===t.location;return o||console.log(`Location filter: ${a} !== ${t.location}`),o}),console.log("After location filter:",n.length)),t.courseType&&(n=n.filter(e=>{var s;const a=null==(s=e.course)?void 0:s.courseType,o=a===t.courseType;return o||console.log(`Course type filter: ${a} !== ${t.courseType}`),o}),console.log("After courseType filter:",n.length)),t.courseName&&(n=n.filter(e=>{var s;const a=null==(s=e.course)?void 0:s.courseEngName,o=a===t.courseName;return o||console.log(`Course name filter: ${a} !== ${t.courseName}`),o}),console.log("After courseName filter:",n.length)),t.quarter){const e=n.length;n=n.filter(e=>{var s;const a=null==(s=e.course)?void 0:s.courseDuration;if(!a)return console.log("Quarter filter: No course duration found"),!1;try{const e=a.split(" - ")[0],[s,o,i]=e.split(" "),r={January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12}[o];if(!r||!i)return console.log(`Quarter filter: Invalid month/year - ${o}/${i}`),!1;let n="";r>=1&&r<=3&&(n=`Q1 ${i}`),r>=4&&r<=6&&(n=`Q2 ${i}`),r>=7&&r<=9&&(n=`Q3 ${i}`),r>=10&&r<=12&&(n=`Q4 ${i}`);const l=n===t.quarter;return l||console.log(`Quarter filter: ${n} !== ${t.quarter}`),l}catch(o){return console.log("Quarter filter error:",o,"for duration:",a),!1}}),console.log(`After quarter filter (${t.quarter}): ${n.length} (was ${e})`)}if(t.searchQuery){const e=n.length;n=n.filter(e=>{var s,a,o,i,r,n,l,c,d,h,p,u,g,m,f,y,C,w,b,x,v,S,N,D,P,j;const R=[((null==(s=e.participant)?void 0:s.name)||"").toLowerCase(),((null==(a=e.participant)?void 0:a.nric)||"").toLowerCase(),((null==(o=e.participant)?void 0:o.contactNumber)||"").toLowerCase(),((null==(i=e.participant)?void 0:i.email)||"").toLowerCase(),((null==(r=e.course)?void 0:r.courseLocation)||"").toLowerCase(),((null==(n=e.course)?void 0:n.courseType)||"").toLowerCase(),((null==(l=e.course)?void 0:l.courseEngName)||"").toLowerCase(),((null==(c=e.course)?void 0:c.courseChiName)||"").toLowerCase(),((null==(d=e.course)?void 0:d.courseDuration)||"").toLowerCase(),((null==(h=e.course)?void 0:h.payment)||"").toLowerCase(),(e.status||"").toLowerCase(),((null==(p=e.official)?void 0:p.receiptNo)||"").toLowerCase(),((null==(u=e.spouse)?void 0:u.name)||"").toLowerCase(),((null==(g=e.marriageDetails)?void 0:g.maritalStatus)||"").toLowerCase(),((null==(m=e.marriageDetails)?void 0:m.marriageDuration)||"").toLowerCase(),((null==(f=e.marriageDetails)?void 0:f.housingType)||"").toLowerCase(),((null==(y=e.marriageDetails)?void 0:y.typeOfMarriage)||"").toLowerCase(),((null==(C=e.spouse)?void 0:C.nric)||"").toLowerCase(),((null==(w=e.spouse)?void 0:w.mobile)||(null==(b=e.spouse)?void 0:b.contactNumber)||"").toLowerCase(),((null==(x=e.spouse)?void 0:x.email)||"").toLowerCase(),((null==(v=e.marriageDetails)?void 0:v.grossMonthlyIncome)||"").toLowerCase(),((null==(S=e.marriageDetails)?void 0:S.hasChildren)||"").toLowerCase(),((null==(N=e.marriageDetails)?void 0:N.howFoundOut)||"").toLowerCase(),((null==(D=e.marriageDetails)?void 0:D.sourceOfReferral)||"").toLowerCase(),(null==(P=e.consent)?void 0:P.marriagePrepConsent1)?"yes":"no",(null==(j=e.consent)?void 0:j.marriagePrepConsent2)?"yes":"no",e.marriagePrepConsent1?"yes":"no",e.marriagePrepConsent2?"yes":"no"],A=R.some(e=>e.includes(t.searchQuery));if(A){const e=R.filter(e=>e.includes(t.searchQuery));console.log(`Search match found for: "${t.searchQuery}" in fields:`,e)}return A}),console.log(`After search filter ("${t.searchQuery}"): ${n.length} (was ${e})`)}console.log("Final Filtered Details:",n.length,"entries"),n.length>0&&console.log("Sample filtered entry:",n[0]);const l=n.map((e,t)=>{var s,a,o,i,r,n,l,c,d,h,p,u,g,m,f,y,C,w,b,x,v,S,N,D,P,j,R,A;try{return{id:e._id,sn:t+1,name:(null==(s=e.participant)?void 0:s.name)||"",contactNo:(null==(a=e.participant)?void 0:a.contactNumber)||"",course:(null==(o=e.course)?void 0:o.courseEngName)||"",courseChi:(null==(i=e.course)?void 0:i.courseChiName)||"",location:(null==(r=e.course)?void 0:r.courseLocation)||"",courseMode:"Face-to-Face"===(null==(n=e.course)?void 0:n.courseMode)?"F2F":(null==(l=e.course)?void 0:l.courseMode)||"",paymentMethod:(null==(c=e.course)?void 0:c.payment)||"",confirmed:(null==(d=e.official)?void 0:d.confirmed)||!1,paymentStatus:e.status||"",recinvNo:(null==(h=e.official)?void 0:h.receiptNo)||"",participantInfo:e.participant||{},courseInfo:e.course||{},officialInfo:e.official||{},refundedDate:(null==(p=e.official)?void 0:p.refundedDate)||"",agreement:e.agreement||"",registrationDate:e.registrationDate||"",sendDetails:e.sendingWhatsappMessage||!1,remarks:(null==(u=e.official)?void 0:u.remarks)||"",paymentDate:(null==(g=e.official)?void 0:g.date)||"",marriageDetails:e.marriageDetails||null,spouse:e.spouse||null,consent:e.consent||null,marriagePrepConsent:e.marriagePrepConsent||null,spouseName:(null==(m=e.spouse)?void 0:m.name)||e.spouseName||"",maritalStatus:(null==(f=e.marriageDetails)?void 0:f.maritalStatus)||e.maritalStatus||"",intendedMarriageDate:(null==(y=e.marriageDetails)?void 0:y.marriageDuration)||e.intendedMarriageDate||"",housingType:(null==(C=e.marriageDetails)?void 0:C.housingType)||e.housingType||"",grossMonthlyIncome:(null==(w=e.marriageDetails)?void 0:w.grossMonthlyIncome)||e.grossMonthlyIncome||"",typeOfMarriage:(null==(b=e.marriageDetails)?void 0:b.typeOfMarriage)||e.typeOfMarriage||"",hasChildren:(null==(x=e.marriageDetails)?void 0:x.hasChildren)||e.hasChildren||"",howFoundOut:(null==(v=e.marriageDetails)?void 0:v.howFoundOut)||e.howFoundOut||"",sourceOfReferral:(null==(S=e.marriageDetails)?void 0:S.sourceOfReferral)||e.sourceOfReferral||"",spouseNric:(null==(N=e.spouse)?void 0:N.nric)||e.spouseNric||"",spouseContact:(null==(D=e.spouse)?void 0:D.mobile)||(null==(P=e.spouse)?void 0:P.contactNumber)||e.spouseContact||"",spouseEmail:(null==(j=e.spouse)?void 0:j.email)||e.spouseEmail||"",marriagePrepConsent1:(null==(R=e.consent)?void 0:R.marriagePrepConsent1)||e.marriagePrepConsent1||!1,marriagePrepConsent2:(null==(A=e.consent)?void 0:A.marriagePrepConsent2)||e.marriagePrepConsent2||!1}}catch(T){return console.error("Error mapping row data for item:",e,T),null}}).filter(e=>null!==e);console.log("Final Row Data length:",l.length),console.log("Marriage Preparation Programme entries in filtered data:",l.filter(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)}).length);const c={registerationDetails:n,rowData:l},d=this.getColumnDefs(l);d&&d.length>0&&(c.columnDefs=d),console.log("Updating state with:",{filteredDetailsLength:c.registerationDetails.length,rowDataLength:c.rowData.length,hasColumnDefs:!!c.columnDefs}),this.setState(c,()=>{if(console.log("State updated successfully. New rowData length:",this.state.rowData.length),this.debugMarriagePrepData(),this.gridApi&&"function"==typeof this.gridApi.refreshCells){console.log("Refreshing grid API");try{this.gridApi.refreshCells()}catch(e){console.warn("Error refreshing grid cells:",e)}}else console.log("Grid API not available or refreshCells method not found")})}}render(){const{selectedRows:e,showBulkUpdateModal:t,bulkUpdateStatus:s,bulkUpdateMethod:a,expandedRowIndex:o}=this.state;return u.jsxs("div",{className:"registration-payment-container",children:[u.jsx("div",{className:"registration-payment-heading",children:u.jsx("h2",{children:"Registration & Payment Details"})}),u.jsxs("div",{className:"button-row",children:[this.state.rowData&&this.state.rowData.some(e=>{var t;return"Marriage Preparation Programme"===(null==(t=e.courseInfo)?void 0:t.courseType)})&&"Marriage Preparation Programme"!==this.props.selectedCourseType&&u.jsx("button",{className:"toggle-btn",onClick:this.toggleHideMarriagePrepFields,style:{backgroundColor:this.state.hideMarriagePrepFields?"#4CAF50":"#ff6b6b",color:"white",border:"none",padding:"10px 15px",borderRadius:"4px",cursor:"pointer",marginRight:"10px",fontSize:"14px"},children:this.state.hideMarriagePrepFields?"Show Marriage Prep Fields":"Hide Marriage Prep Fields"}),u.jsx("button",{className:"save-btn",onClick:()=>this.archiveData(),children:"Archive Data"}),u.jsx("button",{className:"export-btn",onClick:this.exportToLOP,disabled:0===e.length,children:"Export to LOP"}),u.jsx("button",{className:"attendance-btn",onClick:this.exportAttendance,children:"Export Attendance"}),u.jsxs("button",{className:"bulk-update-btn",onClick:this.openBulkUpdateModal,disabled:0===e.length,children:["Bulk Update (",e.length,")"]})]}),u.jsx("div",{className:"grid-container",children:u.jsx(m,{ref:this.gridRef,rowData:this.state.rowData,columnDefs:this.state.columnDefs,rowSelection:"multiple",onGridReady:this.onGridReady,onSelectionChanged:this.onSelectionChanged,onCellValueChanged:this.onCellValueChanged,onCellClicked:this.handleValueClick,suppressRowClickSelection:!0,pagination:!0,paginationPageSize:this.state.rowData.length,domLayout:"normal",getRowStyle:this.getRowStyle})}),t&&u.jsx("div",{className:"modal-overlay",onClick:this.closeBulkUpdateModal,children:u.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[u.jsx("h3",{children:"Bulk Update Selected Records"}),u.jsx("div",{className:"bulk-update-options",children:u.jsxs("div",{className:"update-section",children:[u.jsx("label",{htmlFor:"bulkStatus",children:"Payment Status:"}),u.jsxs("select",{id:"bulkStatus",value:s,onChange:e=>this.setState({bulkUpdateStatus:e.target.value}),children:[u.jsx("option",{value:"",children:"-- No Change --"}),u.jsx("option",{value:"Paid",children:"Paid"}),u.jsx("option",{value:"Pending",children:"Pending"}),u.jsx("option",{value:"Unpaid",children:"Unpaid"}),u.jsx("option",{value:"Refunded",children:"Refunded"}),u.jsx("option",{value:"Confirmed",children:"Confirmed"})]})]})}),u.jsxs("div",{className:"modal-buttons",children:[u.jsxs("button",{className:"update-btn",onClick:this.handleBulkUpdate,children:["Update ",e.length," Records"]}),u.jsx("button",{className:"cancel-btn",onClick:this.closeBulkUpdateModal,children:"Cancel"})]})]})}),null!==o&&u.jsx("div",{className:"expanded-row-detail",children:this.renderDetailView(this.state.rowData[o])})]})}}const G={English:"英语",Mandarin:"中文","English and Mandarin":"英文和中文","All Languages":"所有语言","All Locations":"所有地点"};class Y extends p.Component{constructor(e){super(e),d(this,"translateLanguages",e=>"zh"===this.props.language?e.map(e=>G[e]||e):e),d(this,"handleChange",e=>{const{name:t,value:s}=e.target;console.log("handleChange",t,e),this.setState({[t]:s},()=>{"centreLocation"===t?this.setState({filteredLocations:this.state.locations.filter(e=>e.toLowerCase().includes(s.toLowerCase())),centrelocation:s}):"language"===t?this.setState({filteredLanguages:this.state.languages.filter(e=>e.toLowerCase().includes(s.toLowerCase())),language:s}):"courseType"===t?(console.log("Course Types:",s),this.setState({filteredTypes:this.state.types.filter(e=>e.toLowerCase().includes(s.toLowerCase())),courseType:s})):"courseName"===t?(console.log("Selected Course Name:",s,this.state.coursesName),this.setState({filteredCoursesName:this.state.coursesName.filter(e=>e.toLowerCase().includes(s.toLowerCase())),courseName:s})):"accountType"===t?(console.log(t,s),this.setState({filteredRoles:this.state.roles.filter(e=>e.toLowerCase().includes(s.toLowerCase())),role:s})):"quarter"===t?(console.log("We do Course Quarter",this.state.quarters),console.log(t,s),this.setState({filteredQuarters:this.state.quarters.filter(e=>e.toLowerCase().includes(s.toLowerCase())),quarter:s})):"searchQuery"===t?(console.log(t,s),this.props.passSearchedValueToParent(s)):"attendanceType"===t?this.setState({filteredAttendanceTypes:this.state.attendanceTypes.filter(e=>e.toLowerCase().includes(s.toLowerCase())),attendanceType:s}):"attendanceLocation"===t?this.setState({filteredAttendanceLocations:this.state.attendanceLocations.filter(e=>e.toLowerCase().includes(s.toLowerCase())),attendanceLocation:s},()=>{this.filterActivityCodesByLocation(s)}):"membershipType"===t&&(console.log("Membership Type123:",s),this.setState({filteredMembershipTypes:this.state.membershipTypes.filter(e=>e.toLowerCase().includes(s.toLowerCase())),membershipType:s}))})}),d(this,"handleDropdownToggle",e=>{console.log("Dropdown:",e),"showLocationDropdown"===e?this.setState({showLocationDropdown:!0}):"showLanguageDropdown"===e?this.setState({showLanguageDropdown:!0}):"showTypeDropdown"===e?this.setState({showTypeDropdown:!0}):"showCourseDropdown"===e?(console.log("Show"),this.setState({showCourseDropdown:!0})):"showCourseQuarter"===e?(console.log("Show"),this.setState({showQuarterDropdown:!0})):"showAccountTypeDropdown"===e?this.setState({showAccountTypeDropdown:!0}):"showAttendanceTypeDropdown"===e?this.setState({showAttendanceTypeDropdown:!0}):"showAttendanceLocationDropdown"===e?this.setState({showAttendanceLocationDropdown:!0}):"showActivityCodeDropdown"===e?this.setState({showActivityCodeDropdown:!0}):"showMembershipTypeDropdown"===e&&this.setState({showMembershipTypeDropdown:!0})}),d(this,"handleOptionSelect",(e,t)=>{console.log("Selected value for filtered:",e,t),this.props.language;let s={};if("showLocationDropdown"===t)s={centreLocation:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1};else if("showLanguageDropdown"===t)s={language:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1};else if("showTypeDropdown"===t)s={courseType:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showQuarterDropdown:!1,showAccountTypeDropdown:!1};else if("showAccountTypeDropdown"===t)console.log(e),s={role:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showAccountTypeDropdown:!1,showCourseDropdown:!1,showQuarterDropdown:!1};else if("showCourseDropdown"===t)s={courseName:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1};else if("showCourseQuarter"===t)console.log("Show"),s={quarter:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1};else if("showAttendanceTypeDropdown"===t)s={attendanceType:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1,showAttendanceTypeDropdown:!1,showAttendanceLocationDropdown:!1};else{if("showAttendanceLocationDropdown"===t)return s={attendanceLocation:e,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1,showAttendanceTypeDropdown:!1,showAttendanceLocationDropdown:!1},void this.setState(s,()=>{this.filterActivityCodesByLocation(e),this.props.passSelectedValueToParent(s,t)});"showActivityCodeDropdown"===t?s={activityCode:e,showActivityCodeDropdown:!1}:"showMembershipTypeDropdown"===t&&(s={membershipType:e,showMembershipTypeDropdown:!1,showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1,showAttendanceTypeDropdown:!1,showAttendanceLocationDropdown:!1,showActivityCodeDropdown:!1})}this.setState(s,()=>{console.log("Updated States:",s,t),this.props.passSelectedValueToParent(s,t)})}),d(this,"handleClickOutside",e=>{this.locationDropdownRef.current&&!this.locationDropdownRef.current.contains(e.target)&&this.languageDropdownRef.current&&!this.languageDropdownRef.current.contains(e.target)&&this.typeDropdownRef.current&&!this.typeDropdownRef.current.contains(e.target)&&this.courseDropdownRef.current&&!this.courseDropdownRef.current.contains(e.target)&&this.accountTypeDropdownRef.current&&!this.accountTypeDropdownRef.current.contains(e.target)&&this.quarterDropdownRef.current&&!this.quarterDropdownRef.current.contains(e.target)&&this.attendanceTypeDropdownRef.current&&!this.attendanceTypeDropdownRef.current.contains(e.target)&&this.attendanceLocationDropdownRef.current&&!this.attendanceLocationDropdownRef.current.contains(e.target)&&this.activityCodeDropdownRef.current&&!this.activityCodeDropdownRef.current.contains(e.target)&&this.membershipTypeDropdownRef.current&&!this.membershipTypeDropdownRef.current.contains(e.target)&&this.setState({showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showAccountTypeDropdown:!1,showCourseDropdown:!1,showQuarterDropdown:!1,showAttendanceTypeDropdown:!1,showAttendanceLocationDropdown:!1,showActivityCodeDropdown:!1,showMembershipTypeDropdown:!1}),this.attendanceTypeDropdownRef.current&&!this.attendanceTypeDropdownRef.current.contains(e.target)&&this.setState({showAttendanceTypeDropdown:!1}),this.attendanceLocationDropdownRef&&this.attendanceLocationDropdownRef.current&&!this.attendanceLocationDropdownRef.current.contains(e.target)&&this.setState({showAttendanceLocationDropdown:!1}),this.activityCodeDropdownRef&&this.activityCodeDropdownRef.current&&!this.activityCodeDropdownRef.current.contains(e.target)&&this.setState({showActivityCodeDropdown:!1}),this.membershipTypeDropdownRef&&this.membershipTypeDropdownRef.current&&!this.membershipTypeDropdownRef.current.contains(e.target)&&this.setState({showMembershipTypeDropdown:!1})}),d(this,"filterActivityCodesByLocation",e=>{const t=this.props.activityCodes||[];if(console.log("Filtered Activity Codes:",t),!e||"All Locations"===e)return void this.setState({filteredActivityCodes:t});const s={"CT Hub":"CTH","Tampines 253":"253","Tampines North Community Centre":"TNC","Pasir Ris West Wellness Centre":"PRW"}[e];if(s){const e=t.filter(e=>e&&e.startsWith(s));this.setState({filteredActivityCodes:e,activityCode:""}),this.props.passSelectedValueToParent({activityCode:""},"activityCode")}else this.setState({filteredActivityCodes:t})}),this.state={searchQuery:"",centreLocation:"",language:"",status:"",courseType:"",course:"",locations:[],languages:[],statuses:[],types:[],roles:[],quarters:[],coursesName:[],filteredLocations:[],filteredLanguages:[],filteredStatuses:[],filteredTypes:[],filteredRoles:[],filteredCoursesName:[],filteredCoursesQuarters:[],showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showCourseDropdown:!1,showAccountTypeDropdown:!1,showQuarterDropdown:!1,role:"",staffName:"",quarter:"",attendanceType:"",activityCode:"",attendanceLocation:"",attendanceTypes:[],filteredAttendanceTypes:[],attendanceLocations:[],filteredAttendanceLocations:[],showAttendanceTypeDropdown:!1,showAttendanceLocationDropdown:!1,showActivityCodeDropdown:!1,filteredActivityCodes:[],membershipType:"",membershipTypes:[],filteredMembershipTypes:[],showMembershipTypeDropdown:!1},this.locationDropdownRef=g.createRef(),this.languageDropdownRef=g.createRef(),this.accountTypeDropdownRef=g.createRef(),this.typeDropdownRef=g.createRef(),this.courseDropdownRef=g.createRef(),this.quarterDropdownRef=g.createRef(),this.attendanceTypeDropdownRef=g.createRef(),this.attendanceLocationDropdownRef=g.createRef(),this.activityCodeDropdownRef=g.createRef(),this.membershipTypeDropdownRef=g.createRef(),this.searchInputRef=g.createRef()}componentDidMount(){if(document.addEventListener("mousedown",this.handleClickOutside),this.updateUniqueLocationsLanguagesRolesTypes(this.props),this.setState({filteredActivityCodes:this.props.activityCodes||[]}),this.props.membershipTypes){console.log("SearchSection componentDidMount: Initializing membership types:",this.props.membershipTypes);const e=this.props.membershipTypes||["All Types"];e.includes("All Types")||e.unshift("All Types"),this.setState({membershipTypes:e,filteredMembershipTypes:e})}}componentDidUpdate(e){if(console.log("Update:",this.props),this.props.resetSearch&&e.resetSearch!==this.props.resetSearch&&this.setState({searchQuery:"",centreLocation:"",language:"",role:"",courseName:"",quarter:"",showLocationDropdown:!1,showLanguageDropdown:!1,showTypeDropdown:!1,showAccountTypeDropdown:!1,showCourseDropdown:!1,showQuarterDropdown:!1}),this.props.locations!==e.locations){const e=["All Locations",...new Set(this.props.locations)];this.setState({locations:e,filteredLocations:e})}if(this.props.languages!==e.languages){const e=["All Languages",...new Set(this.props.languages)];this.setState({languages:e,filteredLanguages:e})}if(this.props.types!==e.types){const e=["All Courses Types",...new Set(this.props.types)];this.setState({types:e,filteredTypes:e})}if(this.props.courses!==e.courses){const e=["All Courses Name",...new Set(this.props.courses)];this.setState({coursesName:e,filteredCoursesName:e})}if(this.props.roles!==e.roles){const e=["All Roles",...new Set(this.props.roles)];this.setState({roles:e,filteredRoles:e})}if(this.props.quarters!==e.quarters){const e=["All Quarters",...new Set(this.props.quarters)];this.setState({quarters:e,filteredQuarters:e})}if(console.log("Attendance Types:",this.props.attendanceTypes),this.props.attendanceTypes!==e.attendanceTypes){const e=this.props.attendanceTypes||["All Types"];e.includes("All Types")||e.unshift("All Types"),this.setState({attendanceTypes:e,filteredAttendanceTypes:e})}if(this.props.attendanceLocations!==e.attendanceLocations){const e=this.props.attendanceLocations||["All Locations"];e.includes("All Locations")||e.unshift("All Locations"),this.setState({attendanceLocations:e,filteredAttendanceLocations:e})}if(this.props.activityCodes!==e.activityCodes&&this.setState({filteredActivityCodes:this.props.activityCodes||[]},()=>{this.state.attendanceLocation&&"All Locations"!==this.state.attendanceLocation&&this.filterActivityCodesByLocation(this.state.attendanceLocation)}),this.props.membershipTypes!==e.membershipTypes){console.log("SearchSection: Membership types props changed:",{prevTypes:e.membershipTypes,newTypes:this.props.membershipTypes});const t=this.props.membershipTypes||["All Types"];t.includes("All Types")||t.unshift("All Types"),console.log("SearchSection: Setting membership types to state:",t),this.setState({membershipTypes:t,filteredMembershipTypes:t})}e.searchQuery!==this.props.searchQuery&&""===this.props.searchQuery&&this.searchInputRef&&this.searchInputRef.current&&(this.searchInputRef.current.value=""),e.membershipType!==this.props.membershipType&&"All Types"===this.props.membershipType&&"All Types"!==this.state.selectedMembershipType&&this.setState({selectedMembershipType:"All Types"})}updateUniqueLocationsLanguagesRolesTypes(e){const t=["All Roles",...new Set(e.roles)],s=["All Locations",...new Set(e.locations)],a=["All Languages",...new Set(e.languages)],o=["All Courses Type",...new Set(e.types)],i=["All Courses Name",...new Set(e.courses)],r=["All Courses Quarters",...new Set(e.quarters)];console.log("Props:",e),console.log("Unique: ",r),this.setState({locations:s,filteredLocations:s,languages:this.translateLanguages(a),filteredLanguages:this.translateLanguages(a),types:o,filteredTypes:o,roles:t,filteredRoles:t,quarters:r,filteredQuarters:r,filteredCoursesName:this.translateLanguages(i),filteredActivityCodes:e.activityCodes||[]})}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}render(){const{membershipType:e,showNameDropdown:t,typename:s,filteredName:a,staffName:o,searchQuery:i,centreLocation:r,language:n,quarter:l,courseQuarters:c,filteredQuarters:d,filteredLocations:h,filteredLanguages:p,filteredTypes:g,showLocationDropdown:m,showLanguageDropdown:f,showTypeDropdown:y,courseType:C,showAccountTypeDropdown:w,role:b,roles:x,filteredRoles:v,coursesName:S,showCourseDropdown:N,filteredCoursesName:D,courseName:P,showQuarterDropdown:j}=this.state,{section:R}=this.props;return console.log("Course Name List:",this.state),console.log("Section:",R),u.jsxs("div",{className:"filter-section",children:[" ",u.jsxs("div",{className:"form-group-row",children:["accounts"===R&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"accountType",children:"zh"===this.props.language?"":"Account Type"}),u.jsxs("div",{className:"dropdown-container "+(w?"open":""),ref:this.accountTypeDropdownRef,children:[u.jsx("input",{type:"text",id:"accountType",name:"accountType",value:b,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showAccountTypeDropdown"),placeholder:"zh"===this.props.language?"":"Filter by account type",autoComplete:"off"}),w&&u.jsx("ul",{className:"dropdown-list",children:v.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showAccountTypeDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"searchQuery",children:"zh"===this.props.language?"搜寻":"Search"}),u.jsxs("div",{className:"search-container",children:[u.jsx("input",{type:"text",id:"searchQuery",name:"searchQuery",value:i,onChange:this.handleChange,placeholder:"zh"===this.props.language?"搜索":"Search",autoComplete:"off"}),u.jsx("i",{className:"fas fa-search search-icon"})]})]})]}),"courses"===R&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"centreLocation",children:"zh"===this.props.language?"中心位置":"Locations"}),u.jsxs("div",{className:"dropdown-container "+(m?"open":""),ref:this.locationDropdownRef,children:[u.jsx("input",{type:"text",id:"centreLocation",name:"centreLocation",value:r,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showLocationDropdown"),placeholder:"zh"===this.props.language?"按地点筛选":"Filter by location",autoComplete:"off"}),m&&u.jsx("ul",{className:"dropdown-list",children:h.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showLocationDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"searchQuery",children:"zh"===this.props.language?"搜寻":"Search"}),u.jsxs("div",{className:"search-container",children:[u.jsx("input",{type:"text",id:"searchQuery",name:"searchQuery",value:i,onChange:this.handleChange,placeholder:"zh"===this.props.language?"搜索":"Search",autoComplete:"off"}),u.jsx("i",{className:"fas fa-search search-icon"})]})]})]}),"registration"===R&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"courseType",children:"zh"===this.props.language?"":"Type"}),u.jsxs("div",{className:"dropdown-container "+(y?"open":""),ref:this.typeDropdownRef,children:[u.jsx("input",{type:"text",id:"courseType",name:"courseType",value:C,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showTypeDropdown"),placeholder:"zh"===this.props.language?"":"Filter by type",autoComplete:"off"}),y&&u.jsx("ul",{className:"dropdown-list",children:g.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showTypeDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"centreLocation",children:"zh"===this.props.language?"中心位置":"Locations"}),u.jsxs("div",{className:"dropdown-container "+(m?"open":""),ref:this.locationDropdownRef,children:[u.jsx("input",{type:"text",id:"centreLocation",name:"centreLocation",value:r,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showLocationDropdown"),placeholder:"zh"===this.props.language?"按地点筛选":"Filter by location",autoComplete:"off"}),m&&u.jsx("ul",{className:"dropdown-list",children:h.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showLocationDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"courseQuarter",children:"zh"===this.props.language?"中心位置":"Quarter Year"}),u.jsxs("div",{className:"dropdown-container "+(m?"open":""),ref:this.quarterDropdownRef,children:[u.jsx("input",{type:"text",id:"quarter",name:"quarter",value:l,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showCourseQuarter"),placeholder:"zh"===this.props.language?"按地点筛选":"Filter by course quarter",autoComplete:"off"}),j&&u.jsx("ul",{className:"dropdown-list",children:d.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showCourseQuarter"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"course",children:"zh"===this.props.language?"":"Course"}),u.jsxs("div",{className:"dropdown-container "+(N?"open":""),ref:this.courseDropdownRef,children:[u.jsx("input",{type:"text",id:"courseName",name:"courseName",value:P,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showCourseDropdown"),placeholder:"zh"===this.props.language?"":"Filter by course",autoComplete:"off"}),N&&u.jsx("ul",{className:"dropdown-list",children:D.map((e,t)=>u.jsx("li",{onClick:()=>this.handleOptionSelect(e,"showCourseDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"searchQuery",children:"zh"===this.props.language?"搜寻":"Search"}),u.jsxs("div",{className:"search-container",children:[u.jsx("input",{type:"text",id:"searchQuery",name:"searchQuery",value:i,onChange:this.handleChange,placeholder:"zh"===this.props.language?"搜索":"Search",autoComplete:"off"}),u.jsx("i",{className:"fas fa-search search-icon"})]})]})]}),"attendance"===R&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"attendanceType",children:"zh"===this.props.language?"类型":"Type"}),u.jsxs("div",{className:"dropdown-container "+(this.state.showAttendanceTypeDropdown?"open":""),ref:this.attendanceTypeDropdownRef,children:[u.jsx("input",{type:"text",id:"attendanceType",name:"attendanceType",value:this.state.attendanceType,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showAttendanceTypeDropdown"),placeholder:"zh"===this.props.language?"按类型筛选":"Filter by type",autoComplete:"off"}),this.state.showAttendanceTypeDropdown&&u.jsx("ul",{className:"dropdown-list",children:this.state.filteredAttendanceTypes.map((e,t)=>u.jsx("li",{onMouseDown:()=>this.handleOptionSelect(e,"showAttendanceTypeDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"attendanceLocation",children:"zh"===this.props.language?"地点":"Location"}),u.jsxs("div",{className:"dropdown-container "+(this.state.showAttendanceLocationDropdown?"open":""),ref:this.attendanceLocationDropdownRef,children:[u.jsx("input",{type:"text",id:"attendanceLocation",name:"attendanceLocation",value:this.state.attendanceLocation,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showAttendanceLocationDropdown"),placeholder:"zh"===this.props.language?"按地点筛选":"Filter by location",autoComplete:"off"}),this.state.showAttendanceLocationDropdown&&u.jsx("ul",{className:"dropdown-list",children:this.state.filteredAttendanceLocations.map((e,t)=>u.jsx("li",{onMouseDown:()=>this.handleOptionSelect(e,"showAttendanceLocationDropdown"),children:e},t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"activityCode",children:"zh"===this.props.language?"活动代码":"Activity Code"}),u.jsxs("div",{className:"dropdown-container "+(this.state.showActivityCodeDropdown?"open":""),style:{position:"relative"},ref:this.activityCodeDropdownRef,children:[u.jsx("input",{type:"text",id:"activityCode",name:"activityCode",value:this.state.activityCode,onChange:e=>{const t=e.target.value;this.setState({activityCode:t,showActivityCodeDropdown:!0})},onFocus:()=>this.setState({showActivityCodeDropdown:!0}),onBlur:()=>setTimeout(()=>this.setState({showActivityCodeDropdown:!1},()=>{this.props.passSelectedValueToParent({activityCode:this.state.activityCode},"activityCode")}),150),placeholder:"zh"===this.props.language?"按活动代码筛选":"Filter by activity code",autoComplete:"off",style:{padding:"6px 12px",fontSize:16,borderRadius:4,border:"1px solid #ccc",minWidth:160}}),this.state.showActivityCodeDropdown&&this.state.filteredActivityCodes.filter(e=>!this.state.activityCode||e.toLowerCase().includes(this.state.activityCode.toLowerCase())).length>0&&u.jsx("ul",{className:"dropdown-list",style:{position:"absolute",zIndex:10,width:"100%"},children:this.state.filteredActivityCodes.filter(e=>!this.state.activityCode||e.toLowerCase().includes(this.state.activityCode.toLowerCase())).map((e,t)=>u.jsx("li",{onMouseDown:()=>{this.setState({activityCode:e,showActivityCodeDropdown:!1},()=>{this.props.passSelectedValueToParent({activityCode:e},"activityCode")})},style:{cursor:"pointer",padding:"6px 12px"},children:e},e+t))}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"searchQuery",children:"zh"===this.props.language?"搜寻":"Search"}),u.jsxs("div",{className:"search-container",children:[u.jsx("input",{type:"text",id:"searchQuery",name:"searchQuery",value:i,onChange:this.handleChange,placeholder:"zh"===this.props.language?"搜索":"Search",autoComplete:"off"}),u.jsx("i",{className:"fas fa-search search-icon"})]})]})]}),"membership"===R&&u.jsxs(u.Fragment,{children:[console.log("Membership Type:",this.state.membershipType),console.log("Membership Types in state:",this.state.membershipTypes),console.log("Filtered Membership Types:",this.state.filteredMembershipTypes),console.log("Show Dropdown:",this.state.showMembershipTypeDropdown),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"membershipType",children:"zh"===this.props.language?"会员类型":"Membership Type"}),u.jsxs("div",{className:"dropdown-container "+(this.state.showMembershipTypeDropdown?"open":""),ref:this.membershipTypeDropdownRef,children:[u.jsx("input",{type:"text",id:"membershipType",name:"membershipType",value:e,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showMembershipTypeDropdown"),placeholder:"zh"===this.props.language?"按会员类型筛选":"Filter by membership type",autoComplete:"off",ref:this.searchInputRef}),this.state.showMembershipTypeDropdown&&u.jsxs("ul",{className:"dropdown-list",children:[console.log("Rendering dropdown with types:",this.state.filteredMembershipTypes),this.state.filteredMembershipTypes.map((e,t)=>u.jsx("li",{onMouseDown:()=>this.handleOptionSelect(e,"showMembershipTypeDropdown"),children:e},t))]}),u.jsx("i",{className:"fas fa-angle-down dropdown-icon"})]})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"searchQuery",children:"zh"===this.props.language?"搜寻":"Search"}),u.jsxs("div",{className:"search-container",children:[u.jsx("input",{type:"text",id:"searchQuery",name:"searchQuery",value:i,onChange:this.handleChange,placeholder:"zh"===this.props.language?"搜索会员":"Search membership",autoComplete:"off"}),u.jsx("i",{className:"fas fa-search search-icon"})]})]})]})]})]})}}class K extends p.Component{constructor(){super(...arguments),d(this,"state",{inputValue:"",dropdownVisible:!1,options:[]}),d(this,"handleViewChange",e=>{const t=this.props.getTotalNumber;if("paginated"===e){const e=this.calculateQuarterSegments(t);this.setState({options:e})}else"full"===e&&this.setState({inputValue:"",options:[],dropdownVisible:!1});this.props.onToggleView(e)}),d(this,"handleInputChange",e=>{const t=e.target.value;console.log("Input changed:",t),this.setState({inputValue:t,dropdownVisible:!0})}),d(this,"handleInputClick",()=>{this.setState({dropdownVisible:!0})}),d(this,"handleOptionSelect",e=>{this.setState({inputValue:e,dropdownVisible:!1}),console.log(e),this.props.onEntriesPerPageChange(e)}),d(this,"handleBlur",e=>{e.relatedTarget&&e.relatedTarget.classList.contains("dropdown-list-toggle")||this.setState({dropdownVisible:!1})}),d(this,"handleMouseDown",e=>{e.preventDefault()})}calculateQuarterSegments(e){if(console.log("Total Number:",e),null==e)return[];const t=[e/4,e/4*2,e/4*3,e];console.log("Segments:",t);const s=t.map(e=>e%1>=.4?Math.ceil(e):Math.floor(e)).map(e=>e.toString()).filter(e=>parseInt(e)>0),a=new Set(s);return Array.from(a)}render(){const{viewMode:e}=this.props,{inputValue:t,dropdownVisible:s,options:a}=this.state;return u.jsxs("div",{className:"view-toggle1",children:[u.jsxs("div",{className:"button-row",children:[u.jsx("button",{onClick:()=>this.handleViewChange("full"),className:"full"===e?"active":"",children:"zh"!==this.props.language?"Full View":"全视图"}),u.jsx("button",{onClick:()=>this.handleViewChange("paginated"),className:"paginated"===e?"active":"",children:"zh"!==this.props.language?"Paginated View":"分页视图"})]}),"paginated"===e&&u.jsxs("div",{className:"items-per-page",children:[u.jsx("label",{htmlFor:"entries-per-page",className:"per-page-label",children:"Entries per page"}),u.jsx("input",{id:"entries-per-page",type:"text",className:"per-page-select",value:t,onClick:this.handleInputClick,onChange:this.handleInputChange,onBlur:this.handleBlur,placeholder:"Entries per page",autoComplete:"off"}),s&&u.jsx("ul",{className:"dropdown-list-toggle",children:a.filter(e=>e.toString().includes(t)).map(e=>u.jsx("li",{onMouseDown:this.handleMouseDown,onClick:()=>this.handleOptionSelect(e),children:e},e))})]})]})}}class J extends p.Component{constructor(e){super(e),d(this,"componentDidMount",()=>{this.props.closePopup(),document.addEventListener("click",this.handleClickOutside)}),d(this,"handleClickOutside",e=>{this.dropdownRef&&!this.dropdownRef.contains(e.target)&&this.setState({showDropdown:!1})}),d(this,"handleChange",e=>{const{name:t,value:s}=e.target;this.setState({[t]:s},()=>{this.validateField(t,s)})}),d(this,"handleRoleInputChange",e=>{const t=e.target.value;this.setState({role:t,showDropdown:!0});const s=this.state.roleOptions.filter(e=>e.toLowerCase().includes(t.toLowerCase()));this.setState({filteredRoles:s})}),d(this,"selectRole",e=>{this.setState({role:e,filteredRoles:[],showDropdown:!1},()=>{this.validateField("role",e)})}),d(this,"generateRandomPassword",()=>{const e="abcdefghijklmnopqrstuvwxyz",t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="0123456789",a="!@#$%^&*()_+[]{}|;:,.<>?",o=[e[Math.floor(26*Math.random())],t[Math.floor(26*Math.random())],s[Math.floor(10*Math.random())],a[Math.floor(24*Math.random())]],i=e+t+s+a;for(let n=o.length;n<8;n++)o.push(i[Math.floor(86*Math.random())]);const r=o.sort(()=>Math.random()-.5).join("");this.setState({password:r},()=>{this.validateField("password",r)})}),d(this,"togglePasswordVisibility",()=>{this.setState(e=>({passwordVisible:!e.passwordVisible}))}),d(this,"showDropdownList",()=>{this.setState({filteredRoles:this.state.roleOptions,showDropdown:!0})}),d(this,"clearForm",()=>{this.setState({name:"",email:"",password:"",role:""})}),d(this,"isValidEmail",e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(e)),d(this,"handleSubmit",e=>{e.preventDefault();const{name:t,email:s,password:a,role:o,site:i}=this.state;let r=!0,n="",l="",c="",d="",h="";if(t||(n="Name is required.",r=!1),s?this.isValidEmail(s)||(l="Email is invalid",r=!1):(l="Email is required.",r=!1),a||(c="Password is required.",r=!1),o?"Ops in-charge"!==o&&"NSA in-charge"!==o&&"Site in-charge"!==o&&"Finance"!==o&&"Others"!==o&&(d="Role must be Ops in-charge, NSA in-charge, Site in-charge, Finance or Others",r=!1):(d="Role is required.",r=!1),"Site in-charge"!==o||i||(h="Site is required.",r=!1),r){this.setState({nameError:"",emailError:"",passwordError:"",roleError:"",siteError:h});var p={name:t,email:s,password:a,role:o,site:i};D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accountDetails",{accountDetails:p,purpose:"create"}).then(e=>{"New account with respectively access rights created successfully"===e.data.message&&(this.props.createAccountPopupMessage(!0,e.data.message,e.data.message),this.setState({name:"",email:"",password:"",role:"",site:""}))}).catch(e=>{console.error("Error submitting form:",e)})}else this.setState({nameError:n,emailError:l,passwordError:c,roleError:d,siteError:h})}),this.state={roleOptions:["Ops in-charge","NSA in-charge","Site in-charge","Finance","Others"],filteredRoles:[],site:""}}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}validateField(e,t){let{nameError:s,emailError:a,passwordError:o,roleError:i,siteError:r}=this.state;switch(console.log(e),e){case"name":s=t?"":"Name is required.";break;case"email":a=t?this.isValidEmail(t)?"":"Email is invalid.":"Email is required.";break;case"password":o=t?"":"Password is required.";break;case"role":i=t?"Ops in-charge"!==t&&"NSA in-charge"!==t&&"Site in-charge"!==t&&"Finance"!==t&&"Others"!==t?"Role must be Ops in-charge, NSA in-charge, Site in-charge, Finance or Others":"":"Role is required.";break;case"site":r="Site in-charge"!==this.state.role||t?"":"Site is required."}this.setState({nameError:s,emailError:a,passwordError:o,roleError:i})}render(){return u.jsx(u.Fragment,{children:u.jsx("div",{className:"new-account",children:u.jsxs("div",{className:"form-wrapper",children:[u.jsx("h1",{children:"Create Account"}),u.jsxs("form",{onSubmit:this.handleSubmit,children:[u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"name",children:"Name:"}),u.jsx("input",{type:"text",id:"name",name:"name",placeholder:"Enter Name",value:this.state.name,onChange:this.handleChange,autoComplete:"off"}),this.state.nameError&&u.jsx("p",{className:"error-message1",children:this.state.nameError})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"email",children:"Email:"}),u.jsx("input",{type:"text",id:"email",name:"email",placeholder:"Enter Email",value:this.state.email,onChange:this.handleChange,autoComplete:"off"}),this.state.emailError&&u.jsx("p",{className:"error-message1",children:this.state.emailError})]}),u.jsxs("div",{className:"form-group1",children:[u.jsx("label",{htmlFor:"password",children:"Password:"}),u.jsxs("div",{className:"password-group",children:[u.jsxs("div",{className:"password-input-wrapper",children:[u.jsx("input",{type:this.state.passwordVisible?"text":"password",id:"password",name:"password",value:this.state.password,placeholder:"Password",className:"passwordInput",disabled:!0}),u.jsx("i",{className:`fas ${this.state.passwordVisible?"fa-eye-slash":"fa-eye"} password-icon`,onClick:this.togglePasswordVisibility})]}),u.jsx("button",{type:"button",onClick:this.generateRandomPassword,className:"generate-password-button",children:"Generate Password"})]}),this.state.passwordError&&u.jsx("p",{className:"error-message1",children:this.state.passwordError})]}),u.jsxs("div",{className:"form-group",children:[u.jsx("label",{htmlFor:"role",children:"Role:"}),u.jsxs("div",{className:"role-input-wrapper",ref:e=>this.dropdownRef=e,children:[u.jsx("input",{type:"text",id:"role",name:"role",value:this.state.role,onChange:this.handleRoleInputChange,autoComplete:"off",placeholder:"All roles",onFocus:this.showDropdownList}),this.state.showDropdown&&this.state.filteredRoles.length>0&&u.jsx("ul",{className:"role-dropdown",children:this.state.filteredRoles.map((e,t)=>u.jsx("li",{onClick:()=>this.selectRole(e),children:e},t))})]}),this.state.roleError&&u.jsx("p",{className:"error-message1",children:this.state.roleError})]}),"Site in-charge"===this.state.role&&u.jsxs("div",{className:"form-group",children:[u.jsx("label",{children:"Ssite:"}),u.jsxs("div",{className:"radio-group",children:[u.jsxs("label",{children:[u.jsx("input",{type:"radio",name:"site",value:"Tampines 253 Centre",checked:"Tampines 253 Centre"===this.state.site,onChange:this.handleChange}),"Tampines 253 Centre"]}),u.jsxs("label",{children:[u.jsx("input",{type:"radio",name:"site",value:"CT Hub",checked:"CT Hub"===this.state.site,onChange:this.handleChange}),"CT Hub"]}),u.jsxs("label",{children:[u.jsx("input",{type:"radio",name:"site",value:"Tampines North Community Centre",checked:"Tampines North Community Centre"===this.state.site,onChange:this.handleChange}),"Tampines North Community Centre"]}),u.jsxs("label",{children:[u.jsx("input",{type:"radio",name:"site",value:"Pasir Ris West Wellness Centre",checked:"Pasir Ris West Wellness Centre"===this.state.site,onChange:this.handleChange}),"Pasir Ris West Wellness Centre"]})]})]}),this.state.siteError&&u.jsx("p",{className:"error-message1",children:this.state.siteError}),u.jsxs("div",{className:"button-container",children:[u.jsx("button",{type:"button",onClick:this.clearForm,className:"clear-form-button",style:{padding:"10px",height:"2.5rem",fontSize:"15px"},children:"Clear Form"}),u.jsx("button",{type:"submit",className:"submit-form-button",style:{padding:"10px",height:"2.5rem",fontSize:"15px"},children:"Create Account"})]})]})]})})})}}class Z extends p.Component{constructor(e){super(e),d(this,"handleEntriesPerPageChange",e=>{this.setState({entriesPerPage:parseInt(e.target.value,10),currentPage:1})}),d(this,"fetchReceipt",()=>h(this,null,function*(){return(yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/receipt",{purpose:"retrieve"})).data.result})),d(this,"handleDownload",(e,t)=>{const s=document.createElement("a");s.href=t,s.download=`${e}.pdf`,s.click()}),this.state={hideAllCells:!1,receiptDetails:[],isLoading:!0,inputValues:{},dropdownVisible:{},filteredSuggestions:[],focusedInputIndex:null,originalData:[],currentPage:1,entriesPerPage:10},this.tableRef=g.createRef()}getPaginatedDetails(){const{receiptDetails:e}=this.state,{currentPage:t,entriesPerPage:s}=this.props,a=t*s,o=a-s;return e.slice(o,a)}componentDidMount(){return h(this,null,function*(){const{language:e}=this.props;var t=yield this.fetchReceipt();console.log(t);var s=this.getAllLocations(t);console.log("Locations:",s);var a=this.getAllNames(t);console.log("Names:",a),this.props.passDataToParent(s,a),this.setState({originalData:t,receiptDetails:t,isLoading:!1,locations:s,names:a}),yield this.props.getTotalNumberofDetails(t.length),this.props.closePopup()})}componentDidUpdate(e){return h(this,null,function*(){const{selectedLocation:t,selectedCourseType:s,searchQuery:a}=this.props;t===e.selectedLocation&&a===e.searchQuery||this.filterRegistrationDetails()})}filterRegistrationDetails(){const{section:e}=this.props;if("registration"===e){const{originalData:e}=this.state,{selectedLocation:t,searchQuery:s}=this.props;if("All Loctions"===t)return void this.setState({receiptDetails:e});const a=s?s.toLowerCase().trim():"",o=e.filter(e=>{var s,o,i,r,n;console.log("Substring:",e.receiptNo,t,e.receiptNo.includes(t));const l=(null==(s=e.receiptNo)?void 0:s.toLowerCase().trim())||"",c=(null==(o=e.staff)?void 0:o.toLowerCase().trim())||"",d=(null==(i=e.url)?void 0:i.toLowerCase().trim())||"",h=(null==(r=e.date)?void 0:r.toLowerCase().trim())||"",p=(null==(n=e.time)?void 0:n.toLowerCase().trim())||"",u="All Locations"===t||"所有语言"===t||""===t||!t||e.receiptNo.includes(t);console.log("Matches:",u);const g=!a||(l.includes(a)||c.includes(a)||d.includes(a)||h.includes(a)||p.includes(a));return u&&g});this.setState({receiptDetails:o.length>0?o:[]})}}getAllLocations(e){return[...new Set(e.map(e=>e.receiptNo.split("-")[0].trim()))]}getAllNames(e){return[...new Set(e.map(e=>e.staff))]}render(){const{hideAllCells:e,receiptDetails:t,filteredSuggestions:s,currentInput:a,showSuggestions:o,focusedInputIndex:i}=this.state,r=this.getPaginatedDetails();return u.jsx("div",{className:"registration-payment-container",children:u.jsxs("div",{className:"registration-payment-heading",children:[u.jsx("h1",{children:"zh"===this.props.language?"":"Receipt"}),u.jsx("div",{className:"table-wrapper",ref:this.tableRef,children:u.jsxs("table",{children:[u.jsx("thead",{children:u.jsxs("tr",{children:[u.jsx("th",{children:"zh"===this.props.language?"":"Receipt Number"}),u.jsx("th",{children:"zh"===this.props.language?"":"Receipt"}),u.jsx("th",{children:"zh"===this.props.language?"":"Staff Created"}),u.jsx("th",{children:"zh"===this.props.language?"":"Date Created"}),u.jsx("th",{children:"zh"===this.props.language?"":"Time Created"})]})}),u.jsx("tbody",{children:r.map((e,t)=>u.jsxs("tr",{children:[u.jsx("td",{children:e.receiptNo}),u.jsx("td",{children:u.jsx("a",{onClick:()=>this.handleDownload(e.receiptNo,e.url),children:u.jsx("i",{className:"fa-solid fa-receipt"})})}),u.jsx("td",{children:e.staff}),u.jsx("td",{children:e.date}),u.jsx("td",{children:e.time})]},t))})]})})]})})}}class X extends p.Component{constructor(e){super(e),d(this,"componentDidMount",()=>h(this,null,function*(){const{accountId:e}=this.props;yield this.getAccessRight(e)})),d(this,"isEqual",(e,t)=>{const s=Object.keys(e),a=Object.keys(t);if(s.length!==a.length)return!1;for(const o of s)if(e[o]!==t[o])return!1;return!0}),d(this,"componentWillUpdate",(e,t)=>h(this,null,function*(){e.accountId!==this.props.accountId&&this.getAccessRight(this.props.accountId),t.accessRights!==this.state.accessRights?this.accessRightsUpdated||(this.accessRightsUpdated=!0,this.getAccessRight(this.props.accountId)):this.accessRightsUpdated=!1})),d(this,"getAccessRight",e=>h(this,null,function*(){try{const t=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/accessRights",{purpose:"retrieveAccessRight",accountId:e});console.log("Access Rights Response:",t),this.setState({accessRights:t.data.result}),this.props.onAccessRightsUpdate&&this.props.onAccessRightsUpdate(t.data.result)}catch(t){console.error("Error retrieving access rights:",t)}})),d(this,"toggleMainMenu",e=>{this.setState(t=>({openKey:t.openKey===e?null:e}))}),d(this,"toggleDashboard",()=>{this.props.toggleDashboardComponent()}),d(this,"toggleHome",()=>{this.props.toggleHomeComponent()}),d(this,"handleSubKeyClick",e=>{console.log("Selected:",e),"Create Account"===e?this.props.toggleAccountsComponent(e):"Account Table"===e?(e="Accounts",this.props.toggleAccountsComponent(e)):"Access Rights Table"===e?(e="Access Rights",this.props.toggleAccountsComponent(e)):"NSA Courses"===e?(e="NSA",this.props.toggleCourseComponent(e)):"ILP Courses"===e?(e="ILP",this.props.toggleCourseComponent(e)):"Marriage Preparation Programme Courses"===e?(e="Marriage Preparation Programme",this.props.toggleCourseComponent(e)):"Registration And Payment Table"===e?this.props.toggleRegistrationPaymentComponent(e):"Monthly Report"===e||"Payment Report"===e?this.props.toggleReportComponent(e):"View Attendance"===e?(console.log("View Attendance clicked"),this.props.toggleAttendanceComponent(e)):"View Membership"===e&&(console.log("View Membership clicked"),this.props.toggleMembershipComponent(e))}),d(this,"closeSubMenu",()=>{this.setState({openKey:null})}),this.state={accessRights:{},openKey:null,accessRightsUpdated:!1}}render(){const{accessRights:e,openKey:t}=this.state;console.log("Access Rights:",e);const s={Home:"fa-solid fa-house-user",Dashboard:"fa-solid fa-dashboard",Account:"fa-solid fa-users",Courses:"fa-solid fa-chalkboard-user","Registration And Payment":"fa-solid fa-brands fa-wpforms",Membership:"fa-solid fas fa-address-card","QR Code":"fa-solid fa-qrcode",Reports:"fa-solid fa-table",Attendances:"fa-solid fa-calendar-days"};return u.jsx("div",{className:"sidebar-content",onMouseLeave:this.closeSubMenu,children:u.jsxs("ul",{children:[u.jsx("div",{style:{marginBottom:"-20px"},children:u.jsxs("li",{onClick:()=>this.toggleHome(),children:[u.jsx("i",{className:s.Home,"aria-hidden":"true"}),u.jsx("span",{style:{marginLeft:"5px"},children:"Home"})]},"Home")}),u.jsx("div",{style:{marginBottom:"-20px"},children:u.jsxs("li",{onClick:()=>this.toggleDashboard(),children:[u.jsx("i",{className:s.Dashboard,"aria-hidden":"true"}),u.jsx("span",{style:{marginLeft:"5px"},children:"Dashboard"})]},"Dashboard")}),Object.keys(e).map(a=>{const o=e[a];if(!0===o)return u.jsxs("li",{onClick:()=>this.toggleMainMenu(a),children:[u.jsx("i",{className:s[a],"aria-hidden":"true"})," ",u.jsx("span",{children:a})," "]},a);if("object"==typeof o&&null!==o){const e=Object.keys(o).filter(e=>!0===o[e]);if(e.length>0)return u.jsxs("li",{children:[u.jsxs("div",{onClick:()=>this.toggleMainMenu(a),children:[u.jsx("i",{className:s[a],"aria-hidden":"true"})," ",a," "]}),t===a&&u.jsx("ul",{children:e.map(e=>u.jsx("li",{onClick:()=>this.handleSubKeyClick(e),children:u.jsx("span",{children:e})},e))})]},a)}return null})]})})}}class ee extends p.Component{constructor(e){super(e),d(this,"componentDidMount",()=>h(this,null,function*(){console.log("DashboardSection mounted"),yield this.fetchRegistrationData(),this.props.closePopup1()})),d(this,"fetchRegistrationData",()=>h(this,null,function*(){try{const e=this.props.role||localStorage.getItem("userRole")||"admin",t=this.props.siteIC||localStorage.getItem("siteIC")||"";console.log("Fetching data with role:",e,"and siteIC:",t);const s=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{purpose:"retrieve",role:e,siteIC:t});console.log("Registration data loaded from API:",s.data);const a=Array.isArray(s.data)?s.data:s.data&&Array.isArray(s.data.result)?s.data.result:s.data&&Array.isArray(s.data.data)?s.data.data:[];console.log("Processed registration data array:",a);const o=this.filterDataBySiteIC(a,t);console.log("Filtered data based on siteIC:",o),this.setState({registrationData:o,loading:!1},()=>{const e=this.getAvailableQuarters();e.length>0&&!this.state.selectedQuarter?this.setState({selectedQuarter:e[0]},()=>{this.calculateStatistics()}):this.calculateStatistics()})}catch(e){console.error("Error fetching registration data:",e),this.setState({error:"Failed to load registration data. Please try again.",loading:!1})}})),d(this,"filterDataBySiteIC",(e,t)=>(console.log("Filtering data with siteIC:",t),t&&""!==t?Array.isArray(t)&&t.length>1?(console.log("siteIC is an array with more than one element, showing all data"),e):Array.isArray(t)&&1===t.length?(console.log("siteIC is an array with one element, filtering for site:",t[0]),e.filter(e=>{var s;return((null==(s=e.course)?void 0:s.courseLocation)||e.siteIC||"")===t[0]})):(console.log("siteIC is a specific value, filtering for site:",t),e.filter(e=>{var s;return((null==(s=e.course)?void 0:s.courseLocation)||e.siteIC||"")===t})):(console.log("siteIC is empty, showing all data"),e))),d(this,"getQuarterFromDate",e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return console.warn("Invalid date string:",e),null;const s=t.getMonth(),a=t.getFullYear();return s>=0&&s<=2?`Q1 January - March ${a}`:s>=3&&s<=5?`Q2 April - June ${a}`:s>=6&&s<=8?`Q3 July - September ${a}`:`Q4 October - December ${a}`}catch(t){return console.error("Error parsing date for quarter calculation:",e,t),null}}),d(this,"getAvailableQuarters",()=>{const{registrationData:e}=this.state,t=new Set;if(!Array.isArray(e))return console.warn("registrationData is not an array:",e),[];e.forEach(e=>{if(e.course&&e.course.courseDuration)try{const s=e.course.courseDuration.split(" - ")[0].trim(),a=this.getQuarterFromDate(s);a&&(console.log(`Course: ${e.course.courseEngName}, Start Date: ${s}, Quarter: ${a}`),t.add(a))}catch(s){console.error("Error processing courseDuration:",e.course.courseDuration,s)}});const s=Array.from(t).sort((e,t)=>{const s=e=>({year:parseInt(e.match(/\d{4}/)[0]),quarter:parseInt(e.match(/Q(\d)/)[1])}),a=s(e),o=s(t);return a.year!==o.year?a.year-o.year:a.quarter-o.quarter});return console.log("Available quarters:",s),s}),d(this,"getAvailableLocations",()=>{const{registrationData:e,selectedCourseType:t,selectedQuarter:s}=this.state,a=new Set;if(!Array.isArray(e))return console.warn("registrationData is not an array:",e),[];e.forEach(e=>{if(e.course&&e.course.courseLocation&&("All"===t||e.course.courseType===t)){let t=!0;if(s&&e.course&&e.course.courseDuration){const a=e.course.courseDuration.split(" - ")[0].trim();t=this.getQuarterFromDate(a)===s}else s&&(t=!1);t&&a.add(e.course.courseLocation)}});const o=Array.from(a).sort();return console.log(`Available locations for course type ${t} and quarter ${s}:`,o),o}),d(this,"getAvailableCourses",()=>{const{registrationData:e,selectedCourseType:t,selectedLocation:s,selectedQuarter:a}=this.state,o=new Set;if(!Array.isArray(e))return console.warn("registrationData is not an array:",e),[];e.forEach(e=>{if(e.course&&e.course.courseEngName&&("All"===t||e.course.courseType===t)&&(""===s||e.course.courseLocation===s)){let t=!0;if(a&&e.course&&e.course.courseDuration){const s=e.course.courseDuration.split(" - ")[0].trim();t=this.getQuarterFromDate(s)===a}else a&&(t=!1);t&&o.add(e.course.courseEngName)}});const i=Array.from(o).sort();return console.log(`Available courses for course type ${t}, location ${s}, and quarter ${a}:`,i),i}),d(this,"calculateStatistics",()=>{const{registrationData:e,selectedQuarter:t,selectedLocation:s,selectedCourse:a,selectedCourseType:o}=this.state;if(console.log(`Calculating statistics for ${o} courses`),!Array.isArray(e))return console.warn("registrationData is not an array:",e),void this.setState({statistics:{totalRegistrations:0,totalPaid:0,totalNotPaid:0,totalRefunded:0,totalConfirmed:0,cashPayments:0,paynowPayments:0,skillsfuturePayments:0,paymentCompletionRate:0}});const i=e.filter(e=>{const i=e.course&&("All"===o||e.course.courseType===o);let r=!0;if(t&&e.course&&e.course.courseDuration){const s=e.course.courseDuration.split(" - ")[0].trim();r=this.getQuarterFromDate(s)===t}else t&&(r=!1);let n=!0;s&&e.course&&e.course.courseLocation?n=e.course.courseLocation===s:s&&(n=!1);let l=!0;return a&&e.course&&e.course.courseEngName?l=e.course.courseEngName===a:a&&(l=!1),i&&r&&n&&l}),r=i.length,n=i.map(e=>(e.status||"").toString().toLowerCase()),l=[...new Set(n)];console.log("Unique statuses found in data:",l);const c=i.filter(e=>"paid"===(e.status||"").toString().toLowerCase()).length,d=i.filter(e=>"confirmed"===(e.status||"").toString().toLowerCase()).length,h=i.filter(e=>"refunded"===(e.status||"").toString().toLowerCase()).length,p=i.filter(e=>{const t=(e.status||"").toString().toLowerCase();return"pending"===t||"not paid"===t||"unpaid"===t||""===t}).length,u=c+d,g=i.filter(e=>{const t=(e.status||"").toString().toLowerCase();return"paid"===t||"confirmed"===t}),m=g.map(e=>{var t;return(null==(t=e.course)?void 0:t.payment)||"no payment info"}),f=[...new Set(m)];console.log("Unique payment methods found in paid records:",f),console.log("Total paid and confirmed records:",g.length);const y=g.filter(e=>(e.course&&e.course.payment?e.course.payment.toString().toLowerCase():"").includes("cash")).length,C=g.filter(e=>{const t=e.course&&e.course.payment?e.course.payment.toString().toLowerCase():"";return t.includes("paynow")||t.includes("pay now")}).length,w=g.filter(e=>{const t=e.course&&e.course.payment?e.course.payment.toString().toLowerCase():"";return t.includes("skillsfuture")||t.includes("skills future")||t.includes("sf")}).length;console.log("Payment method counts - Cash:",y,"PayNow:",C,"SkillsFuture:",w);const b=r>0?u/r*100:0;console.log("Status counts - Paid:",c,"Confirmed:",d,"Pending:",p,"Refunded:",h),console.log("Total from status counts:",c+d+p+h,"vs Total Registrations:",r);const x={totalRegistrations:r,totalPaid:u,totalNotPaid:p,totalRefunded:h,totalConfirmed:d,cashPayments:y,paynowPayments:C,skillsfuturePayments:w,paymentCompletionRate:b};return this.setState({statistics:x}),x}),d(this,"getCourseBreakdown",()=>{const{registrationData:e,selectedQuarter:t,selectedLocation:s,selectedCourseType:a}=this.state,o={};if(!Array.isArray(e))return[];return e.filter(e=>{const o=e.course&&("All"===a||e.course.courseType===a);let i=!0;if(t&&e.course&&e.course.courseDuration){const s=e.course.courseDuration.split(" - ")[0].trim();i=this.getQuarterFromDate(s)===t}else t&&(i=!1);let r=!0;return s&&e.course&&e.course.courseLocation?r=e.course.courseLocation===s:s&&(r=!1),o&&i&&r}).forEach(e=>{var t,s;const a=(null==(t=e.course)?void 0:t.courseEngName)||"Unknown Course",i=(null==(s=e.course)?void 0:s.courseLocation)||"Unknown Location",r=(e.status||"").toString().toLowerCase();o[a]||(o[a]={name:a,location:i,total:0,paid:0,pending:0,refunded:0}),o[a].total+=1,"paid"===r||"confirmed"===r?o[a].paid+=1:"refunded"===r?o[a].refunded+=1:o[a].pending+=1}),Object.values(o).sort((e,t)=>t.total-e.total)}),d(this,"getLocationBreakdown",()=>{const{registrationData:e,selectedCourseType:t,selectedQuarter:s}=this.state,a={};if(!Array.isArray(e))return[];return e.filter(e=>{const a=e.course&&("All"===t||e.course.courseType===t);let o=!0;if(s&&e.course&&e.course.courseDuration){const t=e.course.courseDuration.split(" - ")[0].trim();o=this.getQuarterFromDate(t)===s}else s&&(o=!1);return a&&o}).forEach(e=>{var t;const s=(null==(t=e.course)?void 0:t.courseLocation)||"Unknown Location",o=(e.status||"").toString().toLowerCase();a[s]||(a[s]={name:s,total:0,paid:0,pending:0,refunded:0}),a[s].total+=1,"paid"===o||"confirmed"===o?a[s].paid+=1:"refunded"===o?a[s].refunded+=1:a[s].pending+=1}),Object.values(a).sort((e,t)=>t.total-e.total)}),d(this,"handleQuarterChange",e=>{console.log("Quarter changed to:",e.target.value),this.setState({selectedQuarter:e.target.value,selectedLocation:"",selectedCourse:""},()=>{this.calculateStatistics()})}),d(this,"handleLocationChange",e=>{console.log("Location changed to:",e.target.value),this.setState({selectedLocation:e.target.value,selectedCourse:""},()=>{console.log("Location filter applied, course reset"),this.calculateStatistics()})}),d(this,"handleCourseChange",e=>{console.log("Course changed to:",e.target.value),this.setState({selectedCourse:e.target.value},()=>{this.calculateStatistics()})}),d(this,"handleCourseTypeChange",e=>{console.log("Course type changed to:",e.target.value),this.setState({selectedCourseType:e.target.value,selectedLocation:"",selectedCourse:""},()=>{console.log("Course type filter applied, location and course reset"),this.calculateStatistics()})}),d(this,"resetFilters",()=>{this.setState({selectedQuarter:"",selectedLocation:"",selectedCourse:"",selectedCourseType:"All"},()=>{this.calculateStatistics()})}),this.state={registrationData:[],loading:!0,error:null,selectedQuarter:"",selectedLocation:"",selectedCourse:"",selectedCourseType:"All",statistics:{totalRegistrations:0,totalPaid:0,totalNotPaid:0,totalRefunded:0,totalConfirmed:0,cashPayments:0,paynowPayments:0,skillsfuturePayments:0,paymentCompletionRate:0}}}render(){const{loading:e,error:t,selectedQuarter:s,selectedLocation:a,selectedCourse:o,selectedCourseType:i,statistics:r}=this.state;if(e)return u.jsxs("div",{className:"dashboard-loading",children:[u.jsx("div",{className:"loading-spinner"}),u.jsx("p",{children:"Loading dashboard data..."})]});if(t)return u.jsxs("div",{className:"dashboard-error",children:[u.jsx("h3",{children:"Error"}),u.jsx("p",{children:t}),u.jsx("button",{onClick:this.fetchRegistrationData,className:"retry-btn",children:"Retry"})]});const n=this.getAvailableQuarters(),l=this.getAvailableLocations(),c=this.getAvailableCourses();return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"dashboard-header",children:[u.jsx("div",{className:"header-left",children:u.jsx("h2",{children:"Registration Dashboard"})}),u.jsx("div",{className:"header-right",children:u.jsx("div",{className:"quarter-display",children:u.jsxs("select",{className:"quarter-dropdown",value:s,onChange:this.handleQuarterChange,children:[u.jsx("option",{value:"",children:"All Quarters"}),n.map(e=>u.jsx("option",{value:e,children:e},e))]})})})]}),u.jsxs("div",{className:"dashboard-filters",children:[u.jsx("h3",{children:"Filters"}),u.jsxs("div",{className:"filter-row",children:[u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{children:"Course Type:"}),u.jsxs("div",{className:"button-group",children:[u.jsx("button",{className:"filter-btn "+("All"===i?"active":""),onClick:()=>this.handleCourseTypeChange({target:{value:"All"}}),children:"All Courses"}),u.jsx("button",{className:"filter-btn "+("NSA"===i?"active":""),onClick:()=>this.handleCourseTypeChange({target:{value:"NSA"}}),children:"NSA"}),u.jsx("button",{className:"filter-btn "+("ILP"===i?"active":""),onClick:()=>this.handleCourseTypeChange({target:{value:"ILP"}}),children:"ILP"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{children:"Location:"}),u.jsxs("div",{className:"button-group",children:[u.jsx("button",{className:"filter-btn "+(""===a?"active":""),onClick:()=>this.handleLocationChange({target:{value:""}}),children:"All Locations"}),l.map(e=>u.jsx("button",{className:"filter-btn "+(a===e?"active":""),onClick:()=>this.handleLocationChange({target:{value:e}}),children:e},e))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{children:"Courses:"}),u.jsxs("div",{className:"button-group",children:[u.jsx("button",{className:"filter-btn "+(""===o?"active":""),onClick:()=>this.handleCourseChange({target:{value:""}}),children:"All Courses"}),c.map(e=>u.jsx("button",{className:"filter-btn "+(o===e?"active":""),onClick:()=>this.handleCourseChange({target:{value:e}}),title:e,children:e},e))]})]})]})]}),u.jsxs("div",{className:"dashboard-stats",children:[u.jsxs("div",{className:"stats-group",children:[u.jsxs("div",{className:"stats-group-header",children:[u.jsx("h4",{children:"Registration Overview"}),a&&u.jsxs("p",{style:{margin:"4px 0",fontSize:"14px",color:"#666"},children:["📍 Location: ",a]}),!a&&l.length>0&&u.jsxs("p",{style:{margin:"4px 0",fontSize:"14px",color:"#666"},children:["📍 All Locations (",l.length," locations)"]})]}),u.jsx("div",{className:"stats-grid",children:u.jsxs("div",{className:"stat-card primary",children:[u.jsx("div",{className:"stat-icon",children:"📊"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"Total Registrations"}),u.jsx("p",{className:"stat-number",children:r.totalRegistrations}),a&&u.jsxs("p",{style:{fontSize:"12px",color:"#666",margin:"4px 0 0 0"},children:["at ",a]}),!a&&l.length>0&&u.jsxs("p",{style:{fontSize:"12px",color:"#666",margin:"4px 0 0 0"},children:["across ",l.length," location",1!==l.length?"s":""]})]})]})})]}),u.jsxs("div",{className:"stats-group",children:[u.jsx("div",{className:"stats-group-header",children:u.jsx("h4",{children:"Payment Status"})}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-card success",children:[u.jsx("div",{className:"stat-icon",children:"✅"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"Paid"}),u.jsx("p",{className:"stat-number",children:r.totalPaid})]})]}),u.jsxs("div",{className:"stat-card warning",children:[u.jsx("div",{className:"stat-icon",children:"⏳"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"Pending"}),u.jsx("p",{className:"stat-number",children:r.totalNotPaid})]})]}),u.jsxs("div",{className:"stat-card danger",children:[u.jsx("div",{className:"stat-icon",children:"💰"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"Refunded"}),u.jsx("p",{className:"stat-number",children:r.totalRefunded})]})]})]})]}),u.jsxs("div",{className:"stats-group",children:[u.jsx("div",{className:"stats-group-header",children:u.jsx("h4",{children:"Payment Methods"})}),u.jsxs("div",{className:"stats-grid",children:[u.jsxs("div",{className:"stat-card info",children:[u.jsx("div",{className:"stat-icon",children:"💵"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"Cash Payments"}),u.jsx("p",{className:"stat-number",children:r.cashPayments})]})]}),u.jsxs("div",{className:"stat-card info",children:[u.jsx("div",{className:"stat-icon",children:"📱"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"PayNow Payments"}),u.jsx("p",{className:"stat-number",children:r.paynowPayments})]})]}),u.jsxs("div",{className:"stat-card info",children:[u.jsx("div",{className:"stat-icon",children:"🎓"}),u.jsxs("div",{className:"stat-content",children:[u.jsx("h3",{children:"SkillsFuture"}),u.jsx("p",{className:"stat-number",children:r.skillsfuturePayments})]})]})]})]})]}),u.jsxs("div",{className:"dashboard-summary",children:[u.jsx("h3",{children:"Summary"}),u.jsxs("div",{className:"summary-content",children:[u.jsxs("p",{children:["Showing statistics for ",u.jsx("strong",{children:"All"===i?"All":i})," courses",s&&` in ${s}`,a&&` at ${a}`,o&&` for "${o}"`]}),r.totalRegistrations>0&&u.jsxs("div",{className:"summary-insights",children:[u.jsx("h4",{children:"Key Insights:"}),u.jsxs("ul",{children:[u.jsxs("li",{children:[r.paymentCompletionRate>=80?"✅":r.paymentCompletionRate>=60?"⚠️":"❌","Payment completion rate: ",r.paymentCompletionRate.toFixed(1),"%"]}),u.jsxs("li",{children:["Most popular payment method: ",Math.max(r.cashPayments,r.paynowPayments,r.skillsfuturePayments)===r.cashPayments?"Cash":Math.max(r.paynowPayments,r.skillsfuturePayments)===r.paynowPayments?"PayNow":"SkillsFuture"]}),r.totalRefunded>0&&u.jsxs("li",{children:["⚠️ ",r.totalRefunded," refund(s) processed"]})]})]}),!a&&u.jsxs("div",{className:"breakdown-section",children:[u.jsx("h4",{children:"Registration by Location:"}),u.jsx("div",{className:"breakdown-chart",children:this.getLocationBreakdown().map((e,t)=>{const s=r.totalRegistrations>0?e.total/r.totalRegistrations*100:0;return u.jsxs("div",{className:"chart-bar-container",children:[u.jsxs("div",{className:"chart-label",children:[u.jsx("span",{className:"location-name",children:e.name}),u.jsxs("span",{className:"location-stats",children:[e.total," total (",e.paid," paid, ",e.pending," pending)"]})]}),u.jsxs("div",{className:"chart-bar",children:[u.jsx("div",{className:"chart-bar-fill",style:{width:`${s}%`,backgroundColor:`hsl(${210+30*t}, 70%, 50%)`}}),u.jsxs("span",{className:"chart-percentage",children:[s.toFixed(1),"%"]})]})]},e.name)})})]}),!o&&u.jsxs("div",{className:"breakdown-section",children:[u.jsx("h4",{children:"Registration by Course:"}),u.jsx("div",{className:"breakdown-chart",children:this.getCourseBreakdown().slice(0,10).map((e,t)=>{const s=r.totalRegistrations>0?e.total/r.totalRegistrations*100:0;return u.jsxs("div",{className:"chart-bar-container",children:[u.jsxs("div",{className:"chart-label",children:[u.jsx("span",{className:"course-name",title:e.name,children:e.name}),u.jsxs("span",{className:"course-details",children:["📍 ",e.location," | ",e.total," total (",e.paid," paid, ",e.pending," pending",e.refunded>0&&`, ${e.refunded} refunded`,")"]})]}),u.jsxs("div",{className:"chart-bar",children:[u.jsx("div",{className:"chart-bar-fill",style:{width:`${s}%`,backgroundColor:`hsl(${120+25*t}, 60%, 50%)`}}),u.jsxs("span",{className:"chart-percentage",children:[s.toFixed(1),"%"]})]})]},e.name)})}),this.getCourseBreakdown().length>10&&u.jsxs("p",{className:"breakdown-note",children:["Showing top 10 courses out of ",this.getCourseBreakdown().length," total courses"]})]})]})]})]})}}const te={auth:{clientId:"71ce9441-9704-42fa-b12a-eec3fcc850ad",authority:"https://login.microsoftonline.com/1885cbed-e741-4fed-a830-831e834c9022",redirectUri:window.location.origin,postLogoutRedirectUri:window.location.origin,navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,s)=>{if(!s)switch(e){case E.Error:console.error("[MSAL]",t);break;case E.Info:console.info("[MSAL]",t);break;case E.Verbose:console.debug("[MSAL]",t);break;case E.Warning:console.warn("[MSAL]",t)}}}}};M.registerModules([k]);class se extends p.Component{constructor(e){super(e),d(this,"getLocationFromClassId",e=>{if(!e)return"Unknown";const t=e.split(/[-_|\/\\]/)[0].trim().toUpperCase();return{CTH:"CT Hub",253:"Tampines 253",TNC:"Tampines North Community Centre",PRW:"Pasir Ris West Wellness Centre"}[t]||t}),d(this,"columnDefs",[{headerName:"S/N",valueGetter:e=>e.node.rowIndex+1,width:100,suppressSizeToFit:!0},{headerName:"Name",field:"name",width:300,sortable:!0},{headerName:"NRIC",field:"nric",width:200},{headerName:"Type",field:"type",width:200,sortable:!0},{headerName:"Location",valueGetter:e=>this.getLocationFromClassId(e.data.qrCode),width:400,sortable:!0},{headerName:"Activity Code",field:"qrCode",width:500,sortable:!0,wrapText:!0,cellStyle:{whiteSpace:"normal"}},{headerName:"Date",field:"date",width:200,sortable:!0},{headerName:"Time",field:"time",width:200,sortable:!0}]),d(this,"onGridReady",e=>{this.gridApi=e.api,this.gridColumnApi=e.columnApi,e.api.sizeColumnsToFit();const t=()=>{setTimeout(()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},100)};window.addEventListener("resize",t),this.handleResize=t,this.props.onGridReady&&this.props.onGridReady(e)}),d(this,"updateGridData",e=>{this.gridApi&&this.gridApi.setRowData(e)}),this.gridApi=null,this.gridColumnApi=null}componentWillUnmount(){this.handleResize&&window.removeEventListener("resize",this.handleResize)}render(){const{filteredData:e,gridKey:t}=this.props;return u.jsx("div",{className:"grid-container1",children:u.jsx(m,{columnDefs:this.columnDefs,rowData:e,pagination:!0,paginationPageSize:e.length,domLayout:"normal",defaultColDef:{resizable:!0,sortable:!0},onGridReady:this.onGridReady,suppressColumnVirtualisation:!0},t)})}}class ae extends p.Component{constructor(e){super(e),d(this,"reinitializeWithDelay",()=>{this.reinitializeTimeout&&clearTimeout(this.reinitializeTimeout),this.reinitializeTimeout=setTimeout(()=>{this.initializeWebDataRocks(),this.reinitializeTimeout=null},100)}),d(this,"getLocationFromClassId",e=>{if(!e)return"Unknown";const t=e.split(/[-_|\/\\]/)[0].trim().toUpperCase();return{CTH:"CT Hub",253:"Tampines 253",TNC:"Tampines North Community Centre",PRW:"Pasir Ris West Wellness Centre"}[t]||t}),d(this,"initializeWebDataRocks",()=>{if(this.isInitializing)return void console.log("WebDataRocks already initializing, skipping...");const e=this.containerRef.current;if(!e)return void console.warn("Pivot container not found");this.isInitializing=!0,this.cleanupWebDataRocks(),e.innerHTML="";const{filteredData:t}=this.props;if(!t||0===t.length)return console.log("No data available for pivot table"),e.innerHTML='<div style="padding: 20px; text-align: center; color: #666;">No data available to display in pivot table</div>',void(this.isInitializing=!1);const s=t.map(e=>({date:e.date||"",class_id:e.qrCode||"",location:this.getLocationFromClassId(e.qrCode),name:e.name||"",type:e.type||"",nric:e.nric||"",time:e.time||""})),a=["CT Hub","Tampines 253","Tampines North Community Centre","Pasir Ris West Wellness Centre"],o=s.filter(e=>a.includes(e.location));if(console.log("Filtered data for allowed locations:",o),0===o.length)return console.log("No data available for the specified locations"),e.innerHTML='<div style="padding: 20px; text-align: center; color: #666;">No data available for the specified locations (253, TNC, PRW)</div>',void(this.isInitializing=!1);console.log("Initializing WebDataRocks with filtered data:",o);try{this.webDataRocksInstance=new F({container:e,toolbar:!1,height:500,width:"100%",report:{dataSource:{data:o},slice:{rows:[{uniqueName:"location"},{uniqueName:"date"},{uniqueName:"class_id"},{uniqueName:"name"}],measures:[{uniqueName:"name",aggregation:"count",caption:"Name"}]},options:{grid:{type:"classic",showTotals:"on",showGrandTotals:"on",showHeaders:!1,showFilter:!0,showGrandTotalsRows:"on",showGrandTotalsColumns:"on",showTotalsRows:"on",showTotalsColumns:"on"}}},reportcomplete:()=>{this.webDataRocksInstance&&(this.webDataRocksInstance.off("reportcomplete"),this.webDataRocksInstance.expandAllData(),console.log("WebDataRocks pivot table initialized successfully")),this.isInitializing=!1}})}catch(i){console.error("Error initializing WebDataRocks:",i),e.innerHTML='<div style="padding: 20px; text-align: center; color: #d32f2f;">Error loading pivot table. Please try refreshing the page.</div>',this.isInitializing=!1}}),d(this,"cleanupWebDataRocks",()=>{if(this.webDataRocksInstance){try{this.webDataRocksInstance.dispose()}catch(e){console.warn("Error disposing WebDataRocks instance:",e)}this.webDataRocksInstance=null}this.containerRef.current&&(this.containerRef.current.innerHTML=""),this.isInitializing=!1}),this.webDataRocksInstance=null,this.containerRef=g.createRef(),this.isInitializing=!1,this.reinitializeTimeout=null}componentDidMount(){this.initializeWebDataRocks()}componentDidUpdate(e){const t=e.filteredData||[],s=this.props.filteredData||[];if(t.length!==s.length)return console.log("Pivot data length changed, reinitializing WebDataRocks"),void this.reinitializeWithDelay();if(s.length>0){const e=t.map(e=>({date:e.date||"",qrCode:e.qrCode||"",name:e.name||"",type:e.type||"",nric:e.nric||""})),a=s.map(e=>({date:e.date||"",qrCode:e.qrCode||"",name:e.name||"",type:e.type||"",nric:e.nric||""}));JSON.stringify(e)!==JSON.stringify(a)&&(console.log("Pivot data content changed, reinitializing WebDataRocks"),this.reinitializeWithDelay())}}componentWillUnmount(){this.reinitializeTimeout&&(clearTimeout(this.reinitializeTimeout),this.reinitializeTimeout=null),this.cleanupWebDataRocks()}render(){return u.jsx("div",{ref:this.containerRef,id:"pivotContainer",style:{width:"100%",minHeight:500,margin:"24px 0",border:"1px solid #ddd"}})}}const oe="localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net";class ie extends p.Component{constructor(e){super(e),d(this,"onGridReady",e=>{this.gridApi=e.api}),d(this,"fetchAttendance",e=>h(this,null,function*(){try{const t="localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net",s=yield D.post(`${t}/attendance`,{purpose:"retrieveAll"});if(console.log("Attendance data response:",s.data),s.data&&s.data.success){const t=s.data.data||[];console.log("Processed attendance data:",t);const a=["All Types",...new Set(t.map(e=>e.type).filter(Boolean))],{siteIC:o}=this.props;let i=[];i=o&&Array.isArray(o)?[...o]:o&&"string"==typeof o?o.includes(",")?o.split(",").map(e=>e.trim()):[o.trim()]:["CT Hub","Tampines 253","Tampines North Community Centre","Pasir Ris West Wellness Centre"],console.log("Allowed locations for activity codes:",i);const r=t.filter(e=>{const t=this.getLocationFromClassId(e.qrCode);return i.includes(t)}),n=["All Codes",...[...new Set(r.map(e=>e.qrCode).filter(Boolean))].slice(0,50)],l=this.getUniqueLocations(t);console.log("Unique types:",a),console.log("Unique activity codes:",n),console.log("Unique locations:",l),this.setState({attendanceData:t,loading:!1,dataFetched:!0,error:null},()=>{this.cachedFilteredData=null,this.lastFilterParams=null,this.validateActiveTab(),e&&e(t)}),this.props.onTypesLoaded&&this.props.onTypesLoaded(a,n,l)}else this.setState({loading:!1,error:"No attendance data available",dataFetched:!0}),e&&e([]);this.props.closePopup1()}catch(t){console.error("Error fetching attendance data:",t),this.setState({loading:!1,error:"Failed to load attendance data",dataFetched:!0}),e&&e([]),this.props.closePopup1()}})),d(this,"handleViewDetails",e=>{const t=e.data._id;console.log("Viewing details for record:",t)}),d(this,"getPivotTabs",()=>{const{attendanceData:e}=this.state,t=new Set(["all"]),s={CTH:"CT Hub"};return e.forEach(e=>{const a=e.qrCode||"";if(a){const e=a.split(/[-_|\/\\]/)[0].trim();e&&t.add(s[e]||e)}}),Array.from(t)}),d(this,"validateActiveTab",()=>{this.getPivotTabs().includes(this.state.activeTab)||(console.log(`Active tab '${this.state.activeTab}' not found in available tabs, resetting to 'all'`),this.setState({activeTab:"all"}),localStorage.setItem("attendanceActiveTab","all"))}),d(this,"getTabFilterValue",e=>{const t={CTH:"CT Hub"};for(const[s,a]of Object.entries(t))if(a===e)return s;return e}),d(this,"getFilteredDataForTab",e=>{const{attendanceData:t}=this.state;if("all"===e)return t;const s=this.getTabFilterValue(e);return t.filter(e=>(e.qrCode||"").split(/[-_|\/\\]/)[0].trim()===s)}),d(this,"renderExternalTabs",()=>{const{activeTab:e}=this.state,t=this.getPivotTabs();return u.jsxs("div",{className:"button-row5",style:{flexDirection:"row",alignItems:"center",gap:"8px",marginBottom:0,marginRight:0,minWidth:"110px"},children:[t.map(t=>u.jsx("button",{className:e===t?"view-btn active-tab-btn":"view-btn",style:{padding:"8px 20px",margin:"2px 0",fontSize:"20px",minHeight:"44px",lineHeight:"1.3",width:"fit-content",textAlign:"center",fontWeight:e===t?"bold":"normal",backgroundColor:e===t?"#263238":void 0,color:e===t?"#fff":void 0,outline:e===t?"2px solid #263238":"none",boxShadow:e===t?"0 2px 8px #bbb":"none",borderRadius:"5px",cursor:"pointer",border:"none",transition:"all 0.3s ease",overflow:"visible"},onClick:e=>{e.preventDefault(),e.stopPropagation(),this.handleTabChange(t)},disabled:this.isChangingTab,onMouseOver:s=>{e!==t&&(s.target.style.backgroundColor="#e0e0e0")},onMouseOut:s=>{e!==t&&(s.target.style.backgroundColor="")},children:"all"===t?"All Locations":t},t)),u.jsx("button",{className:"save-btn",onClick:()=>this.saveData(),children:"Export To Excel"})]})}),d(this,"getGroupedPivotData",(e=null)=>{const t=e||this.getFilteredDataForTab(this.state.activeTab),s={};return t.forEach(e=>{const t=e.date||"",a=e.qrCode||"",o=e.name||"";s[t]||(s[t]={}),s[t][a]||(s[t][a]=[]),s[t][a].push(o)}),s}),d(this,"handleTabChange",e=>{this.isChangingTab?console.log("Tab change already in progress, ignoring duplicate call"):(this.isChangingTab=!0,console.log("Changing tab to:",e),this.setState({activeTab:e},()=>{localStorage.setItem("attendanceActiveTab",e),setTimeout(()=>{this.isChangingTab=!1},100)}))}),d(this,"renderTabNavigation",()=>{const{activeTab:e}=this.state,t=this.getPivotTabs();return u.jsx("div",{style:{display:"flex",marginBottom:"20px",borderBottom:"2px solid #ddd",justifyContent:"center",flexWrap:"wrap"},children:t.map(t=>u.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),this.handleTabChange(t)},disabled:this.isChangingTab,style:{padding:"10px 20px",margin:"0 5px",border:"none",backgroundColor:e===t?"#263238":"#f5f5f5",color:e===t?"#fff":"#333",cursor:"pointer",borderRadius:"5px 5px 0 0",fontWeight:e===t?"bold":"normal",fontSize:"14px",transition:"all 0.3s ease"},onMouseOver:s=>{e!==t&&(s.target.style.backgroundColor="#e0e0e0")},onMouseOut:s=>{e!==t&&(s.target.style.backgroundColor="#f5f5f5")},children:"all"===t?"All Classes":t},t))})}),d(this,"renderPivotTable",()=>{const e=this.getFilteredAttendanceData(),t=this.getGroupedPivotData(e);let s=0;const a=[];return Object.entries(t).forEach(([e,t])=>{let o=0;a.push(u.jsx("tr",{style:{fontWeight:"bold",background:"#f5f5f5",borderTop:"2px solid #ddd"},children:u.jsx("td",{colSpan:4,style:{padding:"8px 12px",textAlign:"left"},children:e})},`${e}-header`)),Object.entries(t).forEach(([t,i])=>{const r=i.length;o+=r,s+=r,a.push(u.jsxs("tr",{style:{fontWeight:"bold",background:"#e8e8e8"},children:[u.jsx("td",{}),u.jsx("td",{colSpan:3,style:{padding:"8px 12px",textAlign:"left"},children:t})]},`${e}-${t}-header`)),i.forEach((s,o)=>{a.push(u.jsxs("tr",{children:[u.jsx("td",{}),u.jsx("td",{}),u.jsx("td",{style:{padding:"8px 12px"},children:s}),u.jsx("td",{style:{padding:"8px 12px",textAlign:"center"},children:"1"})]},`${e}-${t}-${o}`))}),a.push(u.jsxs("tr",{style:{fontWeight:"bold",background:"#e3f2fd"},children:[u.jsx("td",{}),u.jsx("td",{}),u.jsxs("td",{style:{textAlign:"right",padding:"8px 12px"},children:["Subtotal for ",t,":"]}),u.jsx("td",{style:{textAlign:"center",padding:"8px 12px"},children:r})]},`${e}-${t}-subtotal`))}),a.push(u.jsxs("tr",{style:{fontWeight:"bold",background:"#bbdefb"},children:[u.jsxs("td",{colSpan:3,style:{textAlign:"right",padding:"8px 12px"},children:["Total for ",e,":"]}),u.jsx("td",{style:{textAlign:"center",padding:"8px 12px"},children:o})]},`${e}-total`))}),a.push(u.jsxs("tr",{style:{fontWeight:"bold",background:"#90caf9"},children:[u.jsx("td",{colSpan:3,style:{textAlign:"right",padding:"8px 12px"},children:"Grand Total:"}),u.jsx("td",{style:{textAlign:"center",padding:"8px 12px"},children:s})]},"grand-total")),u.jsx("div",{style:{width:"100%"},children:u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:200,width:"100%"},children:u.jsxs("table",{style:{borderCollapse:"collapse",margin:"0 auto",minWidth:500,maxWidth:900,background:"#fff",boxShadow:"0 2px 8px #eee",border:"1px solid #ddd"},children:[u.jsx("thead",{children:u.jsxs("tr",{style:{background:"#263238",color:"#fff"},children:[u.jsx("th",{style:{padding:"8px 12px",border:"1px solid #ddd",width:"15%"},children:"Date"}),u.jsx("th",{style:{padding:"8px 12px",border:"1px solid #ddd",width:"25%"},children:"Class ID"}),u.jsx("th",{style:{padding:"8px 12px",border:"1px solid #ddd",width:"45%"},children:"Name"}),u.jsx("th",{style:{padding:"8px 12px",border:"1px solid #ddd",width:"15%"},children:"Count of Name"})]})}),u.jsx("tbody",{children:a})]})})})}),d(this,"changeView",()=>{if(this.isChangingView)return void console.log("View change already in progress, ignoring duplicate call");this.isChangingView=!0;const e=!this.state.isPivotView;console.log("Changing view to:",e?"Pivot":"Table"),this.setState({isPivotView:e},()=>{localStorage.setItem("attendanceViewMode",e?"pivot":"table"),setTimeout(()=>{this.isChangingView=!1},100)})}),d(this,"refreshChild",()=>h(this,null,function*(){try{this.setState({loading:!0});const e="localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net",t=yield D.post(`${e}/attendance`,{purpose:"retrieveAll"});if(console.log("Refreshing attendance data:",t.data),t.data&&t.data.success){const e=t.data.data||[],s=["All Types",...new Set(e.map(e=>e.type).filter(Boolean))],a=["All Codes",...new Set(e.map(e=>e.qrCode).filter(Boolean).slice(0,50))],o=this.getUniqueLocations(e);if(this.setState({attendanceData:e,loading:!1,dataFetched:!0,error:null},()=>{this.cachedFilteredData=null,this.lastFilterParams=null}),!this.state.isPivotView&&this.tableViewRef.current&&this.tableViewRef.current.updateGridData){const t=this.getFilteredAttendanceData(e);this.tableViewRef.current.updateGridData(t)}this.props.onTypesLoaded&&this.props.onTypesLoaded(s,a,o),this.props.closePopup1()}else this.setState({loading:!1,error:"No attendance data available",dataFetched:!0}),this.props.closePopup1()}catch(e){console.error("Error refreshing attendance data:",e),this.setState({loading:!1,error:"Failed to refresh attendance data",dataFetched:!0}),this.props.closePopup1()}})),d(this,"resetViewPreferences",()=>{localStorage.removeItem("attendanceViewMode"),localStorage.removeItem("attendanceActiveTab"),this.setState({isPivotView:!1,activeTab:"all"}),console.log("View preferences reset to defaults")}),d(this,"getLocationFromClassId",e=>{if(!e)return"Unknown";const t=e.split(/[-_|\/\\]/)[0].trim().toUpperCase();return{CTH:"CT Hub",253:"Tampines 253",TNC:"Tampines North Community Centre",PRW:"Pasir Ris West Wellness Centre"}[t]||t}),d(this,"getUniqueLocations",e=>{const{siteIC:t}=this.props;let s=["All Locations"];if(t&&Array.isArray(t))s=["All Locations",...t];else if(t&&"string"==typeof t)if(t.includes(",")){const e=t.split(",").map(e=>e.trim());s=["All Locations",...e]}else s=["All Locations",t.trim()];else s=["All Locations","CT Hub","Tampines 253","Tampines North Community Centre","Pasir Ris West Wellness Centre"];const a=new Set(["All Locations"]);return e.forEach(e=>{if(e.qrCode){const t=this.getLocationFromClassId(e.qrCode);t&&"Unknown"!==t&&s.includes(t)&&a.add(t)}}),Array.from(a)}),d(this,"getFilteredAttendanceData",(e=null)=>{const{attendanceType:t,activityCode:s,searchQuery:a,selectedLocation:o,siteIC:i}=this.props,r=e||this.state.attendanceData,n={attendanceType:t||"",activityCode:s||"",searchQuery:a||"",selectedLocation:o||"",siteIC:i||"",dataLength:r.length,dataHash:r.length>0?JSON.stringify(r.slice(0,3)):""};if(this.cachedFilteredData&&this.lastFilterParams&&JSON.stringify(n)===JSON.stringify(this.lastFilterParams))return console.log("[AttendanceSection] Using cached filtered data"),this.cachedFilteredData;console.log("[AttendanceSection] Computing new filtered data"),console.log("[AttendanceSection] attendanceType:",t),console.log("[AttendanceSection] activityCode:",s),console.log("[AttendanceSection] searchQuery:",a),console.log("[AttendanceSection] selectedLocation:",o),console.log("[AttendanceSection] siteIC:",i),console.log("[AttendanceSection] attendanceData length:",r.length);let l=[...r],c=[];if(i&&Array.isArray(i)?(console.log("[AttendanceSection] Multiple sites detected:",i),c=[...i]):i&&"string"==typeof i?i.includes(",")?(console.log("[AttendanceSection] Comma-separated sites detected:",i),c=i.split(",").map(e=>e.trim())):(console.log("[AttendanceSection] Single site detected:",i),c=[i.trim()]):(console.log("[AttendanceSection] No siteIC provided, using default locations"),c=["CT Hub","Tampines 253","Tampines North Community Centre","Pasir Ris West Wellness Centre"]),console.log("[AttendanceSection] Allowed locations:",c),l=l.filter(e=>{const t=this.getLocationFromClassId(e.qrCode);return c.includes(t)}),console.log("[AttendanceSection] After location filtering, records:",l.length),t&&"All Types"!==t&&(l=l.filter(e=>e.type===t)),s&&"All Codes"!==s&&(l=l.filter(e=>e.qrCode&&e.qrCode.includes(s))),o&&"All Locations"!==o&&(l=l.filter(e=>this.getLocationFromClassId(e.qrCode)===o)),a){const e=a.toLowerCase();l=l.filter(t=>{const s=this.getLocationFromClassId(t.qrCode);return t.name&&t.name.toLowerCase().includes(e)||t.nric&&t.nric.toLowerCase().includes(e)||t.qrCode&&t.qrCode.toLowerCase().includes(e)||t.type&&t.type.toLowerCase().includes(e)||s&&s.toLowerCase().includes(e)})}return this.cachedFilteredData=l,this.lastFilterParams=n,console.log("[AttendanceSection] filteredData length:",l.length),l}),d(this,"clearFilterCache",()=>{this.cachedFilteredData=null,this.lastFilterParams=null,console.log("Filter cache cleared")}),d(this,"createSummarySheet",e=>{const t=[];t.push({Metric:"Total Attendance Records",Count:e.length,Percentage:"100%"});const s={};e.forEach(e=>{const t=this.getLocationFromClassId(e.qrCode);s[t]=(s[t]||0)+1}),t.push({Metric:"",Count:"",Percentage:""}),t.push({Metric:"LOCATION BREAKDOWN",Count:"",Percentage:""}),Object.entries(s).sort(([,e],[,t])=>t-e).forEach(([s,a])=>{const o=(a/e.length*100).toFixed(1);t.push({Metric:s,Count:a,Percentage:`${o}%`})});const a={};e.forEach(e=>{const t=e.date||"Unknown Date";a[t]=(a[t]||0)+1}),t.push({Metric:"",Count:"",Percentage:""}),t.push({Metric:"TOP EVENT DATES",Count:"",Percentage:""}),Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,10).forEach(([s,a])=>{const o=(a/e.length*100).toFixed(1);t.push({Metric:s,Count:a,Percentage:`${o}%`})});const o={};e.forEach(e=>{const t=e.qrCode||"Unknown Class";o[t]=(o[t]||0)+1}),t.push({Metric:"",Count:"",Percentage:""}),t.push({Metric:"TOP CLASSES",Count:"",Percentage:""}),Object.entries(o).sort(([,e],[,t])=>t-e).slice(0,10).forEach(([s,a])=>{const o=(a/e.length*100).toFixed(1);t.push({Metric:s,Count:a,Percentage:`${o}%`})});const i=R.json_to_sheet(t);i["!cols"]=[{wch:40},{wch:15},{wch:15}];const r=R.decode_range(i["!ref"]);for(let n=r.s.r;n<=r.e.r;++n)for(let e=r.s.c;e<=r.e.c;++e){const t=R.encode_cell({r:n,c:e});if(!i[t])continue;const s=i[t].v;n===r.s.r?i[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2E7D32"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}}:s&&"string"==typeof s&&(s.includes("BREAKDOWN")||s.includes("TOP "))?i[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"1565C0"}},alignment:{horizontal:"left",vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}}:""!==s&&(i[t].s={alignment:{horizontal:0===e?"left":"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}},(n-1)%2==1&&(i[t].s.fill={fgColor:{rgb:"F5F5F5"}}))}return i}),d(this,"exportDirectDownload",e=>h(this,null,function*(){var t;const s=this.createLoadingIndicator("Generating Excel file...",e.length);document.body.appendChild(s);try{console.log("🔄 Starting direct Excel download...");const t=yield D.post(`${oe}/export-excel-direct`,{data:e},{responseType:"blob",timeout:6e4,headers:{"Content-Type":"application/json"}}),s=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=s;const o=(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-");a.download=`attendance_report_${o}.xlsx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),alert(`✅ Excel file downloaded successfully!\n\n📊 ${e.length.toLocaleString()} records exported`)}catch(a){console.error("❌ Direct download error:",a),413===(null==(t=a.response)?void 0:t.status)?alert("❌ Dataset too large for direct export.\nTry filtering the data to reduce size."):"ECONNABORTED"===a.code?alert("⏱️ Export timeout. The dataset might be too large."):alert(`❌ Direct download failed: ${a.message}`)}finally{document.body.contains(s)&&document.body.removeChild(s)}})),d(this,"createLoadingIndicator",(e,t)=>{const s=document.createElement("div");return s.innerHTML=`\n      <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); \n                  background: white; padding: 20px; border: 2px solid #0078d4; border-radius: 8px; \n                  box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; text-align: center;">\n        <div style="margin-bottom: 15px;">\n          <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #0078d4; \n                      border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>\n        </div>\n        <p style="margin: 10px 0; font-weight: bold; color: #0078d4;">${e}</p>\n        <p style="font-size: 12px; color: #666;">${t.toLocaleString()} records</p>\n        <style>\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          </style>\n        </div>\n      `,s}),d(this,"createColumnBasedPivotTable",(e,t)=>{const s=this.getGroupedPivotData(e),a=[];Object.entries(s).forEach(([e,t])=>{Object.entries(t).forEach(([t,s])=>{const o=this.getLocationFromClassId(t);s.forEach(s=>{a.push({Location:o,Date:e,Class_ID:t,Name:s,Count:1})})})});const o=R.json_to_sheet(a),i=R.decode_range(o["!ref"]),r=[];for(let l=i.s.c;l<=i.e.c;++l){let e=10;for(let t=i.s.r;t<=i.e.r;++t){const s=R.encode_cell({r:t,c:l});if(o[s]&&o[s].v){const t=String(o[s].v).length;e=Math.max(e,t+2)}}r.push({wch:Math.min(e,50)})}o["!cols"]=r;const n=R.decode_range(o["!ref"]);for(let l=n.s.r;l<=n.e.r;++l)for(let e=n.s.c;e<=n.e.c;++e){const t=R.encode_cell({r:l,c:e});o[t]&&(o[t].v,l===n.s.r?o[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4CAF50"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}}:l>=0&&l<n.e.r&&(o[t].s={alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}},(l-1)%2==1&&(o[t].s.fill={fgColor:{rgb:"F5F5F5"}})))}return o}),d(this,"createRawDataSheet",e=>{const t=e.map(e=>({Name:e.name||"",NRIC:e.nric||"","Class ID":e.qrCode||"",Type:e.type||"",Location:this.getLocationFromClassId(e.qrCode)||"",Date:e.date||"",Time:e.time||""})),s=R.json_to_sheet(t);if(t.length>0){const e=Object.keys(t[0]).map(e=>{let s=e.length;return t.forEach(t=>{const a=String(t[e]||"");s=Math.max(s,a.length)}),{wch:Math.min(Math.max(s+2,10),50)}});s["!cols"]=e}const a=R.decode_range(s["!ref"]);for(let o=a.s.r;o<=a.e.r;++o)for(let e=a.s.c;e<=a.e.c;++e){const t=R.encode_cell({r:o,c:e});s[t]&&(o===a.s.r?s[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2E7D32"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}}:(s[t].s={alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}},(o-1)%2==1&&(s[t].s.fill={fgColor:{rgb:"F5F5F5"}})))}return s}),d(this,"createUIFormattedPivotTable",e=>{const t=this.getGroupedPivotData(e),s=[];let a=0;Object.entries(t).forEach(([e,t])=>{let o=0;s.push({Date:e,"Class ID":"",Name:"",Count:"",_rowType:"dateHeader"}),Object.entries(t).forEach(([e,t])=>{const i=t.length;o+=i,a+=i,s.push({Date:"","Class ID":e,Name:"",Count:"",_rowType:"classHeader"}),t.forEach(e=>{s.push({Date:"","Class ID":"",Name:e,Count:1,_rowType:"nameRow"})}),s.push({Date:"","Class ID":"",Name:`Subtotal for ${e}:`,Count:i,_rowType:"subtotal"})}),s.push({Date:"","Class ID":"",Name:`Total for ${e}:`,Count:o,_rowType:"dateTotal"})}),s.push({Date:"","Class ID":"",Name:"Grand Total:",Count:a,_rowType:"grandTotal"});const o=s.map(e=>{const t=e,{_rowType:s}=t;return c(t,["_rowType"])}),i=R.json_to_sheet(o);i["!cols"]=[{wch:15},{wch:25},{wch:45},{wch:15}];const r=R.decode_range(i["!ref"]);for(let n=r.s.r;n<=r.e.r;++n)for(let e=r.s.c;e<=r.e.c;++e){const t=R.encode_cell({r:n,c:e});if(!i[t])continue;const a=s[n-1];if(n===r.s.r)i[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"263238"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}};else if(a){let s="FFFFFF",o=!1,r="center";switch(a._rowType){case"dateHeader":s="F5F5F5",o=!0,r="left";break;case"classHeader":s="E8E8E8",o=!0,r="left";break;case"nameRow":s="FFFFFF",r=2===e?"left":"center";break;case"subtotal":s="E3F2FD",o=!0,r=2===e?"right":"center";break;case"dateTotal":s="BBDEFB",o=!0,r=2===e?"right":"center";break;case"grandTotal":s="90CAF9",o=!0,r=2===e?"right":"center"}i[t].s={font:{bold:o},fill:{fgColor:{rgb:s}},alignment:{horizontal:r,vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}}}}return i}),d(this,"createClassSpecificSheet",(e,t)=>{const s=t.sort((e,t)=>{const s=(e.date||"").localeCompare(t.date||"");return 0!==s?s:(e.name||"").localeCompare(t.name||"")}),a=[];a.push({Name:e,Date:"",Time:"",Location:""}),a.push({Name:"",Date:"",Time:"",Location:""}),a.push({Name:"Name",Date:"Date",Time:"Time",Location:"Location"}),s.forEach(e=>{a.push({Name:e.name||"",Date:e.date||"",Time:e.time||"",Location:this.getLocationFromClassId(e.qrCode)||""})});const o=R.json_to_sheet(a);o["!cols"]=[{wch:35},{wch:15},{wch:12},{wch:30}];const i=R.decode_range(o["!ref"]);for(let r=i.s.r;r<=i.e.r;++r)for(let e=i.s.c;e<=i.e.c;++e){const t=R.encode_cell({r:r,c:e});o[t]&&(0===r?o[t].s={font:{bold:!0,size:16,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"1565C0"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"medium",color:{rgb:"000000"}},right:{style:"medium",color:{rgb:"000000"}}}}:2===r?o[t].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2E7D32"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}}:r>2&&(o[t].s={alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"CCCCCC"}},bottom:{style:"thin",color:{rgb:"CCCCCC"}},left:{style:"thin",color:{rgb:"CCCCCC"}},right:{style:"thin",color:{rgb:"CCCCCC"}}}},(r-3)%2==1&&(o[t].s.fill={fgColor:{rgb:"F5F5F5"}})))}return o["!merges"]||(o["!merges"]=[]),o["!merges"].push({s:{r:0,c:0},e:{r:0,c:3}}),o}),d(this,"saveData",()=>h(this,null,function*(){let e=0,t=null;try{const s=this.getFilteredAttendanceData();if(!s||0===s.length)return void alert("⚠️ No data available to export");const a=[...new Set(s.map(e=>e.qrCode).filter(Boolean))];e=11+a.length,t=this.createLoadingIndicator(`Creating ${e}-sheet Excel file...`,s.length),t.setAttribute("data-loading-indicator","true"),document.body.appendChild(t),console.log(`🔄 Starting ${e}-sheet Excel generation...`),console.log(`📋 Found ${a.length} unique class IDs:`,a);const o=R.book_new(),i=this.createSummarySheet(s);R.book_append_sheet(o,i,"Summary");const r=this.createRawDataSheet(s);R.book_append_sheet(o,r,"Raw_AllLocations");const n=["CT Hub","Tampines 253","Tampines North Community Centre","Pasir Ris West Wellness Centre"];n.forEach((e,t)=>{const a=s.filter(t=>this.getLocationFromClassId(t.qrCode)===e),i=this.createRawDataSheet(a),r=`Raw_${{"CT Hub":"CTHub","Tampines 253":"Tampines253","Tampines North Community Centre":"TampinesNorthCC","Pasir Ris West Wellness Centre":"PasirRisWestWC"}[e]||e.replace(/[^\w]/g,"").substring(0,20)}`;R.book_append_sheet(o,i,r)}),n.forEach((e,t)=>{const a=s.filter(t=>this.getLocationFromClassId(t.qrCode)===e),i=this.createUIFormattedPivotTable(a),r=`Pivot_${{"CT Hub":"CTHub","Tampines 253":"Tampines253","Tampines North Community Centre":"TampinesNorthCC","Pasir Ris West Wellness Centre":"PasirRisWestWC"}[e]||e.replace(/[^\w]/g,"").substring(0,18)}`;R.book_append_sheet(o,i,r)});const l=this.createUIFormattedPivotTable(s);R.book_append_sheet(o,l,"Pivot_AllLocations"),a.forEach((e,t)=>{const a=s.filter(t=>t.qrCode===e),i=this.createClassSpecificSheet(e,a),r=`Class_${String(e).replace(/[^\w\s-]/g,"").replace(/\s+/g,"_").substring(0,24)}`;R.book_append_sheet(o,i,r)});const c=A(o,{bookType:"xlsx",type:"array"}),d=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(d),p=document.createElement("a");p.href=h;const u=(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-");p.download=`attendance_${e}sheets_${u}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(h),alert(`✅ ${e}-sheet Excel file downloaded successfully!\n\n📊 Total: ${s.length.toLocaleString()} records\n📋 Structure:\n• Sheet 1: Summary\n• Sheets 2-5: Raw data (4 locations)\n• Sheets 6-9: Pivot tables (4 locations)\n• Sheet 10: Raw data (ALL locations)\n• Sheet 11: Pivot table (ALL locations)\n• Sheets 12-${e}: Individual class tabs (${a.length} classes)`)}catch(s){console.error(`❌ ${e}-sheet Excel generation error:`,s),alert(`❌ Excel generation failed: ${s.message}`)}finally{t&&document.body.contains(t)&&document.body.removeChild(t)}}));const t=localStorage.getItem("attendanceViewMode"),s=localStorage.getItem("attendanceActiveTab");this.state={attendanceData:[],loading:!0,dataFetched:!1,error:null,attendanceTypes:[],activityCodes:[],isPivotView:"pivot"===t,activeTab:s||"all",pivotTabs:[]},this.gridApi=null,this.tableViewRef=g.createRef(),this.isChangingView=!1,this.isChangingTab=!1,this.cachedFilteredData=null,this.lastFilterParams=null,this.pivotExportFunctions=null}componentDidMount(){return h(this,null,function*(){const{isPivotView:e}=this.state;console.log(`Component mounted - loading ${e?"pivot":"table"} view (restored from localStorage)`),yield this.fetchAttendance(e=>{const t=this.getFilteredAttendanceData(e);console.log("Filtered data on mount:",t)})})}render(){const{attendanceData:e,loading:t,error:s,isPivotView:a}=this.state,o=this.getFilteredAttendanceData(),i=`attendance-grid-${this.props.attendanceType}-${this.props.activityCode}-${this.props.searchQuery}-${this.props.selectedLocation}`;return console.log("attendanceData:",this.state.attendanceData),console.log("filteredData:",o),console.log("isPivotView:",a),u.jsxs("div",{className:"attendance-container",children:[u.jsxs("div",{className:"attendance-heading",children:[u.jsx("h1",{children:"zh"===this.props.language?"":"View Attendance"}),u.jsxs("div",{className:"button-row4",style:{marginLeft:"0px",width:"20%",display:"flex",gap:"10px",alignItems:"center"},children:[u.jsx("button",{className:"view-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.changeView()},disabled:this.isChangingView,children:a?"Table View":"Pivot Table"}),u.jsx("button",{className:"save-btn",onClick:()=>this.saveData(),children:"Export To Excel"})]})]}),a?u.jsx(ae,{filteredData:o}):u.jsx(se,{ref:this.tableViewRef,filteredData:o,gridKey:i,onGridReady:this.onGridReady})]})}}M.registerModules([k]);const re="localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net";class ne extends p.Component{constructor(e){super(e),d(this,"getColumnDefs",()=>(console.log("Generating column definitions for membership data"),[{headerName:"S/N",field:"sn",width:150,sortable:!0,pinned:"left"},{headerName:"Name",field:"particular.name",width:250,sortable:!0,pinned:"left"},{headerName:"Contact Number",field:"particular.contactNumber",width:200,sortable:!0},{headerName:"Race",field:"particular.race",width:150,sortable:!0},{headerName:"Gender",field:"particular.gender",width:120,sortable:!0},{headerName:"Email",field:"particular.email",width:250,sortable:!0},{headerName:"Date of Birth",field:"particular.dateOfBirth",width:150,sortable:!0},{headerName:"Membership Type",field:"type",width:300,sortable:!0,pinned:"right",cellStyle:e=>({backgroundColor:this.getTypeColor(e.value),fontWeight:"bold",color:"white",textAlign:"center",borderRadius:"15px",paddingLeft:"10px",paddingRight:"10px"})}])),d(this,"getTypeColor",e=>{switch(null==e?void 0:e.toLowerCase()){case"member":return"#4CAF50";case"volunteer":return"#2196F3";case"participant":return"#FF9800";default:return"#607D8B"}}),d(this,"getAllMembershipTypes",e=>{console.log("Extracting membership types from data:",e);const t=[...new Set(e.map(e=>e.type))].filter(Boolean);return console.log("Unique membership types found:",t),t}),d(this,"filterMembershipData",()=>{const{membershipType:e,searchQuery:t}=this.props,{membershipData:s}=this.state;console.log("Filtering membership data with:",{membershipType:e,searchQuery:t}),console.log("Initial membership data length:",s);let a=[...s],o="";if("string"==typeof e?o=e:e&&"object"==typeof e&&e.membershipType&&(o=e.membershipType),o&&"All Types"!==o&&(a=a.filter(e=>e.type&&e.type.toLowerCase()===o.toLowerCase())),t){const e=t.toLowerCase();a=a.filter(t=>{const s=t.particular||{};return s.name&&s.name.toLowerCase().includes(e)||s.contactNumber&&s.contactNumber.toLowerCase().includes(e)||s.email&&s.email.toLowerCase().includes(e)||s.race&&s.race.toLowerCase().includes(e)||s.gender&&s.gender.toLowerCase().includes(e)||t.type&&t.type.toLowerCase().includes(e)})}console.log("Filtered membership data:",a.length,"records");const i=a.map((e,t)=>l(n({},e),{sn:t+1}));this.setState({rowData:i})}),d(this,"fetchMembershipData",(e=!1)=>h(this,null,function*(){try{this.setState({loading:!0});const e=yield D.post(`${re}/membership`,{purpose:"retrieveAll"});let t=[];e.data&&e.data.data?t=e.data.data:e.data&&Array.isArray(e.data)?t=e.data:e.data&&e.data.details&&(t=e.data.details);const s=t.map((e,t)=>l(n({},e),{sn:t+1})),a=this.getAllMembershipTypes(s);this.props.passDataToParent&&this.props.passDataToParent(a,null,null,null),this.setState({membershipData:s,rowData:s,originalData:s,loading:!1})}catch(e){console.error("Error fetching membership data:",e),this.setState({error:"Failed to load membership data. Please try again later.",loading:!1})}})),d(this,"refreshMembershipData",()=>h(this,null,function*(){x,this.setState({loading:!0}),yield this.fetchMembershipData(!0);const e=this.state.membershipData.map((e,t)=>l(n({},e),{sn:t+1}));this.setState({rowData:e},()=>{this.props.closePopup1()})})),this.state={membershipData:[],loading:!0,error:null,columnDefs:this.getColumnDefs(),originalData:[],rowData:[]}}componentDidMount(){return h(this,null,function*(){this.setState({columnDefs:this.getColumnDefs()}),yield this.fetchMembershipData(),this.props.closePopup1()})}componentDidUpdate(e){if(e.membershipType!==this.props.membershipType||e.searchQuery!==this.props.searchQuery){if("All Types"!==this.props.membershipType&&this.props.membershipType||this.props.searchQuery&&""!==this.props.searchQuery)this.filterMembershipData();else{const e=this.state.membershipData.map((e,t)=>l(n({},e),{sn:t+1}));this.setState({rowData:e})}this.props.closePopup1()}}render(){const{loading:e,error:t,columnDefs:s,rowData:a}=this.state;return u.jsx("div",{className:"membership-container",children:u.jsxs("div",{className:"membership-heading",children:[u.jsx("h1",{children:"zh"===this.props.language?"会员":"Membership"}),u.jsx("div",{className:"grid-container1",children:u.jsx(m,{columnDefs:s,rowData:a,pagination:!0,paginationPageSize:a.length,domLayout:"normal",defaultColDef:{resizable:!0,sortable:!0},onGridReady:e=>{e.api.sizeColumnsToFit()}})})]})})}}class le extends p.Component{constructor(e){super(e),d(this,"handleFromDateChange",e=>{this.setState({fromDate:e.target.value})}),d(this,"handleToDateChange",e=>{this.setState({toDate:e.target.value})}),d(this,"generateReportButton",()=>h(this,null,function*(){this.setState({showReport:!0,dateRange:`${this.state.fromDate} - ${this.state.toDate}`}),yield this.fetchSiteICDetails(this.state.fromDate,this.state.toDate),yield this.calculateTotalPriceForDateRange(this.state.fromDate,this.state.toDate),this.setState({showSiteICDropdown:!0})})),d(this,"componentDidMount",()=>h(this,null,function*(){this.props.loadingPopup1(),yield this.fetchInvoiceDetails(),this.props.closePopup1()})),d(this,"componentDidUpdate",e=>h(this,null,function*(){e.reportType!==this.props.reportType&&(this.props.loadingPopup1(),yield this.fetchInvoiceDetails(),this.props.closePopup1())})),d(this,"calculateTotalPriceForSelectedMonth",e=>{const{invoiceData:t}=this.state;console.log("Invoice Data:",t);const[s,a]=e.split(" ");new Date(Date.parse(`${s} 1, 2025`)).getMonth();const o=t.filter(t=>{const s=(e=>{if(!e)return null;const[t,s,a]=e.split("/");return new Date(`${a}-${s}-${t}`)})(t.official.date);if(!s)return!1;const a=`${s.toLocaleString("default",{month:"long"})} ${s.getFullYear()}`;return t.official.receiptNo&&a===e});console.log("Filtered Data:",o);const i=o.reduce((e,t)=>{var s;let a=0;if(t.official.date){const e=null==(s=t.course)?void 0:s.coursePrice.replace("$","").trim();""===e||isNaN(parseFloat(e))||(a=parseFloat(e))}return e+a},0);console.log("Filtered Total Price:",i),this.setState({totalPrice:i.toFixed(2)})}),d(this,"calculateTotalPriceForDateRange",()=>{console.log("Updated Invoice Data:",this.state.updatedInvoiceData);const e=this.state.updatedInvoiceData.reduce((e,t)=>{var s;let a=0;if("Cash"===t.course.payment&&"Paid"===t.status){const e=null==(s=t.course)?void 0:s.coursePrice.replace("$","").trim();""===e||isNaN(parseFloat(e))||(a=parseFloat(e))}return e+a},0),t=this.state.updatedInvoiceData.reduce((e,t)=>{var s;let a=0;if("PayNow"===t.course.payment&&"Paid"===t.status){const e=null==(s=t.course)?void 0:s.coursePrice.replace("$","").trim();""===e||isNaN(parseFloat(e))||(a=parseFloat(e))}return e+a},0),s=this.state.updatedInvoiceData.reduce((e,t)=>{var s;let a=0;if("Paid"===t.status){const e=null==(s=t.course)?void 0:s.coursePrice.replace("$","").trim();""===e||isNaN(parseFloat(e))||(a=parseFloat(e))}return e+a},0);console.log("Total Cash:",e),console.log("Total PayNow:",t),console.log("Total Price:",s),this.setState({totalCash:e.toFixed(2),totalPayNow:t.toFixed(2),totalPrice:s.toFixed(2)})}),d(this,"fetchInvoiceDetails",()=>h(this,null,function*(){try{const e=(yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/generate_monthly_report/")).data.data;console.log("Fetched Invoice Data:",e),console.log("This.props:",this.props);const t=(Array.isArray(this.props.siteIC)?this.props.siteIC:"string"==typeof this.props.siteIC&&this.props.siteIC.includes(",")?this.props.siteIC.split(",").map(e=>e.trim()).filter(Boolean):this.props.siteIC?[this.props.siteIC]:[]).map(e=>e.split("-")[0].trim());let s;const a=this.props.role?this.props.role.toLowerCase():"";"admin"===a||"sub-admin"===a||"nsa in-charge"===a||"ops in-charge"===a?(s=e.filter(e=>{var t;return"SkillsFuture"!==(null==(t=e.course)?void 0:t.payment)}),console.log("Filtered Data (Admin/Sub-admin/NSA/Ops in-charge):",s)):a.includes("in-charge")?(s=e.filter(e=>{var s,a,o,i;const r=null==(o=null==(a=null==(s=e.course)?void 0:s.courseLocation)?void 0:a.split("-")[0])?void 0:o.trim();return"SkillsFuture"!==(null==(i=e.course)?void 0:i.payment)&&t.includes(r)}),console.log("Filtered Data (Other In-charge):",s)):(s=e.filter(e=>{var s,a,o,i;const r=null==(o=null==(a=null==(s=e.course)?void 0:s.courseLocation)?void 0:a.split("-")[0])?void 0:o.trim();return"SkillsFuture"!==(null==(i=e.course)?void 0:i.payment)&&t.includes(r)}),console.log("Filtered Data (Default):",s));const o=s.map((e,t)=>l(n({},e),{index:t+1}));console.log("Invoice Data:",o);const i=this.getMonthYearOptions(o);this.setState({invoiceData:o,rowData:o,updatedInvoiceData:o,monthYearOptions:i,filteredMonthYearOptions:i,status:`Collection by ${this.props.userName||"Lee Chin"}`,showReport:!1,showTable:!1,fromDate:"",toDate:"",selectedMonthYear:"",selectedSiteICLocation:""})}catch(e){console.error("Error fetching invoice details:",e)}})),d(this,"fetchSiteICDetails",(e,t)=>h(this,null,function*(){try{this.props.loadingPopup1();const s=e=>{if(!e)return null;const[t,s,a]=e.split("/");return new Date(`${a}-${s}-${t}`)},a=e=>e instanceof Date&&!isNaN(e),o=e?s(e):null,i=t?s(t):null;e&&!a(o)&&console.error("Invalid fromDate:",e),t&&!a(i)&&console.error("Invalid toDate:",t);const r=(Array.isArray(this.props.siteIC)?this.props.siteIC:"string"==typeof this.props.siteIC&&this.props.siteIC.includes(",")?this.props.siteIC.split(",").map(e=>e.trim()).filter(Boolean):this.props.siteIC?[this.props.siteIC]:[]).map(e=>e.split("-")[0].trim());console.log("This Props:",this.props);let c=1;console.log("Original Invoice Data:",this.state.invoiceData);const d=this.state.invoiceData.filter(e=>{var t;const n=e.registrationDate,l=(s(n),null==(t=e.official)?void 0:t.date),c=s(l),d=e.course.courseLocation,h=this.state.selectedSiteICLocation;let p;if(p="All Locations"!==h&&"all"!==h&&""!==h&&h?[h]:r,c){if(o&&i&&a(o)&&a(i))return console.log("From1234",this.props.role,this.props.role.toLowerCase().includes("in-charge")),!this.props.role||"admin"!==this.props.role.toLowerCase()&&"sub-admin"!==this.props.role.toLowerCase()?this.props.role&&this.props.role.toLowerCase().includes("in-charge")?(console.log("In-charge Role Detected:",this.props.role),"nsa in-charge"===this.props.role.toLowerCase()?c>=o&&c<=i&&"CT Hub"===d&&"SkillsFuture"!==e.course.payment&&"Pending"!==e.status:c>=o&&c<=i&&p.includes(d)&&"SkillsFuture"!==e.course.payment&&"Pending"!==e.status):c>=o&&c<=i&&p.includes(d)&&"SkillsFuture"!==e.course.payment&&"Pending"!=e.status:c>=o&&c<=i&&"SkillsFuture"!==e.course.payment&&"Pending"!=e.status;if(!o&&!i)return!this.props.role||"admin"!==this.props.role.toLowerCase()&&"sub-admin"!==this.props.role.toLowerCase()?this.props.role&&this.props.role.toLowerCase().includes("in-charge")?"nsa in-charge"===this.props.role.toLowerCase()?c>=o&&c<=i&&p.includes("CT Hub")&&"SkillsFuture"!==e.course.payment&&"Pending"!==e.status:c>=o&&c<=i&&p.includes(d)&&"SkillsFuture"!==e.course.payment&&"Pending"!==e.status:p.includes(d)&&"SkillsFuture"!==e.course.payment:"SkillsFuture"!==e.course.payment}return!1}).map(e=>{const t=l(n({},e),{index:c});return c++,t});console.log("Filtered Report Data:",d),this.setState({rowData:d,updatedInvoiceData:d,status:`Collection by ${this.props.userName}`}),this.props.closePopup1()}catch(s){console.error("Error fetching invoice details:",s)}})),d(this,"getMonthYearOptions",e=>{const t=new Set;return e.forEach(e=>{const s=e.registrationDate,[a,o,i]=s.split("/"),r=`${new Date(`${i}-${o}-${a}`).toLocaleString("default",{month:"long"})} ${i}`;t.add(r)}),Array.from(t)}),d(this,"handleMonthYearChange",e=>{console.log("Selected Month Year:",e),this.setState({selectedMonthYear:e,showMonthYearDropdown:!1}),this.calculateTotalPriceForSelectedMonth(e),this.filterInvoiceDataByMonthYear(e)}),d(this,"filterInvoiceDataByMonthYear",e=>{const{invoiceData:t}=this.state;if(console.log("Selected Value:",e),console.log("Invoice Data:",t),""!==e){const s=t.filter(t=>{const s=t.official.date||"",[a,o,i]=s.split("/"),r=`${new Date(`${i}-${o}-${a}`).toLocaleString("default",{month:"long"})} ${i}`;return console.log("Filter:",r,e),r===e&&""!==t.official.receiptNo}).map((e,t)=>l(n({},e),{index:t+1}));this.setState({updatedInvoiceData:s,showTable:!0})}else this.setState({updatedInvoiceData:t,showTable:!1})}),d(this,"generateMonthlyReport",()=>{const{updatedInvoiceData:e,selectedMonthYear:t}=this.state,s=["S/N","Received From","Course Name","Course Location","Payment Method","Price","Payment Status","Receipt Number","Registration Date","Payment Date","Refunded Date","Misc","Remarks"],a=e.filter(e=>{var t;return"SkillsFuture"!==(null==(t=e.course)?void 0:t.payment)}),o={};a.forEach(e=>{var t,s;const a=(null==(s=((null==(t=e.official)?void 0:t.receiptNo)||"").split("-")[0])?void 0:s.trim())||"Unknown";o[a]||(o[a]=[]),o[a].push(e)}),Object.keys(o).forEach(e=>{o[e].sort((e,t)=>{var s,a,o,i;const r=(null==(s=e.official)?void 0:s.receiptNo)||"",n=(null==(a=t.official)?void 0:a.receiptNo)||"",l=null==(o=r.split("-")[1])?void 0:o.trim(),c=null==(i=n.split("-")[1])?void 0:i.trim();return l?c?parseInt(l,10)-parseInt(c,10):-1:1})});const i=[];Object.keys(o).sort().forEach(e=>{i.push(...o[e])});var r=i.map((e,t)=>{var s,a,o,i,r,n,l,c,d;return[t+1,(null==(s=e.participant)?void 0:s.name)||"",(null==(a=e.course)?void 0:a.courseEngName)||"",(null==(o=e.course)?void 0:o.courseLocation)||"",(null==(i=e.course)?void 0:i.payment)||"",(null==(r=e.course)?void 0:r.coursePrice)||"",e.status||"",(null==(n=e.official)?void 0:n.receiptNo)||"",e.registrationDate||"",(null==(l=e.official)?void 0:l.date)||"",(null==(c=e.official)?void 0:c.refundedDate)||"","",(null==(d=e.official)?void 0:d.remarks)||""]});const n=`$  ${i.reduce((e,t)=>{var s,a;let o=0;if(null==(s=t.official)?void 0:s.date){const e=((null==(a=t.course)?void 0:a.coursePrice)||"").replace("$","").trim();""===e||isNaN(parseFloat(e))||(o=parseFloat(e))}return e+o},0).toFixed(2)}`,l=new Array(s.length).fill(""),c=new Array(s.length).fill("");c[2]="dd-mm-yy",c[3]="Collection by Lee Chin";const d=new Array(s.length).fill("");d[6]=`Total: ${n}`;const h=[s,...r,l,c,l,d],p=s.map((e,t)=>{let a=s[t].length;return h.forEach(e=>{e[t]&&e[t].toString().length>a&&(a=e[t].toString().length)}),{wch:a+2}}),u=R.aoa_to_sheet(h);u["!cols"]=p;for(let m=0;m<s.length;m++)u[`${String.fromCharCode(65+m)}1`].s={font:{bold:!0}};const g=R.book_new();R.book_append_sheet(g,u,"Invoice Report"),T(g,`Invoice Report - ${t}.xlsx`)}),d(this,"generatePaymentReport",()=>{const{updatedInvoiceData:e,dateRange:t}=this.state,s=["S/N","Received From","Course Name","Course Location","Payment Method","Price","Payment Status","Receipt Number","Registration Date","Payment Date","Refunded Date","Misc","Remarks"],a=e.reduce((e,t)=>{var s;const a=((null==(s=t.official)?void 0:s.receiptNo)||"").split(" - ")[0];return e[a]||(e[a]=[]),e[a].push(t),e},{}),o=Object.keys(a).map(e=>({receiptPrefix:e,data:a[e].sort((e,t)=>{var s,a;const o=null==(s=e.official)?void 0:s.receiptNo.split(" - ")[1],i=null==(a=t.official)?void 0:a.receiptNo.split(" - ")[1];return o&&i?parseInt(o)-parseInt(i):0})})),i=[];o.forEach(e=>{e.data.forEach((e,t)=>{var s,a,o,r,n,l,c,d;i.push([i.length+1,(null==(s=e.participant)?void 0:s.name)||"",(null==(a=e.course)?void 0:a.courseEngName)||"",(null==(o=e.course)?void 0:o.courseLocation)||"",(null==(r=e.course)?void 0:r.payment)||"",(null==(n=e.course)?void 0:n.coursePrice)||"",e.status||"",(null==(l=e.official)?void 0:l.receiptNo)||"",e.registrationDate||"",e.official.date||"",(null==(c=e.official)?void 0:c.refundedDate)||"","",(null==(d=e.official)?void 0:d.remarks)||""])})});const{totalPriceCash:r,totalPricePaynow:n}=e.reduce((e,t)=>{var s,a,o;let i=parseFloat(null==(s=t.course)?void 0:s.coursePrice.replace("$","").trim())||0;return"Cash"===(null==(a=t.course)?void 0:a.payment)&&(e.totalPriceCash+=i),"PayNow"===(null==(o=t.course)?void 0:o.payment)&&(e.totalPricePaynow+=i),e},{totalPriceCash:0,totalPricePaynow:0}),l=`$ ${r.toFixed(2)}`,c=`$ ${n.toFixed(2)}`,d=`$ ${(n+r).toFixed(2)}`,h=new Array(s.length).fill(""),p=new Array(s.length).fill("");p[2]="dd-mm-yy",p[3]=`Collection by ${this.props.userName}`;const u=new Array(s.length).fill("");u[6]=`Total (Cash): ${l}`;const g=new Array(s.length).fill("");g[6]=`Total (PayNow): ${c}`;const m=new Array(s.length).fill("");m[6]=`Total: ${d}`;const f=[s,...i,h,p,h,u,g,m],y=s.map((e,t)=>{let a=s[t].length;return f.forEach(e=>{var s;const o=(null==(s=e[t])?void 0:s.toString())||"";o.length>a&&(a=o.length)}),{wch:a+2}}),C=R.aoa_to_sheet(f);C["!cols"]=y;for(let b=0;b<s.length;b++)C[`${String.fromCharCode(65+b)}1`].s={font:{bold:!0}};const w=R.book_new();R.book_append_sheet(w,C,"Invoice Report"),T(w,`Invoice Report - ${t}.xlsx`)}),d(this,"handleChange",e=>{const{name:t,value:s}=e.target;console.log("handleChange",t,e),this.setState({[t]:s},()=>{if("selectedMonthYear"===t){const e=this.state.monthYearOptions.filter(e=>e.toLowerCase().includes(s.toLowerCase()));this.setState({filteredMonthYearOptions:e,selectedMonthYear:s})}else if("selectedSiteICLocation"===t){const e=Array.isArray(this.props.siteIC)?this.props.siteIC:"string"==typeof this.props.siteIC&&this.props.siteIC.includes(",")?this.props.siteIC.split(",").map(e=>e.trim()).filter(Boolean):this.props.siteIC?[this.props.siteIC]:[],t=[];e.length>1&&t.push("All Locations"),e.forEach(e=>{const s=e.split("-")[0].trim();t.push(s)});const a=t.filter(e=>e.toLowerCase().includes(s.toLowerCase()));this.setState({filteredSiteOptions:a,selectedSiteICLocation:s})}})}),d(this,"handleDropdownToggle",e=>{console.log("Dropdown:",e),"showMonthYearDropdown"===e?this.setState({showMonthYearDropdown:!0}):"showSiteDropdown"===e&&this.setState({showSiteDropdown:!0})}),d(this,"handleSiteChange",e=>{console.log("Selected Site:",e),this.setState({selectedSiteICLocation:e,showSiteDropdown:!1},()=>h(this,null,function*(){yield this.fetchSiteICDetails(this.state.fromDate,this.state.toDate),yield this.calculateTotalPriceForDateRange()}))}),this.state={invoiceData:[],updatedInvoiceData:[],columnDefs:[{headerName:"S/N",field:"index",width:100,sortable:!0},{headerName:"Received From",field:"participant.name",width:200,sortable:!0},{headerName:"Course Name",field:"course.courseEngName",width:350,sortable:!0},{headerName:"Course Location",field:"course.courseLocation",width:300,sortable:!0},{headerName:"Payment Method",field:"course.payment",width:150,sortable:!0},{headerName:"Price",field:"course.coursePrice",width:150,sortable:!0},{headerName:"Payment Status",field:"status",width:200,sortable:!0},{headerName:"Receipt Number",field:"official.receiptNo",width:300,sortable:!0},{headerName:"Registration Date",field:"registrationDate",width:150,sortable:!0},{headerName:"Payment Date",field:"official.date",width:150,sortable:!0},{headerName:"Refunded Date",field:"official.refundedDate",width:150,sortable:!0},{headerName:"Misc",field:"misc",width:250,sortable:!0},{headerName:"Remarks",field:"official.remarks",width:250,sortable:!0}],rowData:[],monthYearOptions:[],filteredMonthYearOptions:[],selectedMonthYear:"",showTable:!1,status:"",total:"",fromDate:"",toDate:"",showReport:!1,dateRange:"",totalCash:0,totalPayNow:0,showMonthYearDropdown:!1,selectedSiteICLocation:"",showSiteICDropdown:!1,showSiteDropdown:!1,filteredSiteOptions:[]}}render(){var{showMonthYearDropdown:e,filteredMonthYearOptions:t,updatedInvoiceData:s,showSiteICDropdown:a,selectedSiteICLocation:o,showSiteDropdown:i,filteredSiteOptions:r}=this.state;return M.registerModules([k]),u.jsxs(u.Fragment,{children:["Monthly Report"===this.props.reportType&&u.jsxs(u.Fragment,{children:[u.jsx("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Monthly Report"}),u.jsxs("div",{id:"month-year-selector1",name:"monthYearSelector1",className:"dropdown-container1 "+(e?"open":""),children:[u.jsx("input",{type:"text",id:"month-year-dropdown1",name:"selectedMonthYear",value:this.state.selectedMonthYear,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showMonthYearDropdown"),placeholder:"zh"===this.props.language?"":"Click to select the month year",autoComplete:"off"}),e&&u.jsx("ul",{className:"dropdown-list1",children:t.map((e,t)=>u.jsx("li",{onClick:()=>this.handleMonthYearChange(e),children:e},t))})]}),this.state.showTable&&u.jsxs(u.Fragment,{children:[console.log("This props.1:",this.props),u.jsxs("div",{className:"report-container",children:[this.state.showSiteICDropdown&&u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",margin:"10px 0"},children:[u.jsx("label",{style:{fontWeight:"bold",minWidth:"80px"},children:"Select Site:"}),u.jsxs("div",{id:"site-selector",name:"siteSelector",className:"dropdown-container1 "+(i?"open":""),style:{flex:1,maxWidth:"300px"},children:[u.jsx("input",{type:"text",id:"site-dropdown",name:"selectedSiteICLocation",value:this.state.selectedSiteICLocation,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showSiteDropdown"),placeholder:"Click to select site",autoComplete:"off"}),i&&u.jsx("ul",{className:"dropdown-list1",children:(()=>{const e=Array.isArray(this.props.siteIC)?this.props.siteIC:"string"==typeof this.props.siteIC&&this.props.siteIC.includes(",")?this.props.siteIC.split(",").map(e=>e.trim()).filter(Boolean):this.props.siteIC?[this.props.siteIC]:[],t=[];e.length>1&&t.push("All Locations"),e.forEach(e=>{const s=e.split("-")[0].trim();t.push(s)});return(r.length>0?r:t).map((e,t)=>u.jsx("li",{onClick:()=>this.handleSiteChange(e),children:e},t))})()})]})]}),u.jsx("p",{children:u.jsxs("strong",{children:["Report For ",this.state.selectedMonthYear]})}),u.jsx("p",{children:u.jsxs("strong",{children:["Status : ",this.state.status]})}),u.jsx("p",{children:u.jsxs("strong",{children:["Total : $",this.state.totalPrice]})})]}),u.jsxs("div",{id:"invoice-table-container",name:"invoiceTableContainer",children:[u.jsx("div",{id:"ag-grid-container",name:"agGridContainer",className:"ag-theme-alpine",children:u.jsx(m,{columnDefs:this.state.columnDefs,rowData:this.state.updatedInvoiceData,pagination:!0,paginationPageSize:this.state.updatedInvoiceData.length,domLayout:"normal",onGridReady:this.onGridReady})}),u.jsx("div",{id:"export-button-container",name:"exportButtonContainer",style:{textAlign:"center",marginTop:"20px"},children:u.jsx("button",{id:"export-to-excel-button",name:"exportToExcelButton",onClick:this.generateMonthlyReport,children:"Export to Excel"})})]})]})]}),"Payment Report"===this.props.reportType&&u.jsxs(u.Fragment,{children:[u.jsx("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Payment Report"}),u.jsxs("div",{id:"date-range-selector",name:"dateRangeSelector",style:{marginTop:"20px",textAlign:"center"},children:[u.jsx("p",{style:{fontWeight:"bold"},children:"Date Range"})," ",u.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"20px",alignItems:"center"},children:[u.jsxs("div",{style:{textAlign:"left",width:"auto",display:"flex",alignItems:"center",gap:"10px"},children:[u.jsx("label",{htmlFor:"from-date",style:{display:"block",marginBottom:"5px"},children:"From"}),u.jsx("input",{type:"text",id:"from-date",name:"fromDate",onChange:this.handleFromDateChange,value:this.state.fromDate,placeholder:"dd/mm/yyyy",style:{padding:"8px",fontSize:"1rem",width:"7vw",border:"1px solid #000000",borderRadius:"4px"}})]}),u.jsxs("div",{style:{textAlign:"left",width:"auto",display:"flex",alignItems:"center",gap:"10px"},children:[u.jsx("label",{htmlFor:"to-date",style:{display:"block",marginBottom:"5px"},children:"To"}),u.jsx("input",{type:"text",id:"to-date",name:"toDate",onChange:this.handleToDateChange,value:this.state.toDate,placeholder:"dd/mm/yyyy",style:{padding:"8px",fontSize:"1rem",width:"7vw",border:"1px solid #000000",borderRadius:"4px"}})]}),u.jsx("div",{children:u.jsx("button",{className:"generate-btn",onClick:()=>this.generateReportButton(),children:"Generate"})})]})]}),this.state.showReport&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"report-container",children:[this.state.showSiteICDropdown&&null!==this.props.siteIC&&void 0!==this.props.siteIC&&""!==this.props.siteIC&&Array.isArray(this.props.siteIC)&&this.props.siteIC.length>0&&u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",margin:"10px 0"},children:[u.jsx("label",{style:{fontWeight:"bold",minWidth:"80px"},children:"Select Site:"}),u.jsxs("div",{id:"site-selector-payment",name:"siteSelectorPayment",className:"dropdown-container1 "+(i?"open":""),style:{flex:1,maxWidth:"300px",marginLeft:"0px"},children:[u.jsx("input",{type:"text",id:"site-dropdown-payment",name:"selectedSiteICLocation",value:this.state.selectedSiteICLocation,onChange:this.handleChange,onClick:()=>this.handleDropdownToggle("showSiteDropdown"),placeholder:"Click to select site",autoComplete:"off"}),i&&u.jsx("ul",{className:"dropdown-list1",children:(()=>{const e=Array.isArray(this.props.siteIC)?this.props.siteIC:"string"==typeof this.props.siteIC&&this.props.siteIC.includes(",")?this.props.siteIC.split(",").map(e=>e.trim()).filter(Boolean):this.props.siteIC?[this.props.siteIC]:[],t=[];e.length>1&&t.push("All Locations"),e.forEach(e=>{const s=e.split("-")[0].trim();t.push(s)});return(r.length>0?r:t).map((e,t)=>u.jsx("li",{onClick:()=>this.handleSiteChange(e),children:e},t))})()})]})]}),u.jsx("p",{children:u.jsxs("strong",{children:["Report For ",this.state.dateRange]})}),u.jsx("p",{children:u.jsxs("strong",{children:["Status : ",this.state.status]})}),u.jsxs("p",{style:{display:"flex",alignItems:"flex-start"},children:[u.jsx("strong",{style:{marginRight:"10px"},children:"Total:"}),u.jsxs("span",{style:{display:"flex",flexDirection:"column"},children:[u.jsxs("span",{children:["$",this.state.totalPrice," "]}),u.jsxs("span",{children:["$",this.state.totalCash,"   (Cash)"]}),u.jsxs("span",{children:[" $",this.state.totalPayNow,"   (PayNow)"]})]})]})]}),u.jsx("div",{id:"ag-grid-container",name:"agGridContainer",className:"ag-theme-alpine",children:u.jsx(m,{columnDefs:this.state.columnDefs,rowData:this.state.updatedInvoiceData,pagination:!0,paginationPageSize:this.state.updatedInvoiceData.length,domLayout:"normal",onGridReady:this.onGridReady})}),u.jsx("div",{id:"export-button-container",name:"exportButtonContainer",style:{textAlign:"center",marginTop:"20px"},children:u.jsx("button",{id:"export-to-excel-button",name:"exportToExcelButton",onClick:this.generatePaymentReport,children:"Export to Excel"})})]})]}),this.state.showTable&&0===s.length&&u.jsx("div",{style:{textAlign:"center",color:"red"},children:"No data available for the selected period."})]})}}class ce extends p.Component{constructor(e){super(e),d(this,"getRoleBasedActions",()=>{const{role:e}=this.props,t={Administrator:[{key:"Create Account",title:"Create Account",icon:"fas fa-user-plus",description:"Add new user accounts to the system",action:()=>this.props.onNavigate("create-account")},{key:"Account Table",title:"Manage Accounts",icon:"fas fa-users-cog",description:"View and manage user accounts",action:()=>this.props.onNavigate("accounts")},{key:"Access Rights Table",title:"Access Rights",icon:"fas fa-shield-alt",description:"Configure user permissions and access rights",action:()=>this.props.onNavigate("access-rights")},{key:"Registration And Payment Table",title:"Registrations & Payments",icon:"fas fa-credit-card",description:"Manage course registrations and payments",action:()=>this.props.onNavigate("registration")},{key:"NSA Courses",title:"NSA Courses",icon:"fas fa-graduation-cap",description:"Manage NSA course offerings",action:()=>this.props.onNavigate("nsa-courses")},{key:"ILP Courses",title:"ILP Courses",icon:"fas fa-book-open",description:"Manage ILP course offerings",action:()=>this.props.onNavigate("ilp-courses")}],Manager:[{key:"Registration And Payment Table",title:"Registrations & Payments",icon:"fas fa-credit-card",description:"Manage course registrations and payments",action:()=>this.props.onNavigate("registration")},{key:"View Attendance",title:"View Attendance",icon:"fas fa-clipboard-check",description:"Monitor student attendance records",action:()=>this.props.onNavigate("attendance")},{key:"View Membership",title:"View Membership",icon:"fas fa-id-card",description:"Manage member information and records",action:()=>this.props.onNavigate("membership")},{key:"Monthly Report",title:"Monthly Report",icon:"fas fa-chart-bar",description:"Generate monthly analytics reports",action:()=>this.props.onNavigate("monthly-report")},{key:"Payment Report",title:"Payment Report",icon:"fas fa-file-invoice-dollar",description:"Generate payment and financial reports",action:()=>this.props.onNavigate("payment-report")},{key:"NSA Courses",title:"NSA Courses",icon:"fas fa-graduation-cap",description:"Manage NSA course offerings",action:()=>this.props.onNavigate("nsa-courses")}],Staff:[{key:"Registration And Payment Table",title:"Registrations & Payments",icon:"fas fa-credit-card",description:"Handle course registrations and payments",action:()=>this.props.onNavigate("registration")},{key:"View Attendance",title:"View Attendance",icon:"fas fa-clipboard-check",description:"Record and view student attendance",action:()=>this.props.onNavigate("attendance")},{key:"View Membership",title:"View Membership",icon:"fas fa-id-card",description:"Access member information",action:()=>this.props.onNavigate("membership")},{key:"NSA Courses",title:"NSA Courses",icon:"fas fa-graduation-cap",description:"View NSA course information",action:()=>this.props.onNavigate("nsa-courses")},{key:"ILP Courses",title:"ILP Courses",icon:"fas fa-book-open",description:"View ILP course information",action:()=>this.props.onNavigate("ilp-courses")}],Instructor:[{key:"View Attendance",title:"Mark Attendance",icon:"fas fa-clipboard-check",description:"Mark and manage student attendance",action:()=>this.props.onNavigate("attendance")},{key:"NSA Courses",title:"My NSA Courses",icon:"fas fa-graduation-cap",description:"View assigned NSA courses",action:()=>this.props.onNavigate("nsa-courses")},{key:"ILP Courses",title:"My ILP Courses",icon:"fas fa-book-open",description:"View assigned ILP courses",action:()=>this.props.onNavigate("ilp-courses")},{key:"View Membership",title:"Student Information",icon:"fas fa-id-card",description:"View student member information",action:()=>this.props.onNavigate("membership")}]};return t[e]||t.Staff}),d(this,"getNavigationCards",()=>{const{accessRights:e={}}=this.props,t={Account:"fas fa-users",Courses:"fas fa-chalkboard-user","Registration And Payment":"fas fa-wpforms",Membership:"fas fa-address-card","QR Code":"fas fa-qrcode",Reports:"fas fa-table",Attendances:"fas fa-calendar-days"},s={"Create Account":"Add new user accounts to the system","Account Table":"View and manage existing accounts","Access Rights Table":"Configure user permissions and access rights","NSA Courses":"Manage NSA course offerings and schedules","ILP Courses":"Manage ILP course offerings and programs","Registration And Payment Table":"Handle course registrations and payments","Monthly Report":"Generate monthly analytics and reports","Payment Report":"View payment summaries and financial reports","View Attendance":"Monitor and record student attendance","View Membership":"Manage member information and records"},a=[];return Object.keys(e).forEach(o=>{const i=e[o];if(!0===i)a.push({key:o,title:o,icon:t[o]||"fas fa-folder",description:`Access ${o} functionality`,subKeys:[],hasSubKeys:!1});else if("object"==typeof i&&null!==i){const e=Object.keys(i).filter(e=>!0===i[e]);e.length>0&&a.push({key:o,title:o,icon:t[o]||"fas fa-folder",description:`Manage ${o} options (${e.length} items)`,subKeys:e.map(e=>({key:e,title:e,description:s[e]||`Access ${e} functionality`,action:()=>this.handleSubKeyNavigation(e)})),hasSubKeys:!0})}}),a}),d(this,"toggleNavigationCard",e=>{this.setState(t=>({expandedCard:t.expandedCard===e?null:e}))}),d(this,"getGreeting",()=>{const e=this.state.currentTime.getHours();return e<12?"Good Morning":e<17?"Good Afternoon":"Good Evening"}),d(this,"formatDate",()=>this.state.currentTime.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),d(this,"handleSubKeyNavigation",e=>{if(this.props.onNavigate){let t=e;switch(e){case"Create Account":t="create-account";break;case"Account Table":t="accounts";break;case"Access Rights Table":t="access-rights";break;case"NSA Courses":t="nsa-courses";break;case"ILP Courses":t="ilp-courses";break;case"Registration And Payment Table":t="registration";break;case"Monthly Report":t="monthly-report";break;case"Payment Report":t="payment-report";break;case"View Attendance":t="attendance";break;case"View Membership":t="membership";break;default:t=e}this.props.onNavigate(t)}}),this.state={currentTime:new Date,expandedCard:null}}componentDidMount(){this.timeInterval=setInterval(()=>{this.setState({currentTime:new Date})},6e4)}componentWillUnmount(){this.timeInterval&&clearInterval(this.timeInterval)}render(){const{userName:e,role:t,onNavigate:s}=this.props,a=this.getRoleBasedActions(),o=this.getNavigationCards(),{expandedCard:i}=this.state;return u.jsxs("div",{className:"welcome-section",children:[u.jsxs("div",{className:"welcome-header",children:[u.jsxs("div",{className:"welcome-content",children:[u.jsxs("h1",{children:[this.getGreeting(),", ",e,"!"]}),u.jsx("p",{children:"Welcome to ECSS Course Management System"}),u.jsxs("div",{className:"welcome-meta",children:[u.jsxs("div",{className:"meta-item",children:[u.jsx("i",{className:"fas fa-calendar-day"}),u.jsx("span",{children:this.formatDate()})]}),u.jsxs("div",{className:"meta-item",children:[u.jsx("i",{className:"fas fa-user-shield"}),u.jsxs("span",{children:["Role: ",t||"Administrator"]})]})]})]}),u.jsx("div",{className:"welcome-decoration",children:u.jsx("i",{className:"fas fa-graduation-cap"})})]}),o.length>0&&u.jsxs("div",{className:"navigation-section",children:[u.jsx("h2",{children:"Your Navigation"}),u.jsx("div",{className:"navigation-cards-grid",children:o.map(e=>u.jsxs("div",{className:`navigation-card ${e.hasSubKeys?"expandable":"single"} ${i===e.key?"expanded":""}`,children:[u.jsxs("div",{className:"navigation-card-header",onClick:()=>e.hasSubKeys?this.toggleNavigationCard(e.key):this.handleSubKeyNavigation(e.key),children:[u.jsx("div",{className:"card-icon",children:u.jsx("i",{className:e.icon})}),u.jsxs("div",{className:"card-content",children:[u.jsx("h3",{children:e.title}),u.jsx("p",{children:e.description})]}),e.hasSubKeys&&u.jsx("div",{className:"expand-icon",children:u.jsx("i",{className:"fas fa-chevron-"+(i===e.key?"up":"down")})})]}),e.hasSubKeys&&i===e.key&&u.jsx("div",{className:"navigation-subkeys",children:e.subKeys.map(e=>u.jsxs("div",{className:"subkey-item",onClick:e.action,children:[u.jsxs("div",{className:"subkey-content",children:[u.jsx("h4",{children:e.title}),u.jsx("p",{children:e.description})]}),u.jsx("div",{className:"subkey-arrow",children:u.jsx("i",{className:"fas fa-arrow-right"})})]},e.key))})]},e.key))})]}),u.jsxs("div",{className:"quick-actions-section",children:[u.jsx("h2",{children:"Your Quick Actions"}),u.jsx("div",{className:"action-cards-grid",children:a.map((e,t)=>u.jsxs("div",{className:"action-card",onClick:e.action,children:[u.jsx("div",{className:"card-icon",children:u.jsx("i",{className:e.icon})}),u.jsxs("div",{className:"card-content",children:[u.jsx("h3",{children:e.title}),u.jsx("p",{children:e.description}),u.jsxs("div",{className:"card-footer",children:[u.jsx("span",{className:"action-text",children:"Access"}),u.jsx("i",{className:"fas fa-arrow-right"})]})]})]},e.key))})]})]})}}class de extends p.Component{constructor(e){super(e),d(this,"handleRefreshMembership",()=>{this.setState({membershipType:"All Types",membershipSearchQuery:"",searchQuery:"",resetMembershipTable:!0,resetSearch:!0},()=>{this.setState({resetSearch:!1})})}),d(this,"handleDataFromChild",(e,t,s,a)=>h(this,null,function*(){var{section:o}=this.state;if(console.log("Current Sections123:",o),console.log("Received filters:",{filter1:e,filter2:t,filter3:s,filter4:a}),"courses"===o){const s=new Set(e),a=new Set(t);this.setState({locations:Array.from(s),languages:Array.from(a)})}else if("membership"===o)if(console.log("Processing membership types:",e),console.log("Type of filter1:",typeof e,Array.isArray(e)),Array.isArray(e)){const t=new Set(e);console.log("Unique membership types:",Array.from(t)),this.setState({types:Array.from(t),membershipTypes:["All Types",...Array.from(t)]},()=>{console.log("HomePage state updated with membership types:",this.state.membershipTypes)})}else console.warn("Expected array for membership types, received:",typeof e,e);else if("registration"===o){const o=new Set(e),i=new Set(t),r=new Set(s),n=new Set(a);console.log("Filter Course:",r),this.setState({locations:Array.from(o),types:Array.from(i),names:Array.from(r),quarters:Array.from(n)})}else if("accounts"===o){var i=new Set(e);this.setState({roles:Array.from(i)})}})),d(this,"handleSelectFromChild",(e,t)=>h(this,null,function*(){console.log("Selected Data:",e,t);var{section:s}=this.state;"courses"===s?"showLanguageDropdown"===t?this.setState({selectedLanguage:e.language}):("showLocationDropdown"===t||"showTypeDropdown"===t)&&this.setState({selectedLocation:e.centreLocation}):"accounts"===s&&"showAccountTypeDropdown"===t&&this.setState({selectedAccountType:e.role})})),d(this,"handleRegPaymentSelectFromChild",(e,t)=>h(this,null,function*(){console.log("Selected Data (Registration Payment):",e,t),e.centreLocation?this.setState({selectedLocation:e.centreLocation}):e.courseType?this.setState({selectedCourseType:e.courseType}):e.courseName?(console.log("Hello"),this.setState({selectedCourseName:e.courseName})):e.quarter&&(console.log("Hello"),this.setState({selectedQuarter:e.quarter}))})),d(this,"toggleReportComponent",e=>h(this,null,function*(){try{this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState({courseType:null,sidebarVisible:!1,isRegistrationPaymentVisible:!1,section:"",accountType:null,createAccount:!1,reportVisibility:!0,reportType:e,attendanceVisibility:!1,isMembershipVisible:!1})}catch(t){console.log(t)}})),d(this,"toggleAttendanceComponent",e=>h(this,null,function*(){try{this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState({isPopupOpen:!0,popupMessage:"Loading Attendance",popupType:"loading"},()=>{this.setState({courseType:null,sidebarVisible:!1,isRegistrationPaymentVisible:!1,isReceiptVisible:!1,section:"attendance",accountType:null,createAccount:!1,reportVisibility:!1,dashboard:!1,attendanceVisibility:!0,attendanceType:e,isMembershipVisible:!1})})}catch(t){console.log(t),this.setState({isPopupOpen:!0,popupMessage:"Error loading attendance view",popupType:"error-message"})}})),d(this,"toggleMembershipComponent",()=>h(this,null,function*(){try{this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState({isPopupOpen:!0,popupMessage:"Loading Membership",popupType:"loading"},()=>{this.setState({courseType:null,sidebarVisible:!1,isRegistrationPaymentVisible:!1,isReceiptVisible:!1,section:"membership",accountType:null,createAccount:!1,reportVisibility:!1,dashboard:!1,attendanceVisibility:!1,attendanceType:"",isMembershipVisible:!0,membershipType:"All Types",membershipSearchQuery:"",searchQuery:"",membershipTypes:["All Types"]})})}catch(e){console.log(e),this.setState({isPopupOpen:!0,popupMessage:"Error loading membership view",popupType:"error-message"})}})),d(this,"handleRegPaymentSearchFromChild",e=>h(this,null,function*(){this.setState({searchQuery:e})})),d(this,"searchResultFromChild",e=>h(this,null,function*(){this.setState({searchQuery:e})})),d(this,"searchRegPaymentResultFromChild",e=>h(this,null,function*(){console.log("Registration Payment Search Result:",e),this.setState({regPaymentSearchQuery:e})})),d(this,"toggleSubMenu",e=>{this.setState(t=>({submenuVisible:t.submenuVisible===e?null:e}))}),d(this,"toggleLanguage",()=>{this.setState(e=>({language:"en"===e.language?"zh":"en"}))}),d(this,"handleMouseLeave",()=>{this.setState({submenuVisible:null})}),d(this,"toggleSidebar",()=>{this.setState(e=>({sidebarVisible:!e.sidebarVisible}))}),d(this,"toggleCourseComponent",e=>h(this,null,function*(){try{this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState({isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading",courseType:e,sidebarVisible:!1,isRegistrationPaymentVisible:!1,section:"courses",accountType:"",createAccount:!1,isReceiptVisible:!1,reportVisibility:!1,isMembershipVisible:!1})}catch(t){console.log(t)}})),d(this,"componentDidMount",()=>h(this,null,function*(){this.resetInactivity(),window.addEventListener("mousemove",this.resetInactivity),window.addEventListener("keypress",this.resetInactivity),window.addEventListener("click",this.resetInactivity),window.addEventListener("scroll",this.resetInactivity),window.addEventListener("beforeunload",this.handleBeforeUnload)})),d(this,"handleBeforeUnload",e=>{localStorage.setItem("myComponentState",JSON.stringify(this.state)),e.preventDefault()}),d(this,"toggleDashboardComponent",()=>{try{console.log("Dashboard Page"),this.setState({isPopupOpen:!0,popupMessage:"Loading Dashboard",popupType:"loading"},()=>{this.setState({courseType:null,sidebarVisible:!1,isRegistrationPaymentVisible:!1,isReceiptVisible:!1,section:"",accountType:null,createAccount:!1,reportVisibility:!1,attendanceVisibility:!1,isMembershipVisible:!1,dashboard:!0,resetSearch:!1})})}catch(e){console.log(e),this.setState({isPopupOpen:!0,popupMessage:"Error loading dashboard",popupType:"error-message"})}}),d(this,"toggleAccountsComponent",e=>h(this,null,function*(){try{"Create Account"!==e?(this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),console.log("Account Type:",e),this.setState({isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading",courseType:"",sidebarVisible:!1,isRegistrationPaymentVisible:!1,section:"accounts",accountType:e,createAccount:!1,reportVisibility:!1,attendanceVisibility:!1,isMembershipVisible:!1})):this.setState({isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading",courseType:"",sidebarVisible:!1,isRegistrationPaymentVisible:!1,section:"accounts",accountType:null,createAccount:!0,reportVisibility:!1,attendanceVisibility:!1,isMembershipVisible:!1})}catch(t){console.log(t)}})),d(this,"closePopup",()=>{this.setState({isPopupOpen:!1,popupMessage:"",popupType:""})}),d(this,"closePopup2",()=>{this.setState({isPopupOpen:!0,popupMessage:"You have updated the entry successfully",popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1}),this.refreshChild()},5e3)}),d(this,"closePopup3",()=>{this.setState({isPopupOpen:!0,popupMessage:"You have deleted the entry successfully",popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1})},5e3)}),d(this,"closePopup4",()=>{this.setState({isPopupOpen:!0,popupMessage:"You have send the payment advice message successfully",popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1})},5e3)}),d(this,"closePopup5",()=>{this.setState({isPopupOpen:!0,popupMessage:"You have port over the participants successfully",popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1})},5e3)}),d(this,"generateDeleteConfirmationPopup",e=>{console.log("ID deleted:",e),this.setState({isPopupOpen:!0,popupMessage:"Are you sure you want to delete this participant?",popupType:"delete",deleteId:e})}),d(this,"generateSendDetailsConfirmationPopup",e=>{this.setState({isPopupOpen:!0,popupMessage:"Are you sure you have send this participant the payment advice?",popupType:"sendOver",deleteId:e})}),d(this,"generatePortOverConfirmationPopup",(e,t,s,a)=>{console.log("ID deleted:",e),console.log("Course Info:",s),console.log("Payment Status:",a),this.setState({isPopupOpen:!0,popupMessage:"Are you sure you want to port over this participant?",popupType:"portOver",deleteId:e,courseInfo:s,participantInfo:t,status:a})}),d(this,"generateReceiptPopup",()=>{this.setState({isPopupOpen:!0,popupMessage:"Generating Receipt...",popupType:"loading"})}),d(this,"updateRemarksPopup",()=>{this.setState({isPopupOpen:!0,popupMessage:"Changing Payment Method...",popupType:"loading"})}),d(this,"updatePaymentPopup",()=>{this.setState({isPopupOpen:!0,popupMessage:"Updating Payment Status...",popupType:"loading"})}),d(this,"getPaginatedCourses",()=>{const{currentPage:e,coursesPerPage:t}=this.state,s=(e-1)*t;return this.getFilteredCourses().slice(s,s+t)}),d(this,"getTotalNumberofCourses",e=>h(this,null,function*(){console.log(e),this.setState({nofCourses:e})})),d(this,"getTotalNumberofDetails",e=>h(this,null,function*(){console.log("Registration:",e),this.setState({noofDetails:e})})),d(this,"getTotalNumberofAccounts",e=>h(this,null,function*(){console.log("Total Number Of Accounts:",e),this.setState({nofAccounts:e})})),d(this,"handleEntriesPerPageChange",e=>{e=Number(e);const{nofCourses:t,section:s,noofDetails:a,nofAccounts:o}=this.state;console.log("Entries Per Page:",e),console.log("Number of Courses:",o),"courses"===s?this.setState({entriesPerPage:e,currentPage:1},()=>{const s=Math.ceil(t/e);console.log("Total Pages:",s),this.setState({totalPages:s})}):"registration"===s?this.setState({entriesPerPage:e,currentPage:1},()=>{const t=Math.ceil(a/e);console.log("Total Pages:",t),this.setState({totalPages:t})}):"accounts"===s&&(console.log("Number of Accounts:",o),this.setState({entriesPerPage:e,currentPage:1},()=>{const t=Math.ceil(o/e);console.log(" Accounts Total Pages:",t),this.setState({totalPages:t})}))}),d(this,"onResetSearch",()=>{this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})})}),d(this,"logOut",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"Are you sure that you want to log out?",popupType:"logout",isDropdownOpen:!1})})),d(this,"noActivityDetected",()=>h(this,null,function*(){this.setState({isInactive:!0}),this.setState({isPopupOpen:!0,popupMessage:"",popupType:"no-activity"})})),d(this,"resetInactivity",()=>{this.setState({isInactive:!1}),clearTimeout(this.inactivityTimeout),this.inactivityTimeout=setTimeout(this.noActivityDetected,9e5)}),d(this,"goBackHome",()=>h(this,null,function*(){var e;console.log("Logout"),"Logout successful"===(yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/login",{purpose:"logout",accountId:null==(e=this.props.location.state)?void 0:e.accountId})).data.message.message&&(this.props.auth.logout(),this.props.history.push("/"))})),d(this,"toggleDropdown",()=>{this.setState(e=>({isDropdownOpen:!e.isDropdownOpen}))}),d(this,"closePopupMessage",()=>h(this,null,function*(){this.setState({isPopupOpen:!1},()=>{this.refreshChild()})})),d(this,"refreshChild",()=>{this.setState(e=>({refreshKey:e.refreshKey+1}))}),d(this,"updateAccessRights",e=>h(this,null,function*(){console.log("Updated Access Right:",e),this.setState({isPopupOpen:!0,popupMessage:e,popupType:"update-access-right"})})),d(this,"handleAccessRightsData",e=>{this.setState({accessRights:e})}),d(this,"warningPopUpMessage",e=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:e,popupType:"error-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1,name:"",password:"",role:""})},5e3)})),d(this,"loadingPopup",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"Loading Dashboard",popupType:"loading"})})),d(this,"loadingPopup1",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading"})})),d(this,"generateInvoicePopup",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"Generating Invoice",popupType:"loading"})})),d(this,"showUpdatePopup",e=>h(this,null,function*(){console.log("Selected:",e),this.setState({isPopupOpen:!0,popupMessage:e,popupType:"loading"})})),d(this,"generateInvoiceNumber",()=>h(this,null,function*(){this.setState({isPopupOpen:!0,popupMessage:"Generating Invoice For SkillsFuture Payment",popupType:"loading"})})),d(this,"handleAttendanceSelectFromChild",(e,t)=>{console.log("Selected Attendance Filter:",e,t),"showAttendanceTypeDropdown"===t?this.setState({attendanceFilterType:e.attendanceType}):"activityCode"===t?this.setState({attendanceFilterCode:e.activityCode}):"showAttendanceLocationDropdown"===t?this.setState({attendanceFilterLocation:e.attendanceLocation}):"showMembershipTypeDropdown"===t&&this.setState({membershipType:e.membershipType})}),d(this,"handleMembershipSelectFromChild",e=>{console.log("Membership type selected:",e),this.setState({membershipType:e})}),d(this,"handleMembershipSearchFromChild",e=>{console.log("Membership search query:",e),this.setState({membershipSearchQuery:e,searchQuery:e})}),d(this,"handleAttendanceSearchFromChild",e=>{console.log("Attendance Search Query:",e),this.setState({attendanceSearchQuery:e})}),d(this,"handleAttendanceTypesLoaded",(e,t,s)=>{console.log("Received attendance types:",e),console.log("Received activity codes:",t),console.log("Received attendance locations:",s),this.setState({attendanceTypes:e||["All Types"],activityCodes:t||["All Codes"],attendanceLocations:s||["All Locations"]})}),d(this,"handleWelcomeNavigate",e=>{switch(console.log("Welcome navigation to:",e),e){case"registration":this.toggleRegistrationPaymentComponent("Registration And Payment Table");break;case"dashboard":this.toggleDashboardComponent();break;case"courses":case"nsa-courses":this.toggleCourseComponent("NSA");break;case"ilp-courses":this.toggleCourseComponent("ILP");break;case"marriage-preparation-programme-courses":this.toggleCourseComponent("Marriage Preparation Programme");break;case"attendance":this.toggleAttendanceComponent("All Types");break;case"membership":this.toggleMembershipComponent();break;case"reports":case"monthly-report":this.toggleReportComponent("Monthly Report");break;case"payment-report":this.toggleReportComponent("Payment Report");break;case"create-account":this.toggleAccountsComponent("Create Account");break;case"accounts":this.toggleAccountsComponent("Accounts");break;case"access-rights":this.toggleAccountsComponent("Access Rights");break;default:console.log("Navigation section not found:",e)}}),d(this,"toggleHomeComponent",()=>{console.log("Navigating to Home - showing Welcome Section"),this.setState({accountType:null,courseType:null,isRegistrationPaymentVisible:!1,createAccount:!1,reportVisibility:!1,dashboard:!1,attendanceVisibility:!1,isMembershipVisible:!1,isReceiptVisible:!1,section:"",submenuVisible:null})});const t=localStorage.getItem("myComponentState");var s=t?JSON.parse(t):{submenuVisible:null,language:"en",courseType:null,isPopupOpen:!1,popupMessage:"",popupType:"",sidebarVisible:!1,locations:[],languages:[],types:[],names:[],status:"",selectedCourseLanguage:"",selectedCourseLocation:"",selectedCourseType:"",selectedCourseName:"",courseSearchQuery:"",selectedRegPaymentLanguage:"",selectedRegPaymentLocation:"",selectedQuarter:"",regPaymentSearchQuery:"",resetSearch:!1,currentPage:1,courseInfo:{},entriesPerPage:1e11,totalPages:1,nofCourses:0,noofDetails:0,nofAccounts:0,viewMode:"full",isRegistrationPaymentVisible:!1,isMembershipVisible:!1,section:"",accountType:null,roles:[],createAccount:!1,displayedName:"",isDropdownOpen:!1,isReceiptVisible:!1,attendanceVisibility:!1,item:"",isInactive:!1,refreshKey:0,dashboard:!1,deleteId:"",reportVisibility:!1,reportType:"",quarters:[],attendanceFilterType:"All Types",attendanceFilterCode:"All Codes",attendanceFilterLocation:"All Locations",attendanceSearchQuery:"",attendanceTypes:[],activityCodes:[],attendanceLocations:[],membershipTypes:["All Types"],membershipType:"All Types",membershipSearchQuery:"",searchQuery:"",resetMembershipTable:!1,accessRights:{}};s.attendanceFilterType="All Types",s.attendanceFilterCode="All Codes",s.attendanceFilterLocation="All Locations",s.attendanceSearchQuery="",this.state=s,this.handleDataFromChild=this.handleDataFromChild.bind(this),this.searchResultFromChild=this.searchResultFromChild.bind(this),this.handleSelectFromChild=this.handleSelectFromChild.bind(this),this.handleRegPaymentSelectFromChild=this.handleRegPaymentSelectFromChild.bind(this),this.handleRegPaymentSearchFromChild=this.handleRegPaymentSearchFromChild.bind(this),this.handleMembershipSelectFromChild=this.handleMembershipSelectFromChild.bind(this),this.handleMembershipSearchFromChild=this.handleMembershipSearchFromChild.bind(this),this.handlePageChange=this.handlePageChange.bind(this),this.toggleViewMode=this.toggleViewMode.bind(this),this.toggleRegistrationPaymentComponent=this.toggleRegistrationPaymentComponent.bind(this),this.createAccountPopupMessage=this.createAccountPopupMessage.bind(this),this.inactivityTimeout=null,this.editAccountPopupMessage=this.editAccountPopupMessage.bind(this)}componentDidUpdate(e,t){const s=l(n({},this.state),{isPopupOpen:!1,popupMessage:"",popupType:"",loading:!1});localStorage.setItem("myComponentState",JSON.stringify(s)),this.state.resetMembershipTable&&!t.resetMembershipTable&&(this.membershipSectionRef.current&&this.membershipSectionRef.current.refreshMembershipData(),this.setState({resetMembershipTable:!1}))}componentWillUnmount(){clearTimeout(this.inactivityTimeout),window.removeEventListener("mousemove",this.resetInactivity),window.removeEventListener("keypress",this.resetInactivity),window.removeEventListener("click",this.resetInactivity),window.removeEventListener("scroll",this.resetInactivity),window.removeEventListener("beforeunload",this.handleBeforeUnload),localStorage.removeItem("myComponentState")}toggleViewMode(e){var{section:t}=this.state;console.log("Toggle View Mode:",t),this.setState({viewMode:e}),"full"===e&&("courses"===t?this.handleEntriesPerPageChange(this.state.nofCourses):"registration"===t?this.handleEntriesPerPageChange(this.state.noofDetails):"accounts"===t&&this.handleEntriesPerPageChange(this.state.nofAccounts))}handlePageChange(e){console.log("Total No Of Pages:",this.state.totalPages),e>=1&&e<=this.state.totalPages&&this.setState({currentPage:e})}toggleRegistrationPaymentComponent(e){console.log("Selected Item:",e),"Registration And Payment Table"===e?(this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState(t=>({courseType:"",isRegistrationPaymentVisible:!t.isRegistrationPaymentVisible,isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading",sidebarVisible:!1,section:"registration",accountType:null,createAccount:!1,isReceiptVisible:!1,item:e,reportVisibility:!1,attendanceVisibility:!1,isMembershipVisible:!1}))):"Receipt Table"===e&&(this.setState({resetSearch:!0},()=>{this.setState({resetSearch:!1})}),this.setState(t=>({courseType:"",isRegistrationPaymentVisible:!1,isPopupOpen:!0,popupMessage:"Loading In Progress",popupType:"loading",sidebarVisible:!1,section:"registration",accountType:null,createAccount:!1,isReceiptVisible:!t.isReceiptVisible,item:e,attendanceVisibility:!1,isMembershipVisible:!1})))}createAccountPopupMessage(e,t,s){console.log(e,t,s),this.setState({isPopupOpen:e,popupMessage:t,popupType:"success-message"}),setTimeout(()=>{this.setState({isPopupOpen:!1})},5e3)}editAccountPopupMessage(e){this.setState({isPopupOpen:!0,popupMessage:e,popupType:"edit-account"})}courseNameAndDetails(e){var t=e.split(/<br\s*\/?>/gi);return 3===t.length?(t[2]=t[2].replace(/[()]/g,""),{engName:t[1],chiName:t[0],location:t[2]}):2===t.length?(t[1]=t[1].replace(/[()]/g,""),{engName:t[0],chiName:t[0],location:t[1]}):void 0}render(){var e,t,s,a;console.log("Props History Push",this.props);const o=(null==(e=this.props.location.state)?void 0:e.name)||"User",i=null==(t=this.props.location.state)?void 0:t.role,r=null==(s=this.props.location.state)?void 0:s.siteIC,{membershipType:n,membershipTypes:l,membershipSearchQuery:c,isMembershipVisible:d,attendanceVisibility:h,reportType:p,reportVisibility:g,participantInfo:m,status:f,item:y,isDropdownOpen:C,isReceiptVisible:w,dashboard:b,displayedName:x,submenuVisible:v,language:S,courseType:N,accountType:D,isPopupOpen:P,popupMessage:j,popupType:R,sidebarVisible:A,locations:T,languages:I,types:M,selectedLanguage:k,selectedLocation:L,selectedCourseType:E,searchQuery:F,resetSearch:O,viewMode:U,currentPage:B,totalPages:_,nofCourses:V,noofDetails:z,isRegistrationPaymentVisible:W,section:G,roles:te,selectedAccountType:se,nofAccounts:ae,createAccount:oe,names:re,selectedCourseName:de,courseInfo:he,selectedQuarter:pe,quarters:ue,attendanceFilterType:ge,attendanceFilterCode:me,attendanceFilterLocation:fe,attendanceSearchQuery:ye,attendanceTypes:Ce,activityCodes:we,attendanceLocations:be}=this.state;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"dashboard",children:[u.jsxs("div",{className:"header",children:[u.jsx("button",{className:"sidebar-toggle",onClick:this.toggleSidebar,children:"☰"}),u.jsx("div",{className:"language-toggle",children:u.jsx("button",{onClick:this.toggleLanguage,children:"en"===S?"中文":"English"})}),u.jsxs("div",{className:"user-dropdown",children:[u.jsxs("div",{className:"dropdown-toggle",onClick:this.toggleDropdown,children:[u.jsx("span",{className:"displayedName",children:o}),u.jsx("i",{className:"fas fa-user-alt"})]}),C&&u.jsx("div",{className:"dropdown-menu",children:u.jsx("ul",{children:u.jsx("li",{onClick:this.logOut,children:"Logout"})})})]})]}),u.jsxs("div",{className:"content "+(A?"sidebar-visible":"sidebar-hidden"),children:[u.jsx("div",{className:"sidebar "+(null!==v?"expanded":""),onMouseLeave:this.handleMouseLeave,children:u.jsx(X,{accountId:null==(a=this.props.location.state)?void 0:a.accountId,toggleHomeComponent:this.toggleHomeComponent,toggleDashboardComponent:this.toggleDashboardComponent,toggleAccountsComponent:this.toggleAccountsComponent,toggleCourseComponent:this.toggleCourseComponent,toggleRegistrationPaymentComponent:this.toggleRegistrationPaymentComponent,toggleReportComponent:this.toggleReportComponent,toggleAttendanceComponent:this.toggleAttendanceComponent,toggleMembershipComponent:this.toggleMembershipComponent,onAccessRightsUpdate:this.handleAccessRightsData},this.state.refreshKey)}),u.jsxs("div",{className:"main-content",children:[null===D&&null===N&&!1===W&&!1===oe&&!1===g&&!1===b&&!1===h&&!1===d&&!1===w&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"welcome-section",children:u.jsx(ce,{userName:o,role:i,accessRights:this.state.accessRights,onNavigate:this.handleWelcomeNavigate})})}),null===D&&null===N&&!1===W&&!1===oe&&!1===g&&!0===b&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"dashboard-section",children:u.jsx(ee,{closePopup1:this.closePopup,role:i,siteIC:r})})}),oe&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"create-account-section",children:u.jsx(J,{language:S,closePopup:this.closePopup,createAccountPopupMessage:this.createAccountPopupMessage})})}),D&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"search-section",children:u.jsx(Y,{language:S,closePopup:this.closePopup,passSelectedValueToParent:this.handleSelectFromChild,passSearchedValueToParent:this.searchResultFromChild,resetSearch:O,section:G,roles:te,item:y})}),u.jsx("div",{className:"account-section",children:u.jsx(H,{language:S,accountType:D,closePopup:this.closePopup,passDataToParent:this.handleDataFromChild,selectedAccountType:se,searchQuery:F,getTotalNumberofAccounts:this.getTotalNumberofAccounts,currentPage:B,entriesPerPage:this.state.entriesPerPage,resetSearch:O,section:G,edit:this.editAccountPopupMessage,updateAccessRights:this.updateAccessRights},this.state.refreshKey)})]}),N&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"search-section",children:u.jsx(Y,{language:S,closePopup:this.closePopup,languages:I,locations:T,passSelectedValueToParent:this.handleSelectFromChild,passSearchedValueToParent:this.searchResultFromChild,resetSearch:O,section:G,item:y})}),u.jsx("div",{className:"courses-section",children:u.jsx(Q,{language:S,courseType:N,closePopup:this.closePopup,passDataToParent:this.handleDataFromChild,selectedLanguage:k,selectedLocation:L,searchQuery:F,getTotalNumberofCourses:this.getTotalNumberofCourses,currentPage:B,entriesPerPage:this.state.entriesPerPage,resetSearch:O,section:G,item:y})})]}),d&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"search-section",children:u.jsx(Y,{section:G,language:S,resetSearch:O,passSelectedValueToParent:this.handleMembershipSelectFromChild,passSearchedValueToParent:this.handleMembershipSearchFromChild,membershipTypes:l})}),u.jsx("div",{className:"membership-section",children:u.jsx(ne,{section:G,userName:o,passDataToParent:this.handleDataFromChild,loadingPopup1:this.loadingPopup1,role:i,siteIC:r,closePopup1:this.closePopup,searchQuery:F,membershipType:n,resetSearch:O,language:S,refreshChild:this.refreshChild},this.state.refreshKey)})]}),W&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"search-section",children:u.jsx(Y,{locations:T,types:M,courses:re,quarters:ue,resetSearch:O,section:G,passSelectedValueToParent:this.handleRegPaymentSelectFromChild,passSearchedValueToParent:this.handleRegPaymentSearchFromChild,item:y})}),u.jsx("div",{className:"registration-payment-section",children:u.jsx(q,{closePopup:this.closePopup,section:G,passDataToParent:this.handleDataFromChild,selectedLocation:L,selectedCourseType:E,selectedCourseName:de,selectedQuarter:pe,searchQuery:F,resetSearch:O,getTotalNumberofDetails:this.getTotalNumberofDetails,currentPage:B,entriesPerPage:this.state.entriesPerPage,userName:o,siteIC:r,role:i,refreshChild:this.refreshChild,generateReceiptPopup:this.generateReceiptPopup,updatePaymentPopup:this.updatePaymentPopup,updateRemarksPopup:this.updateRemarksPopup,warningPopUpMessage:this.warningPopUpMessage,showUpdatePopup:this.showUpdatePopup,generateInvoiceNumber:this.generateInvoiceNumber,onResetSearch:this.onResetSearch,closePopupMessage:this.closePopupMessage,generateDeleteConfirmationPopup:this.generateDeleteConfirmationPopup,generatePortOverConfirmationPopup:this.generatePortOverConfirmationPopup,generateSendDetailsConfirmationPopup:this.generateSendDetailsConfirmationPopup},this.state.refreshKey)})]}),w&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"search-section",children:u.jsx(Y,{locations:T,types:M,resetSearch:O,section:G,passSelectedValueToParent:this.handleRegPaymentSelectFromChild,passSearchedValueToParent:this.handleRegPaymentSearchFromChild,item:y})}),u.jsx("div",{className:"view-toggle-section",children:u.jsx(K,{language:S,viewMode:U,onToggleView:this.toggleViewMode,onEntriesPerPageChange:this.handleEntriesPerPageChange,getTotalNumber:z})}),u.jsx("div",{className:"receipt-section",children:u.jsx(Z,{closePopup:this.closePopup,section:G,passDataToParent:this.handleDataFromChild,selectedLocation:L,selectedCourseType:E,searchQuery:F,resetSearch:O,getTotalNumberofDetails:this.getTotalNumberofDetails,currentPage:B,entriesPerPage:this.state.entriesPerPage,userName:o})})]}),g&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"invoice-section",children:u.jsx(le,{userName:o,closePopup1:this.closePopup,loadingPopup1:this.loadingPopup1,generateInvoicePopup:this.generateInvoicePopup,reportType:p,role:i,siteIC:r})})}),h&&u.jsxs(u.Fragment,{children:[u.jsx(Y,{section:"attendance",language:S,resetSearch:O,passSelectedValueToParent:this.handleAttendanceSelectFromChild,passSearchedValueToParent:this.handleAttendanceSearchFromChild,attendanceTypes:Ce,attendanceLocations:be,activityCodes:we,item:"attendance"}),u.jsx("div",{className:"attendance-section",children:u.jsx(ie,{userName:o,loadingPopup1:this.loadingPopup1,role:i,siteIC:r,closePopup1:this.closePopup,attendanceType:this.state.attendanceFilterType,activityCode:this.state.attendanceFilterCode,selectedLocation:this.state.attendanceFilterLocation,searchQuery:this.state.attendanceSearchQuery,onTypesLoaded:this.handleAttendanceTypesLoaded})})]})]})]}),u.jsx("div",{className:"footer",children:u.jsxs("p",{children:["© 2024 En Community Service Society Courses Management System.",u.jsx("br",{}),"All rights reserved."]})})]}),u.jsx($,{isOpen:P,message:j,userName:o,type:R,participantInfo:m,status:f,courseInfo:he,closePopup:this.closePopup,closePopup2:this.closePopup2,goBackLoginPage:this.goBackHome,closePopupMessage:this.closePopupMessage,id:this.state.deleteId})]})}}const he=_(de);class pe extends p.Component{render(){const{courseType:e}=this.props,t="Marriage Preparation Programme"===e;return u.jsxs("div",{className:"form-details-section",children:[!t&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"introduction",children:[u.jsx("h1",{children:"ECSS Course Registration Page"}),u.jsx("p",{className:"description",children:"The Council for Third Age (C3A), set up in May 2007, is an agency which promotes active ageing in Singapore through public education, outreach, and partnerships. As an umbrella body in the active ageing landscape, with its focus on senior learning and volunteerism, as well as positive ageing, C3A works with and through partners to help third agers age well. In conjunction with the National Silver Academy (NSA), C3A has been appointed to oversee the administration of course subsidies for eligible participants."}),u.jsx("p",{className:"description",children:"活跃乐龄理事会，简称（C3A）成立于2007年5月，本理事会提倡活跃乐龄的理念，让我国的乐龄人士过积极与正面的晚年生活。活跃乐龄理事会把终身学习，活跃乐龄和强化乐龄义工会理念三大领域作为重任，理事会在乐龄工作上起了引领带动的作用。活跃乐龄理事会（C3A）被委任为全国乐龄学苑课程的行政机构。"}),u.jsxs("p",{className:"description",children:["By submitting this form, I agree that En Community Services Society and AIC may collect, use and disclose my personal data, as provided in this form, in accordance with En Community Services Society’s Data Protection Policy and AIC’s Data Protection Policy (",u.jsx("a",{href:"https://www.aic.sg/data-protection-policy",children:"https://www.aic.sg/data-protection-policy"}),")."]}),u.jsx("p",{className:"description",children:"Do note that photographs and videos may be taken during the course for publicity purposes"}),"NSA"===e&&u.jsxs(u.Fragment,{children:[u.jsx("h5",{className:"description",children:"*50 岁以上的新加坡公民及永久居民享有津贴"}),u.jsx("h5",{className:"description",children:"*NSA subsidy applicable for Singaporean and PR age 50 and above"}),u.jsx("h5",{className:"notification",style:{color:"red"},children:"*No refunds within 2 weeks before the course starts."}),u.jsx("h5",{className:"notification",style:{color:"red"},children:"*课程开始前两周内不予退款。"})]})]}),u.jsx("div",{className:"image-container",children:u.jsx("img",{src:"https://ecss.org.sg/wp-content/uploads/2024/09/NSA-En.jpg",alt:"Description of the image",className:"registration-image"})})]}),t&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"introduction",children:[u.jsx("h1",{children:"ECSS Marriage Preparation Course Registration Page"}),u.jsx("p",{className:"description"}),u.jsx("p",{className:"description"}),u.jsx("p",{className:"description"}),u.jsx("p",{className:"description"})]}),u.jsx("div",{className:"image-container",children:u.jsx("img",{src:"",alt:"Marriage Preparation Course Logo",className:"registration-image"})})]})]})}}g.forwardRef(({value:e,onClick:t},s)=>u.jsx("input",{className:"personal-info-input",value:e,onClick:t,ref:s,placeholder:"dd/mm/yyyy"}));class ue extends p.Component{constructor(e){super(e),d(this,"handleChange",e=>{const{name:t,value:s}=e.target,{singPassPopulatedFields:a}=this.props;if(null==a?void 0:a[t])return;let o=s;if("nRIC"===t)if(o=o.trim(),o.length>=2){const e=o.charAt(0).toUpperCase(),t=o.slice(1,-1),s=o.charAt(o.length-1).toUpperCase();o=e+t+s}else 1===o.length&&(o=o.toUpperCase());"pName"===t&&(o=s.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")),console.log(`${t}: ${o}`),this.props.onChange({[t]:o})}),d(this,"isValidDDMMYYYY",e=>{if(!/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$/.test(e))return!1;const[t,s,a]=e.split("/"),o=new Date(`${a}-${s}-${t}`);return o&&o.getFullYear()===parseInt(a,10)&&o.getMonth()+1===parseInt(s,10)&&o.getDate()===parseInt(t,10)}),d(this,"handleChange1",(e,t)=>{const{singPassPopulatedFields:s}=this.props;if("DOB"===t){if(null==s?void 0:s.dOB)return;let{name:t,value:a}=e.target;a=a.replace(/\D/g,""),a.length>=3&&a.length<=4?a=a.slice(0,2)+"/"+a.slice(2):a.length>4&&a.length<=8&&(a=a.slice(0,2)+"/"+a.slice(2,4)+"/"+a.slice(4)),a.length>10&&(a=a.slice(0,10)),this.setState({manualDate:a}),this.isValidDDMMYYYY(a)?(console.log("✅ Valid date:",a),this.props.onChange({[t]:a}),this.setState({selectedDate:new Date(a.split("/").reverse().join("-"))})):console.warn("❌ Invalid date format. Expected dd/mm/yyyy")}}),d(this,"handleBackspace",e=>{if("Backspace"===e.key){const e=this.state.manualDate,t=e.length-1;if(t<=0)this.setState({manualDate:""}),this.props.onChange({dOB:""});else{const s=e.substring(0,t);this.setState({manualDate:s}),this.props.onChange({dOB:s})}}}),d(this,"handleDateChange",e=>{const t=e.toLocaleDateString("en-GB");if(console.log("Handle Date Change:",e),console.log("Current Selected Date:",this.state.selectedDate),console.log("Year:",e.getFullYear()),t){const t=`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`;this.setState({selectedDate:e,manualDate:t}),this.props.onChange({dOB:t})}else this.setState({selectedDate:null,manualDate:""}),this.props.onChange({dOB:""})}),d(this,"toggleCalendar",e=>{this.setState(e=>({showCalendar:!e.showCalendar}))}),d(this,"closeCalendar",()=>{this.setState({showCalendar:!1})}),d(this,"handleMonthChange",e=>{const{selectedDate:t}=this.state,s=parseInt(e,10),a=new Date(t.getFullYear(),s,t.getDate()),o=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`;this.setState({selectedDate:a,manualDate:o}),this.props.onChange({dOB:o}),this.setState({showCalendar:!1})}),d(this,"handleYearChange",e=>{const{selectedDate:t}=this.state;console.log(e),console.log(t);const s=parseInt(e,10),a=new Date(s,t.getMonth(),t.getDate()),o=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`;console.log(o),this.setState({selectedDate:a,manualDate:o}),this.props.onChange({dOB:o}),this.setState({showCalendar:!1})}),d(this,"handleDateFieldChange",(e,t)=>{const{singPassPopulatedFields:s}=this.props;if(null==s?void 0:s[t])return;let{value:a}=e.target;a=a.replace(/\D/g,""),a.length>=3&&a.length<=4?a=a.slice(0,2)+"/"+a.slice(2):a.length>4&&a.length<=8&&(a=a.slice(0,2)+"/"+a.slice(2,4)+"/"+a.slice(4)),a.length>10&&(a=a.slice(0,10)),this.isValidDDMMYYYY(a)?(console.log(`✅ Valid date for ${t}:`,a),this.props.onChange({[t]:a})):""===a?this.props.onChange({[t]:""}):this.props.onChange({[t]:a})}),this.state={showCalendar:!1,selectedDate:new Date((new Date).getFullYear()-89,0,1),manualDate:""}}componentDidMount(){const{data:e}=this.props;if(e&&e.dOB&&(this.setState({manualDate:e.dOB}),this.isValidDDMMYYYY(e.dOB))){const[t,s,a]=e.dOB.split("/"),o=new Date(a,s-1,t);this.setState({selectedDate:o})}if(e&&e.pName){const t=e.pName.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");t!==e.pName&&this.props.onChange({pName:t})}if(e&&e.nRIC){let t=e.nRIC.trim();if(t.length>=2){const e=t.charAt(0).toUpperCase(),s=t.slice(1,-1),a=t.charAt(t.length-1).toUpperCase();t=e+s+a}else 1===t.length&&(t=t.toUpperCase());t!==e.nRIC&&this.props.onChange({nRIC:t})}}componentDidUpdate(e){var t,s,a;const{data:o}=this.props;if((null==(t=e.data)?void 0:t.dOB)!==(null==o?void 0:o.dOB)&&(null==o?void 0:o.dOB)&&o.dOB!==this.state.manualDate&&(this.setState({manualDate:o.dOB}),this.isValidDDMMYYYY(o.dOB))){const[e,t,s]=o.dOB.split("/"),a=new Date(s,t-1,e);this.setState({selectedDate:a})}if((null==(s=e.data)?void 0:s.pName)!==(null==o?void 0:o.pName)&&(null==o?void 0:o.pName)){const e=o.pName.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");e!==o.pName&&this.props.onChange({pName:e})}if((null==(a=e.data)?void 0:a.nRIC)!==(null==o?void 0:o.nRIC)&&(null==o?void 0:o.nRIC)){let e=o.nRIC.trim();if(e.length>=2){const t=e.charAt(0).toUpperCase(),s=e.slice(1,-1),a=e.charAt(e.length-1).toUpperCase();e=t+s+a}else 1===e.length&&(e=e.toUpperCase());e!==o.nRIC&&this.props.onChange({nRIC:e})}}render(){var e;const{data:t={},errors:s,singPassPopulatedFields:a,onClearSingPassData:o,hideMyInfoOptions:i}=this.props,r=!i&&a&&Object.values(a).some(e=>!0===e),n="Marriage Preparation Programme"===(null==(e=this.props.data)?void 0:e.type);let l,c={};if(n){l=[{name:"pName",label:"Full Name",placeholder:"Full Name",isSelect:!1,isRadio:!1},{name:"nRIC",label:"NRIC/FIN",placeholder:"NRIC/FIN",isSelect:!1,isRadio:!1},{name:"dOB",label:"Date of Birth",placeholder:"Date of Birth",isSelect:!0,isDate:!0},{name:"rESIDENTIALSTATUS",label:"Residential Status",placeholder:"Residential Status",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"gENDER",label:"Sex",placeholder:"Sex",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"rACE",label:"Ethnicity",placeholder:"Ethnicity",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"mARITALSTATUS",label:"Marital Status",placeholder:"Marital Status",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"postalCode",label:"Postal Code",placeholder:"Postal Code",isSelect:!1,isRadio:!1,isNumber:!0},{name:"cNO",label:"Mobile Number",placeholder:"Mobile Number",isSelect:!1,isRadio:!1,isPhone:!0},{name:"eMAIL",label:"Email Address",placeholder:"Email Address",isSelect:!1,isRadio:!1,isEmail:!0},{name:"eDUCATION",label:"Highest Educational Attainment",placeholder:"Highest Educational Attainment",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"hOUSINGTYPE",label:"Housing Type",placeholder:"Housing Type",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"gROSSMONTHLYINCOME",label:"Gross Monthly Couple Income",placeholder:"Gross Monthly Couple Income",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"mARRIAGEDURATION",label:"Marriage duration",placeholder:"Marriage duration",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"tYPEOFMARRIAGE",label:"Type of Marriage",placeholder:"Type of Marriage",isSelect:!0,isRadio:!1,isDropdown:!0},{name:"hASCHILDREN",label:"Have child(ren) before current marriage",placeholder:"Have child(ren) before current marriage",isSelect:!0,isRadio:!1,isDropdown:!0}];c={rESIDENTIALSTATUS:["ALIEN","CITIZEN","PR","UNKNOWN","NOT APPLICABLE"],gENDER:["FEMALE","MALE"],rACE:["Chinese","Malay","Indian","Others"],mARITALSTATUS:["SINGLE","MARRIED","WIDOWED","DIVORCED"],eDUCATION:["Below Secondary","Secondary","Post-secondary (non-tertiary)","Diploma & Professional Qualification","Bachelor's Degree or Equivalent","Postgraduate Diploma/Degree"],hOUSINGTYPE:["HDB rental Flat","HDB 1 & 2 room Flat","HDB 3-room Flat","HDB 4-room Flat","HDB 5-room & Executive Flat","Condominiums & Other Apartments","Landed property","Others"],gROSSMONTHLYINCOME:["$2,500 and below","$2,501 to $8,500","$8,501 and above"],mARRIAGEDURATION:["Soon-to-wed","0 to 2 years","More than 2 years to 5 years","More than 5 years to 10 years","More than 10 years to 25 years","More than 25 years"],tYPEOFMARRIAGE:["This marriage is/will be a first marriage for both of us","This is/will be a remarriage for either of us/both of us"],hASCHILDREN:["Yes","No"]}}else{l=[{name:"pName",label:"Name 姓名",placeholder:"Name 姓名 (As in NRIC 与身份证相符)",isSelect:!1,isRadio:!1},{name:"nRIC",label:"NRIC Number 身份证号码",placeholder:"NRIC Number 身份证号码",isSelect:!1,isRadio:!1},{name:"rESIDENTIALSTATUS",label:"Residential Status 居民身份",placeholder:"Residential Status 居民身份",isSelect:!0,isRadio:!0},{name:"rACE",label:"Race 种族",placeholder:"Race 种族",isSelect:!0,isRadio:!0},{name:"gENDER",label:"Gender 性别",placeholder:"Gender 性别",isSelect:!0,isRadio:!0},{name:"dOB",label:"Date of Birth 出生日期",placeholder:"Date of Birth 出生日期",isSelect:!0,isDate:!0},{name:"address",label:"Address 地址",placeholder:"Address 地址",isSelect:!1,isRadio:!1},{name:"eDUCATION",label:"Education Level 最高教育水平",placeholder:"Education Level 最高教育水平",isSelect:!0,isRadio:!0},{name:"wORKING",label:"Work Status 工作状态",placeholder:"Work Status 工作状态",isSelect:!0,isRadio:!0}];c={gENDER:["M 男","F 女"],eDUCATION:["No Formal Education 无正规教育","Primary 小学","Secondary 中学","Post-Secondary (Junior College/ITE) 专上教育","Diploma 文凭","Bachelor's Degree 学士学位","Master's Degree 硕士","Others 其它"],rACE:["Chinese 华","Indian 印","Malay 马","Others 其他"],wORKING:["Retired 退休","Employed full-time 全职工作","Self-employed 自雇人","Part-time 兼职","Unemployed 失业"],rESIDENTIALSTATUS:["SC 新加坡公民","PR 永久居民"]}}return u.jsxs("div",{children:[n&&u.jsx("h3",{style:{marginBottom:"20px",color:"#333",borderBottom:"2px solid #eee",paddingBottom:"10px"},children:"Personal Information"}),r&&!i&&u.jsxs("div",{className:"clear-singpass-container",children:[u.jsx("p",{className:"singpass-info",children:"📄 Some fields have been populated with your Singpass data and are protected from editing."}),u.jsx("button",{type:"button",className:"clear-singpass-button",onClick:()=>{window.confirm("Are you sure you want to clear all Singpass data? This will empty all populated fields.")&&o&&o()},children:"🗑️ Clear Singpass Data"})]}),l.map(e=>{var o,i;return u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:e.name,children:e.label}),e.isRadio?u.jsx("div",{className:"radio-group1",children:null==(o=c[e.name])?void 0:o.map(s=>u.jsxs("label",{className:"radio-option1",children:[u.jsx("input",{type:"radio",name:e.name,value:s,checked:t[e.name]===s,onChange:this.handleChange,onClick:this.closeCalendar,disabled:null==a?void 0:a[e.name]}),s]},s))}):e.isDropdown||e.isSelect&&!e.isRadio&&!e.isDate?u.jsxs("select",{id:e.name,name:e.name,value:t[e.name]||"",onChange:this.handleChange,className:"personal-info-input "+((null==a?void 0:a[e.name])?"disabled-field":""),disabled:null==a?void 0:a[e.name],children:[u.jsxs("option",{value:"",children:["Select ",e.label]}),null==(i=c[e.name])?void 0:i.map(e=>u.jsx("option",{value:e,children:e},e))]}):e.isSelect&&e.isDate?u.jsxs(u.Fragment,{children:[u.jsx("input",{id:e.name,name:e.name,type:"text",className:"personal-info-input "+((null==a?void 0:a[e.name])?"disabled-field":""),value:"dOB"===e.name?this.state.manualDate||t[e.name]||"":t[e.name]||"",placeholder:"dd/mm/yyyy",onChange:t=>{t.stopPropagation(),"dOB"===e.name?this.handleChange1(t,"DOB"):this.handleDateFieldChange(t,e.name)},onKeyDown:"dOB"===e.name?this.handleBackspace:void 0,onBlur:this.closeCalendar,autoComplete:"off",disabled:null==a?void 0:a[e.name]}),u.jsx("br",{})]}):e.isNumber?u.jsx("input",{type:"number",id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:this.handleChange,className:"personal-info-input1 "+((null==a?void 0:a[e.name])?"disabled-field":""),onClick:this.closeCalendar,disabled:null==a?void 0:a[e.name]}):e.isPhone?u.jsx("input",{type:"tel",id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:this.handleChange,className:"personal-info-input1 "+((null==a?void 0:a[e.name])?"disabled-field":""),onClick:this.closeCalendar,disabled:null==a?void 0:a[e.name]}):e.isEmail?u.jsx("input",{type:"email",id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:this.handleChange,className:"personal-info-input1 "+((null==a?void 0:a[e.name])?"disabled-field":""),onClick:this.closeCalendar,disabled:null==a?void 0:a[e.name]}):u.jsx("input",{type:"text",id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:this.handleChange,className:"personal-info-input1 "+((null==a?void 0:a[e.name])?"disabled-field":""),onClick:this.closeCalendar,disabled:null==a?void 0:a[e.name]}),s[e.name]&&u.jsx("span",{className:"error-message3",children:s[e.name]})]},e.name)}),!n&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"cNO",children:"Contact No. 联络号码"}),u.jsx("input",{type:"text",id:"cNO",name:"cNO",placeholder:"Contact No. 联络号码",value:t.cNO||"",onChange:e=>this.props.onChange({cNO:e.target.value}),className:"personal-info-input1",onClick:this.closeCalendar,disabled:!1}),s.cNO&&u.jsx("span",{className:"error-message3",children:s.cNO})]}),u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"eMAIL",children:"Email 电子邮件"}),u.jsx("input",{type:"email",id:"eMAIL",name:"eMAIL",placeholder:'Enter "N/A" if no email 如果没有电子邮件，请输入"N/A"',value:t.eMAIL||"",onChange:e=>this.props.onChange({eMAIL:e.target.value}),className:"personal-info-input1",onClick:this.closeCalendar,disabled:!1}),s.eMAIL&&u.jsx("span",{className:"error-message3",children:s.eMAIL})]})]})]})}}class ge extends p.Component{constructor(e){super(e),d(this,"handleChange",e=>{const{name:t,value:s}=e.target;let a=s;if("spouseNRIC"===t)if(a=a.trim(),a.length>=2){const e=a.charAt(0).toUpperCase(),t=a.slice(1,-1),s=a.charAt(a.length-1).toUpperCase();a=e+t+s}else 1===a.length&&(a=a.toUpperCase());"spouseName"===t&&(a=s.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")),"howFoundOut"===t&&("Others, please specify"===s?this.setState({showOthersSpecify:!0}):(this.setState({showOthersSpecify:!1}),this.props.onChange({howFoundOutOthers:""}))),console.log(`${t}: ${a}`),this.props.onChange({[t]:a})}),d(this,"isValidDDMMYYYY",e=>{if(!/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$/.test(e))return!1;const[t,s,a]=e.split("/"),o=new Date(`${a}-${s}-${t}`);return o&&o.getFullYear()===parseInt(a,10)&&o.getMonth()+1===parseInt(s,10)&&o.getDate()===parseInt(t,10)}),d(this,"handleDateChange",e=>{const{name:t}=e.target;let{value:s}=e.target;s=s.replace(/\D/g,""),s.length>=3&&s.length<=4?s=s.slice(0,2)+"/"+s.slice(2):s.length>4&&s.length<=8&&(s=s.slice(0,2)+"/"+s.slice(2,4)+"/"+s.slice(4)),s.length>10&&(s=s.slice(0,10)),this.props.onChange({[t]:s}),this.isValidDDMMYYYY(s)?console.log(`✅ Valid date for ${t}:`,s):""===s?console.log(`Field ${t} cleared`):console.log(`❌ Invalid date format for ${t}. Expected dd/mm/yyyy`)}),this.state={showOthersSpecify:!1}}render(){const{data:e={},errors:t}=this.props,s={spouseResidentialStatus:["ALIEN","CITIZEN","PR","UNKNOWN","NOT APPLICABLE"],spouseSex:["FEMALE","MALE"],spouseEthnicity:["Chinese","Malay","Indian","Others"],spouseMaritalStatus:["SINGLE","MARRIED","WIDOWED","DIVORCED"],spouseEducation:["Below Secondary","Secondary","Post-secondary (non-tertiary)","Diploma & Professional Qualification","Bachelor's Degree or Equivalent","Postgraduate Diploma/Degree"],spouseHousingType:["HDB rental Flat","HDB 1 & 2 room Flat","HDB 3-room Flat","HDB 4-room Flat","HDB 5-room & Executive Flat","Condominiums & Other Apartments","Landed property","Others"],howFoundOut:["Centre for Fathering / Dads for Life / Mums for Life","E-newsletter, Email alerts, push SMS notifications","Families for Life Campaigns / Events (e.g., National Family Festival, 'I Still Do' event)","Families for Life Facebook","Families for Life Instagram","Families for Life Website","Family Nexus","Google Banner Advertisement","Online Influencers","Out-of-Home Advertisements","Preschool","School","Social Service Agencies","TV / Radio Ads","Word-of-Mouth (e.g., Colleagues, Family, Friends)","YouTube Advertisement","Others, please specify"],sourceOfReferral:["Not Applicable","Child Protective Services (CPS)","ComLink+","Family Service Centres (FSC)","FamNex Our Tampines Hub (Tampines)","FamNex Bukit Canberra (Sembawang)","FamNex Punggol","FamNex Choa Chu Kang","FamNex Keat Hong","KidSTART","Social Service Offices (SSO)","Strengthening Families Programme (FAM@FSC)","Singapore Prison Services","Youth-At-Risk Agencies (YAR)"]};return u.jsxs("div",{children:[u.jsx("h3",{style:{marginBottom:"20px",color:"#333",borderBottom:"2px solid #eee",paddingBottom:"10px"},children:"Spouse Information"}),[{name:"spouseName",label:"Spouse's Full Name",placeholder:"Spouse's Full Name",isSelect:!1,isRadio:!1},{name:"spouseNRIC",label:"Spouse's NRIC/FIN/Passport No.",placeholder:"Spouse's NRIC/FIN/Passport No.",isSelect:!1,isRadio:!1},{name:"spouseDOB",label:"Spouse's Date of Birth",placeholder:"Spouse's Date of Birth",isSelect:!0,isDate:!0},{name:"spouseResidentialStatus",label:"Spouse's Residential Status",placeholder:"Spouse's Residential Status",isSelect:!0,isDropdown:!0},{name:"spouseSex",label:"Spouse's Sex",placeholder:"Spouse's Sex",isSelect:!0,isDropdown:!0},{name:"spouseEthnicity",label:"Spouse's Ethnicity",placeholder:"Spouse's Ethnicity",isSelect:!0,isDropdown:!0},{name:"spouseMaritalStatus",label:"Spouse's Marital Status",placeholder:"Spouse's Marital Status",isSelect:!0,isDropdown:!0},{name:"spousePostalCode",label:"Spouse's Postal Code",placeholder:"Spouse's Postal Code",isSelect:!1,isNumber:!0},{name:"spouseMobile",label:"Spouse's Mobile Number",placeholder:"Spouse's Mobile Number",isSelect:!1,isPhone:!0},{name:"spouseEmail",label:"Spouse's Email Address",placeholder:"Spouse's Email Address",isSelect:!1,isEmail:!0},{name:"spouseEducation",label:"Spouse's Highest Educational Attainment",placeholder:"Spouse's Highest Educational Attainment",isSelect:!0,isDropdown:!0},{name:"spouseHousingType",label:"Spouse's Housing Type",placeholder:"Spouse's Housing Type",isSelect:!0,isDropdown:!0},{name:"howFoundOut",label:"How did you find out about this programme?",placeholder:"How did you find out about this programme?",isSelect:!0,isDropdown:!0},{name:"sourceOfReferral",label:"Source of Referral?",placeholder:"Source of Referral?",isSelect:!0,isDropdown:!0}].map(a=>{var o;return u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:a.name,children:a.label}),a.isDropdown?u.jsxs("select",{id:a.name,name:a.name,value:e[a.name]||"",onChange:this.handleChange,className:"personal-info-input",children:[u.jsxs("option",{value:"",children:["Select ",a.label]}),null==(o=s[a.name])?void 0:o.map(e=>u.jsx("option",{value:e,children:e},e))]}):a.isDate?u.jsx("input",{id:a.name,name:a.name,type:"text",className:"personal-info-input",value:e[a.name]||"",placeholder:"dd/mm/yyyy",onChange:this.handleDateChange,autoComplete:"off"}):a.isNumber?u.jsx("input",{type:"number",id:a.name,name:a.name,placeholder:a.placeholder,value:e[a.name]||"",onChange:this.handleChange,className:"personal-info-input1"}):a.isPhone?u.jsx("input",{type:"tel",id:a.name,name:a.name,placeholder:a.placeholder,value:e[a.name]||"",onChange:this.handleChange,className:"personal-info-input1"}):a.isEmail?u.jsx("input",{type:"email",id:a.name,name:a.name,placeholder:a.placeholder,value:e[a.name]||"",onChange:this.handleChange,className:"personal-info-input1"}):u.jsx("input",{type:"text",id:a.name,name:a.name,placeholder:a.placeholder,value:e[a.name]||"",onChange:this.handleChange,className:"personal-info-input1"}),t[a.name]&&u.jsx("span",{className:"error-message3",children:t[a.name]})]},a.name)}),this.state.showOthersSpecify&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"howFoundOutOthers",children:"Please specify:"}),u.jsx("input",{type:"text",id:"howFoundOutOthers",name:"howFoundOutOthers",placeholder:"Please specify how you found out about this programme",value:e.howFoundOutOthers||"",onChange:this.handleChange,className:"personal-info-input1"}),t.howFoundOutOthers&&u.jsx("span",{className:"error-message3",children:t.howFoundOutOthers})]})]})}}class me extends p.Component{constructor(e){super(e),d(this,"handlePaymentChange",e=>{const t=e.target.value;this.setState({selectedPayment:t,paymentTouched:!0}),this.props.onChange(l(n({},this.props.formData),{payment:t}))}),this.state={selectedPayment:"",paymentTouched:!1}}decodeHtmlEntities(e){return(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent}render(){const{selectedPayment:e,paymentTouched:t}=this.state,{courseType:s,courseLocation:a,courseEnglishName:o,courseChineseName:i}=this.props,r="NSA"===s,n="ILP"===s,l="Marriage Preparation Programme"===s;return u.jsxs("div",{className:"course-details-section",children:[u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"courseType",children:"Course Type 课程类型"}),u.jsx("span",{className:"course-detail-text",id:"courseType",children:s})]}),u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"courseName",children:"Course Name 课程名称"}),u.jsxs("span",{className:"course-detail-text",id:"courseName",children:["English Name: ",this.decodeHtmlEntities(this.props.courseEnglishName)]}),u.jsx("br",{}),u.jsxs("span",{className:"course-detail-text",id:"courseName",children:["中文名: ",this.decodeHtmlEntities(this.props.courseChineseName)]})]}),u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"courseLocation",children:"Course Location 课程地点"}),u.jsx("span",{className:"course-detail-text",id:"courseLocation",children:this.props.courseLocation})]}),!n&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"coursePrice",children:"Course Price 价格"}),u.jsx("span",{className:"course-detail-text",id:"coursePrice",children:this.props.coursePrice})]}),u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"courseDuration",children:"Course Duration 课程时长"}),u.jsx("span",{className:"course-detail-text",id:"courseDuration",children:this.props.courseDuration})]}),r&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{htmlFor:"courseMode",children:"Course Mode 课程模式"}),u.jsx("span",{className:"course-detail-text",id:"courseMode",children:this.props.courseMode})]}),(r||l)&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{children:"I wish to pay by:"}),u.jsx("label",{children:"我希望通过以下方式付款："}),u.jsxs("div",{className:"payment-options",children:[r&&"Pasir Ris West Wellness Centre"!==a||l?u.jsxs("label",{children:[u.jsx("input",{type:"radio",value:"Cash",checked:"Cash"===e,onChange:this.handlePaymentChange}),"Cash"]}):null,u.jsxs("label",{children:[u.jsx("input",{type:"radio",value:"PayNow",checked:"PayNow"===e,onChange:this.handlePaymentChange}),"PayNow"]}),r&&("Community Ukulele – Mandarin L2A"===o||"Community Ukulele – Mandarin L2B"===o||"Community Ukulele – Mandarin L1"!==o&&"音乐祝福社区四弦琴班"!==i)||l?u.jsxs("label",{children:[u.jsx("input",{type:"radio",value:"SkillsFuture",checked:"SkillsFuture"===e,onChange:this.handlePaymentChange}),"SkillsFuture"]}):null]}),(r||l)&&!e&&t&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"error-message3",children:"Please select a payment option."}),u.jsx("span",{className:"error-message3",children:"请选择付款方式。"})]})]})]})}}class fe extends p.Component{constructor(e){super(e),d(this,"handleAgreementChange",e=>{const t=e.target.value;this.setState({selectedChoice:t,isSelected:!0}),this.props.onChange(l(n({},this.props.formData),{agreement:t}))}),d(this,"handleMarriagePrepConsentChange",e=>t=>{const s=t.target.checked;this.setState(t=>{const a=l(n({},t),{[e]:s,marriagePrepInteracted:!0});return this.props.onChange(l(n({},this.props.formData),{marriagePrepConsent1:a.marriagePrepConsent1,marriagePrepConsent2:a.marriagePrepConsent2})),a})}),this.state={selectedChoice:"",isSelected:!1,marriagePrepConsent1:!1,marriagePrepConsent2:!1,marriagePrepInteracted:!1}}render(){const{selectedChoice:e,isSelected:t,marriagePrepConsent1:s,marriagePrepConsent2:a,marriagePrepInteracted:o}=this.state,{agreement:i,errors:r,courseType:n}=this.props,l="Marriage Preparation Programme"===n;return console.log("AgreementDetailsSection - courseType:",l),u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"agreement-details-section",children:[!l&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{children:"Consent for use of Personal Data"}),u.jsxs("span",{className:"agreement-detail-text",children:["By submitting this form, I consent to my Personal Data being collected, used and disclosed to C3A and relevant partners for course administration purposes and to be informed of relevant information on programmes, research and publicity relating to active ageing. Do note that photographs and videos may be taken during the course for publicity purposes. I agree to C3A’s privacy policy which may be viewed at ",u.jsx("a",{href:"https://www.c3a.org.sg",children:"www.c3a.org.sg"}),". I understand that I may update my personal data or withdraw my consent at any time by emailing ",u.jsx("a",{href:"mailto:dataprotection@c3a.org.sg",children:"dataprotection@c3a.org.sg"}),".",u.jsx("br",{}),"通过提交本表格，我同意让活跃乐龄理事会(C3A)及有关机构拥有我的个人资料，并且通过简讯，邮件或其他通讯管道：无论电子传递或其他方式）接受关于乐龄人士活跃乐龄的节目，调查，促销和其他讯息，我也同意主办单位和C3A在节目，活动中拍照和录像作为宣传用途。 我了解我可以随时通过发送电子邮件至",u.jsx("a",{href:"mailto:dataprotection@c3a.org.sg",children:"dataprotection@c3a.org.sg"}),"更新我的个人资料或撤销我的同意，活跃乐龄理事会的隐私条款可在 ",u.jsx("a",{href:"https://www.c3a.org.sg",children:"www.c3a.org.sg"}),"网站上查阅。"]})]}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{children:"Consent for Collection, Use and Disclosure of Personal Information"}),u.jsx("div",{className:"agreement-detail-text-container",children:u.jsxs("span",{className:"agreement-detail-text",children:[u.jsx("strong",{children:"TERMS AND CONDITIONS FOR COLLECTION, USE AND DISCLOSURE OF PERSONAL INFORMATION FOR FAMILIES FOR LIFE MARRIAGE PREPARATION PROGRAMME"}),u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"1. INTRODUCTION"}),u.jsx("br",{}),'1.1 This document sets out the terms and conditions ("Terms") governing the collection, use and disclosure of your personal data by the Government of Singapore in relation to the Families for Life Marriage Preparation Programme ("Programme").',u.jsx("br",{}),u.jsx("br",{}),"1.2 By participating in the Programme, you agree to be bound by these Terms.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"2. COLLECTION OF PERSONAL DATA"}),u.jsx("br",{}),"2.1 The Government may collect the following categories of personal data from you:",u.jsx("br",{}),"(a) Personal particulars (including but not limited to your name, NRIC/FIN/passport number, date of birth, gender, race, nationality, residential status, contact details, educational level, employment details, marital status, housing type, and income level);",u.jsx("br",{}),"(b) Information about your spouse/partner (including but not limited to name, NRIC/FIN/passport number, date of birth, gender, race, nationality, residential status, contact details, educational level, employment details, marital status, housing type);",u.jsx("br",{}),"(c) Information about your relationship (including but not limited to duration of marriage/relationship, type of marriage, whether you have children);",u.jsx("br",{}),"(d) Programme-related information (including but not limited to your participation, attendance, feedback, and assessment results);",u.jsx("br",{}),"(e) Photos and videos taken during the Programme; and",u.jsx("br",{}),"(f) Any other information that you provide to us.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"3. PURPOSES OF COLLECTION, USE AND DISCLOSURE"}),u.jsx("br",{}),"3.1 Your personal data may be collected, used and disclosed for the following purposes:",u.jsx("br",{}),"(a) To administer your participation in the Programme;",u.jsx("br",{}),"(b) To conduct research and analysis to improve the Programme and develop new programmes;",u.jsx("br",{}),"(c) To monitor and evaluate the effectiveness of the Programme;",u.jsx("br",{}),"(d) To contact you for follow-up surveys or research;",u.jsx("br",{}),"(e) To provide you with information about other relevant programmes and services;",u.jsx("br",{}),"(f) To compile statistics and conduct research for policy formulation and review;",u.jsx("br",{}),"(g) To verify your identity and eligibility for the Programme;",u.jsx("br",{}),"(h) To process your application and manage your participation;",u.jsx("br",{}),"(i) For publicity and promotional purposes, including the use of photos and videos;",u.jsx("br",{}),"(j) To comply with legal and regulatory requirements; and",u.jsx("br",{}),"(k) For any other purposes related to the above.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"4. DISCLOSURE OF PERSONAL DATA"}),u.jsx("br",{}),"4.1 Your personal data may be disclosed to:",u.jsx("br",{}),"(a) Government agencies and statutory boards;",u.jsx("br",{}),"(b) Service providers and contractors engaged by the Government;",u.jsx("br",{}),"(c) Research institutions and academic organizations;",u.jsx("br",{}),"(d) Programme facilitators and trainers;",u.jsx("br",{}),"(e) Other participants in the Programme (for contact and networking purposes);",u.jsx("br",{}),"(f) Media organizations (for publicity purposes); and",u.jsx("br",{}),"(g) Any other parties as required by law or for the purposes stated above.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"5. RETENTION OF PERSONAL DATA"}),u.jsx("br",{}),"5.1 Your personal data will be retained for as long as necessary to fulfill the purposes for which it was collected, or as required by law.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"6. ACCESS AND CORRECTION"}),u.jsx("br",{}),"6.1 You may request access to or correction of your personal data by contacting us at the details provided below.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"7. WITHDRAWAL OF CONSENT"}),u.jsx("br",{}),"7.1 You may withdraw your consent to the collection, use and disclosure of your personal data at any time by giving notice to us. However, please note that withdrawal of consent may affect your ability to participate in the Programme.",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"8. CONTACT INFORMATION"}),u.jsx("br",{}),"8.1 If you have any questions about these Terms or wish to exercise your rights regarding your personal data, please contact:",u.jsx("br",{}),"Ministry of Social and Family Development",u.jsx("br",{}),"Email: ",u.jsx("a",{href:"mailto:MSF_info@msf.gov.sg",children:"MSF_info@msf.gov.sg"}),u.jsx("br",{}),"Phone: 6355 2200",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"9. UPDATES TO THESE TERMS"}),u.jsx("br",{}),"9.1 These Terms may be updated from time to time. The updated Terms will be made available at ",u.jsx("a",{href:"https://go.gov.sg/fflmarriage-tnc",target:"_blank",rel:"noopener noreferrer",children:"https://go.gov.sg/fflmarriage-tnc"}),".",u.jsx("br",{}),u.jsx("br",{}),u.jsx("strong",{children:"10. GOVERNING LAW"}),u.jsx("br",{}),"10.1 These Terms shall be governed by and construed in accordance with the laws of Singapore."]})})]}),u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{children:"Select all that applies"}),u.jsxs("div",{className:"agreement-options marriage-prep-checkboxes",children:[u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:s,onChange:this.handleMarriagePrepConsentChange("marriagePrepConsent1")}),"I confirm that my spouse/spouse-to-be and I understand and agree to the collection, use and disclosure of our Personal Information as set out above"]}),u.jsxs("label",{children:[u.jsx("input",{type:"checkbox",checked:a,onChange:this.handleMarriagePrepConsentChange("marriagePrepConsent2")}),"I confirm that I have read and understood the Terms of Consent as set out above"]})]}),u.jsx("br",{}),o&&(!s||!a)&&u.jsx("span",{className:"error-message3",children:"Both consent options must be selected to proceed"})]})]})]}),!l&&u.jsxs("div",{className:"input-group1",children:[u.jsx("label",{children:"I agree to privacy policy"}),u.jsx("div",{className:"agreement-options",children:u.jsxs("label",{children:[u.jsx("input",{type:"radio",value:"Agree 我同意",checked:"Agree 我同意"===e,onChange:this.handleAgreementChange}),"Agree 我同意"]})}),u.jsx("br",{}),!e&&t&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"error-message3",children:"Please select the declaration"}),u.jsx("span",{className:"error-message3",children:"请选择声明"})]})]})]})}}class ye extends g.Component{render(){return u.jsx("div",{className:"submit-details-section",children:u.jsxs("div",{className:"input-group2",children:[u.jsx("h2",{className:"submit-detail-header",children:"Registration Confirmation"}),u.jsx("span",{className:"submit-detail-sub-header",children:"Application Processing"}),u.jsx("span",{className:"submit-detail-text",children:"Thank you for registration! It is currently under review, and we will contact you shortly."}),u.jsx("br",{}),u.jsx("span",{className:"submit-detail-text",children:"感谢您的注册！我们正在审核中，会尽快与您联系。"})]})})}}class Ce extends p.Component{constructor(e){super(e),d(this,"generateCodeVerifier",()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";let t="";const s=new Uint8Array(128);window.crypto.getRandomValues(s);for(let a=0;a<128;a++)t+=e[s[a]%66];return t.substring(0,128)}),d(this,"generateCodeChallenge",e=>h(this,null,function*(){const t=yield window.crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})),d(this,"decodeUrlSafely",e=>{if(!e)return null;try{console.log("Original URL parameter:",e);let s=e,a="",o=0;const i=5;for(;s!==a&&o<i;){a=s;try{if(!s.includes("%"))break;{const e=decodeURIComponent(s);if(console.log(`Attempting decode: ${s}`),e===s||e.includes("%")){if(e===s)break;s=e,console.log(`Decode attempt ${o+1}: ${s}`)}else s=e,console.log(`Decode attempt ${o+1}: ${s}`)}o++}catch(t){console.warn(`Decode attempt ${o+1} failed, using previous result:`,t);break}}if(console.log("Final decoded URL:",s),s.includes("ecss.org.sg")||s.startsWith("http")){if(/[\u4e00-\u9fff]/.test(s)){console.log("Successfully decoded URL with Chinese characters:",s);const e=s.match(/[\u4e00-\u9fff]+/g);e&&console.log("Chinese characters found:",e.join(""))}return s}return console.warn("Decoded URL does not look valid, using original:",e),e}catch(s){return console.warn("Failed to decode URL, using as-is:",s),e}}),d(this,"handleLogin",()=>h(this,null,function*(){var e,t,s;try{if(this.props.errorHandler){console.log("🔍 Checking MyInfo service availability before authentication...");if(!(yield this.props.errorHandler.checkServiceAvailability())){console.log("⚠️ MyInfo service is not available, blocking authentication attempt");const e=this.props.errorHandler.getCurrentStatus();let t="MyInfo service is currently unavailable. Please try again later.";return"maintenance"===e.category?t="MyInfo is currently undergoing maintenance. Service will be restored shortly.":"network"===e.category?t="Connection to MyInfo service failed. Please check your internet connection and try again.":"performance"===e.category&&(t="MyInfo service is experiencing performance issues. Please try again in a few moments."),void(yield this.props.errorHandler.handleError(new Error(t),"myinfo_auth"))}console.log("✅ MyInfo service is available, proceeding with authentication")}const e=this.state.clickCount+1;if(this.setState({clickCount:e}),this.state.forceMyInfoError){console.log("🧪 Forcing MyInfo error for testing purposes");const e="MyInfo service is temporarily unavailable. Please try again later.";if(this.props.onMyInfoError)return void this.props.onMyInfoError(e);throw new Error(e)}0,this.setState({redirecting:!0,error:null}),this.props.onLoginStart&&(yield this.props.onLoginStart());const t=new URLSearchParams(window.location.search);let s=this.props.redirectLink||t.get("link");if(console.log("Raw URL parameter from URLSearchParams:",s),console.log("Current environment:","localhost"===window.location.hostname?"development":"production"),s){const e=this.decodeUrlSafely(s);sessionStorage.setItem("course_link",e),console.log("Stored redirect link in sessionStorage (Azure SWA UTF-8 safe)");const a={environment:"localhost"===window.location.hostname?"development":"production",hostname:window.location.hostname,originalParam:t.get("link"),processedLink:e,timestamp:(new Date).toISOString()};sessionStorage.setItem("azure_swa_environment_info",JSON.stringify(a))}const a=this.generateCodeVerifier(),o=yield this.generateCodeChallenge(a),i=window.crypto.randomUUID(),r=window.crypto.randomUUID(),n="https://id.singpass.gov.sg/auth",l=new URLSearchParams({client_id:"ZrjDybXZeOFUA70KYMwb1dnfmdEXFfAS",response_type:"code",scope:"openid dob email mobileno name race regadd residentialstatus sex uinfin",redirect_uri:"localhost"===window.location.hostname?"http://localhost:3000/callback":"https://salmon-wave-09f02b100.6.azurestaticapps.net/callback",state:i,nonce:r,code_challenge:o,code_challenge_method:"S256",response_mode:"query",prompt:"login",acr_values:"2"});sessionStorage.setItem("singpass_state",i),sessionStorage.setItem("singpass_nonce",r),sessionStorage.setItem("singpass_code_verifier",a);const c=`${n}?${l.toString()}`;console.log("SingPass Authorization URL with exact approved scopes:",c),console.log("Azure SWA redirect URI:",l.get("redirect_uri")),this.props.onBeforeRedirect&&(yield this.props.onBeforeRedirect(c)),window.location.href=c}catch(a){console.error("SingPass authentication error:",a),this.setState({error:a.message||"Failed to initiate SingPass authentication. Please try again.",redirecting:!1}),this.props.onError&&this.props.onError(a),this.props.onMyInfoError&&((null==(e=a.message)?void 0:e.includes("MyInfo"))||(null==(t=a.message)?void 0:t.includes("unavailable"))||(null==(s=a.message)?void 0:s.includes("service temporarily")))&&this.props.onMyInfoError(a.message)}})),this.state={redirecting:!1,error:null,clickCount:0,forceMyInfoError:!1}}render(){const{redirecting:e,error:t,clickCount:s}=this.state,{buttonText:a="Retrieve Myinfo with",disabled:o=!1,className:i="",style:r={},showLogo:l=!0,size:c="default"}=this.props,d=a,h=0===s,p={small:{minWidth:"200px",height:"36px",fontSize:"14px",padding:"0 16px"},default:{minWidth:"280px",height:"48px",fontSize:"16px",padding:"0 24px"},large:{minWidth:"320px",height:"56px",fontSize:"18px",padding:"0 32px"}},g=p[c]||p.default,m=o||e;return u.jsxs(u.Fragment,{children:[h&&u.jsx(u.Fragment,{}),t&&u.jsx(u.Fragment,{}),u.jsxs("button",{onClick:this.handleLogin,disabled:m,className:i,"aria-label":"Log in with Sing Pass authentication",style:n({whiteSpace:"nowrap",backgroundColor:m?"#cccccc":"#F4333D",color:"#FFFFFF",border:"none",borderRadius:"6px",cursor:m?"not-allowed":"pointer",fontSize:g.fontSize,fontFamily:"Poppins, sans-serif",fontWeight:"bold",minWidth:g.minWidth,position:"relative",height:g.height,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:g.padding,margin:"0 auto",transition:"background-color 0.2s ease",letterSpacing:"0.025em",textRendering:"optimizeLegibility"},r),onMouseEnter:e=>{m||(e.target.style.backgroundColor="#B0262D")},onMouseLeave:e=>{m||(e.target.style.backgroundColor="#F4333D")},children:[u.jsx("span",{"aria-hidden":"true",style:{fontFamily:"Poppins, bold, sans-serif",fontSize:g.fontSize,fontWeight:"bold",lineHeight:"1",whiteSpace:"nowrap !important",backgroundColor:"transparent"},children:d}),l&&u.jsx("img",{src:"/Singpass logo/singpass_logo_white.svg",alt:"Sing Pass","aria-label":"Sing Pass",role:"img",style:{fontSize:"1ex",height:"1.5ex",width:"auto",minHeight:"small"===c?"10px":"large"===c?"14px":"12px",filter:"brightness(0) invert(1)",verticalAlign:"baseline",display:"inline-block",marginTop:"6px",marginLeft:"-3px"},onError:e=>{e.target.src="/Singpass logo/singpass_logo_white.png",e.target.onerror=null}})]})]})}}class we{constructor(){this.isOnline=navigator.onLine,this.serviceStatus="unknown",this.lastHealthCheck=null,this.healthCheckInterval=null,this.retryAttempts=0,this.maxRetryAttempts=3,this.healthCheckIntervalMs=3e4,this.timeoutMs=1e4,this.networkListeners=[],this.serviceListeners=[],this.initializeNetworkMonitoring(),this.startHealthMonitoring()}initializeNetworkMonitoring(){const e=()=>{console.log("🌐 Network connectivity restored"),this.isOnline=!0,this.notifyNetworkStatusChange("online"),this.performHealthCheck()},t=()=>{console.log("🌐 Network connectivity lost"),this.isOnline=!1,this.serviceStatus="unavailable",this.notifyNetworkStatusChange("offline")};window.addEventListener("online",e),window.addEventListener("offline",t),this.networkCleanup=()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}startHealthMonitoring(){this.performHealthCheck(),this.healthCheckInterval=setInterval(()=>{this.performHealthCheck()},this.healthCheckIntervalMs)}stopHealthMonitoring(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.networkCleanup&&this.networkCleanup()}performHealthCheck(){return h(this,null,function*(){if(!this.isOnline)return this.serviceStatus="unavailable",{status:"unavailable",reason:"No network connectivity"};const e=Date.now();try{const t="https://id.singpass.gov.sg",s=this.checkEndpoint(t),a=yield Promise.race([s,new Promise((e,t)=>setTimeout(()=>t(new Error("Health check timeout")),this.timeoutMs))]),o=Date.now()-e;if(a.ok){this.serviceStatus=o>5e3?"degraded":"healthy",this.retryAttempts=0,this.lastHealthCheck=new Date;const e={status:this.serviceStatus,responseTime:o,timestamp:this.lastHealthCheck};return this.notifyServiceStatusChange(e),e}throw new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(t){console.warn("🔍 MyInfo health check failed:",t.message),this.retryAttempts++,this.serviceStatus=this.retryAttempts>=this.maxRetryAttempts?"unavailable":"degraded";const e={status:this.serviceStatus,error:t.message,retryAttempts:this.retryAttempts,timestamp:new Date};return this.notifyServiceStatusChange(e),e}})}checkEndpoint(e){return h(this,null,function*(){const t=new AbortController,s=setTimeout(()=>t.abort(),this.timeoutMs);try{const a=yield fetch(e,{method:"HEAD",mode:"no-cors",signal:t.signal,cache:"no-cache"});return clearTimeout(s),{ok:!0,status:a.status,statusText:a.statusText}}catch(a){if(clearTimeout(s),"AbortError"===a.name)throw new Error("Request timeout");return this.fallbackConnectivityCheck()}})}fallbackConnectivityCheck(){return h(this,null,function*(){return new Promise((e,t)=>{const s=new Image,a=setTimeout(()=>{t(new Error("Connectivity check timeout"))},this.timeoutMs);s.onload=()=>{clearTimeout(a),e({ok:!0,status:200,statusText:"OK"})},s.onerror=()=>{clearTimeout(a),t(new Error("Connectivity check failed"))},s.src="https://www.google.com/favicon.ico?"+Date.now()})})}isServiceAvailable(){return h(this,null,function*(){return this.getServiceStatus(),(!this.lastHealthCheck||Date.now()-this.lastHealthCheck.getTime()>this.healthCheckIntervalMs)&&(yield this.performHealthCheck()),{available:"healthy"===this.serviceStatus||"degraded"===this.serviceStatus,status:this.serviceStatus,lastCheck:this.lastHealthCheck,networkOnline:this.isOnline}})}getServiceStatus(){return{status:this.serviceStatus,isOnline:this.isOnline,lastHealthCheck:this.lastHealthCheck,retryAttempts:this.retryAttempts}}categorizeError(e){const t=e.message||e.toString();return!this.isOnline||t.includes("network")||t.includes("connectivity")?{category:"network",severity:"high",userMessage:"Please check your internet connection and try again.",technicalMessage:t,suggestedAction:"check_connection"}:t.includes("timeout")||t.includes("slow")?{category:"performance",severity:"medium",userMessage:"MyInfo service is responding slowly. Please wait a moment and try again.",technicalMessage:t,suggestedAction:"retry_later"}:t.includes("maintenance")||t.includes("scheduled")?{category:"maintenance",severity:"high",userMessage:"MyInfo is currently undergoing maintenance. Please try again later.",technicalMessage:t,suggestedAction:"manual_entry"}:t.includes("unavailable")||t.includes("service")?{category:"service_unavailable",severity:"high",userMessage:"MyInfo service is temporarily unavailable. You can continue with manual entry.",technicalMessage:t,suggestedAction:"manual_entry"}:{category:"unknown",severity:"medium",userMessage:"There was an issue connecting to MyInfo. You can proceed with manual entry.",technicalMessage:t,suggestedAction:"manual_entry"}}attemptRetry(e,t=3){return h(this,null,function*(){let s;for(let o=1;o<=t;o++)try{console.log(`🔄 Retry attempt ${o}/${t}`);const s=yield this.isServiceAvailable();if(!s.available&&"unavailable"===s.status)throw new Error("Service is unavailable, skipping retry");const a=yield e();return console.log(`✅ Retry attempt ${o} succeeded`),a}catch(a){if(s=a,console.warn(`❌ Retry attempt ${o} failed:`,a.message),a.message.includes("network")||a.message.includes("cancelled"))break;if(o<t){const e=1e3*Math.pow(2,o-1);console.log(`⏳ Waiting ${e}ms before next retry...`),yield new Promise(t=>setTimeout(t,e))}}throw s})}onNetworkStatusChange(e){return this.networkListeners.push(e),()=>{this.networkListeners=this.networkListeners.filter(t=>t!==e)}}onServiceStatusChange(e){return this.serviceListeners.push(e),()=>{this.serviceListeners=this.serviceListeners.filter(t=>t!==e)}}notifyNetworkStatusChange(e){this.networkListeners.forEach(t=>{try{t({type:"network",status:e,timestamp:new Date})}catch(s){console.error("Error in network status callback:",s)}})}notifyServiceStatusChange(e){this.serviceListeners.forEach(t=>{try{t(n({type:"service"},e))}catch(s){console.error("Error in service status callback:",s)}})}destroy(){this.stopHealthMonitoring(),this.networkListeners=[],this.serviceListeners=[]}}class be{constructor(e={}){this.options=n({enableRealTimeMonitoring:!0,enableProactiveChecking:!0,enableAutoRetry:!0,maxRetryAttempts:3,retryDelay:1e3,healthCheckInterval:3e4},e),this.serviceMonitor=new we,this.errorHistory=[],this.isMonitoring=!1,this.lastErrorTime=null,this.consecutiveErrors=0,this.errorHandlers=[],this.statusChangeHandlers=[],this.retryHandlers=[],this.options.enableRealTimeMonitoring&&this.initializeRealTimeMonitoring()}initializeRealTimeMonitoring(){this.isMonitoring=!0,this.serviceMonitor.onNetworkStatusChange(e=>{this.handleNetworkStatusChange(e)}),this.serviceMonitor.onServiceStatusChange(e=>{this.handleServiceStatusChange(e)}),console.log("🔍 Real-time MyInfo monitoring initialized")}handleNetworkStatusChange(e){const{status:t,timestamp:s}=e;console.log(`🌐 Network status changed to: ${t} at ${s.toISOString()}`),"offline"===t?this.notifyError({type:"network_offline",message:"Internet connection lost. Please check your network and try again.",severity:"high",timestamp:s,category:"network",suggestedAction:"check_connection"}):"online"===t&&(console.log("🌐 Network connectivity restored - checking MyInfo service availability"),this.checkServiceAvailability()),this.notifyStatusChange({type:"network",status:t,timestamp:s})}handleServiceStatusChange(e){const{status:t,error:s,responseTime:a,timestamp:o}=e;console.log(`🔧 MyInfo service status: ${t} (${a}ms) at ${o.toISOString()}`),"unavailable"===t?(this.consecutiveErrors++,this.notifyError({type:"service_unavailable",message:"MyInfo service is currently unavailable. You can continue with manual entry.",severity:"high",timestamp:o,category:"service",suggestedAction:"manual_entry",technicalDetails:s})):"degraded"===t?this.notifyError({type:"service_degraded",message:"MyInfo service is experiencing slow response times. Please be patient or try again later.",severity:"medium",timestamp:o,category:"performance",suggestedAction:"retry_later",responseTime:a}):"healthy"===t&&(this.consecutiveErrors=0,console.log("✅ MyInfo service is healthy")),this.notifyStatusChange({type:"service",status:t,responseTime:a,timestamp:o})}checkServiceAvailability(){return h(this,null,function*(){if(!this.options.enableProactiveChecking)return{available:!0,status:"unknown"};try{console.log("🔍 Checking MyInfo service availability...");const e=yield this.serviceMonitor.isServiceAvailable();if(!e.available){const t={type:"preauth_check_failed",message:this.generateUserFriendlyMessage(e.status),severity:"unavailable"===e.status?"high":"medium",timestamp:new Date,category:"service",suggestedAction:"unavailable"===e.status?"manual_entry":"retry_later",technicalDetails:e};return this.notifyError(t),{available:!1,error:t}}return console.log("✅ MyInfo service is available"),{available:!0,status:e.status}}catch(e){console.error("🚨 Error checking service availability:",e);const t=this.serviceMonitor.categorizeError(e),s={type:"preauth_check_error",message:t.userMessage,severity:t.severity,timestamp:new Date,category:t.category,suggestedAction:t.suggestedAction,technicalDetails:e.message};return this.notifyError(s),{available:!1,error:s}}})}handleAuthenticationError(e,t){return h(this,null,function*(){const s=new Date;this.lastErrorTime=s,console.error("🚨 MyInfo authentication error:",e);const a=this.serviceMonitor.categorizeError(e),o={type:"authentication_error",originalError:e,message:a.userMessage,severity:a.severity,timestamp:s,category:a.category,suggestedAction:a.suggestedAction,technicalDetails:a.technicalMessage};if(this.errorHistory.push(o),this.options.enableAutoRetry&&this.shouldRetry(a))try{console.log("🔄 Attempting auto-retry for MyInfo authentication..."),this.notifyRetryAttempt({attempt:1,maxAttempts:this.options.maxRetryAttempts});const e=yield this.serviceMonitor.attemptRetry(t,this.options.maxRetryAttempts);return console.log("✅ Auto-retry succeeded"),{success:!0,result:e}}catch(i){console.error("❌ Auto-retry failed:",i),o.retryAttempted=!0,o.retryError=i.message,o.message=`${a.userMessage} Auto-retry also failed.`}return this.notifyError(o),{success:!1,error:o}})}shouldRetry(e){return"network"!==e.category&&"maintenance"!==e.category&&(!(this.consecutiveErrors>=this.options.maxRetryAttempts)&&!(this.lastErrorTime&&Date.now()-this.lastErrorTime.getTime()<3e4))}generateUserFriendlyMessage(e){switch(e){case"unavailable":return"MyInfo service is currently unavailable. You can continue by filling out the form manually.";case"degraded":return"MyInfo service is experiencing slow response times. You may proceed manually or try again later.";case"unknown":return"Unable to verify MyInfo service status. You can continue with manual entry if needed.";default:return"MyInfo service status is uncertain. You can proceed with manual entry if authentication fails."}}getSystemStatus(){const e=this.serviceMonitor.getServiceStatus();return{isMonitoring:this.isMonitoring,network:{online:e.isOnline},service:{status:e.status,lastHealthCheck:e.lastHealthCheck,retryAttempts:e.retryAttempts},errors:{total:this.errorHistory.length,consecutive:this.consecutiveErrors,lastError:this.lastErrorTime,recent:this.errorHistory.slice(-5)}}}getErrorRecommendations(){const e=this.getSystemStatus(),t=[];return e.network.online||t.push({type:"network",priority:"high",action:"Check your internet connection",description:"Ensure you have a stable internet connection before proceeding."}),"unavailable"===e.service.status&&t.push({type:"service",priority:"high",action:"Use manual entry",description:"MyInfo is currently unavailable. Proceed with manual form completion."}),"degraded"===e.service.status&&t.push({type:"performance",priority:"medium",action:"Wait and retry",description:"MyInfo is slow. Wait a few minutes and try again, or proceed manually."}),e.errors.consecutive>2&&t.push({type:"recurring",priority:"high",action:"Manual entry recommended",description:"Multiple errors detected. Manual entry is recommended at this time."}),t}onError(e){return this.errorHandlers.push(e),()=>{this.errorHandlers=this.errorHandlers.filter(t=>t!==e)}}onStatusChange(e){return this.statusChangeHandlers.push(e),()=>{this.statusChangeHandlers=this.statusChangeHandlers.filter(t=>t!==e)}}onRetryAttempt(e){return this.retryHandlers.push(e),()=>{this.retryHandlers=this.retryHandlers.filter(t=>t!==e)}}notifyError(e){this.errorHandlers.forEach(t=>{try{t(e)}catch(s){console.error("Error in error handler callback:",s)}})}notifyStatusChange(e){this.statusChangeHandlers.forEach(t=>{try{t(e)}catch(s){console.error("Error in status change callback:",s)}})}notifyRetryAttempt(e){this.retryHandlers.forEach(t=>{try{t(e)}catch(s){console.error("Error in retry handler callback:",s)}})}destroy(){this.isMonitoring=!1,this.serviceMonitor&&this.serviceMonitor.destroy(),this.errorHandlers=[],this.statusChangeHandlers=[],this.retryHandlers=[],console.log("🔍 Real-time MyInfo monitoring stopped")}}class xe extends p.Component{constructor(e){super(e),d(this,"updateStatus",()=>{const{errorHandler:e}=this.props;if(e){const t=e.getSystemStatus(),s=e.getErrorRecommendations();this.setState({serviceStatus:t.service.status,networkOnline:t.network.online,lastCheck:t.service.lastHealthCheck,errorCount:t.errors.consecutive,recommendations:s})}}),d(this,"getStatusConfig",()=>{const{serviceStatus:e,networkOnline:t}=this.state;if(!t)return{status:"offline",color:"#e74c3c",icon:"🌐",label:"Offline",message:"No internet connection"};switch(e){case"healthy":return{status:"healthy",color:"#27ae60",icon:"✅",label:"Online",message:"MyInfo service is working normally"};case"degraded":return{status:"degraded",color:"#f39c12",icon:"⚠️",label:"Slow",message:"MyInfo service is responding slowly"};case"unavailable":return{status:"unavailable",color:"#e74c3c",icon:"❌",label:"Unavailable",message:"MyInfo service is currently unavailable"};default:return{status:"unknown",color:"#95a5a6",icon:"❓",label:"Unknown",message:"Checking MyInfo service status..."}}}),d(this,"toggleDetails",()=>{this.setState(e=>({showDetails:!e.showDetails}))}),d(this,"handleRefresh",()=>{const{errorHandler:e}=this.props;e&&e.serviceMonitor.performHealthCheck()}),d(this,"formatTime",e=>e?new Date(e).toLocaleTimeString():"Never"),this.state={serviceStatus:"unknown",networkOnline:navigator.onLine,lastCheck:null,isVisible:!0,showDetails:!1,errorCount:0,recommendations:[]}}componentDidMount(){this.updateStatus()}componentDidUpdate(e){e.errorHandler!==this.props.errorHandler&&this.updateStatus()}render(){const{showCompact:e=!1,showDetails:t=!1}=this.props,{showDetails:s,lastCheck:a,errorCount:o,recommendations:i}=this.state,r=this.getStatusConfig();return e?u.jsxs("div",{className:"myinfo-status-compact",style:{borderColor:r.color},children:[u.jsx("span",{className:"status-icon",children:r.icon}),u.jsx("span",{className:"status-label",style:{color:r.color},children:r.label})]}):u.jsx("div",{})}}const ve=!1;class Se extends p.Component{constructor(e){super(e),d(this,"checkSingPassAuthentication",()=>{try{const e=sessionStorage.getItem("singpass_user_data_json"),t=sessionStorage.getItem("singpass_access_token");if(e&&t){const t=JSON.parse(e);return t&&t.name}return!1}catch(e){return console.error("Error checking SingPass authentication:",e),!1}}),d(this,"handleProceedWithoutSingPass",()=>{this.setState({isAuthenticated:!0,currentSection:1})}),d(this,"formatRace",e=>{if(!e)return"";if("string"==typeof e&&(e.includes("华")||e.includes("印")||e.includes("马")||e.includes("其他")))return e;let t="OT";"object"==typeof e?e.code?t=e.code:e.value&&(t=e.value):"string"==typeof e&&(t=e);const s={CN:"Chinese 华",IN:"Indian 印",MY:"Malay 马",OT:"Others 其他"};return s[t]||s.OT}),d(this,"formatGender",e=>{if(console.log("Formatting gender:",e),!e)return"";if("string"==typeof e&&(e.includes("男")||e.includes("女")))return e;let t=e.code;"object"==typeof e&&void 0!==e.value&&(t=e.code);return{M:"M 男",F:"F 女"}[t]||t}),d(this,"formatResidentialStatus",e=>{if(console.log("Residential Status:",e),!e)return"";if("string"==typeof e&&(e.includes("新加坡公民")||e.includes("永久居民")))return e;let t=e;"object"==typeof e&&(t=e.classification||e.code||e.value),console.log("Status Code:",t);return{SC:"SC 新加坡公民",C:"SC 新加坡公民",PR:"PR 永久居民",P:"PR 永久居民"}[t]||t}),d(this,"extractMobileNumber",e=>{if(!e)return"";if("object"==typeof e&&e.nbr)return e.nbr.value?e.nbr.value:e.nbr;if("string"==typeof e||"number"==typeof e){let t=String(e).trim();return t.startsWith("+65")&&(t=t.substring(3)),t.startsWith("65")&&10===t.length&&(t=t.substring(2)),t}return""}),d(this,"componentDidMount",()=>h(this,null,function*(){this._isMounted=!0,window.scrollTo(0,0);const e=new URLSearchParams(window.location.search);let t=decodeURIComponent(e.get("link"));const s=e.get("section");if(t)try{t=decodeURIComponent(t),console.log("Decoded course link from URL:",t),sessionStorage.setItem("courseLink",t),console.log("Saved decoded course link to sessionStorage:",t)}catch(i){console.error("Error decoding URL:",i),sessionStorage.setItem("courseLink",t)}else t=sessionStorage.getItem("courseLink"),console.log("Retrieved course link from sessionStorage:",t);let a=s?parseInt(s):0;const o=!!s;console.log("Final Course Link:",t),console.log("Section Parameter:",s),console.log("Initial Section (before course type check):",a),console.log("Has Section Param:",o);this.checkSingPassAuthentication()?(console.log("User already authenticated with SingPass"),this.setState({isAuthenticated:!0,loading:!1,currentSection:a}),this.populateFormWithSingPassData()):(console.log("User not authenticated, proceeding without SingPass data"),this.setState({isAuthenticated:!1,currentSection:a})),yield this.loadCourseData(t,o)})),d(this,"navigateToSection",e=>{const t=new URLSearchParams(window.location.search),s=sessionStorage.getItem("courseLink");s&&t.set("link",decodeURIComponent(s)),t.set("section",e);const a=`${window.location.pathname}?${decodeURIComponent(t.toString())}`;window.history.pushState(null,"",a),this.setState({currentSection:e})}),d(this,"loadCourseData",(e,t=!1)=>h(this,null,function*(){if(e||(e=sessionStorage.getItem("courseLink")),console.log("Loading course data with link:",e),console.log("Has section param:",t),e){let i=function(e){return e.find(e=>{const t=decodeURIComponent(e.permalink);return console.log("Comparing:"),console.log("Input Link:",r),console.log("Course Permalink:",t),r===t})},r=e;try{e.includes("%")&&(r=decodeURIComponent(e))}catch(o){console.warn("Could not decode link, using original:",o),r=e}console.log("Decoded course link for processing:",r);var s=yield this.fetchCourses("");console.log("All Courses:",s);var a=i(s);if(console.log("Matched Course:",a),a){let e="";if(a.categories&&Array.isArray(a.categories)&&a.categories[1]&&"string"==typeof a.categories[1].name){const t=a.categories[1].name.split(":");e=t.length>1&&"string"==typeof t[1]?t[1].trim():t[0].trim()}else e=a.categories&&Array.isArray(a.categories)&&a.categories[0]&&"string"==typeof a.categories[0].name?a.categories[0].name.trim():"";console.log("Course Type:",e);let s="",i="";"ILP"===e?s="#006400":"NSA"===e?s="#003366":"Marriage Preparation Programme"===e&&(s="#f5f5f5",i="#f5f5f5");let r=a.attributes[1].options[0];r="CT Hub"===r?"CT Hub":"恩 Project@253"===r?"Tampines 253 Centre":"Pasir Ris West"===r?"Pasir Ris West Wellness Centre":"Tampines North CC"===r?"Tampines North Community Centre":r,console.log("Selected Course Details:",a.name.split(/<br\s*\/?>/)),console.log("Selected Course Price:",a.price);const c=a.short_description;console.log("Short Description:",c);let d="";a&&Array.isArray(a.attributes)&&a.attributes[2]&&Array.isArray(a.attributes[2].options)&&a.attributes[2].options.length>0&&(d=a.attributes[2].options[0]),console.log("Course Mode:",d);const h=c.split("<p>"),p=h[h.length-2],u=h[h.length-1];let g="";try{if(h&&h.length>=3){let e=h[h.length-3];console.log("Timing Paragraph",e),e.includes("–")||(e=this.decodeHtmlEntities(e));const t=/(\d{1,2}[:.]\d{2}[ap]m\s*[–-]\s*\d{1,2}[:.]\d{2}[ap]m)/i,s=e.match(t);if(s&&s[0])g=s[0],console.log("Successfully extracted timing:",g);else{console.log("No time pattern found with standard format, trying alternative pattern");const t=/(\d{1,2}[:.]\d{2}[ap]m).+?(\d{1,2}[:.]\d{2}[ap]m)/i,s=e.match(t);s?(g=`${s[1]} – ${s[2]}`,console.log("Found time with alternative pattern:",g)):console.log("Could not extract timing from paragraph:",e)}}else console.warn("Not enough paragraphs to extract timing information")}catch(o){console.error("Error extracting course time:",o)}const m=p.replace("<strong>","").replace("</strong>","").replace("</p>","").split("<br />")[2],f=u.replace("<strong>","").replace("</strong>","").replace("</p>","").split("<br />")[2];console.log("Start Date:",m),console.log("End Date:",f);const y=`${m.replace(/\n/g,"")} - ${f.replace(/\n/g,"")}`,C=a.name.split(/<br\s*\/?>/).map(e=>e.trim()),w=a.price?`$${parseFloat(a.price).toFixed(2)}`:"$0.00";let b={};3===C.length?b={chineseName:C[0],englishName:C[1],location:r,price:w,type:e,courseDuration:y,courseTime:g,courseMode:d}:2===C.length?b={englishName:C[0]||"",location:r,price:w,type:e,courseDuration:y,courseTime:g,courseMode:d}:1===C.length&&(b={englishName:C[0],location:r,price:w,type:e,courseDuration:y,courseTime:g,courseMode:d});const x="Marriage Preparation Programme"===e&&!t;this._isMounted?this.setState(e=>({formData:n(n({},e.formData),b),loading:!0,bgColor:s,formContainerBg:i,currentSection:x?1:e.currentSection})):this.state=l(n({},this.state),{formData:n(n({},this.state.formData),b),loading:!0,bgColor:s,formContainerBg:i,currentSection:x?1:this.state.currentSection}),x&&console.log("Marriage Preparation Programme detected, starting from section 1")}else console.log("No matching course found"),this.setState({loading:!0})}else console.log("No course link provided, loading form without course data"),this.setState({loading:!0})})),d(this,"getSingPassUserData",()=>{try{const e=sessionStorage.getItem("singpass_user_data_json");return e?JSON.parse(e):null}catch(e){return console.error("Error retrieving SingPass user data:",e),null}}),d(this,"handleDataChange",e=>{try{this.setState(t=>{const s=n(n({},t.formData),e),a=Object.keys(e)[0],o=n({},t.validationErrors);return o[a]&&delete o[a],{formData:s,validationErrors:o}})}catch(t){console.log(t)}}),d(this,"handleSingPassSuccess",()=>{console.log("SingPass authentication successful"),this.populateFormWithSingPassData(),this.navigateToSection(1),window.scrollTo(0,0),this.setState({isAuthenticated:!0})}),d(this,"populateFormWithSingPassData",()=>{try{const e=this.getSingPassUserData();if("Marriage Preparation Programme"===this.state.formData.type)return console.log("Marriage Preparation Programme detected, skipping SingPass data population"),void this.navigateToSection(1);if(this.navigateToSection(1),!e)return void console.log("No SingPass user data available");let t="";e.regadd&&(t=`${e.regadd.block.value} ${e.regadd.street.value} #${e.regadd.floor.value}-${e.regadd.unit.value}, ${e.regadd.building.value}, ${e.regadd.country.desc} ${e.regadd.postal.value}`,t=t.replace(/, ,/g,",").replace(/ ,/g,",").replace(/,,/g,","),t=t.replace(/(,\s*)+/g,", ").replace(/,\s*$/,"")),console.log("SingPass user data:",e);const s={pName:e.name||"",nRIC:e.uinfin||"",rESIDENTIALSTATUS:this.formatResidentialStatus(e.residentialstatus),rACE:this.formatRace(e.race),gENDER:this.formatGender(e.sex),dOB:e.dob?e.dob.formattedDate1||e.dob:"",cNO:this.extractMobileNumber(e.mobileno),eMAIL:e.email?e.email.replace(/^([^@]*)@/,(e,t)=>t.toLowerCase()+"@"):"",address:t,postalCode:e.regadd&&e.regadd.postal?e.regadd.postal.value:""},a={pName:!!e.name,nRIC:!!e.uinfin,rESIDENTIALSTATUS:!!e.residentialstatus,rACE:!!e.race,gENDER:!!e.sex,dOB:!!e.dob,address:!!e.regadd,postalCode:!(!e.regadd||!e.regadd.postal),cNO:!1,eMAIL:!1};this.setState(e=>({formData:n(n({},e.formData),s),singPassPopulatedFields:a})),console.log("Form populated with SingPass data successfully")}catch(e){console.error("Error populating form with SingPass data:",e)}}),d(this,"clearCourseData",()=>{sessionStorage.removeItem("courseLink"),sessionStorage.removeItem("singpass_user_data_json"),sessionStorage.removeItem("singpass_access_token")}),d(this,"clearSingPassData",()=>{if("Marriage Preparation Programme"===this.state.formData.type)return void console.log("Marriage Preparation Programme detected, SingPass clearing not applicable");sessionStorage.removeItem("singpass_user_data_json"),sessionStorage.removeItem("singpass_access_token"),console.log("Form data",this.state.formData);const e=l(n({},this.state.formData),{pName:"",nRIC:"",rESIDENTIALSTATUS:"",rACE:"",gENDER:"",dOB:"",address:"",postalCode:"",cNO:"",eMAIL:""});this.setState({isAuthenticated:!1,singPassPopulatedFields:{},formData:e,validationErrors:{}}),console.log("SingPass data cleared successfully")}),d(this,"handleMyInfoError",(e="MyInfo is currently unavailable.")=>{console.log("MyInfo error occurred:",e),this.setState({myInfoError:!0,showMyInfoErrorModal:!0,myInfoErrorMessage:e})}),d(this,"handleCloseMyInfoErrorModal",()=>{this.setState({showMyInfoErrorModal:!1})}),d(this,"handleProceedManually",()=>{this.setState({showMyInfoErrorModal:!1,isAuthenticated:!0,currentSection:1})}),d(this,"handleNext",()=>{console.log("Pressed Next");const e=this.validateForm(),{currentSection:t,formData:s}=this.state;console.log("Current Section:",t);const a="Marriage Preparation Programme"===s.type&&0===t?1:t;if("Marriage Preparation Programme"===s.type?(3===a&&("NSA"!==this.props.type||this.courseDetailsRef.state.selectedPayment||(e.selectedPayment="Please select a payment option.",this.courseDetailsRef.setState({paymentTouched:!0}))),4===a&&(this.agreementDetailsRef.state.marriagePrepConsent1&&this.agreementDetailsRef.state.marriagePrepConsent2||(e.agreement="Both consent options must be selected to proceed.",this.agreementDetailsRef.setState({marriagePrepInteracted:!0})))):(2===a&&("NSA"!==this.props.type||this.courseDetailsRef.state.selectedPayment?"ILP"===this.props.type&&console.log("Go Next"):(e.selectedPayment="Please select a payment option.",this.courseDetailsRef.setState({paymentTouched:!0}))),3!==a||this.agreementDetailsRef.state.selectedChoice||(e.agreement="Please choose the declaration.",this.agreementDetailsRef.setState({isSelected:!0}))),0===Object.keys(e).length){const e="Marriage Preparation Programme"===s.type?5:4;if(this.state.currentSection<e){let e=this.state.currentSection+1;"Marriage Preparation Programme"===s.type&&0===t&&(e=2),this.navigateToSection(e),window.scrollTo(0,0)}("Marriage Preparation Programme"===s.type&&4===this.state.currentSection||"Marriage Preparation Programme"!==s.type&&3===this.state.currentSection)&&this.handleSubmit()}else this.setState({validationErrors:e})}),d(this,"handleBack",()=>{const{currentSection:e,formData:t}=this.state;if(("Marriage Preparation Programme"!==t.type||1!==e)&&e>0){const t=e-1;this.navigateToSection(t)}}),d(this,"isCurrentSectionValid",()=>{const{currentSection:e,formData:t}=this.state;if("Marriage Preparation Programme"===t.type)return!0;switch(e){case 0:default:return!0;case 1:return t.pName&&t.nRIC&&t.rESIDENTIALSTATUS&&t.rACE&&t.gENDER&&t.dOB&&t.cNO&&t.eMAIL&&t.address&&t.eDUCATION&&t.wORKING;case 2:return"NSA"!==t.type||t.payment;case 3:return t.agreement}}),d(this,"handleSubmit",()=>{const{formData:e}=this.state;var t=e.pName,s=e.nRIC,a=e.rESIDENTIALSTATUS,o=e.rACE,i=e.gENDER,r=e.dOB,n=e.cNO,l=e.eMAIL,c=e.postalCode;!c&&e.address&&(c=(e.address.match(/Singapore\s*(\d{6})/i)||[])[1]||"");var d=e.eDUCATION,h=e.wORKING,p=e.type,u={participant:{name:t,nric:s,residentialStatus:a,race:o,gender:i,dateOfBirth:r,contactNumber:n,email:l,postalCode:c,educationLevel:d,workStatus:h},course:{courseType:p,courseEngName:this.decodeHtmlEntities(e.englishName),courseChiName:this.decodeHtmlEntities(e.chineseName),courseLocation:e.location,coursePrice:e.price,courseDuration:e.courseDuration,courseMode:e.courseMode,courseTime:e.courseTime,payment:e.payment},agreement:e.agreement,status:"Pending"};"Marriage Preparation Programme"===p&&(u.marriageDetails={maritalStatus:e.mARITALSTATUS,housingType:e.hOUSINGTYPE,grossMonthlyIncome:e.gROSSMONTHLYINCOME,marriageDuration:e.mARRIAGEDURATION,typeOfMarriage:e.tYPEOFMARRIAGE,hasChildren:e.hASCHILDREN,howFoundOut:e.howFoundOut,howFoundOutOthers:e.howFoundOutOthers,sourceOfReferral:e.sourceOfReferral},u.spouse={name:e.spouseName,nric:e.spouseNRIC,dateOfBirth:e.spouseDOB,residentialStatus:e.spouseResidentialStatus,sex:e.spouseSex,ethnicity:e.spouseEthnicity,maritalStatus:e.spouseMaritalStatus,postalCode:e.spousePostalCode,mobile:e.spouseMobile,email:e.spouseEmail,education:e.spouseEducation,housingType:e.spouseHousingType},u.consent={marriagePrepConsent1:e.marriagePrepConsent1,marriagePrepConsent2:e.marriagePrepConsent2}),console.log("Participants Details",u),D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/courseregistration",{participantDetails:u,purpose:"insert"}).then(e=>{console.log("Form submitted successfully",e.data),e.data?D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/whatsapp",{phoneNumber:u.participant.contactNumber,name:u.participant.name,course:u.course.courseEngName,template:"course_registration_submission",purpose:"registration"}).then(()=>{console.log("WhatsApp registration message sent successfully"),this.clearCourseData(),setTimeout(()=>{},1e4)}).catch(e=>{console.error("Failed to send WhatsApp registration message:",e),console.log("WhatsApp registration message sent successfully"),this.clearCourseData(),setTimeout(()=>{},1e4)}):alert("Error during submission")}).catch(e=>{console.error("Error submitting form:",e),alert("Error during submission")})}),d(this,"validateForm",()=>{const{currentSection:e,formData:t}=this.state,s={},a="Marriage Preparation Programme"===t.type&&0===e?1:e;if(0===a)return s;if(1===a){if("Marriage Preparation Programme"===t.type)return s;if(t.pName||(s.pName="Name is required. 姓名是必填项。"),t.nRIC||(s.nRIC="NRIC Number is required. 身份证号码是必填项。"),t.nRIC){const{isValid:e,error:a}=this.isValidNRIC(t.nRIC);e||(s.nRIC=a)}if(t.rESIDENTIALSTATUS||(s.rESIDENTIALSTATUS="Residential Status is required. 居民身份是必填项。"),t.rACE||(s.rACE="Race is required. 种族是必填项。"),t.gENDER||(s.gENDER="Gender is required. 性别是必填项。"),t.dOB||(s.dOB="Date of Birth is required. 出生日期是必填项。"),t.dOB){const{isValid:e,error:a}=this.isValidDOB(t.dOB,t.type);e||(s.dOB=a)}t.cNO||(s.cNO="Contact No. is required. 联系号码是必填项。"),t.cNO&&!/^\d+$/.test(t.cNO)&&(s.cNO="Contact No. must contain only numbers. 联系号码只能包含数字。"),t.cNO&&8!==t.cNO.length&&(s.cNO="Contact No. must be exactly 8 digits. 联系号码必须是8位数字。"),t.cNO&&!/^[89]/.test(t.cNO)&&(s.cNO="Contact No. must start with 8 or 9. 联系号码必须以8或9开头。"),t.eMAIL||(s.eMAIL="Email is required. 电子邮件是必填项。"),t.location||(s.location="Location is required. 地点是必填项。"),t.address||(s.address="Address is required. 地址是必填项。"),t.eDUCATION||(s.eDUCATION="Education Level is required. 教育水平是必填项。"),t.wORKING||(s.wORKING="Work Status is required. 工作状态是必填项。")}return s}),d(this,"simulateMyInfoError",()=>{const e=[{message:"MyInfo service is temporarily unavailable. Please try again later.",type:"service_unavailable"},{message:"Unable to retrieve your data from MyInfo at this time.",type:"data_retrieval_failed"},{message:"MyInfo is currently undergoing maintenance. Service will be restored shortly.",type:"maintenance"},{message:"Connection to MyInfo service failed. Please check your internet connection and try again.",type:"connection_failed"},{message:"MyInfo authentication timed out. Please try again.",type:"timeout"},{message:"MyInfo service is experiencing high traffic. Please wait a moment and try again.",type:"high_traffic"}],t=e[Math.floor(Math.random()*e.length)];console.log("🧪 Simulating MyInfo error:",t.type,"-",t.message),this.handleMyInfoError(t.message)}),d(this,"setupErrorHandlerListeners",()=>{this.myInfoErrorHandler.onError(e=>{console.log("🚨 Real-time MyInfo error detected:",e),this.handleRealTimeMyInfoError(e)}),this.myInfoErrorHandler.onStatusChange(e=>{console.log("📊 MyInfo status changed:",e),this.handleServiceStatusChange(e)}),this.myInfoErrorHandler.onRetryAttempt(e=>{console.log("🔄 MyInfo retry attempt:",e),this.handleRetryAttempt(e)})}),d(this,"handleRealTimeMyInfoError",e=>{const{message:t,severity:s,category:a,suggestedAction:o}=e;this.setState({myInfoError:!0,showMyInfoErrorModal:!0,myInfoErrorMessage:t,serviceRecommendations:this.myInfoErrorHandler.getErrorRecommendations()}),console.error("Real-time MyInfo error:",{category:a,severity:s,suggestedAction:o,technicalDetails:e.technicalDetails})}),d(this,"handleServiceStatusChange",e=>{const{type:t,status:s}=e;"service"===t?this.setState({myInfoServiceStatus:s,serviceRecommendations:this.myInfoErrorHandler.getErrorRecommendations()}):"network"===t&&this.setState({networkOnline:"online"===s})}),d(this,"handleRetryAttempt",e=>{const{attempt:t,maxAttempts:s}=e;console.log(`🔄 Retry attempt ${t}/${s} in progress...`)}),d(this,"checkMyInfoAvailabilityBeforeAuth",()=>h(this,null,function*(){try{console.log("🔍 Checking MyInfo service availability before authentication...");const e=yield this.myInfoErrorHandler.checkServiceAvailability();return e.available?(console.log("✅ MyInfo service is available for authentication"),!0):(console.warn("⚠️ MyInfo service not available:",e.error),this.handleRealTimeMyInfoError(e.error),!1)}catch(e){return console.error("🚨 Error checking MyInfo availability:",e),this.handleMyInfoError("Unable to verify MyInfo service status. You can proceed with manual entry."),!1}})),d(this,"handleSingPassAuthenticationWithMonitoring",()=>h(this,null,function*(){if(yield this.checkMyInfoAvailabilityBeforeAuth())try{const e=()=>h(this,null,function*(){return console.log("🔐 Starting SingPass authentication..."),{success:!0}});(yield this.myInfoErrorHandler.handleAuthenticationError(new Error("Simulated auth for testing"),e)).success?(console.log("✅ SingPass authentication successful"),this.handleSingPassSuccess()):console.error("❌ SingPass authentication failed after retries")}catch(e){console.error("🚨 Unexpected error during authentication:",e),this.handleMyInfoError(e.message)}})),this.state={currentSection:0,loading:!1,isAuthenticated:!1,singPassPopulatedFields:{},myInfoError:!1,showMyInfoErrorModal:!1,myInfoErrorMessage:"",myInfoServiceStatus:"unknown",networkOnline:navigator.onLine,showStatusIndicator:!0,serviceRecommendations:[],formData:{englishName:"",chineseName:"",location:"",nRIC:"",rESIDENTIALSTATUS:"",rACE:"",gENDER:"",dOB:"",cNO:"",eMAIL:"",address:"",postalCode:"",eDUCATION:"",wORKING:"",courseDate:"",agreement:"",bgColor:"",courseMode:"",courseTime:"",mARITALSTATUS:"",hOUSINGTYPE:"",gROSSMONTHLYINCOME:"",mARRIAGEDURATION:"",tYPEOFMARRIAGE:"",hASCHILDREN:"",spouseName:"",spouseNRIC:"",spouseDOB:"",spouseResidentialStatus:"",spouseSex:"",spouseEthnicity:"",spouseMaritalStatus:"",spousePostalCode:"",spouseMobile:"",spouseEmail:"",spouseEducation:"",spouseHousingType:"",howFoundOut:"",howFoundOutOthers:"",sourceOfReferral:"",marriagePrepConsent1:!1,marriagePrepConsent2:!1},validationErrors:{}},this.myInfoErrorHandler=new be({enableRealTimeMonitoring:!0,enableProactiveChecking:!0,enableAutoRetry:!0,maxRetryAttempts:3}),this.setupErrorHandlerListeners()}fetchCourses(e){return h(this,null,function*(){try{return(yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/courses/",{courseType:e})).data.courses}catch(t){console.error("Error:",t)}})}decodeHtmlEntities(e){return(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent}isValidNRIC(e){return e?9!==e.length?{isValid:!1,error:"NRIC must be exactly 9 characters. NRIC 必须是9个字符。"}:/^[STFG]\d{7}[A-Z]$/.test(e)?{isValid:!0,error:null}:{isValid:!1,error:"Invalid NRIC format. 必须符合新加坡身份证格式，例如 S1234567D。"}:{isValid:!1,error:"NRIC Number is required. 身份证号码是必填项。"}}isValidDOB(e,t){if("ILP"!==t&&"NSA"!==t){if(!e)return{isValid:!1,error:"Date of Birth is required. 出生日期是必填项。"};const t=e.split("/");let s;if(e.match(/^\d{2}\/\d{2}\/\d{4}$/))s=new Date(`${t[2]}-${t[1]}-${t[0]}`);else{if(!e.match(/^\d{4}\/\d{2}\/\d{2}$/))return{isValid:!1,error:"Invalid Date of Birth format. 日期格式无效，必须符合：dd/mm/yyyy, yyyy/mm/dd, yyyy/dd/mm, mm/dd/yyyy。"};s=new Date(`${t[0]}-${t[1]}-${t[2]}`)}return isNaN(s.getTime())?{isValid:!1,error:"Invalid Date of Birth format. 日期格式无效。"}:{isValid:!0,error:null}}if("string"==typeof e){const t=e.split("/");let s;if(e.match(/^\d{2}\/\d{2}\/\d{4}$/))s=new Date(`${t[2]}-${t[1]}-${t[0]}`);else{if(!e.match(/^\d{4}\/\d{2}\/\d{2}$/))return{isValid:!1,error:"Invalid Date of Birth format. 日期格式无效，必须符合：dd/mm/yyyy, yyyy/mm/dd, yyyy/dd/mm, mm/dd/yyyy。"};s=new Date(`${t[0]}-${t[1]}-${t[2]}`)}return(new Date).getFullYear()-s.getFullYear()<50?{isValid:!1,error:"Age must be at least 50 years. 年龄必须至少为50岁。"}:{isValid:!0,error:null}}if(e.formattedDate1){return(new Date).getFullYear()-new Date(e.formattedDate1).getFullYear()<50?{isValid:!1,error:"Age must be at least 50 years. 年龄必须至少为50岁。"}:{isValid:!0,error:null}}return{isValid:!1,error:"Date of Birth is required. 出生日期是必填项。"}}componentWillUnmount(){this._isMounted=!1,console.log("🔍 Stopping MyInfo real-time monitoring..."),this.myInfoErrorHandler&&this.myInfoErrorHandler.destroy()}render(){const{currentSection:e,formData:t,validationErrors:s,bgColor:a,loading:o,isAuthenticated:i}=this.state;return!1===o?u.jsxs("div",{className:"loading-spinner1",style:{textAlign:"center",marginTop:"20px"},children:[u.jsx("div",{className:"spinner1"}),u.jsx("p",{style:{fontSize:"18px",color:"#333",fontWeight:"600",marginTop:"10px"},children:"Loading..."})]}):u.jsxs("div",{className:"formwholepage",style:{backgroundColor:a},children:[u.jsx("div",{className:"form-page",children:u.jsxs("div",{className:"form-container",style:this.state.formContainerBg?{backgroundColor:this.state.formContainerBg}:{},children:[u.jsx(xe,{status:this.state.myInfoServiceStatus,isOnline:this.state.networkOnline,recommendations:this.state.serviceRecommendations,compact:!0}),0===e&&"Marriage Preparation Programme"!==t.type&&u.jsx(pe,{courseType:t.type,isAuthenticated:i,onAuthenticationChange:e=>this.setState({isAuthenticated:e}),onProceedWithoutSingPass:this.handleProceedWithoutSingPass,validationErrors:s}),(1===e||0===e&&"Marriage Preparation Programme"===t.type)&&u.jsx(ue,{data:t,onChange:this.handleDataChange,errors:s,singPassPopulatedFields:"Marriage Preparation Programme"===t.type?{}:this.state.singPassPopulatedFields,onClearSingPassData:"Marriage Preparation Programme"===t.type?null:this.clearSingPassData,hideMyInfoOptions:"Marriage Preparation Programme"===t.type}),2===e&&"Marriage Preparation Programme"===t.type&&u.jsx(ge,{data:t,onChange:this.handleDataChange,errors:s}),2===e&&"Marriage Preparation Programme"!==t.type&&u.jsx(me,{ref:e=>this.courseDetailsRef=e,courseEnglishName:t.englishName,courseChineseName:t.chineseName,courseLocation:t.location,coursePrice:t.price,courseType:t.type,courseDuration:t.courseDuration,courseMode:t.courseMode,payment:t.payment,onChange:this.handleDataChange}),3===e&&"Marriage Preparation Programme"===t.type&&u.jsx(me,{ref:e=>this.courseDetailsRef=e,courseEnglishName:t.englishName,courseChineseName:t.chineseName,courseLocation:t.location,coursePrice:t.price,courseType:t.type,courseDuration:t.courseDuration,courseMode:t.courseMode,payment:t.payment,onChange:this.handleDataChange}),3===e&&"Marriage Preparation Programme"!==t.type&&u.jsx(fe,{ref:e=>this.agreementDetailsRef=e,agreement:t.agreement,onChange:this.handleDataChange,errors:s,courseType:t.type}),4===e&&"Marriage Preparation Programme"===t.type&&u.jsx(fe,{ref:e=>this.agreementDetailsRef=e,agreement:t.agreement,onChange:this.handleDataChange,errors:s,courseType:t.type}),4===e&&"Marriage Preparation Programme"!==t.type&&u.jsx(ye,{}),5===e&&"Marriage Preparation Programme"===t.type&&u.jsx(ye,{})]})}),0===e&&"Marriage Preparation Programme"!==t.type&&u.jsxs("div",{className:"flex-button-container",children:[u.jsx("button",{onClick:this.handleNext,disabled:!this.isCurrentSectionValid(),className:"next-button",children:"Next 下一步"}),u.jsx(Ce,{buttonText:"Retrieve Myinfo with",onAuthenticationSuccess:this.handleSingPassSuccess,onMyInfoError:this.handleMyInfoError,errorHandler:this.realTimeErrorHandler,onError:e=>{var t,s;console.error("SingPass error:",e),((null==(t=e.message)?void 0:t.includes("MyInfo"))||(null==(s=e.message)?void 0:s.includes("unavailable")))&&this.handleMyInfoError(e.message)}}),ve]}),(e>0&&e<4||0===e&&"Marriage Preparation Programme"===t.type||4===e&&"Marriage Preparation Programme"===t.type)&&u.jsxs("div",{className:"button-container",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Marriage Preparation Programme"!==t.type||0!==e&&1!==e?u.jsx("button",{onClick:this.handleBack,disabled:0===e,children:"Back 返回"}):u.jsx("div",{}),u.jsx("button",{onClick:this.handleNext,disabled:!this.isCurrentSectionValid(),style:{marginLeft:"auto"},children:3===e&&"Marriage Preparation Programme"!==t.type||4===e&&"Marriage Preparation Programme"===t.type?"Submit 提交":"Next 下一步"})]}),ve,u.jsx($,{isOpen:this.state.showMyInfoErrorModal,closePopup:this.handleCloseMyInfoErrorModal,onProceedManually:this.handleProceedManually,title:"MyInfo Unavailable",message:this.state.myInfoErrorMessage,type:"myinfo-error",icon:"⚠️"})]})}}class Ne extends p.Component{constructor(e){super(e),d(this,"handleExcelFile",e=>h(this,null,function*(){const t=e.target.files[0],s=new FileReader;this.setState({fileName:t.name}),s.onload=e=>h(this,null,function*(){const t=e.target.result,s=I(t,{type:"array"}),a=s.SheetNames[0],o=s.Sheets[a];console.log("BSTR:",o);const i=R.sheet_to_json(o,{defval:""});console.log("JSON:",i);const r=i.map((e,t)=>({participant:{name:e["Participant Name"]||"",nric:e["Participant NRIC"]||"",residentialStatus:e["Participant Residential Status"]||"",race:e["Participant Race"]||"",gender:e["Participant Gender"]||"",dateOfBirth:e["Participant Date of Birth"]||"",contactNumber:e["Participant Contact Number"]||"",email:e["Participant Email"]||"",postalCode:e["Participant Postal Code"]||"",educationLevel:e["Participant Education Level"]||"",workStatus:e["Participant Work Status  "]||""},course:{courseEngName:e["Course English Name"]||"",courseChiName:e["Course Chinese Name"]||"",courseLocation:e["Course Location"]||"",coursePrice:`$${parseFloat(e["Course Price"]).toFixed(2)}`||"",courseDuration:e["Course Duration"]||"",payment:e.Payment||""},agreement:e.Agreement||"",status:e["Payment Status"]||"",registrationDate:e["Registration Date"],official:{name:"",date:"",time:"",receiptNo:"",remarks:""}}));this.setState({data:r}),console.log("Formatted Data:",r),yield this.sendDataToAPI(r)}),s.readAsArrayBuffer(t)})),d(this,"sendDataToAPI",e=>h(this,null,function*(){console.log("Mass Import Data:",e);try{const t=yield D.post(("localhost"===window.location.hostname?"http://localhost:3001":"https://ecss-backend-node.azurewebsites.net")+"/massimport",{purpose:"massimport",formattedData:e});console.log("API Response:",t)}catch(t){console.error("API Error:",t)}})),this.state={fileName:"",data:[]}}render(){return u.jsxs("div",{className:"upload-section",children:[u.jsx("h3",{children:"Upload Excel File"}),u.jsx("label",{htmlFor:"file-input",className:"custom-file-input",children:this.state.fileName||"Choose File"}),u.jsx("input",{type:"file",id:"file-input",accept:".xlsx, .xls",onChange:this.handleExcelFile,className:"file-input"}),this.state.data.length>0&&u.jsxs("div",{children:[u.jsx("h4",{children:"Imported Data:"}),u.jsx("pre",{children:JSON.stringify(this.state.data,null,2)})]})]})}}class De extends p.Component{render(){const{courses:e,addToCart:t,showMoreInfo:s,renderCourseName:a}=this.props;return u.jsxs("div",{className:"course-selection-container",children:[u.jsx("h1",{children:"Course Selection"}),u.jsx("ul",{className:"course-list",children:e.map(e=>u.jsxs("li",{className:"course-item",children:[u.jsx("div",{className:"course-header",children:u.jsx("img",{src:e.images[0].src||"https://via.placeholder.com/150",alt:e.name,className:"course-image"})}),u.jsxs("div",{className:"course-body",children:[a(e.name),u.jsx("p",{className:"course-price",children:e.price?`$${e.price}`:"Price not available"})]}),u.jsx("div",{className:"course-footer",children:u.jsx("button",{onClick:()=>t(e),className:"add-to-cart-btn",children:"Add to Cart"})})]},e.id))})]})}}class Pe extends g.Component{render(){const{cartItemCount:e,onCartClick:t}=this.props;return u.jsx("div",{className:"add-to-cart-bar",children:u.jsx("div",{className:"cart-info",children:u.jsxs("div",{className:"cart-button",onClick:t,children:[u.jsx(y,{className:"cart-icon"}),e>0&&u.jsx("span",{className:"cart-badge",children:e})]})})})}}class je extends p.Component{render(){const{cartItems:e,onClose:t,renderCourseName1:s,handleCheckout:a}=this.props;return console.log("Cart Items:",e),u.jsx("div",{className:"cart-popup-overlay",children:u.jsxs("div",{className:"cart-popup",children:[u.jsx("h2",{children:"Your Cart"}),0===e.length?u.jsx("p",{children:"Your cart is empty."}):u.jsx("div",{className:"cart-items-list",children:e.map((e,t)=>u.jsxs("div",{className:"cart-item",children:[u.jsx("img",{src:e.imageUrl,alt:e.name,className:"cart-item-image"}),u.jsxs("div",{className:"cart-item-details",children:[s(e.name),u.jsxs("p",{className:"cart-item-price",children:["$",e.price]})]})]},t))}),u.jsxs("div",{className:"button-container",children:[u.jsx("button",{onClick:t,children:"Close"}),u.jsx("button",{onClick:()=>a(e),children:"Checkout"})]})]})})}}class Re extends p.Component{constructor(e){super(e),d(this,"handleFilterClick",(e,t)=>{if(console.log(`${e} clicked: ${t}`),"language"===e){const e=t;this.setState({selectedLanguage:e},()=>{this.filterCourses()})}else if("location"===e){const e=t;this.setState({selectedLocation:e},()=>{this.filterCourses()})}else if("courseType"===e){const e=t;this.setState({selectedCourseType:e},()=>{this.filterCourses()})}}),d(this,"handleSearchChange",e=>{const t=e.target.value;this.setState({searchQuery:t},()=>{this.filterCourses()})}),d(this,"filterCourses",()=>{const{selectedLanguage:e,selectedLocation:t,selectedCourseType:s,searchQuery:a}=this.state;console.log("Selected:",e,t,s,a);const{courses:o}=this.props;if(console.log("Courses:",o),0===o.length)return console.log("No courses available"),void this.props.onFilterChange([]);const i=o.filter(o=>{console.log("Checking course:",o);const i=null===t||"All Locations"===t,r=null===s||"All Types"===s,n=null===e||"All Languages"===e||o.attributes&&o.attributes[0]&&o.attributes[0].options[0]===e,l=i||o.attributes&&o.attributes[1]&&o.attributes[1].options[0]===t,c=r||o.categories&&o.categories[1].name===s,d=o.name.toLowerCase().includes(a.toLowerCase());return n&&l&&c&&d});console.log("Filtered Courses:",i),this.props.onFilterChange(i)}),this.state={selectedLanguage:null,selectedLocation:null,selectedCourseType:null,searchQuery:""}}render(){const{filters:e}=this.props,{selectedLanguage:t,selectedLocation:s,selectedCourseType:a,searchQuery:o}=this.state;return u.jsxs("div",{className:"filter-sidebar",children:[u.jsx("div",{className:"search-bar",children:u.jsx("input",{type:"text",placeholder:"Search for courses",value:o,onChange:this.handleSearchChange,className:"search-bar"})}),u.jsxs("div",{className:"filter-section1",children:[u.jsx("h3",{className:"filter-heading",children:"课程类型 Course Types"}),u.jsx("div",{className:"filter-list",children:e.types.map((e,t)=>u.jsx("div",{onClick:()=>this.handleFilterClick("courseType",e),className:"filter-item1 "+(a===e?"selected":""),children:t>=1?e.split(":")[1].trim():e},t))})]}),u.jsxs("div",{className:"filter-section1",children:[u.jsx("h3",{className:"filter-heading",children:"语言 Languages"}),u.jsx("div",{className:"filter-list",children:e.languages.map((e,s)=>u.jsx("div",{onClick:()=>this.handleFilterClick("language",e),className:"filter-item1 "+(t===e?"selected":""),children:e},s))})]}),u.jsxs("div",{className:"filter-section1",children:[u.jsx("h3",{className:"filter-heading",children:"地点 Locations"}),u.jsx("div",{className:"filter-list",children:e.locations.map((e,t)=>u.jsx("div",{onClick:()=>this.handleFilterClick("location",e),className:"filter-item1 "+(s===e?"selected":""),children:e},t))})]})]})}}class Ae extends p.Component{render(){const{selectedCourse:e,renderCourseName2:t,renderDescription:s,renderCourseDetails:a,handleClose:o,handleAddToCart:i}=this.props;return e?(console.log("Selected Course:",e),u.jsxs("div",{className:"course-popup",children:[u.jsx("div",{className:"popup-overlay1",onClick:this.closePopup}),u.jsx("div",{className:"popup-content1",children:u.jsxs("div",{className:"course-details",children:[u.jsxs("div",{className:"course-header1",children:[u.jsx("img",{src:e.images[0].src||"https://via.placeholder.com/150",className:"popup-course-image"}),u.jsx("div",{className:"course-info",children:t(e.name)})]}),u.jsx("p",{className:"course-description",children:s(e.description)}),u.jsxs("div",{className:"course-details-section",children:[u.jsx("h3",{children:"Course Details"}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Contact Number:"})," ",a(e.short_description).contactNumber]}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Language: "})," ",a(e.short_description).language]}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Location: "})," ",a(e.short_description).location]}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Fee/Lesson/Vacancy:"}),a(e.short_description).feeLessonVacancy]}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Lesson Schedule:"}),a(e.short_description).lessonSchedule]}),u.jsxs("p",{style:{display:"flex"},children:[u.jsx("strong",{style:{marginRight:"1rem"},children:"Course Duration:"}),a(e.short_description).courseDateRange]})]}),u.jsx("div",{className:"course-reviews",children:u.jsxs("div",{className:"button-container",children:[u.jsx("button",{onClick:o,children:"Close"}),u.jsx("button",{onClick:()=>i(e),children:"Add to Cart"})]})})]})})]})):null}}class Te extends p.Component{constructor(){super(...arguments),d(this,"state",{courses:[],loading:!0,error:null,cartItemCount:0,cartItems:[],showCartPopup:!1,filters:{languages:[],locations:[]},filteredCourses:[],showPopup:!1,selectedCourse:{}}),d(this,"componentDidMount",()=>h(this,null,function*(){yield this.fetchCourses()})),d(this,"fetchCourses",()=>h(this,null,function*(){try{var e=yield D.post(("localhost"===window.location.hostname?"http://localhost:3002":"https://ecss-backend-django.azurewebsites.net")+"/courses/",{courseType:"NSA"});console.log("Response Data:",e.data),e.data&&e.data.courses?(this.setState({courses:e.data.courses,loading:!1,filteredCourses:e.data.courses}),yield this.fetchFilters(e.data.courses)):this.setState({error:"No courses found",loading:!1})}catch(t){console.error("Error fetching data:",t),this.setState({error:"Failed to fetch courses",loading:!1})}})),d(this,"fetchFilters",e=>h(this,null,function*(){try{const t=new Set(["All Languages"]),s=new Set(["All Locations"]),a=new Set(["All Types"]);e.forEach(e=>{var o,i;(null==(o=e.attributes[0])?void 0:o.options[0])&&t.add(e.attributes[0].options[0]),(null==(i=e.attributes[1])?void 0:i.options[0])&&s.add(e.attributes[1].options[0]),e.categories[1].name&&a.add(e.categories[1].name)});const o=Array.from(t),i=Array.from(s),r=Array.from(a);this.setState({filters:{languages:o,locations:i,types:r}}),console.log("Unique Languages:",o),console.log("Unique Locations:",i)}catch(t){console.error("Error fetching filters:",t),this.setState({error:"Failed to fetch filters"})}})),d(this,"handleFilterChange",e=>{this.setState({filteredCourses:e})}),d(this,"addToCart",e=>{console.log("Add To Cart:",e),this.setState(t=>({cartItemCount:t.cartItemCount+1,cartItems:[...t.cartItems,{imageUrl:e.images[0].src,name:e.name,price:e.price,course:e}]}))}),d(this,"showMoreInfo",e=>{this.setState({showPopup:!0,selectedCourse:e})}),d(this,"handleCartClick",()=>{console.log("Toggling Cart Popup..."),this.setState(e=>({showCartPopup:!e.showCartPopup}))}),d(this,"closePopup",()=>{console.log("Toggling Cart Popup..."),this.setState(e=>({showPopup:!e.showPopup}))}),d(this,"renderDescription",e=>{console.log("Long Description:",e);const t=e.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n").split(/<\/?p>/).filter(Boolean).slice(2).map(e=>`<p>${e}</p>`).join("");return u.jsx("div",{children:u.jsx("div",{dangerouslySetInnerHTML:{__html:t}})})}),d(this,"renderCourseDetails",e=>{let t=e.replace(/<br\/>/g,"").replace(/<p>/g,"").replace(/<\/p>/g,"").replace(/<div class="nta_wa_button"[^>]*>.*?<\/div>/g,"");t=t.replace(/\s+/g," ").trim(),console.log("Processed Description:",t);const s=t.match(/(?:联系电话 Contact Number:)[^\d]*(\d{4}[\s\-]?\d{4})(?:\s?\((Whatsapp only)\))?/i);let a="";if(console.log("Contact Number Match:",s),s){const e=s[1].trim(),t=s[2]?"(Whatsapp only)":"";a=t?e+" "+t:e}const o=t.match(/语言 Language:<\/b><br \/>(.*?)<br \/>(.*?)<b>/i);let i=[];if(o){i=[o[1].trim(),o[2].trim()]}const r=t.match(new RegExp("地点 Location:<\\/b>(.*?)<b>","is"));let n="";r&&(n=r[1].replace(/<br\s*\/?>/g," ").trim());const l=t.match(new RegExp("学费\\/课数\\/名额 Fee\\/Lesson\\/Vacancy：<\\/b>(.*?)<b>","is"));let c="",d={};if(l){let e="",t="";c=l[1].replace(/<br\s*\/?>/g," ").trim();const s=/\$?([\d\.]+)\/(\d+)\s*?Lesson(?:s)?\/(\d+)\s*?Vacanc(?:y|ies)/i,a=c.match(s);console.log("English Fee:",a),a&&(e=a[0].trim());const o=/\$([\d\.]+)\s*\/\s*(\d+)\s?堂课\s*\/\s*(\d+)\s?名额/,i=c.match(o);i&&(t=i[0].trim()),console.log("Mandarin Fee:",i),d=u.jsxs("div",{style:{whiteSpace:"pre-line"},children:[e," ",u.jsx("br",{}),t]})}const h=t.match(new RegExp("课程表 Lesson Schedule:<\\/b>(.*?)<strong>","is"));let p="";if(h){const e=h[1].replace(/<br\s*\/?>/g," ").trim(),t=/(Every\s*)?([A-Za-z]+(?:day)?)\s*,\s*(\d{1,2}:\d{2}[apm]{2}\s*[-–]?\s*\d{1,2}:\d{2}[apm]{2})/,s=e.match(t);let a="";s&&(a=s[0].trim()),console.log("English Schedule:",a);const o=/(每个\s*)?(星期一|星期二|星期三|星期四|星期五|星期六|星期日),\s*(上午|下午|中午)\d{1,2}点(\d{1,2}分)?到(上午|下午|中午)\d{1,2}点(\d{1,2}分)?/,i=e.match(o);let r="";i&&(r=i[0].trim()),console.log("Mandarin Schedule:",r),p=u.jsxs("div",{style:{whiteSpace:"pre-line"},children:[r," ",u.jsx("br",{}),a]})}const g=t.match(new RegExp("开课日期 Start Date:<\\/strong><br\\s*\\/?>\\s*(.*?)<br\\s*\\/?>\\s*(\\d{1,2} [A-Za-z]+ \\d{4})","is")),m=t.match(new RegExp("课完日期 End Date:<\\/strong><br\\s*\\/?>\\s*(.*?)<br\\s*\\/?>\\s*(\\d{1,2} [A-Za-z]+ \\d{4})","is"));let f="";if(g&&m){const e=g[1].trim(),t=g[2].trim(),s=m[1].trim(),a=m[2].trim();console.log(`${e} - ${s}\n${t} - ${a}`),f=u.jsxs("div",{style:{whiteSpace:"pre-line"},children:[e," - ",s," ",u.jsx("br",{}),t," - ",a]})}return{contactNumber:a,language:i[0].trim()+" "+i[1].trim(),location:n,feeLessonVacancy:d,lessonSchedule:p,courseDateRange:f}}),d(this,"handleCheckout",e=>{console.log("Registered Courses:",e)})}renderCourseName(e){const t=e.split(/<br\s*\/?>/);return t.map((e,s,a)=>(s===t.length-1&&(e=e.slice(1,-1)),u.jsx("p",{className:"course-name",children:e.trim()},s)))}renderCourseName1(e){const t=e.split(/<br\s*\/?>/);return t.map((e,s,a)=>(s===t.length-1&&(e=e.slice(1,-1)),u.jsx("p",{className:"cart-item-name",children:e.trim()})))}renderCourseName2(e){const t=e.split(/<br\s*\/?>/);return t.map((e,s,a)=>(s===t.length-1&&(e=e.slice(1,-1)),u.jsx("h3",{className:"info-item-name",children:e.trim()})))}render(){const{courses:e,filteredCourses:t,loading:s,error:a,cartItemCount:o,cartItems:i,showCartPopup:r,filters:n,showPopup:l,selectedCourse:c}=this.state;return s?u.jsx("p",{children:"Loading courses..."}):a?u.jsx("p",{children:a}):u.jsxs("div",{className:"course-selection-page",children:[u.jsx(Pe,{cartItemCount:o,onCartClick:this.handleCartClick}),u.jsxs("div",{className:"main-container",children:[u.jsx(Re,{courses:e,filters:n,onFilterChange:this.handleFilterChange}),u.jsx(De,{courses:t,addToCart:this.addToCart,showMoreInfo:this.showMoreInfo,renderCourseName:this.renderCourseName})]}),r&&u.jsx(je,{cartItems:i,onClose:this.handleCartClick,renderCourseName1:this.renderCourseName1,handleCheckout:this.handleCheckout}),l&&c&&u.jsx(Ae,{selectedCourse:c,renderCourseName2:this.renderCourseName2,renderDescription:this.renderDescription,renderCourseDetails:this.renderCourseDetails,handleClose:this.closePopup,handleAddToCart:this.addToCart})]})}}class Ie extends p.Component{constructor(e){super(e),d(this,"generateCodeVerifier",()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";let t="";const s=new Uint8Array(128);window.crypto.getRandomValues(s);for(let a=0;a<128;a++)t+=e[s[a]%66];return t.substring(0,128)}),d(this,"generateCodeChallenge",e=>h(this,null,function*(){const t=yield window.crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})),d(this,"decodeUrlSafely",e=>{if(!e)return null;try{let s=e,a="",o=0;const i=5;for(;s!==a&&o<i;){a=s;try{if(!s.includes("%"))break;{const e=decodeURIComponent(s);if(e===s||e.includes("%")){if(e===s)break;s=e}else s=e}o++}catch(t){break}}return s}catch(s){return e}}),d(this,"handleLogin",()=>h(this,null,function*(){try{const t=new URLSearchParams(window.location.search);let s=t.get("link");if(s){var e=this.decodeUrlSafely(s);s="http://localhost:3000/form"}if(s){sessionStorage.setItem("course_link",e);const a={environment:"development",hostname:"localhost",originalParam:t.get("link"),processedLink:s,timestamp:(new Date).toISOString()};sessionStorage.setItem("azure_swa_environment_info",JSON.stringify(a))}const a=this.generateCodeVerifier(),o=yield this.generateCodeChallenge(a),i=window.crypto.randomUUID(),r=window.crypto.randomUUID(),n="https://id.singpass.gov.sg/auth",l=new URLSearchParams({client_id:"ZrjDybXZeOFUA70KYMwb1dnfmdEXFfAS",response_type:"code",scope:"openid dob email mobileno name race regadd residentialstatus sex uinfin",redirect_uri:"http://localhost:3000/callback",state:i,nonce:r,code_challenge:o,code_challenge_method:"S256",response_mode:"query",prompt:"login",acr_values:"2"});sessionStorage.setItem("singpass_state",i),sessionStorage.setItem("singpass_nonce",r),sessionStorage.setItem("singpass_code_verifier",a);const c=`${n}?${l.toString()}`;this.setState({redirecting:!0}),window.location.href=c}catch(t){this.setState({error:"Failed to initiate SingPass authentication. Please try again.",redirecting:!1})}})),d(this,"formatDisplayUrl",e=>{if(!e)return"";try{if(e.includes("ecss.org.sg/product/")){const t=e.split("/product/")[1];if(t){const e=t.match(/[\u4e00-\u9fff]+/g);if(e&&e.length>0){return`ECSS: ${e.join("")}...`}const s=t.split("-").find(e=>e.length>5&&!e.includes("%"));if(s)return`ECSS: ${s}...`}}return e.length>60?e.substring(0,60)+"...":e}catch(t){return e.length>60?e.substring(0,60)+"...":e}}),this.state={redirecting:!1,error:null,redirectLink:null}}componentDidMount(){let e=new URLSearchParams(window.location.search).get("link");e&&(e=this.decodeUrlSafely(e),this.setState({redirectLink:e}))}render(){const{redirecting:e,error:t,redirectLink:s}=this.state;return u.jsxs("div",{style:{maxWidth:"400px",margin:"50px auto",padding:"30px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",fontFamily:'"Poppins", "Segoe UI", sans-serif',textAlign:"center",backgroundColor:"white"},children:[u.jsx("style",{children:"\n            @font-face {\n              font-family: 'Poppins';\n              src: url('/Noto_Sans,Poppins/Poppins/Poppins-Bold.ttf') format('truetype');\n              font-weight: bold;\n              font-style: normal;\n              font-display: swap;\n              unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n            }\n            @font-face {\n              font-family: 'Poppins';\n              src: url('/Noto_Sans,Poppins/Poppins/Poppins-Regular.ttf') format('truetype');\n              font-weight: normal;\n              font-style: normal;\n              font-display: swap;\n              unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n            }\n            @font-face {\n              font-family: 'Noto Sans CJK';\n              src: url('/Noto_Sans,Poppins/Noto_Sans/NotoSansCJK-Regular.ttf') format('truetype');\n              font-weight: normal;\n              font-style: normal;\n              font-display: swap;\n              unicode-range: U+4E00-9FFF, U+3400-4DBF, U+20000-2A6DF, U+2A700-2B73F, U+2B740-2B81F, U+2B820-2CEAF, U+2CEB0-2EBEF, U+30000-3134F;\n            }\n            @font-face {\n              font-family: 'Noto Sans CJK';\n              src: url('/Noto_Sans,Poppins/Noto_Sans/NotoSansCJK-Bold.ttf') format('truetype');\n              font-weight: bold;\n              font-style: normal;\n              font-display: swap;\n              unicode-range: U+4E00-9FFF, U+3400-4DBF, U+20000-2A6DF, U+2A700-2B73F, U+2B740-2B81F, U+2B820-2CEAF, U+2CEB0-2EBEF, U+30000-3134F;\n            }\n          "}),t&&u.jsx("div",{style:{backgroundColor:"#ffebee",border:"1px solid #ffcdd2",borderRadius:"4px",padding:"12px",margin:"0 0 20px 0",color:"#c62828",fontSize:"14px"},children:t}),s&&u.jsxs("div",{style:{backgroundColor:"#e3f2fd",border:"1px solid #bbdefb",borderRadius:"4px",padding:"12px",margin:"0 0 20px 0",color:"#1565c0",fontSize:"14px"},children:[u.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:"Authentication Required"}),u.jsxs("p",{style:{margin:"0 0 8px 0",fontSize:"12px",fontFamily:'"Noto Sans CJK", "Poppins", sans-serif',wordBreak:"break-word",lineHeight:"1.4",textAlign:"left",padding:"4px 8px",backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"3px",border:"1px solid rgba(25, 101, 192, 0.2)"},children:[u.jsx("strong",{children:"Destination:"}),u.jsx("br",{}),this.formatDisplayUrl(s)]}),u.jsx("p",{style:{margin:0,fontSize:"12px"},children:"You will be redirected after successful login"})]}),u.jsxs("div",{children:[u.jsx("h2",{style:{color:"#333",marginBottom:"30px",fontFamily:"Poppins, sans-serif",fontWeight:"600"},children:"SingPass Authentication"}),u.jsxs("button",{onClick:this.handleLogin,disabled:e,"aria-label":"Log in with Sing Pass authentication","aria-describedby":"singpass-description",style:{backgroundColor:e?"#cccccc":"#F4333D",color:"#FFFFFF",border:"none",borderRadius:"6px",cursor:e?"not-allowed":"pointer",fontSize:"16px",fontFamily:"Poppins, sans-serif",fontWeight:"bold",minWidth:"280px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"0 24px",margin:"0 auto",transition:"background-color 0.2s ease",letterSpacing:"0.025em",textRendering:"optimizeLegibility"},onMouseEnter:t=>{e||(t.target.style.backgroundColor="#B0262D")},onMouseLeave:t=>{e||(t.target.style.backgroundColor="#F4333D")},children:[u.jsx("span",{"aria-hidden":"true",style:{fontFamily:"Poppins, bold, sans-serif",fontSize:"16px",fontWeight:"bold",lineHeight:"1"},children:e?"Redirecting...":"Log in with"}),!e&&u.jsx("img",{src:"/Singpass logo/singpass_logo_white.svg",alt:"Sing Pass","aria-label":"Sing Pass",role:"img",style:{fontSize:"1ex",height:"1ex",width:"auto",minHeight:"14px",filter:"brightness(0) invert(1)",verticalAlign:"baseline",display:"inline-block"},onError:e=>{e.target.src="/Singpass logo/singpass_logo_white.png",e.target.onerror=null}})]}),u.jsx("p",{id:"singpass-description",style:{marginTop:"20px",fontSize:"12px",color:"#888",lineHeight:"1.4",fontFamily:"Poppins, sans-serif"},children:"Secure authentication using your SingPass Digital ID"})]})]})}}class Me extends p.Component{constructor(){super(...arguments),d(this,"handleCallback",()=>h(this,null,function*(){try{const e=new URLSearchParams(window.location.search),t=e.get("code"),s=e.get("state"),a=e.get("error"),o=e.get("error_description");if(a)return void console.error(`Singpass authorization error: ${a} - ${o}`);if(!t)return void console.error("No authorization code received from Singpass");const i=sessionStorage.getItem("singpass_state"),r=sessionStorage.getItem("singpass_nonce"),n=sessionStorage.getItem("singpass_code_verifier");if(s!==i)return void console.error("State parameter mismatch - possible CSRF attack");yield this.callBackendTokenExchange(t,n,r,s)}catch(e){console.error("Callback handling error:",e)}})),d(this,"callBackendTokenExchange",(e,t,s,a)=>h(this,null,function*(){var o,i,r,n,l;try{const r="https://ecss-backend-node.azurewebsites.net/singpass/token";console.log("Exchanging tokens via backend..."),console.log("Backend URL:",r),console.log("Request data:",{code:"REDACTED",code_verifier:"REDACTED",state:a,nonce:s?"PRESENT":"MISSING"});const n=window.location.href,l={code:e,code_verifier:t,state:a,nonce:s,href:n},h=yield D.post(r,l,{headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:3e4,validateStatus:function(e){return e<600}});if(console.log("Backend response status:",h.status),console.log("Backend response data:",h.data),h.status>=400){let e=`Backend error (${h.status})`;throw h.data&&(h.data.error_description?e=h.data.error_description:h.data.message?e=h.data.message:h.data.error?e=h.data.error:"string"==typeof h.data&&(e=h.data)),console.error("Backend API error:",{status:h.status,data:h.data,message:e}),new Error(e)}if(!h.data||!h.data.success){const e=(null==(o=h.data)?void 0:o.error_description)||(null==(i=h.data)?void 0:i.error)||"Backend authentication failed";throw console.error("Backend authentication failed:",h.data),new Error(e)}const{data:p}=h.data;console.log("Backend response data keys:",Object.keys(p)),console.log("User profile available:",!!p.userProfile),console.log("Individual fields available:",{name:!!p.name,uinfin:!!p.uinfin,residentialstatus:!!p.residentialstatus,race:!!p.race,sex:!!p.sex,dob:!!p.dob,mobileno:!!p.mobileno,email:!!p.email,regadd:!!p.regadd});const{uuid:u,access_token:g,userProfile:m,token_type:f,expires_in:y,scope:C,scopeArray:w,refresh_token:b,id_token:x,name:v,uinfin:S,residentialstatus:N,race:P,sex:j,dob:R,mobileno:A,email:T,regadd:I,endpointUsed:M}=p;if(console.log("Singpass authentication completed via:",M),console.log("Storing user data..."),g&&(sessionStorage.setItem("singpass_access_token",g),sessionStorage.setItem("singpass_token_type",f||"Bearer"),y)){const e=Date.now()+1e3*y;sessionStorage.setItem("singpass_token_expires",e.toString())}M&&sessionStorage.setItem("singpass_endpoint_used",M),C&&sessionStorage.setItem("singpass_scope",C),w&&w.length>0&&sessionStorage.setItem("singpass_scope_array",JSON.stringify(w)),b&&sessionStorage.setItem("singpass_refresh_token",b),x&&sessionStorage.setItem("singpass_id_token",x),sessionStorage.setItem("singpass_user_uuid",u),m&&sessionStorage.setItem("singpass_user_profile",JSON.stringify(m)),v&&sessionStorage.setItem("singpass_user_name",v),S&&sessionStorage.setItem("singpass_user_uinfin",S),N&&sessionStorage.setItem("singpass_user_residentialstatus",N),P&&sessionStorage.setItem("singpass_user_race",P),j&&sessionStorage.setItem("singpass_user_sex",j),R&&sessionStorage.setItem("singpass_user_dob",R),A&&sessionStorage.setItem("singpass_user_mobileno",A),T&&sessionStorage.setItem("singpass_user_email",T),I&&sessionStorage.setItem("singpass_user_regadd",JSON.stringify(I));const k={name:v||null,uinfin:S||null,residentialstatus:N||null,race:P||null,sex:j||null,dob:R||null,mobileno:A||null,email:T||null,regadd:I||null,hasRegadd:!!I,timestamp:Date.now(),source:"singpass",endpointUsed:M||"unknown"};try{sessionStorage.setItem("singpass_user_data_json",JSON.stringify(k)),console.log("User data successfully stored as JSON")}catch(c){console.error("JSON.stringify failed, using fallback approach:",c);const e={name:"string"==typeof v?v:String(v||""),uinfin:"string"==typeof S?S:String(S||""),residentialstatus:"string"==typeof N?N:String(N||""),race:"string"==typeof P?P:String(P||""),sex:"string"==typeof j?j:String(j||""),dob:"string"==typeof R?R:String(R||""),mobileno:"string"==typeof A?A:String(A||""),email:"string"==typeof T?T:String(T||""),regadd:I?"string"==typeof I?I:JSON.stringify(I).substring(0,500):null,hasRegadd:!!I,timestamp:Date.now(),source:"singpass",endpointUsed:M||"unknown"};try{sessionStorage.setItem("singpass_user_data_json",JSON.stringify(e)),console.log("Cleaned user data stored successfully")}catch(d){console.error("Even fallback JSON storage failed:",d),Object.keys(e).forEach(t=>{sessionStorage.setItem(`singpass_user_data_${t}`,String(e[t]||""))}),console.log("Stored user data as individual string fields")}}const L=sessionStorage.getItem("courseLink");console.log("Redirect link from sessionStorage:",L),sessionStorage.removeItem("singpass_state"),sessionStorage.removeItem("singpass_nonce"),sessionStorage.removeItem("singpass_code_verifier");let E="/form";if(L){const e=new URLSearchParams;e.set("link",L),E=`/form?${e.toString()}`,console.log("Redirecting to form with link parameter:",E)}else console.log("Redirecting to form without link parameter");console.log("Final user data summary:",{name:!!v,uinfin:!!S,residentialstatus:!!N,race:!!P,sex:!!j,dob:!!R,mobileno:!!A,email:!!T,regadd:!!I,endpointUsed:M}),window.location.href=E}catch(h){console.error("Backend Singpass API error:",h),console.error("Error details:",{message:h.message,response:null==(r=h.response)?void 0:r.data,status:null==(n=h.response)?void 0:n.status}),h.message,500===(null==(l=h.response)?void 0:l.status)&&h.message}}))}componentDidMount(){this.handleCallback()}render(){return u.jsxs("div",{style:{maxWidth:"400px",margin:"50px auto",padding:"40px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",fontFamily:'"Poppins", "Segoe UI", sans-serif',textAlign:"center",backgroundColor:"white"},children:[u.jsx("style",{children:"\n            @font-face {\n              font-family: 'Poppins';\n              src: url('/Noto_Sans,Poppins/Poppins/Poppins-Bold.ttf') format('truetype');\n              font-weight: bold;\n              font-style: normal;\n              font-display: swap;\n            }\n            @keyframes spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n            }\n          "}),u.jsx("h2",{style:{color:"#333",marginBottom:"20px",fontFamily:"Poppins, sans-serif"},children:"Processing Singpass Authentication..."}),u.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #F4333D",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"20px auto"}}),u.jsx("p",{style:{color:"#666",fontFamily:"Poppins, sans-serif"},children:"Please wait while we process your authentication..."})]})}}class ke extends p.Component{render(){}}const Le=()=>{const[e,t]=p.useState(!1),[s,a]=p.useState("MyInfo service is temporarily unavailable. Please try again later."),o=[{message:"MyInfo service is temporarily unavailable. Please try again later.",type:"service_unavailable",label:"Service Unavailable"},{message:"Unable to retrieve your data from MyInfo at this time.",type:"data_retrieval_failed",label:"Data Retrieval Failed"},{message:"MyInfo is currently undergoing maintenance. Service will be restored shortly.",type:"maintenance",label:"Maintenance"},{message:"Connection to MyInfo service failed. Please check your internet connection and try again.",type:"connection_failed",label:"Connection Failed"},{message:"MyInfo authentication timed out. Please try again.",type:"timeout",label:"Timeout"},{message:"MyInfo service is experiencing high traffic. Please wait a moment and try again.",type:"high_traffic",label:"High Traffic"}],i=e=>{a(e.message),t(!0)},r={display:"inline-block",width:"24px",height:"24px",backgroundColor:"#4caf50",borderRadius:"50%",color:"white",textAlign:"center",lineHeight:"24px",fontWeight:"bold",marginRight:"10px"},c={backgroundColor:"#f9f9f9",padding:"20px",borderRadius:"5px",marginBottom:"20px"},d={padding:"10px 15px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},h=l(n({},d),{backgroundColor:"#4caf50"});return u.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px",fontFamily:"Arial, sans-serif"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px",borderBottom:"1px solid #eee",paddingBottom:"10px"},children:[u.jsx("span",{style:r,children:"✓"}),u.jsx("h1",{children:"MyInfo Error Handling Test"})]}),u.jsxs("div",{style:c,children:[u.jsxs("h2",{children:["Requirement ",u.jsx("span",{style:r,children:"✓"})]}),u.jsx("p",{style:{fontWeight:"bold"},children:"In the event of a MyInfo error, users can continue filling out the form by manually entering their personal details."}),u.jsx("p",{children:"This page allows you to test and take screenshots of the error handling implementation that satisfies this requirement."})]}),u.jsxs("div",{style:c,children:[u.jsx("h2",{children:"Test Error Scenarios"}),u.jsx("p",{children:"Click a button below to show the corresponding error popup:"}),u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"20px"},children:o.map(e=>u.jsx("button",{style:d,onClick:()=>i(e),children:e.label},e.type))}),u.jsx("div",{style:{marginTop:"20px"},children:u.jsx("button",{style:h,onClick:()=>i(o[0]),children:"Show Default Error Popup"})})]}),u.jsx($,{isOpen:e,type:"myinfo-error",message:s,closePopup:()=>{t(!1)},onProceedManually:()=>{console.log("User chose to proceed manually"),t(!1)}})]})};class Ee extends p.Component{render(){const e=this.props,{component:t}=e,s=c(e,["component"]),{isAuthenticated:a}=this.context;return u.jsx(C,l(n({},s),{render:e=>a?u.jsx(t,n({},e)):u.jsx(w,{to:"/"})}))}}d(Ee,"contextType",U);class Fe extends p.Component{constructor(){super(...arguments),d(this,"componentDidMount",()=>h(this,null,function*(){console.log("ok"),setTimeout(()=>{this.props.history.push({pathname:"/"})},1e4)}))}render(){return u.jsx("div",{className:"errorpage-container",children:u.jsxs("div",{className:"errorpage-content",children:[u.jsx("h1",{className:"errorpage-title",children:"404 - Page Not Found"}),u.jsx("p",{className:"errorpage-message",children:"Sorry, the page you are looking for does not exist."}),"We will redirect you back to the login page."]})})}}new O(te).initialize().then(()=>{console.log("✅ MSAL initialized successfully")}).catch(e=>{console.error("❌ MSAL initialization failed:",e)});class Oe extends p.Component{render(){return u.jsx(B,{children:u.jsx(b,{children:u.jsxs(v,{children:[u.jsx(C,{exact:!0,path:"/",component:z}),u.jsx(Ee,{path:"/home",component:he}),u.jsx(C,{path:"/form",component:Se}),u.jsx(C,{path:"/new",component:W}),u.jsx(C,{path:"/mass",component:Ne}),u.jsx(C,{path:"/coursesSelection",component:Te}),u.jsx(C,{exact:!0,path:"/singpass",component:Ie}),u.jsx(C,{path:"/callback",component:Me}),u.jsx(C,{path:"/myinfo-results",component:ke}),u.jsx(C,{path:"/myinfo-error-test",component:Le}),u.jsx(C,{component:Fe})]})})})}}S.createRoot(document.getElementById("root")).render(u.jsx(g.StrictMode,{children:u.jsx(N,l(n({},{authority:"https://id.singpass.gov.sg",client_id:"ZrjDybXZeOFUA70KYMwb1dnfmdEXFfAS",redirect_uri:"https://salmon-wave-09f02b100.6.azurestaticapps.net/callback",response_type:"code",scope:"openid",automaticSilentRenew:!1,loadUserInfo:!1,response_mode:"query",prompt:"login",acr_values:"2",nonce:!0,state:!0,monitorSession:!1,checkSessionInterval:0,revokeAccessTokenOnSignout:!1,includeIdTokenInSilentRenew:!1}),{children:u.jsx(Oe,{})}))}));
