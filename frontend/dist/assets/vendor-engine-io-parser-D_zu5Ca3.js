const e=Object.create(null);e.open="0",e.close="1",e.ping="2",e.pong="3",e.message="4",e.upgrade="5",e.noop="6";const t=Object.create(null);Object.keys(e).forEach(n=>{t[e[n]]=n});const n={type:"error",data:"parser error"},r="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"==={}.toString.call(Blob),a="function"==typeof ArrayBuffer,f=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,o=({type:t,data:n},o,i)=>r&&n instanceof Blob?o?i(n):s(n,i):a&&(n instanceof ArrayBuffer||f(n))?o?i(n):s(new Blob([n]),i):i(e[t]+(n||"")),s=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function i(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let c;const u="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let C=0;C<64;C++)u["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(C)]=C;const l="function"==typeof ArrayBuffer,y=(e,r)=>{if("string"!=typeof e)return{type:"message",data:d(e,r)};const a=e.charAt(0);return"b"===a?{type:"message",data:b(e.substring(1),r)}:t[a]?e.length>1?{type:t[a],data:e.substring(1)}:{type:t[a]}:n},b=(e,t)=>{if(l){const n=(e=>{let t,n,r,a,f,o=.75*e.length,s=e.length,i=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),l=new Uint8Array(c);for(t=0;t<s;t+=4)n=u[e.charCodeAt(t)],r=u[e.charCodeAt(t+1)],a=u[e.charCodeAt(t+2)],f=u[e.charCodeAt(t+3)],l[i++]=n<<2|r>>4,l[i++]=(15&r)<<4|a>>2,l[i++]=(3&a)<<6|63&f;return c})(e);return d(n,t)}return{base64:!0,data:e}},d=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,g=String.fromCharCode(30),h=(e,t)=>{const n=e.length,r=new Array(n);let a=0;e.forEach((e,f)=>{o(e,!1,e=>{r[f]=e,++a===n&&t(r.join(g))})})},w=(e,t)=>{const n=e.split(g),r=[];for(let a=0;a<n.length;a++){const e=y(n[a],t);if(r.push(e),"error"===e.type)break}return r};function p(){return new TransformStream({transform(e,t){!function(e,t){r&&e.data instanceof Blob?e.data.arrayBuffer().then(i).then(t):a&&(e.data instanceof ArrayBuffer||f(e.data))?t(i(e.data)):o(e,!1,e=>{c||(c=new TextEncoder),t(c.encode(e))})}(e,n=>{const r=n.length;let a;if(r<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,r);else if(r<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(n)})}})}let A;function B(e){return e.reduce((e,t)=>e+t.length,0)}function U(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function m(e,t){A||(A=new TextDecoder);const r=[];let a=0,f=-1,o=!1;return new TransformStream({transform(s,i){for(r.push(s);;){if(0===a){if(B(r)<1)break;const e=U(r,1);o=!(128&~e[0]),f=127&e[0],a=f<126?3:126===f?1:2}else if(1===a){if(B(r)<2)break;const e=U(r,2);f=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),a=3}else if(2===a){if(B(r)<8)break;const e=U(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),o=t.getUint32(0);if(o>Math.pow(2,21)-1){i.enqueue(n);break}f=o*Math.pow(2,32)+t.getUint32(4),a=3}else{if(B(r)<f)break;const e=U(r,f);i.enqueue(y(o?e:A.decode(e),t)),a=0}if(0===f||f>e){i.enqueue(n);break}}}})}const k=4;export{w as a,o as b,m as c,y as d,h as e,p as f,k as p};
