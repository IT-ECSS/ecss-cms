var e=Object.defineProperty,r=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a={}.hasOwnProperty,s={}.propertyIsEnumerable,i=(r,n,t)=>n in r?e(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t,o=(e,r)=>{for(var n in r||(r={}))a.call(r,n)&&i(e,n,r[n]);if(t)for(var n of t(r))s.call(r,n)&&i(e,n,r[n]);return e},l=(e,t)=>r(e,n(t)),c=(e,r,n)=>new Promise((t,a)=>{var s=e=>{try{o(n.next(e))}catch(r){a(r)}},i=e=>{try{o(n.throw(e))}catch(r){a(r)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,i);o((n=n.apply(e,r)).next())});import{R as u}from"./react-core-tM5X_WPO.js";import{U as d}from"./vendor-oidc-client-ts-C-sCSuQ3.js";var g=u.createContext(void 0);g.displayName="AuthContext";var v={isLoading:!0,isAuthenticated:!1},m=(e,r)=>{switch(r.type){case"INITIALISED":case"USER_LOADED":return l(o({},e),{user:r.user,isLoading:!1,isAuthenticated:!!r.user&&!r.user.expired,error:void 0});case"USER_SIGNED_OUT":case"USER_UNLOADED":return l(o({},e),{user:void 0,isAuthenticated:!1});case"NAVIGATOR_INIT":return l(o({},e),{isLoading:!0,activeNavigator:r.method});case"NAVIGATOR_CLOSE":return l(o({},e),{isLoading:!1,activeNavigator:void 0});case"ERROR":{const n=r.error;return n.toString=()=>`${n.name}: ${n.message}`,l(o({},e),{isLoading:!1,error:n})}default:{const n=new TypeError(`unknown type ${r.type}`),t={name:n.name,message:n.message,innerError:n,stack:n.stack,source:"unknown",toString:()=>`${t.name}: ${t.message}`};return l(o({},e),{isLoading:!1,error:t})}}},p=R("signinCallback","Sign-in failed"),f=R("signoutCallback","Sign-out failed"),S=R("renewSilent","Renew silent failed");function y(e,r){return{name:E(e,"name",()=>"Error"),message:E(e,"message",()=>r),stack:E(e,"stack",()=>(new Error).stack),innerError:e}}function R(e,r){return n=>l(o({},y(n,r)),{source:e})}function E(e,r,n){if(e&&"object"==typeof e){const n=e[r];if("string"==typeof n)return n}return n()}var O=["clearStaleState","querySessionStatus","revokeTokens","startSilentRenew","stopSilentRenew"],w=["signinPopup","signinSilent","signinRedirect","signinResourceOwnerCredentials","signoutPopup","signoutRedirect","signoutSilent"],h=e=>()=>{throw new Error(`UserManager#${e} was called from an unsupported context. If this is a server-rendered page, defer this call with useEffect() or pass a custom UserManager implementation.`)},U="undefined"==typeof window?null:d,b=e=>{const r=e,{children:n,onSigninCallback:i,skipSigninCallback:d,matchSignoutCallback:R,onSignoutCallback:E,onRemoveUser:b,userManager:k=null}=r,I=((e,r)=>{var n={};for(var i in e)a.call(e,i)&&r.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&t)for(var i of t(e))r.indexOf(i)<0&&s.call(e,i)&&(n[i]=e[i]);return n})(r,["children","onSigninCallback","skipSigninCallback","matchSignoutCallback","onSignoutCallback","onRemoveUser","userManager"]),[A]=u.useState(()=>null!=k?k:U?new U(I):{settings:I}),[C,L]=u.useReducer(m,v),N=u.useMemo(()=>Object.assign({settings:A.settings,events:A.events},Object.fromEntries(O.map(e=>{var r,n;return[e,null!=(n=null==(r=A[e])?void 0:r.bind(A))?n:h(e)]})),Object.fromEntries(w.map(e=>[e,A[e]?r=>c(void 0,null,function*(){L({type:"NAVIGATOR_INIT",method:e});try{return yield A[e](r)}catch(n){return L({type:"ERROR",error:l(o({},y(n,`Unknown error while executing ${e}(...).`)),{source:e,args:r})}),null}finally{L({type:"NAVIGATOR_CLOSE"})}}):h(e)]))),[A]),D=u.useRef(!1);u.useEffect(()=>{A&&!D.current&&(D.current=!0,c(void 0,null,function*(){try{let e=null;((e=window.location)=>{let r=new URLSearchParams(e.search);return!!((r.get("code")||r.get("error"))&&r.get("state")||(r=new URLSearchParams(e.hash.replace("#","?")),(r.get("code")||r.get("error"))&&r.get("state")))})()&&!d&&(e=yield A.signinCallback(),i&&(yield i(e))),e=e||(yield A.getUser()),L({type:"INITIALISED",user:e})}catch(e){L({type:"ERROR",error:p(e)})}try{if(R&&R(A.settings)){const e=yield A.signoutCallback();E&&(yield E(e))}}catch(e){L({type:"ERROR",error:f(e)})}}))},[A,d,i,E,R]),u.useEffect(()=>{if(!A)return;const e=e=>{L({type:"USER_LOADED",user:e})};A.events.addUserLoaded(e);const r=()=>{L({type:"USER_UNLOADED"})};A.events.addUserUnloaded(r);const n=()=>{L({type:"USER_SIGNED_OUT"})};A.events.addUserSignedOut(n);const t=e=>{L({type:"ERROR",error:S(e)})};return A.events.addSilentRenewError(t),()=>{A.events.removeUserLoaded(e),A.events.removeUserUnloaded(r),A.events.removeUserSignedOut(n),A.events.removeSilentRenewError(t)}},[A]);const P=u.useCallback(()=>c(void 0,null,function*(){yield A.removeUser(),b&&(yield b())}),[A,b]),T=u.useMemo(()=>l(o(o({},C),N),{removeUser:P}),[C,N,P]);return u.createElement(g.Provider,{value:T},n)};export{b as A};
